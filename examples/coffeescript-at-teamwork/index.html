<!DOCTYPE html><html><title>Adam Lynch</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Adam Lynch"><meta name="author" content="Adam Lynch"><link rel="stylesheet" href="styles/index.css"><body><div class="wrapper"><p>This example is taken from a post (<a href="http://engineroom.teamwork.com/coffeescript">CoffeeScript at Teamwork</a>) which I wrote for Teamwork&#39;s <a href="http://engineroom.teamwork.com">Engine Room</a>.</p><hr><p>The first project at Teamwork to use <a href="/content/images/2014/Sep/Capture.JPG">CoffeeScript</a> was the <a href="https://www.teamwork.com/ipad">Teamwork.com iPad app</a>. <em>Fast forward two years</em>. We now have web, mobile and even desktop apps built with CoffeeScript. If you need a primer, there&#39;s no better place than <a href="http://coffeescript.org/">coffeescript.org</a> where you can learn by example.</p><h2 id="why-bother-">Why bother?</h2><pre><code class="lang-coffeescript">@customer = customer
    @cart = cart

    $(&#39;.shopping_cart&#39;).bind &#39;click&#39;, (event) =&gt;
        @customer.purchase @cart
</code></pre><p>After a glance at the above snippet, it would fair to think of it as just JavaScript with a few superficial changes. There&#39;s more to it than that.</p><blockquote><p>&quot;CoffeeScript&quot; isn&#39;t a new programming language, it&#39;s a set of abbreviations for writing JavaScript using a standard set of Design Patterns. The generated JavaScript isn&#39;t hyper-optimized spaghetti, it&#39;s JavaScript, The Good Parts.</p><p>--- <em>Reginald Braithwaite, <a href="https://github.com/raganwald-deprecated/homoiconic/blob/master/2011/12/jargon.md">CoffeeScript is not a language worth learning</a></em></p></blockquote><p>Sure, it provides nice ways of doing some handy things (e.g. multiline strings, interpolation, function binding, classes and more), but the point here is that it subtly makes it difficult to use certain patterns deemed unwise. This is the real value of CoffeeScript.</p><h2 id="gotchas">Gotchas</h2><p>A few noteworthy things have caught us out along the way;</p><ul><li>Implicit returns. The last statement in a function is always converted to a <code>return</code> statement. This isn&#39;t a problem most of the time, but it can be. See this <a href="https://github.com/hparra/gulp-rename/pull/24">pull-request</a> I created for the <a href="https://github.com/hparra/gulp-rename">gulp-rename</a> plugin for a real world example.</li><li><code>x = y -1</code> will effectively be converted to <code>x = y(-1);</code> unless you put a space after the minus symbol.</li><li>Ternary / conditional operators are just written as inline if statements; e.g. <code>w = if x then y else z</code>. If you wrote <code>w = x ? y : z</code>, then it might take a minute to realise that the result of the compilation is actually <code>w = typeof x !== &quot;undefined&quot; &amp;&amp; x !== null ? x : { y: z };</code>.</li><li>Any properties of a class defined (and given a value) outside the constructor will be static, i.e. the value will be shared / kept in sync with any classes extending this class. The property can be defined outside of the constructor, but if so, needs to initialized with <code>null</code> and the actual value set in the constructor.</li><li>The expression <code>&#39;a&#39; isnt &#39;b&#39;</code> is compiled to <code>&#39;a&#39; !== &#39;b&#39;;</code> (which evaluates to <code>true</code>), but <code>&#39;a&#39; is not &#39;b&#39;</code> is compiled to <code>&#39;a&#39; === !&#39;b&#39;;</code> (which is <code>false</code>).</li><li>There is no such thing as a private method in CoffeeScript. You might read online that using an equals symbol instead of a colon (i.e. <code>doSomething = -&gt;</code>) will do it, but no. This is actually just a function defined within the scope of the class (function) but is not bound with the correct value of <code>this</code>. So from within this function, an instance method of the class is not accessible (i.e. it would be &#39;private&#39; but you couldn&#39;t call <code>@differentStandardMethod</code> from it).</li></ul><h2 id="coding-style">Coding style</h2><p>Obligatory quote:</p><blockquote><p>Programs are meant to be read by humans and only incidentally for computers to execute.</p><p>--- <em>H. Abelson and G. Sussman (in &quot;Structure and Interpretation of Computer Programs&quot;)</em></p></blockquote><p>Consistency and readability are important factors in overall code quality. CoffeeScript already helps in this respect as there is a &quot;CoffeeScript way&quot; to write a lot of things. Also, most JavaScript style guides are dominated by rules for curly braces, which isn&#39;t really a problem anymore as they would be few and far between.</p><p>We use <a href="http://coffeelint.org">CoffeeLint</a> to enforce the remainder. It comes with configurable preset rules (e.g. indentation) and the ability to add custom ones. Our rules (which are completely up for debate with the company) are published to npm as <a href="https://www.npmjs.org/package/teamwork-coffeelint-rules">teamwork-coffeelint-rules</a> which allows any project to easily install them as a dependency.</p><p><a href="http://gulpjs.com">Gulp</a>, our build system of choice, is built around Node streams. This means we can easily have a <em>pipeline</em> where we grab our CoffeeScript files, pass them through <a href="https://github.com/janraasch/gulp-coffeelint">gulp-coffeelint</a>, then <a href="https://github.com/adam-lynch/gulp-coffeelint-threshold">gulp-coffeelint-threshold</a> (which I created to give us more granular control over the error reporting) before actually compiling them and putting the result somewhere. So if your code doesn&#39;t pass the code style check, an error is thrown and the application isn&#39;t even built. This way, it&#39;s a lot less likely that non-compliant code ends up under version control / in the application. It&#39;s easy to also have this linting as a separate standalone task.</p><h3 id="editorconfig">EditorConfig</h3><p>Enforcing a code style is great, but now developers would have to configure their IDEs and text-editors to follow some of the same rules, otherwise things would become very tedious as they would get an error every time they change a file. A developer ideally shouldn&#39;t have to manually change their settings per project after cloning it; the quicker we get to writing code, the better. So that&#39;s where <a href="http://editorconfig.org">EditorConfig</a> comes in.</p><p>To use EditorConfig, you need to install your editor&#39;s <a href="http://editorconfig.org/#download">EditorConfig plugin</a> and add a <code>.editorconfig</code> file to your project containing, for example, the following:</p><pre><code># top-most EditorConfig file
    root = true

    [*]
    charset = &quot;utf8&quot;

    [*.coffee]
    indent_style = space
    indent_size = 4
    trim_trailing_whitespace = true
</code></pre><p>Let&#39;s say your editor is set up to use tabs by default instead of spaces. Now if you press tab, your editor will input four spaces. I think it&#39;s not worth talking about tabs vs. spaces anymore once you use EditorConfig. <em>Sidestepping a religious debate</em>. So now a developer could clone multiple projects with different code styles and easily switch between them without any worry or configuration. Also, it&#39;s great that a project&#39;s code style is documented and configured <em>in</em> the project (and under version control).</p><h2 id="documentation">Documentation</h2><p>Speaking of editors, Github recently released <a href="https://atom.io/">Atom</a>, their open-source text-editor built with CoffeeScript. I had a quick look through the source code and quickly noticed <a href="https://github.com/gjtorikian/biscotto">Biscotto</a>, a CoffeeScript documentation generator. To use Biscotto, you need to follow some nice comment conventions (which support Markdown); for example:</p><pre><code class="lang-coffeescript">    # Does something to something
    # options - {Object}
    #         :x - {Number}
    #         :y - {Number}
    #         :anotherOption - {Something}
    # element - {HTMLElement}
    # isReady - Optional {Boolean}, defaults to `true`
    # Returns a {Number}
    doSomething: (options, element, isReady = true) -&gt;
        return 0
</code></pre><p>Then Biscotto can generate a nice <a href="http://gjtorikian.github.io/biscotto/">HTML documentation site</a> from that, even linking the <code>element</code> argument to the relevant <a href="https://developer.mozilla.org">Mozilla Developer Network</a> entry and <code>option.anotherOption</code> to the generated page for the <code>Something</code> class.</p><p><img src="/content/images/2014/Sep/Capture.JPG" alt="Example documentation site"></p><p>There was no Gulp plugin at the time for Biscotto, so I created <a href="https://github.com/adam-lynch/gulp-biscotto">gulp-biscotto</a>.</p><p>As you might expect, our code hasn&#39;t got as many Biscotto comments as we&#39;d like, so we&#39;re probably going to create another Gulp plugin which will check your CoffeeScript files for a minimum amount of documentation. This would most likely only be a friendly warning and or belong to a standalone lint task that we&#39;d run every once in awhile.</p><p>Also, we&#39;re planning to <a href="https://github.com/gjtorikian/biscotto/issues/57">write a Markdown generator for Biscotto</a> so project documentation (i.e. <code>README.md</code>) can be generated from the comments.</p><h2 id="going-forward">Going forward</h2><p>CoffeeScript will be used over vanilla JavaScript for future projects, although we&#39;ve yet to find a nice way of using CoffeeScript in <a href="http://knockoutjs.com/">Knockout</a> templates. We&#39;ve also discussed using CoffeeScript with types (like a blend of CoffeeScript and <a href="http://www.typescriptlang.org/">TypeScript</a>), but the jury is still out on that.</p><p>If you have any CoffeeScript tips of your own that I&#39;ve missed here, please feel free to share them in the comments below.</p></div></body></html>