<!DOCTYPE html>
<html data-n-head="" data-n-head-ssr>
  <head>
    <meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="#ffffff" theme-color="theme-color"><meta data-n-head="true" content="You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…
" name="description" data-hid="description"><meta data-n-head="true" content="NW.js, node-webkit, npm, distribution, paths, windows, development" name="keywords" data-hid="keywords"><meta data-n-head="true" content="summary" name="twitter:card" data-hid="twitter:card"><meta data-n-head="true" content="Dealing with long paths" name="twitter:title" data-hid="twitter:title"><meta data-n-head="true" content="You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…
" name="twitter:description" data-hid="twitter:description"><meta data-n-head="true" content="/images/blog-content/dealing-with-long-paths/helping-hand.gif" name="twitter:image"><meta data-n-head="true" content="/dealing-with-long-paths" name="twitter:url" data-hid="twitter:url"><meta data-n-head="true" content="article" name="og:type" data-hid="og:type"><meta data-n-head="true" content="Dealing with long paths" name="og:title" data-hid="og:title"><meta data-n-head="true" content="You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…
" name="og:description" data-hid="og:description"><meta data-n-head="true" content="/images/blog-content/dealing-with-long-paths/helping-hand.gif" name="og:image" data-hid="og:image"><meta data-n-head="true" content="/dealing-with-long-paths" name="og:url" data-hid="og:url"><title data-n-head="true">Dealing with long paths</title><link href="/apple-touch-icon.png" rel="apple-touch-icon" data-n-head="true" sizes="76x76"><link href="/favicon-32x32.png" rel="icon" data-n-head="true" sizes="32x32" type="image/x-icon"><link href="/favicon-16x16.png" rel="icon" data-n-head="true" sizes="16x16" type="image/png"><link href="/safari-pinned-tab.svg" rel="mask-icon" data-n-head="true" color="#53687a"><link href="//unpkg.com/prismjs/themes/prism.css" rel="stylesheet" data-n-head="true"><link href="/_nuxt/manifest.2d9a9011fe1c2094eaa3.js" rel="preload" as="script"><link href="/_nuxt/vendor.ce05078a33ab89125ee8.js" rel="preload" as="script"><link href="/_nuxt/app.47e50bb931a38adb894d.js" rel="preload" as="script"><link href="/_nuxt/layouts/default.8ce3dde6452dcf1cfcac.js" rel="preload" as="script"><link href="/_nuxt/1.6c5ddda757f906a1b66c.js" rel="preload" as="script"><link href="/_nuxt/pages/index.5bad6aa85a4e69648400.js" rel="prefetch"><style data-vue-ssr-id="6dd13fd5:0">*{-webkit-box-sizing:border-box;box-sizing:border-box}body,html{margin:0;padding:0}ol,ul{list-style:none;padding-left:0;margin:0}a{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;text-decoration:none;color:inherit}body{font-family:Arial,sans-serif;line-height:1.55;letter-spacing:-.25px;-webkit-font-smoothing:antialiased}.wf-active body{font-family:Lato,Arial,sans-serif}html{font-size:14px}@media (min-width:470px){html{font-size:16px}}body{background:#ececec;color:#333;padding-top:28px;padding-top:2rem}.wrapper{max-width:840px;max-width:60rem;margin:0 auto}.header{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0 28px;padding:0 2rem;background:#ececec}@media (min-width:59rem){.header{-ms-flex-wrap:nowrap;flex-wrap:nowrap}}.site-title{margin:0;text-align:center;-webkit-transition:opacity .25s ease-in;transition:opacity .25s ease-in;min-width:100%;max-width:84px;max-width:6rem}@media (min-width:42rem){.site-title{min-width:0;-webkit-box-flex:1;-ms-flex:1;flex:1}}@media (min-width:59rem){.site-title{-webkit-box-flex:initial;-ms-flex:initial;flex:initial}}.site-title:hover{opacity:.9}.site-link{display:inline-block;background:url(/_nuxt/img/Logo.542e06c.png) 0 no-repeat;background-size:5.99rem;height:126px;height:9rem;width:84px;width:6rem;margin:0 auto;text-indent:-9999px}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.site-link{background-image:url(/_nuxt/img/Logo@2x.b121531.png)}}.site-happy-text-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;margin:0 auto;padding:0;width:100%;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:18.2px;font-size:1.3rem}@media (min-width:42rem){.site-happy-text-wrapper{-webkit-box-flex:2;-ms-flex:2;flex:2;padding:0 0 0 2rem}}@media (min-width:59rem){.site-happy-text-wrapper{-webkit-box-flex:1;-ms-flex:1;flex:1;font-size:1.2rem}}@media (min-width:61rem){.site-happy-text-wrapper{font-size:1.3rem}}.site-happy-text{-webkit-box-flex:1;-ms-flex:1;flex:1;margin:0;text-align:center}@media (min-width:42rem){.site-happy-text{text-align:left}}.site-happy-text-headline{display:block}.site-happy-text-headline,.wf-active .site-happy-text-headline{font-size:26.599px;font-size:1.9rem;font-weight:700}@media (min-width:25rem){.site-happy-text-headline{font-size:2.3rem;line-height:1.7}.wf-active .site-happy-text-headline{line-height:1.5;font-size:2.5rem}}@media (min-width:59rem){.site-happy-text-headline{font-size:2.9rem}.wf-active .site-happy-text-headline{font-size:3.1rem}}@media (min-width:61rem){.site-happy-text-headline{font-size:2.92rem;line-height:1.7}.wf-active .site-happy-text-headline{line-height:1.5;font-size:3.2rem}}.site-happy-text-tagline{display:inline}@media (min-width:42rem){.site-happy-text-tagline{display:block}}.navigation-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;padding:28px 0 0;padding:2rem 0 0;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}@media (min-width:59rem){.navigation-wrapper{max-width:23rem;padding:0 0 0 2rem}}.navigation{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;min-width:100%;width:100%}@media (min-width:59rem){.navigation{-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-width:0}}.navigation-item{-webkit-box-flex:1;-ms-flex:1 1 33%;flex:1 1 33%;min-width:33%;display:-webkit-box;display:-ms-flexbox;display:flex;position:relative;cursor:pointer;font-size:11.9px;font-size:.85rem;font-weight:200;-webkit-transition:background-color .25s;transition:background-color .25s}@media (min-width:25rem){.navigation-item{font-size:.9rem}}@media (min-width:45rem){.navigation-item{min-width:0;-webkit-box-flex:1;-ms-flex:1;flex:1}}@media (min-width:59rem){.navigation-item{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;min-width:33%}}.navigation-item:first-child{background:#e2e2e2}.navigation-item:first-child:hover{background:#ddd}.navigation-item:nth-child(2){background:#e8e8e8}.navigation-item:nth-child(2):hover{background:#e3e3e3}.navigation-item:nth-child(3){background:#efefef}.navigation-item:nth-child(3):hover{background:#eaeaea}.navigation-item:nth-child(4){background:#ddd}.navigation-item:nth-child(4):hover{background:#d8d8d8}.navigation-item:nth-child(5){background:#e3e3e3}.navigation-item:nth-child(5):hover{background:#dedede}.navigation-item:nth-child(6){background:#eaeaea}.navigation-item:nth-child(6):hover{background:#e4e4e4}.navigation-link{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:14px;padding:1rem;text-decoration:none;font-size:12.6px;font-size:.9rem;color:#000;-webkit-transition:color .25s;transition:color .25s}@media (min-width:25rem){.navigation-link{padding:1.4rem}}.navigation-link:after{content:"";position:absolute;top:100%;left:0;bottom:0;right:0;height:0;width:100%;background:#fff;opacity:.1;cursor:pointer;-webkit-transition:all .2s ease-out;transition:all .2s ease-out}.navigation-link:hover:after{top:50%;height:50%}.navigation-item-text{-webkit-box-flex:1;-ms-flex:1;flex:1}.posts{padding:28px;padding:2rem}.post-wrapper{padding-bottom:28px;padding-bottom:2rem}.post-wrapper:last-child{padding-bottom:0}.post{padding:28px;padding:2rem;margin:28px;margin:2rem;background:#fff;max-width:840px;max-width:60rem;overflow:hidden;position:relative}.post:before{background:linear-gradient(180deg,hsla(0,0%,100%,0) 0,#fff 1500px);-webkit-animation:fadein 1s ease-in;animation:fadein 1s ease-in}.post:after,.post:before{content:" ";position:absolute;top:0;left:50%;bottom:0;width:100vw;-webkit-transform:translateX(-50%);transform:translateX(-50%);z-index:-1}.post:after{background:linear-gradient(0deg,#ececec 0,hsla(0,0%,100%,0) 1000px)}.posts .post{margin:0 auto}.posts .post:after,.posts .post:before{content:none}.posts .post:before{-webkit-animation:none;animation:none}.post>:first-child{margin-top:0}.post-content{font-size:15.4px;font-size:1.1rem;line-height:1.55}.post-content>*{margin:21px 0 0;margin:1.5rem 0 0}.post-content :not(figure)>a{color:#4580a7;padding-bottom:.7px;padding-bottom:.05rem;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(104,130,197,.4)),to(rgba(104,130,197,.4)));background-image:linear-gradient(rgba(104,130,197,.4),rgba(104,130,197,.4));background-repeat:no-repeat;background-size:100% 1.5px;background-position:center bottom 10%;background-origin:padding-box;text-shadow:3px 0 #fff,2px 0 #fff,1px 0 #fff,-1px 0 #fff,-2px 0 #fff,-3px 0 #fff;-webkit-transition:color .25s;transition:color .25s}.post-content :not(figure)>a:hover{color:#6882c5}.post-content blockquote{position:relative;font-size:18.2px;font-size:1.3rem;font-size:21.98px;font-size:1.57rem;font-style:italic;font-weight:100;padding-left:28px;padding-left:2rem;line-height:1.48;margin-top:28px;margin-top:2rem}.post-content blockquote:before{content:"\201C";position:absolute;top:-21px;top:-1.5rem;left:-7px;left:-.5rem;height:42px;height:3rem;width:25px;color:#f5f5f5;font-size:84px;font-size:6rem;font-style:normal;line-height:1}.post-content blockquote footer{margin-top:14px;margin-top:1rem;font-size:12.6px;font-size:.9rem;text-align:right}.post-content blockquote cite{display:inline-block;margin-left:7px;margin-left:.5rem}.post-content figure{text-align:center}.post-content figcaption{color:#666;font-size:12.6px;font-size:.9rem;font-style:italic}.post-content img{display:block;max-width:100%;height:auto;margin:0 auto;min-height:50px;min-width:150px;position:relative;color:#b6b6b6;font-size:12.6px;font-size:.9rem;text-align:center}.post-content img:before{content:"Image failed to load :/";display:block;font-size:13.299px;font-size:.95rem}.post-content code,.post-content pre{font-family:Consolas,Monaco,Andale Mono,monospace;text-shadow:0 1px #fff;white-space:pre;word-spacing:normal;word-break:normal;-webkit-font-feature-settings:none;font-feature-settings:none;-webkit-font-variant-ligatures:none;font-variant-ligatures:none;word-wrap:normal;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.post-content :not(h3):not(h4):not(h5):not(h6)>code,.post-content pre{font-size:11.9px;font-size:.85rem}.post-content :not(pre)>code,.post-content pre{background:#f5f5f5}.post-content pre{padding:14px;padding:1rem;overflow:auto;color:#000}.post-content :not(pre)>code{display:inline-block;padding:0 3.815px;padding:0 .2725rem;white-space:normal}.post-content a code{background:transparent none repeat 0 0/auto auto padding-box border-box scroll;background:initial;font-size:13.719px;font-size:.98rem;padding:0;padding:initial}.post-content p:first-child{margin-top:0}.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{position:relative}.post-content h3{font-size:22.75px;font-size:1.625rem}.post-content h4{font-size:19.446px;font-size:1.389rem}.post-content h5{font-size:16.142px;font-size:1.153rem}.post-content h6{font-size:13.034px;font-size:.931rem}.post-content .post-header-anchor{position:absolute;left:-28px;left:-2rem;top:20px;width:28px;width:2rem;-webkit-transform:translateY(-50%);transform:translateY(-50%);background:0 0;text-align:center;line-height:1;text-shadow:none;-webkit-transition:opacity .25s ease-in-out;transition:opacity .25s ease-in-out}.post-content .post-header-anchor:focus{outline:0}.post-content .post-header-anchor:hover svg{opacity:1}.post-content .post-header-anchor:after{content:" copied";position:absolute;bottom:-14px;left:0;right:0;font-size:.6em;color:gray;opacity:0;visibility:none;-webkit-transition:opacity 2s;transition:opacity 2s}.post-content .post-header-anchor svg{opacity:.2}.post-content h4 .post-header-anchor{top:18px}.post-content h5 .post-header-anchor{top:16px}.post-content h6 .post-header-anchor{top:14px}.post-content .post-header-anchor--copied:after{opacity:1}.post-content p:last-of-type{margin-bottom:0}.post-content h3,.post-content h4,.post-content h5,.post-content h6{position:relative}.post-content h3+p,.post-content h4+p,.post-content h5+p,.post-content h6+p{margin-top:7px;margin-top:.5rem}.post-content p+h3,.post-content p+h4,.post-content p+h5,.post-content p+h6{margin-top:28px;margin-top:2rem}.post-content ol,.post-content ul{padding-left:1.25em;list-style:disc outside none;list-style:initial}.post-content ol{list-style-type:decimal}.post-content li{margin-bottom:7px;margin-bottom:.5rem}.post-summary .post-content,.post-summary .post-content>*{display:inline}.post-content table{border-spacing:0;border-collapse:collapse}.post-content td,.post-content th{padding:0;padding:6px 13px;border:1px solid #dfe2e5}.post-content th{font-weight:600;text-align:left}.post-title-wrapper{margin:0}.post-title{line-height:1.4;font-size:19.599px;font-size:1.4rem;font-weight:700}.wf-active .post-title{font-size:21px;font-size:1.5rem;line-height:1.2}@media (min-width:30rem){.post-title{line-height:1.6;font-size:1.85rem}.wf-active .post-title{line-height:1.5;font-size:2rem}}.post-title-label{display:inline-block;position:relative;bottom:.3em;padding:.2em .4em;margin-left:.3em;font-size:.5em;background:#e3e3e3;color:#9e9e9e;border-radius:5%;font-weight:400;-webkit-transition:opacity .25s ease-in;transition:opacity .25s ease-in}.post-title:hover .post-title-label{opacity:.9}.post-title-label-parenthesis{display:none}.post-meta{font-size:12.6px;font-size:.9rem;margin:14px 0;margin:1rem 0;color:#a2a2a2}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.post-meta{color:#000;font-weight:300}}.post-blog-date{display:block;margin-top:7px;margin-top:.5rem}@media (min-width:30rem){.post-blog-date{display:inline;margin-top:0}.post-blog-date+.post-blog-title:before{display:inline-block;content:" \2014   ";margin:0 .25rem 0 .5rem}}.post-blog-link{font-weight:400;font-style:italic}.footer-link,.post-blog-link,.post-read-more-link,.post-title,.site-happy-text-tagline-link{-webkit-transition:color .25s;transition:color .25s}.footer-link:hover,.post-blog-link:hover,.post-read-more-link:hover,.post-title:hover,.site-happy-text-tagline-link:hover{color:#6882c5;background:-webkit-gradient(linear,left top,right top,from(#5c7b8f),to(#6882c5));background:linear-gradient(90deg,#5c7b8f,#6882c5);background-clip:border-box;-webkit-background-clip:text;-webkit-text-fill-color:transparent;-webkit-box-decoration-break:clone;box-decoration-break:clone}.site-happy-text-headline-link{-webkit-transition:color .25s;transition:color .25s}.footer-link,.post-read-more-link,.post-title,.site-happy-text-headline-link:hover,.site-happy-text-tagline-link{color:#5c7b8f}.post-read-more-link{display:inline-block;font-weight:700;margin:0}.post-comments{margin:28px 28px 0;margin:2rem 2rem 0;padding:28px;padding:2rem;background:#fff}.post-comments a{color:#5c7b8f;padding-bottom:.7px;padding-bottom:.05rem;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(rgba(0,0,0,.2)));background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2));background-repeat:no-repeat;background-size:100% 1.5px;background-position:center bottom 10%;background-origin:padding-box;text-shadow:3px 0 #fff,2px 0 #fff,1px 0 #fff,-1px 0 #fff,-2px 0 #fff,-3px 0 #fff;-webkit-transition:color .25s;transition:color .25s}.post-comments a:hover{color:#6882c5}.footer{text-align:center;font-size:11.2px;font-size:.8rem;margin-bottom:28px;margin-bottom:2rem}.footer-text{margin:0}.footer-link{font-weight:700}.copyright{display:block;color:gray}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.copyright{font-weight:100}}.fix-bug-ignore{color:red}.posts{position:relative}.post-wrapper{-webkit-transition:padding .5s ease-in-out,-webkit-transform .3s ease-in-out;transition:padding .5s ease-in-out,-webkit-transform .3s ease-in-out;transition:padding .5s ease-in-out,transform .3s ease-in-out;transition:padding .5s ease-in-out,transform .3s ease-in-out,-webkit-transform .3s ease-in-out}.post{-webkit-transition:opacity .1s ease-in-out,-webkit-transform .1s ease-in-out;transition:opacity .1s ease-in-out,-webkit-transform .1s ease-in-out;transition:opacity .1s ease-in-out,transform .1s ease-in-out;transition:opacity .1s ease-in-out,transform .1s ease-in-out,-webkit-transform .1s ease-in-out}.posts--entering-post .post-wrapper:not(.post-wrapper--entering-from-posts) .post{opacity:.2;-webkit-transform:scale(.8);transform:scale(.8)}.posts--entering-post .post-wrapper--entering-from-posts{left:28px;left:2rem;right:28px;right:2rem}.post-skeleton{line-height:1.55;position:relative;opacity:0;max-height:0;overflow:hidden}.post-skeleton.post-skeleton--visible,.post-wrapper--entering-from-posts .post-skeleton{opacity:1;margin-top:28px;margin-top:2rem;max-height:none}.post-skeleton:after{content:" ";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;opacity:.2;-webkit-animation:1s skeleton infinite ease-in-out;animation:1s skeleton infinite ease-in-out}.post-skeleton-word{height:15.4px;height:1.1rem;background:#f7f7f7;width:46px;display:inline-block;margin:4px 6px 0 0}.post-skeleton-word:nth-child(2n){width:36px}.post-skeleton-word:nth-child(3n){width:76px}.post-skeleton+.post-skeleton .post-skeleton-word:nth-child(3n){width:71px}.post-skeleton-word:nth-child(5n){width:96px}.post-skeleton-word:nth-child(6n){width:63px}.post-skeleton-word:nth-child(7n){width:26px}@-webkit-keyframes skeleton{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}98%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}99%{-webkit-transform:translate3d(100%,100%,0);transform:translate3d(100%,100%,0)}to{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@keyframes skeleton{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}98%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}99%{-webkit-transform:translate3d(100%,100%,0);transform:translate3d(100%,100%,0)}to{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@-webkit-keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes fadein{0%{opacity:0}to{opacity:1}}</style><style data-vue-ssr-id="1629eadd:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}</style>
    <script src="https://unpkg.com/scrollto-with-animation/dist/scrollto-with-animation.min.js"></script>
  </head>
  <body data-n-head="">
    <div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#869bad;opacity:0"></div><div id="__layout"><div class="wrapper"><main class="content"><header class="header"><h1 class="site-title"><a href="/" class="site-link nuxt-link-active">Adam Lynch</a></h1><div class="site-happy-text-wrapper"><p class="site-happy-text"><span class="site-happy-text-headline">
                I'm <a href="/" class="site-happy-text-headline-link nuxt-link-active">Adam Lynch</a>.
            </span><span class="site-happy-text-tagline">
                I like to
                <a href="https://github.com/adam-lynch" class="site-happy-text-tagline-link">code</a>,
                <a href="/" class="site-happy-text-tagline-link nuxt-link-active">write</a>, and dabble in design.
            </span><span class="site-happy-text-tagline">
                I lead <a href="https://www.teamwork.com" class="site-happy-text-tagline-link">Teamwork.com</a>'s next product.
            </span></div><nav class="navigation-wrapper" role="navigation"><ul class="navigation"><li class="navigation-item writing-navigation-item"><a href="/" class="navigation-link nuxt-link-active"><span class="navigation-item-text">Writing</span></a><li class="navigation-item code-navigation-item"><a href="https://github.com/adam-lynch" class="navigation-link" rel="noopener"><span class="navigation-item-text">Code</span></a><li class="navigation-item edit-navigation-item"><a href="https://github.com/adam-lynch/adam-lynch.github.io" class="navigation-link" rel="noopener"><span class="navigation-item-text">Edit page</span></a><li class="navigation-item twitter-navigation-item"><a href="https://twitter.com/lynchy010/" class="navigation-link" rel="noopener"><span class="navigation-item-text">Twitter</span></a><li class="navigation-item email-navigation-item"><a href="mailto:contact@adamlynch.com" class="navigation-link" rel="noopener"><span class="navigation-item-text">Email</span></a><li class="navigation-item linkedin-navigation-item"><a href="https://www.linkedin.com/in/adamlynch010/" class="navigation-link" rel="noopener"><span class="navigation-item-text">LinkedIn</span></a></ul></nav></header><div><div><article class="post"><h2 class="post-title-wrapper"><a href="/dealing-with-long-paths" class="post-title nuxt-link-exact-active nuxt-link-active">Dealing with long paths</a></h2><div class="post-meta"><time class="post-blog-date">July 1st, 2015</time><div class="no-ssr-placeholder"></div></div><div class="post-content">
<p>You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a> to give you a helping hand with this.</p>
<p><img src="/images/blog-content/dealing-with-long-paths/helping-hand.gif" alt="A helping hand"></p>
<h4><a href="#npm" class="post-header-anchor" id="npm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm</h4>
<p>Neither this problem nor our solution is exclusive to <a href="https://nodejs.org/" rel="noopener">Node.js</a>, but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by <a href="https://www.npmjs.com/" rel="noopener">npm</a> package maintainers but even <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">the design of npm itself is a problem from the get-go</a>.</p>
<p>npm stores your dependencies (listed in your <code>package.json</code>) in a <code>node_modules</code> directory. If those dependencies have dependencies of their own, they're stored in their own <code>node_modules</code> directory (i.e. <code>your-project/node_modules/a/node_modules/b/</code>) and so on recursively. It's nice, but in hindsight, it's obviously incompatible with Windows's path length limit.</p>
<h4><a href="#delete-delete-delete" class="post-header-anchor" id="delete-delete-delete" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Delete delete delete</h4>
<p>Most people have probably been lucky enough to only have come across this problem when trying to delete dependencies and then Windows complains that the path is too long.</p>
<p>A simple way around this is to take a module halfway down deep into your dependency graph (i.e. <code>node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/</code>) in Windows Explorer and move it somewhere closer to the root (e.g. <code>node_modules/</code>) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.</p>
<p>There are also some tools which could help. I’ve noticed that you can delete really long paths while using <a href="http://www.7-zip.org/" rel="noopener">7-Zip</a> File Manager to browse files.</p>
<h4><a href="#runtime-errors" class="post-header-anchor" id="runtime-errors" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Runtime errors</h4>
<p>If you’ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level <code>node_modules</code> and not a <code>node_modules</code> directory <code>n</code> levels deep. Make sure to install the correct version and test thoroughly.</p>
<p>There are also a few Node modules out there which “flatten” your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So, be careful.</p>
<h4><a href="#cant-npm-fix-this" class="post-header-anchor" id="cant-npm-fix-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Can’t npm fix this?</h4>
<p><s>You might see people reference Windows APIs (which support long paths) as a possible fix but it is <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">very unlikely</a> this will be fixed in npm. <code>[npm dedupe](https://docs.npmjs.com/cli/dedupe)</code> <em>should</em> help with this too but it's not reliable in my experience.</s></p>
<p>This has been fixed as of <a href="https://github.com/npm/npm/releases/tag/v3.0.0" rel="noopener">npm 3.0.0</a>.</p>
<blockquote>
<p>Your dependencies will now be installed <em>maximally</em> flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project’s <code>node_modules</code> folder with no nesting. You'll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.</p>
</blockquote>
<p>Excuse me…</p>
<figure>
          <a href="/images/blog-content/dealing-with-long-paths/dance.gif"><img src="/images/blog-content/dealing-with-long-paths/dance.gif" alt=""></a>
          <figcaption><p>* Dances *</p>
</figcaption>
        </figure><h4><a href="#manually-checking-for-exceedingly-long-paths" class="post-header-anchor" id="manually-checking-for-exceedingly-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Manually checking for exceedingly long paths</h4>
<p>Up until now, we’ve had to routinely check for long paths using <a href="https://pathlengthchecker.codeplex.com/" rel="noopener">Path Length Checker</a> (on Windows) but a manual check is not good enough as stuff can still slip through the net.</p>
<h4><a href="#introducing-gulp-path-length" class="post-header-anchor" id="introducing-gulp-path-length" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing gulp-path-length</h4>
<p>So, we’ve created a simple <a href="http://gulpjs.com" rel="noopener">Gulp</a> plugin help with this; <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a>. You could use it like this in a Gulp task:</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-path-length'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./example/path/to/directory/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>If all is well, nothing will happen. If you have a path exceeding 256 characters, the Gulp task will stop and an error will reveal the offending path. This is really fast either way as Gulp doesn't need to read the contents of the files. The limit can be changed with a parameter; i.e. <code>.pipe(pathLength({ maxLength: 50 });</code>.</p>
<p>This is fine if it's just for you locally, but there are bigger fish to fry.</p>
<h3><a href="#distributed-long-paths" class="post-header-anchor" id="distributed-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Distributed long paths</h3>
<p>What if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It's one thing having issues locally or within a team, it's a whole other thing to have path length problems in production on end users' machines.</p>
<p>We've run into this with <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> for Windows as it's built on <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> (formerly node-webkit) and can contain long paths (i.e. dependencies from npm). Depending on how long the current user's username was, the user might've seen something like this when they tried to launch Teamwork Chat:</p>
<p>A dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of <a href="https://github.com/mllrsohn/node-webkit-builder" rel="noopener">node-webkit-builder</a>, I know we're not the only ones who have faced this problem.</p>
<h3><a href="#is-there-anything-we-can-do" class="post-header-anchor" id="is-there-anything-we-can-do" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Is there anything we can do?</h3>
<p>Once the code is shipped, it's too late. Luckily, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. We've added a <code>rewrite</code> option to gulp-path-length for simulating paths to prevent this problem ever ocurring again;</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-path-length'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./example/path/to/directory/**'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    read<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    rewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      match<span class="token punctuation">:</span> <span class="token string">'./example/path/to/directory/'</span><span class="token punctuation">,</span>
      replacement<span class="token punctuation">:</span> <span class="token string">'C:\\Users\\a-long-username-here\\AppData\\And\\So\\On'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>So, it doesn't matter where you are on your filesystem or which operating system you're using, it will test the length of files (which belong to the given <code>rewrite.match</code> directory) as if they're in a specific directory on Windows (i.e. <code>rewrite.replacement</code>). The outcome would be the same for any developer on the team.</p>
<p>You could run this before you ship your code but we've added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of <a href="https://lodash.com/" rel="noopener">lodash</a> modules), they'll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.</p>
<p>Are we missing anything here? Feel free to send us a pull-request or create an issue over at the gulp-path-length <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">GitHub repository</a>.</p>
</div></article><aside><div class="post-comments"><p>Feedback is more than welcome via <a href="https://twitter.com/lynchy010">@lynchy010</a> or <a href="mailto:contact@adamlynch.com">contact@adamlynch.com</a></div><div class="no-ssr-placeholder"></div></aside></div></div><footer class="footer"><p class="footer-text"><a href="https://github.com/adam-lynch/adam-lynch.github.io" class="footer-link">This site is open source</a><span class="copyright">© 2019 Adam Lynch</span></footer></main></div></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{article:{id:"dealing-with-long-paths",slug:"dealing-with-long-paths",highlightedLanguages:["javascript"],source:"---\ndate: 2015-07-01\nsummary: You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork's Engine Room\n  url: https://engineroom.teamwork.com/dealing-with-long-paths-fcf412649a01\ntags:\n  - NW.js\n  - node-webkit\n  - npm\n  - distribution\n  - paths\n  - windows\n  - development\n---\n\n## Dealing with long paths\n\nYou might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called [gulp-path-length](https://github.com/Teamwork/gulp-path-length) to give you a helping hand with this.\n\n![A helping hand](/images/blog-content/dealing-with-long-paths/helping-hand.gif)\n\n#### npm\n\nNeither this problem nor our solution is exclusive to [Node.js](https://nodejs.org/), but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by [npm](https://www.npmjs.com/) package maintainers but even [the design of npm itself is a problem from the get-go](https://github.com/joyent/node/issues/6960#issuecomment-46704998).\n\nnpm stores your dependencies (listed in your `package.json`) in a `node_modules` directory. If those dependencies have dependencies of their own, they're stored in their own `node_modules` directory (i.e. `your-project/node_modules/a/node_modules/b/`) and so on recursively. It's nice, but in hindsight, it's obviously incompatible with Windows's path length limit.\n\n#### Delete delete delete\n\nMost people have probably been lucky enough to only have come across this problem when trying to delete dependencies and then Windows complains that the path is too long.\n\nA simple way around this is to take a module halfway down deep into your dependency graph (i.e. `node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/`) in Windows Explorer and move it somewhere closer to the root (e.g. `node_modules/`) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.\n\nThere are also some tools which could help. I’ve noticed that you can delete really long paths while using [7-Zip](http://www.7-zip.org/) File Manager to browse files.\n\n#### Runtime errors\n\nIf you’ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level `node_modules` and not a `node_modules` directory `n` levels deep. Make sure to install the correct version and test thoroughly.\n\nThere are also a few Node modules out there which “flatten” your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So, be careful.\n\n#### Can’t npm fix this?\n\n~~You might see people reference Windows APIs (which support long paths) as a possible fix but it is [very unlikely](https://github.com/joyent/node/issues/6960#issuecomment-46704998) this will be fixed in npm. `[npm dedupe](https://docs.npmjs.com/cli/dedupe)` _should_ help with this too but it's not reliable in my experience.~~\n\nThis has been fixed as of [npm 3.0.0](https://github.com/npm/npm/releases/tag/v3.0.0).\n\n>Your dependencies will now be installed _maximally_ flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project’s `node_modules` folder with no nesting. You'll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.\n\nExcuse me…\n\n:::figure dealing-with-long-paths/dance.gif \\* Dances \\*\n:::\n\n#### Manually checking for exceedingly long paths\n\nUp until now, we’ve had to routinely check for long paths using [Path Length Checker](https://pathlengthchecker.codeplex.com/) (on Windows) but a manual check is not good enough as stuff can still slip through the net.\n\n#### Introducing gulp-path-length\n\nSo, we’ve created a simple [Gulp](http://gulpjs.com) plugin help with this; [gulp-path-length](https://github.com/Teamwork/gulp-path-length). You could use it like this in a Gulp task:\n\n```javascript\nvar gulp = require('gulp');\nvar pathLength = require('gulp-path-length');\n\ngulp.task('default', function(){\n  gulp.src('./example/path/to/directory/**', {read: false})\n    .pipe(pathLength());\n});\n```\n\nIf all is well, nothing will happen. If you have a path exceeding 256 characters, the Gulp task will stop and an error will reveal the offending path. This is really fast either way as Gulp doesn't need to read the contents of the files. The limit can be changed with a parameter; i.e. `.pipe(pathLength({ maxLength: 50 });`.\n\nThis is fine if it's just for you locally, but there are bigger fish to fry.\n\n### Distributed long paths\n\nWhat if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It's one thing having issues locally or within a team, it's a whole other thing to have path length problems in production on end users' machines.\n\nWe've run into this with [Teamwork Chat](https://www.teamwork.com/chat) for Windows as it's built on [NW.js](https://github.com/nwjs/nw.js) (formerly node-webkit) and can contain long paths (i.e. dependencies from npm). Depending on how long the current user's username was, the user might've seen something like this when they tried to launch Teamwork Chat:\n\nA dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of [node-webkit-builder](https://github.com/mllrsohn/node-webkit-builder), I know we're not the only ones who have faced this problem.\n\n### Is there anything we can do?\n\nOnce the code is shipped, it's too late. Luckily, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. We've added a `rewrite` option to gulp-path-length for simulating paths to prevent this problem ever ocurring again;\n\n```javascript\nvar gulp = require('gulp');\nvar pathLength = require('gulp-path-length');\n\ngulp.task('default', function() {\n  gulp.src('./example/path/to/directory/**', {\n    read: false\n  })\n  .pipe(pathLength({\n    rewrite: {\n      match: './example/path/to/directory/',\n      replacement: 'C:\\\\Users\\\\a-long-username-here\\\\AppData\\\\And\\\\So\\\\On'\n    }\n  }));\n});\n```\n\nSo, it doesn't matter where you are on your filesystem or which operating system you're using, it will test the length of files (which belong to the given `rewrite.match` directory) as if they're in a specific directory on Windows (i.e. `rewrite.replacement`). The outcome would be the same for any developer on the team.\n\nYou could run this before you ship your code but we've added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of [lodash](https://lodash.com/) modules), they'll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.\n\nAre we missing anything here? Feel free to send us a pull-request or create an issue over at the gulp-path-length [GitHub repository](https://github.com/Teamwork/gulp-path-length).\n",unfilteredRenderedBody:'<h2><a id="dealing-with-long-paths" class="post-header-anchor" href="#dealing-with-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dealing with long paths</h2>\n<p>You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a> to give you a helping hand with this.</p>\n<p><img src="/images/blog-content/dealing-with-long-paths/helping-hand.gif" alt="A helping hand"></p>\n<h4><a id="npm" class="post-header-anchor" href="#npm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm</h4>\n<p>Neither this problem nor our solution is exclusive to <a href="https://nodejs.org/" rel="noopener">Node.js</a>, but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by <a href="https://www.npmjs.com/" rel="noopener">npm</a> package maintainers but even <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">the design of npm itself is a problem from the get-go</a>.</p>\n<p>npm stores your dependencies (listed in your <code>package.json</code>) in a <code>node_modules</code> directory. If those dependencies have dependencies of their own, they\'re stored in their own <code>node_modules</code> directory (i.e. <code>your-project/node_modules/a/node_modules/b/</code>) and so on recursively. It\'s nice, but in hindsight, it\'s obviously incompatible with Windows\'s path length limit.</p>\n<h4><a id="delete-delete-delete" class="post-header-anchor" href="#delete-delete-delete" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Delete delete delete</h4>\n<p>Most people have probably been lucky enough to only have come across this problem when trying to delete dependencies and then Windows complains that the path is too long.</p>\n<p>A simple way around this is to take a module halfway down deep into your dependency graph (i.e. <code>node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/</code>) in Windows Explorer and move it somewhere closer to the root (e.g. <code>node_modules/</code>) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.</p>\n<p>There are also some tools which could help. I’ve noticed that you can delete really long paths while using <a href="http://www.7-zip.org/" rel="noopener">7-Zip</a> File Manager to browse files.</p>\n<h4><a id="runtime-errors" class="post-header-anchor" href="#runtime-errors" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Runtime errors</h4>\n<p>If you’ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level <code>node_modules</code> and not a <code>node_modules</code> directory <code>n</code> levels deep. Make sure to install the correct version and test thoroughly.</p>\n<p>There are also a few Node modules out there which “flatten” your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So, be careful.</p>\n<h4><a id="cant-npm-fix-this" class="post-header-anchor" href="#cant-npm-fix-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Can’t npm fix this?</h4>\n<p><s>You might see people reference Windows APIs (which support long paths) as a possible fix but it is <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">very unlikely</a> this will be fixed in npm. <code>[npm dedupe](https://docs.npmjs.com/cli/dedupe)</code> <em>should</em> help with this too but it\'s not reliable in my experience.</s></p>\n<p>This has been fixed as of <a href="https://github.com/npm/npm/releases/tag/v3.0.0" rel="noopener">npm 3.0.0</a>.</p>\n<blockquote>\n<p>Your dependencies will now be installed <em>maximally</em> flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project’s <code>node_modules</code> folder with no nesting. You\'ll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.</p>\n</blockquote>\n<p>Excuse me…</p>\n<figure>\n          <a href="/images/blog-content/dealing-with-long-paths/dance.gif"><img src="/images/blog-content/dealing-with-long-paths/dance.gif" alt=""/></a>\n          <figcaption><p>* Dances *</p>\n</figcaption>\n        </figure><h4><a id="manually-checking-for-exceedingly-long-paths" class="post-header-anchor" href="#manually-checking-for-exceedingly-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Manually checking for exceedingly long paths</h4>\n<p>Up until now, we’ve had to routinely check for long paths using <a href="https://pathlengthchecker.codeplex.com/" rel="noopener">Path Length Checker</a> (on Windows) but a manual check is not good enough as stuff can still slip through the net.</p>\n<h4><a id="introducing-gulp-path-length" class="post-header-anchor" href="#introducing-gulp-path-length" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing gulp-path-length</h4>\n<p>So, we’ve created a simple <a href="http://gulpjs.com" rel="noopener">Gulp</a> plugin help with this; <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a>. You could use it like this in a Gulp task:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>If all is well, nothing will happen. If you have a path exceeding 256 characters, the Gulp task will stop and an error will reveal the offending path. This is really fast either way as Gulp doesn\'t need to read the contents of the files. The limit can be changed with a parameter; i.e. <code>.pipe(pathLength({ maxLength: 50 });</code>.</p>\n<p>This is fine if it\'s just for you locally, but there are bigger fish to fry.</p>\n<h3><a id="distributed-long-paths" class="post-header-anchor" href="#distributed-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Distributed long paths</h3>\n<p>What if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It\'s one thing having issues locally or within a team, it\'s a whole other thing to have path length problems in production on end users\' machines.</p>\n<p>We\'ve run into this with <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> for Windows as it\'s built on <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> (formerly node-webkit) and can contain long paths (i.e. dependencies from npm). Depending on how long the current user\'s username was, the user might\'ve seen something like this when they tried to launch Teamwork Chat:</p>\n<p>A dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of <a href="https://github.com/mllrsohn/node-webkit-builder" rel="noopener">node-webkit-builder</a>, I know we\'re not the only ones who have faced this problem.</p>\n<h3><a id="is-there-anything-we-can-do" class="post-header-anchor" href="#is-there-anything-we-can-do" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Is there anything we can do?</h3>\n<p>Once the code is shipped, it\'s too late. Luckily, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. We\'ve added a <code>rewrite</code> option to gulp-path-length for simulating paths to prevent this problem ever ocurring again;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    read<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    rewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      match<span class="token punctuation">:</span> <span class="token string">\'./example/path/to/directory/\'</span><span class="token punctuation">,</span>\n      replacement<span class="token punctuation">:</span> <span class="token string">\'C:\\\\Users\\\\a-long-username-here\\\\AppData\\\\And\\\\So\\\\On\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So, it doesn\'t matter where you are on your filesystem or which operating system you\'re using, it will test the length of files (which belong to the given <code>rewrite.match</code> directory) as if they\'re in a specific directory on Windows (i.e. <code>rewrite.replacement</code>). The outcome would be the same for any developer on the team.</p>\n<p>You could run this before you ship your code but we\'ve added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of <a href="https://lodash.com/" rel="noopener">lodash</a> modules), they\'ll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.</p>\n<p>Are we missing anything here? Feel free to send us a pull-request or create an issue over at the gulp-path-length <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">GitHub repository</a>.</p>\n',attributes:{date:"2015-07-01T00:00:00.000Z",summary:"You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/dealing-with-long-paths-fcf412649a01"},tags:[{id:"nwjs",name:"NW.js"},{id:"node-webkit",name:"node-webkit"},{id:"npm",name:"npm"},{id:"distribution",name:"distribution"},{id:"paths",name:"paths"},{id:"windows",name:"windows"},{id:"development",name:"development"}],title:"Dealing with long paths",updated_at:"2019-05-22T08:25:36.112Z",photo:"/images/blog-content/dealing-with-long-paths/helping-hand.gif"},title:"Dealing with long paths",renderedSummary:"<p>You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…</p>\n",rendered:'<h2><a id="dealing-with-long-paths" class="post-header-anchor" href="#dealing-with-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dealing with long paths</h2>\n<p>You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a> to give you a helping hand with this.</p>\n<p><img src="/images/blog-content/dealing-with-long-paths/helping-hand.gif" alt="A helping hand"></p>\n<h4><a id="npm" class="post-header-anchor" href="#npm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm</h4>\n<p>Neither this problem nor our solution is exclusive to <a href="https://nodejs.org/" rel="noopener">Node.js</a>, but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by <a href="https://www.npmjs.com/" rel="noopener">npm</a> package maintainers but even <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">the design of npm itself is a problem from the get-go</a>.</p>\n<p>npm stores your dependencies (listed in your <code>package.json</code>) in a <code>node_modules</code> directory. If those dependencies have dependencies of their own, they\'re stored in their own <code>node_modules</code> directory (i.e. <code>your-project/node_modules/a/node_modules/b/</code>) and so on recursively. It\'s nice, but in hindsight, it\'s obviously incompatible with Windows\'s path length limit.</p>\n<h4><a id="delete-delete-delete" class="post-header-anchor" href="#delete-delete-delete" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Delete delete delete</h4>\n<p>Most people have probably been lucky enough to only have come across this problem when trying to delete dependencies and then Windows complains that the path is too long.</p>\n<p>A simple way around this is to take a module halfway down deep into your dependency graph (i.e. <code>node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/</code>) in Windows Explorer and move it somewhere closer to the root (e.g. <code>node_modules/</code>) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.</p>\n<p>There are also some tools which could help. I’ve noticed that you can delete really long paths while using <a href="http://www.7-zip.org/" rel="noopener">7-Zip</a> File Manager to browse files.</p>\n<h4><a id="runtime-errors" class="post-header-anchor" href="#runtime-errors" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Runtime errors</h4>\n<p>If you’ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level <code>node_modules</code> and not a <code>node_modules</code> directory <code>n</code> levels deep. Make sure to install the correct version and test thoroughly.</p>\n<p>There are also a few Node modules out there which “flatten” your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So, be careful.</p>\n<h4><a id="cant-npm-fix-this" class="post-header-anchor" href="#cant-npm-fix-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Can’t npm fix this?</h4>\n<p><s>You might see people reference Windows APIs (which support long paths) as a possible fix but it is <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">very unlikely</a> this will be fixed in npm. <code>[npm dedupe](https://docs.npmjs.com/cli/dedupe)</code> <em>should</em> help with this too but it\'s not reliable in my experience.</s></p>\n<p>This has been fixed as of <a href="https://github.com/npm/npm/releases/tag/v3.0.0" rel="noopener">npm 3.0.0</a>.</p>\n<blockquote>\n<p>Your dependencies will now be installed <em>maximally</em> flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project’s <code>node_modules</code> folder with no nesting. You\'ll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.</p>\n</blockquote>\n<p>Excuse me…</p>\n<figure>\n          <a href="/images/blog-content/dealing-with-long-paths/dance.gif"><img src="/images/blog-content/dealing-with-long-paths/dance.gif" alt=""/></a>\n          <figcaption><p>* Dances *</p>\n</figcaption>\n        </figure><h4><a id="manually-checking-for-exceedingly-long-paths" class="post-header-anchor" href="#manually-checking-for-exceedingly-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Manually checking for exceedingly long paths</h4>\n<p>Up until now, we’ve had to routinely check for long paths using <a href="https://pathlengthchecker.codeplex.com/" rel="noopener">Path Length Checker</a> (on Windows) but a manual check is not good enough as stuff can still slip through the net.</p>\n<h4><a id="introducing-gulp-path-length" class="post-header-anchor" href="#introducing-gulp-path-length" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing gulp-path-length</h4>\n<p>So, we’ve created a simple <a href="http://gulpjs.com" rel="noopener">Gulp</a> plugin help with this; <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a>. You could use it like this in a Gulp task:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>If all is well, nothing will happen. If you have a path exceeding 256 characters, the Gulp task will stop and an error will reveal the offending path. This is really fast either way as Gulp doesn\'t need to read the contents of the files. The limit can be changed with a parameter; i.e. <code>.pipe(pathLength({ maxLength: 50 });</code>.</p>\n<p>This is fine if it\'s just for you locally, but there are bigger fish to fry.</p>\n<h3><a id="distributed-long-paths" class="post-header-anchor" href="#distributed-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Distributed long paths</h3>\n<p>What if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It\'s one thing having issues locally or within a team, it\'s a whole other thing to have path length problems in production on end users\' machines.</p>\n<p>We\'ve run into this with <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> for Windows as it\'s built on <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> (formerly node-webkit) and can contain long paths (i.e. dependencies from npm). Depending on how long the current user\'s username was, the user might\'ve seen something like this when they tried to launch Teamwork Chat:</p>\n<p>A dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of <a href="https://github.com/mllrsohn/node-webkit-builder" rel="noopener">node-webkit-builder</a>, I know we\'re not the only ones who have faced this problem.</p>\n<h3><a id="is-there-anything-we-can-do" class="post-header-anchor" href="#is-there-anything-we-can-do" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Is there anything we can do?</h3>\n<p>Once the code is shipped, it\'s too late. Luckily, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. We\'ve added a <code>rewrite</code> option to gulp-path-length for simulating paths to prevent this problem ever ocurring again;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    read<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    rewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      match<span class="token punctuation">:</span> <span class="token string">\'./example/path/to/directory/\'</span><span class="token punctuation">,</span>\n      replacement<span class="token punctuation">:</span> <span class="token string">\'C:\\\\Users\\\\a-long-username-here\\\\AppData\\\\And\\\\So\\\\On\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So, it doesn\'t matter where you are on your filesystem or which operating system you\'re using, it will test the length of files (which belong to the given <code>rewrite.match</code> directory) as if they\'re in a specific directory on Windows (i.e. <code>rewrite.replacement</code>). The outcome would be the same for any developer on the team.</p>\n<p>You could run this before you ship your code but we\'ve added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of <a href="https://lodash.com/" rel="noopener">lodash</a> modules), they\'ll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.</p>\n<p>Are we missing anything here? Feel free to send us a pull-request or create an issue over at the gulp-path-length <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">GitHub repository</a>.</p>\n',summary:"You might have been unfortunate enough to learn that Windows has a 256-character limit on file paths. You could’ve run into this problem locally or on end users’ machines. We’ve created a simple little module called gulp-path-length to…\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/dealing-with-long-paths-fcf412649a01"},photo:"/images/blog-content/dealing-with-long-paths/helping-hand.gif",keywords:["NW.js","node-webkit","npm","distribution","paths","windows","development"],published_at:"2015-07-01T00:00:00.000Z",updated_at:"2019-05-22T08:25:36.112Z",year:2015,month:7,day:2,relevanceScore:0,moreArticles:[{id:"npm-distribution-path-length-problems",slug:"npm-distribution-path-length-problems",highlightedLanguages:["javascript"],source:"---\ndate: 2015-12-07\nsummary: NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.\noriginal:\n  blogLink: https://www.packtpub.com/books/content/blogs\n  blogName: Packt books\n  url: https://www.packtpub.com/books/content/npm-and-distribution-path-length-problems\ntags:\n  - node-webkit\n  - desktop\n  - javascript\n  - npm\n  - distribution\n  - windows\n  - paths\n  - development\n---\n\n## npm and distribution path length problems\n\n:::summary\n\nYou might have been unfortunate enough to learn that Windows has a 256 character limit on file paths. You could've ran into this problem locally or on end users' machines. There's no real workaround but there are preventive measures you can take. Even if you haven't, feel free to take pleasure from reading my horror story.\n\n:::\n\n### npm\n\nNeither this problem nor our solution are exclusive to Node.js but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by npm package maintainers but even [the design of npm itself is a problem on Windows from the get-go](https://github.com/joyent/node/issues/6960#issuecomment-46704998).\n\nnpm stores your dependencies (listed in your package.json) in a `node_modules` directory. If those dependencies have dependencies of their own they're stored in their own `node_modules` directory (i.e. `your-project/node_modules/a/node_modules/b/`) and so on recursively. It's nice but in hindsight it's obviously incompatible with Windows's path length limit.\n\n### Delete delete delete\n\nMost people have probably been lucky enough to only have come across this problem when trying to delete dependencies where then Windows complains that the path is too long.\n\nA simple way around this is to take a module halfway down deep into your dependency graph (i.e. `node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/`) in Windows Explorer and move it somewhere closer to the root (e.g. `node_modules/`) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.\n\nThere are also some tools which could help. I've noticed that you can delete really long paths while using [7-Zip](http://www.7-zip.org/) File Manager to browse files.\n\n### Runtime errors\n\nIf you've ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level `node_modules` and not a `node_modules` directory n levels deep. Make sure to install the correct version and test thoroughly.\n\nThere are also a few Node modules out there which \"flatten\" your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So be careful.\n\n### Can't npm fix this?\n\n~~You might see people reference Windows APIs (which support long paths) as a possible fix but it is [very unlikely](https://github.com/joyent/node/issues/6960#issuecomment-46704998) <span style=\"text-decoration: line-through;\">this will be fixed in npm.[npm dedupe](https://docs.npmjs.com/cli/dedupe) _should_ help with this too but it's not reliable in my experience.~~\n\nYes, they, can! This has been fixed as of [npm 3.0.0](https://github.com/npm/npm/releases/tag/v3.0.0) (yet to be released).\n\nYour dependencies will now be installed _maximally_ flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project's `node_modules` folder with no nesting. You'll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.\n\nExcuse me...\n\n:::figure npm-distribution-path-length-problems/dance.gif \\* Dances \\*\n:::\n\nMind you, it's a bit late for me. Unless npm 3 also ships with a time machine. More about that in a bit.\n\n### Manually checking for exceedingly long paths\n\nUp until now, I've had to routinely check for long paths using [Path Length Checker](https://pathlengthchecker.codeplex.com/) (on Windows) but a manual check is not good enough as stuff can still slip through the net.\n\n### Introducing gulp-path-length\n\nSo there's a simple [Gulp](http://gulpjs.com) plugin to help with this; [gulp-path-length](https://github.com/Teamwork/gulp-path-length). You could use it like this in a Gulp task:\n\n```javascript\nvar gulp = require('gulp');\nvar pathLength = require('gulp-path-length');\n\ngulp.task('default', function(){\n  gulp.src('./example/path/to/directory/**', {read: false})\n      .pipe(pathLength());\n});\n```\n\nIf all is well, nothing will happen. If you have a path exceeding 256 characters, the gulp task will stop and an error reveal the offending path. This is really fast either way as Gulp doesn't need to read the contents of the files. The limit can be changed with a parameter; i.e. `.pipe(pathLength({ maxLength: 50 });`.\n\nThis is fine if it's just for you locally but there are bigger fish to fry.\n\n### Distributed long paths\n\nWhat if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It's one thing having issues locally or within a team, it's a whole other thing to have path length problems in production on end users machines.\n\nI've had that pleasure myself with [Teamwork Chat](https://www.teamwork.com/chat), which we built on top of [NW.js](https://github.com/nwjs/nw.js). NW.js is basically Node.js and Chromium mashed together to allow you to create desktop apps from Web apps. Any NW.js can access all of node's core modules and any other modules you've installed from nom, for example. Therefore the npm - Windows path length issue applies here too. Depending on how long the end user's username was, the user might've seen something like this when they tried to launch Teamwork Chat:\n\n:::figure npm-distribution-path-length-problems/fatal.png The NW.js fatal error screen\n:::\n\nA dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of [nw-builder](https://github.com/nwjs/nw-builder), I know we're not the only ones who have faced this problem.\n\n### Is there anything we can do?\n\nOnce the code is shipped, it's too late. Luckily in my case, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. This is where gulp-path-length's rewrite option comes in. It can be used like this to simulate path lengths:\n\n```javascript\nvar gulp = require('gulp');\nvar pathLength = require('gulp-path-length');\n\ngulp.task('default', function(){\n  gulp.src('./example/path/to/directory/**', {read: false})\n    .pipe(pathLength({\n      rewrite: {\n        match: './example/path/to/directory/',\n        replacement: 'C:\\\\Users\\\\a-long-username-here\\\\AppData\\\\Blah\\\\Blah\\\\Blah'\n      }\n    }));\n});\n```\n\nSo it doesn't matter where you are on your filesystem or which operating system you're using, it will test the length of files in a given directory as if they're in a hypothetical directory on Windows.\n\nYou could run this before you ship your code but we've added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of [lodash](https://lodash.com/) modules), they'll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.\n",unfilteredRenderedBody:'<h2><a id="npm-and-distribution-path-length-problems" class="post-header-anchor" href="#npm-and-distribution-path-length-problems" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm and distribution path length problems</h2>\n<article-summary><p>You might have been unfortunate enough to learn that Windows has a 256 character limit on file paths. You could\'ve ran into this problem locally or on end users\' machines. There\'s no real workaround but there are preventive measures you can take. Even if you haven\'t, feel free to take pleasure from reading my horror story.</p>\n</article-summary><h3><a id="npm" class="post-header-anchor" href="#npm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm</h3>\n<p>Neither this problem nor our solution are exclusive to Node.js but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by npm package maintainers but even <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">the design of npm itself is a problem on Windows from the get-go</a>.</p>\n<p>npm stores your dependencies (listed in your package.json) in a <code>node_modules</code> directory. If those dependencies have dependencies of their own they\'re stored in their own <code>node_modules</code> directory (i.e. <code>your-project/node_modules/a/node_modules/b/</code>) and so on recursively. It\'s nice but in hindsight it\'s obviously incompatible with Windows\'s path length limit.</p>\n<h3><a id="delete-delete-delete" class="post-header-anchor" href="#delete-delete-delete" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Delete delete delete</h3>\n<p>Most people have probably been lucky enough to only have come across this problem when trying to delete dependencies where then Windows complains that the path is too long.</p>\n<p>A simple way around this is to take a module halfway down deep into your dependency graph (i.e. <code>node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/</code>) in Windows Explorer and move it somewhere closer to the root (e.g. <code>node_modules/</code>) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.</p>\n<p>There are also some tools which could help. I\'ve noticed that you can delete really long paths while using <a href="http://www.7-zip.org/" rel="noopener">7-Zip</a> File Manager to browse files.</p>\n<h3><a id="runtime-errors" class="post-header-anchor" href="#runtime-errors" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Runtime errors</h3>\n<p>If you\'ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level <code>node_modules</code> and not a <code>node_modules</code> directory n levels deep. Make sure to install the correct version and test thoroughly.</p>\n<p>There are also a few Node modules out there which &quot;flatten&quot; your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So be careful.</p>\n<h3><a id="cant-npm-fix-this" class="post-header-anchor" href="#cant-npm-fix-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Can\'t npm fix this?</h3>\n<p><s>You might see people reference Windows APIs (which support long paths) as a possible fix but it is <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">very unlikely</a> <span style="text-decoration: line-through;">this will be fixed in npm.<a href="https://docs.npmjs.com/cli/dedupe" rel="noopener">npm dedupe</a> <em>should</em> help with this too but it\'s not reliable in my experience.</s></p>\n<p>Yes, they, can! This has been fixed as of <a href="https://github.com/npm/npm/releases/tag/v3.0.0" rel="noopener">npm 3.0.0</a> (yet to be released).</p>\n<p>Your dependencies will now be installed <em>maximally</em> flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project\'s <code>node_modules</code> folder with no nesting. You\'ll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.</p>\n<p>Excuse me...</p>\n<figure>\n          <a href="/images/blog-content/npm-distribution-path-length-problems/dance.gif"><img src="/images/blog-content/npm-distribution-path-length-problems/dance.gif" alt=""/></a>\n          <figcaption><p>* Dances *</p>\n</figcaption>\n        </figure><p>Mind you, it\'s a bit late for me. Unless npm 3 also ships with a time machine. More about that in a bit.</p>\n<h3><a id="manually-checking-for-exceedingly-long-paths" class="post-header-anchor" href="#manually-checking-for-exceedingly-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Manually checking for exceedingly long paths</h3>\n<p>Up until now, I\'ve had to routinely check for long paths using <a href="https://pathlengthchecker.codeplex.com/" rel="noopener">Path Length Checker</a> (on Windows) but a manual check is not good enough as stuff can still slip through the net.</p>\n<h3><a id="introducing-gulp-path-length" class="post-header-anchor" href="#introducing-gulp-path-length" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing gulp-path-length</h3>\n<p>So there\'s a simple <a href="http://gulpjs.com" rel="noopener">Gulp</a> plugin to help with this; <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a>. You could use it like this in a Gulp task:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>If all is well, nothing will happen. If you have a path exceeding 256 characters, the gulp task will stop and an error reveal the offending path. This is really fast either way as Gulp doesn\'t need to read the contents of the files. The limit can be changed with a parameter; i.e. <code>.pipe(pathLength({ maxLength: 50 });</code>.</p>\n<p>This is fine if it\'s just for you locally but there are bigger fish to fry.</p>\n<h3><a id="distributed-long-paths" class="post-header-anchor" href="#distributed-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Distributed long paths</h3>\n<p>What if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It\'s one thing having issues locally or within a team, it\'s a whole other thing to have path length problems in production on end users machines.</p>\n<p>I\'ve had that pleasure myself with <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a>, which we built on top of <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a>. NW.js is basically Node.js and Chromium mashed together to allow you to create desktop apps from Web apps. Any NW.js can access all of node\'s core modules and any other modules you\'ve installed from nom, for example. Therefore the npm - Windows path length issue applies here too. Depending on how long the end user\'s username was, the user might\'ve seen something like this when they tried to launch Teamwork Chat:</p>\n<figure>\n          <a href="/images/blog-content/npm-distribution-path-length-problems/fatal.png"><img src="/images/blog-content/npm-distribution-path-length-problems/fatal.png" alt=""/></a>\n          <figcaption><p>The NW.js fatal error screen</p>\n</figcaption>\n        </figure><p>A dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of <a href="https://github.com/nwjs/nw-builder" rel="noopener">nw-builder</a>, I know we\'re not the only ones who have faced this problem.</p>\n<h3><a id="is-there-anything-we-can-do" class="post-header-anchor" href="#is-there-anything-we-can-do" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Is there anything we can do?</h3>\n<p>Once the code is shipped, it\'s too late. Luckily in my case, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. This is where gulp-path-length\'s rewrite option comes in. It can be used like this to simulate path lengths:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      rewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        match<span class="token punctuation">:</span> <span class="token string">\'./example/path/to/directory/\'</span><span class="token punctuation">,</span>\n        replacement<span class="token punctuation">:</span> <span class="token string">\'C:\\\\Users\\\\a-long-username-here\\\\AppData\\\\Blah\\\\Blah\\\\Blah\'</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So it doesn\'t matter where you are on your filesystem or which operating system you\'re using, it will test the length of files in a given directory as if they\'re in a hypothetical directory on Windows.</p>\n<p>You could run this before you ship your code but we\'ve added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of <a href="https://lodash.com/" rel="noopener">lodash</a> modules), they\'ll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.</p>\n',attributes:{date:"2015-12-07T00:00:00.000Z",summary:"NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.",original:{blogLink:"https://www.packtpub.com/books/content/blogs",blogName:"Packt books",url:"https://www.packtpub.com/books/content/npm-and-distribution-path-length-problems"},tags:[{id:"node-webkit",name:"node-webkit"},{id:"desktop",name:"desktop"},{id:"javascript",name:"javascript"},{id:"npm",name:"npm"},{id:"distribution",name:"distribution"},{id:"windows",name:"windows"},{id:"paths",name:"paths"},{id:"development",name:"development"}],title:"npm and distribution path length problems",updated_at:"2019-05-22T08:26:01.131Z",photo:"/images/blog-content/npm-distribution-path-length-problems/dance.gif"},title:"npm and distribution path length problems",renderedSummary:"<p>NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.</p>\n",rendered:'<h2><a id="npm-and-distribution-path-length-problems" class="post-header-anchor" href="#npm-and-distribution-path-length-problems" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm and distribution path length problems</h2>\n<p>You might have been unfortunate enough to learn that Windows has a 256 character limit on file paths. You could\'ve ran into this problem locally or on end users\' machines. There\'s no real workaround but there are preventive measures you can take. Even if you haven\'t, feel free to take pleasure from reading my horror story.</p>\n<h3><a id="npm" class="post-header-anchor" href="#npm" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>npm</h3>\n<p>Neither this problem nor our solution are exclusive to Node.js but a lot of the victims of the path length problem were probably running Node.js on Windows. Windows users know that they get left out in the cold often by npm package maintainers but even <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">the design of npm itself is a problem on Windows from the get-go</a>.</p>\n<p>npm stores your dependencies (listed in your package.json) in a <code>node_modules</code> directory. If those dependencies have dependencies of their own they\'re stored in their own <code>node_modules</code> directory (i.e. <code>your-project/node_modules/a/node_modules/b/</code>) and so on recursively. It\'s nice but in hindsight it\'s obviously incompatible with Windows\'s path length limit.</p>\n<h3><a id="delete-delete-delete" class="post-header-anchor" href="#delete-delete-delete" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Delete delete delete</h3>\n<p>Most people have probably been lucky enough to only have come across this problem when trying to delete dependencies where then Windows complains that the path is too long.</p>\n<p>A simple way around this is to take a module halfway down deep into your dependency graph (i.e. <code>node_modules/a/node_modules/b/node_modules/c/.../node_modules/h/</code>) in Windows Explorer and move it somewhere closer to the root (e.g. <code>node_modules/</code>) to cut the file path down before trying to delete it again. This would have to be repeated for every culprit.</p>\n<p>There are also some tools which could help. I\'ve noticed that you can delete really long paths while using <a href="http://www.7-zip.org/" rel="noopener">7-Zip</a> File Manager to browse files.</p>\n<h3><a id="runtime-errors" class="post-header-anchor" href="#runtime-errors" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Runtime errors</h3>\n<p>If you\'ve ran into actual bugs caused by this, you could find a module halfway down the dependency graph and add it as a dependency to your project so it will be installed under the top level <code>node_modules</code> and not a <code>node_modules</code> directory n levels deep. Make sure to install the correct version and test thoroughly.</p>\n<p>There are also a few Node modules out there which &quot;flatten&quot; your dependency graph. The downside to these modules is that if there is a conflict (package A depends on version 1.0.0 of package Z and package B depends on version 3.2.1 of package Z) then the latest version of the module (package Z) is used, which could be problematic. So be careful.</p>\n<h3><a id="cant-npm-fix-this" class="post-header-anchor" href="#cant-npm-fix-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Can\'t npm fix this?</h3>\n<p><s>You might see people reference Windows APIs (which support long paths) as a possible fix but it is <a href="https://github.com/joyent/node/issues/6960#issuecomment-46704998" rel="noopener">very unlikely</a> <span style="text-decoration: line-through;">this will be fixed in npm.<a href="https://docs.npmjs.com/cli/dedupe" rel="noopener">npm dedupe</a> <em>should</em> help with this too but it\'s not reliable in my experience.</s></p>\n<p>Yes, they, can! This has been fixed as of <a href="https://github.com/npm/npm/releases/tag/v3.0.0" rel="noopener">npm 3.0.0</a> (yet to be released).</p>\n<p>Your dependencies will now be installed <em>maximally</em> flat. Insofar as is possible, all of your dependencies, and their dependencies, and THEIR dependencies will be installed in your project\'s <code>node_modules</code> folder with no nesting. You\'ll only see modules nested underneath one another when two (or more) modules have conflicting dependencies.</p>\n<p>Excuse me...</p>\n<figure>\n          <a href="/images/blog-content/npm-distribution-path-length-problems/dance.gif"><img src="/images/blog-content/npm-distribution-path-length-problems/dance.gif" alt=""/></a>\n          <figcaption><p>* Dances *</p>\n</figcaption>\n        </figure><p>Mind you, it\'s a bit late for me. Unless npm 3 also ships with a time machine. More about that in a bit.</p>\n<h3><a id="manually-checking-for-exceedingly-long-paths" class="post-header-anchor" href="#manually-checking-for-exceedingly-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Manually checking for exceedingly long paths</h3>\n<p>Up until now, I\'ve had to routinely check for long paths using <a href="https://pathlengthchecker.codeplex.com/" rel="noopener">Path Length Checker</a> (on Windows) but a manual check is not good enough as stuff can still slip through the net.</p>\n<h3><a id="introducing-gulp-path-length" class="post-header-anchor" href="#introducing-gulp-path-length" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing gulp-path-length</h3>\n<p>So there\'s a simple <a href="http://gulpjs.com" rel="noopener">Gulp</a> plugin to help with this; <a href="https://github.com/Teamwork/gulp-path-length" rel="noopener">gulp-path-length</a>. You could use it like this in a Gulp task:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>If all is well, nothing will happen. If you have a path exceeding 256 characters, the gulp task will stop and an error reveal the offending path. This is really fast either way as Gulp doesn\'t need to read the contents of the files. The limit can be changed with a parameter; i.e. <code>.pipe(pathLength({ maxLength: 50 });</code>.</p>\n<p>This is fine if it\'s just for you locally but there are bigger fish to fry.</p>\n<h3><a id="distributed-long-paths" class="post-header-anchor" href="#distributed-long-paths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Distributed long paths</h3>\n<p>What if there are multiple developers working on your project? What if a developer is using Mac OS X or Linux? There could easily be false positives. It\'s one thing having issues locally or within a team, it\'s a whole other thing to have path length problems in production on end users machines.</p>\n<p>I\'ve had that pleasure myself with <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a>, which we built on top of <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a>. NW.js is basically Node.js and Chromium mashed together to allow you to create desktop apps from Web apps. Any NW.js can access all of node\'s core modules and any other modules you\'ve installed from nom, for example. Therefore the npm - Windows path length issue applies here too. Depending on how long the end user\'s username was, the user might\'ve seen something like this when they tried to launch Teamwork Chat:</p>\n<figure>\n          <a href="/images/blog-content/npm-distribution-path-length-problems/fatal.png"><img src="/images/blog-content/npm-distribution-path-length-problems/fatal.png" alt=""/></a>\n          <figcaption><p>The NW.js fatal error screen</p>\n</figcaption>\n        </figure><p>A dummy application. None of our app code is executed. This means no error reports and no way the app could even auto-update once a patch was released. As a maintainer of <a href="https://github.com/nwjs/nw-builder" rel="noopener">nw-builder</a>, I know we\'re not the only ones who have faced this problem.</p>\n<h3><a id="is-there-anything-we-can-do" class="post-header-anchor" href="#is-there-anything-we-can-do" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Is there anything we can do?</h3>\n<p>Once the code is shipped, it\'s too late. Luckily in my case, we have a rough idea where the files will exist on end users machines thanks to our Windows installer. This is where gulp-path-length\'s rewrite option comes in. It can be used like this to simulate path lengths:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pathLength <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-path-length\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./example/path/to/directory/**\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>read<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pathLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      rewrite<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        match<span class="token punctuation">:</span> <span class="token string">\'./example/path/to/directory/\'</span><span class="token punctuation">,</span>\n        replacement<span class="token punctuation">:</span> <span class="token string">\'C:\\\\Users\\\\a-long-username-here\\\\AppData\\\\Blah\\\\Blah\\\\Blah\'</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So it doesn\'t matter where you are on your filesystem or which operating system you\'re using, it will test the length of files in a given directory as if they\'re in a hypothetical directory on Windows.</p>\n<p>You could run this before you ship your code but we\'ve added this to a compilation build step so we catch it as early as possible. If a Mac developer adds really long paths to the project (like an npm dependency which depends on a chain of <a href="https://lodash.com/" rel="noopener">lodash</a> modules), they\'ll see right away that this will break stuff for some Windows users. For good measure, we also run it in a continuous integration step.</p>\n',summary:"NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.\n",original:{blogLink:"https://www.packtpub.com/books/content/blogs",blogName:"Packt books",url:"https://www.packtpub.com/books/content/npm-and-distribution-path-length-problems"},photo:"/images/blog-content/npm-distribution-path-length-problems/dance.gif",keywords:["node-webkit","desktop","javascript","npm","distribution","windows","paths","development"],published_at:"2015-12-07T00:00:00.000Z",updated_at:"2019-05-22T08:26:01.131Z",year:2015,month:12,day:8,relevanceScore:.29166666666666674},{id:"under-the-hood-of-a-hybrid-app",slug:"under-the-hood-of-a-hybrid-app",highlightedLanguages:[],source:'---\ndate: 2016-04-16\nsummary: It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork\'s Engine Room\n  url: https://engineroom.teamwork.com/under-the-hood-of-a-hybrid-app-2215ce6e342a\ntags:\n  - product\n  - web\n  - javascript\n  - nw.js\n  - node-webkit\n  - desktop\n  - hybrid\n  - mobile\n  - development\n---\n\n## Under the hood of a hybrid (app)\n\nIt has been about a year since we had [A peek under the hood of Teamwork Chat](http://engineroom.teamwork.com/under-the-hood-of-teamwork-chat/). Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More and more companies are using our app, including some really famous ones. At the time of writing this, over 12 million messages have been sent. Teamwork has grown three times in size, and the Teamwork Chat team with it, thanks to some great hires.\n\nLet’s take a look at some of my predictions from last year’s post;\n\n> As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture.\n\nAlong with our Windows and Mac OS X desktop apps, [Teamwork Chat](https://www.teamwork.com/chat) is now available in your favourite Web browser. This was almost as easy as we expected. See [Donal’s](http://engineroom.teamwork.com/author/donal/) recent [Deploying the Teamwork Chat Web app](http://engineroom.teamwork.com/how-we-sped-up-serving-static-files-in-teamwork-chat/) post for more.\n\nSure, Teamwork Chat is a mobile-first responsive app, so yes, users could access Teamwork Chat on their phones. This was welcomed with open arms, but did I make any mobile *app* predictions?\n\n> Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.\n\nYep, and that’s what we’ve done. In this post, I’m going to describe how our [Android](https://play.google.com/store/apps/details?id=com.teamwork.chat&hl=en) and [iOS](https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8) apps came to be, lessons we’ve learned along the way, and where we’re headed. Not only in respect to mobile apps, but Teamwork Chat as a whole.\n\n### Mobile apps, finally\n\nWe released our first internal prototype about a year ago; a mash of Appcelerator and some Web code. It wasn’t as nice as we thought it would be. We would’ve needed to put in a lot more work to make it really usable. We had bigger fish to fry though. After a painful period of trying to maintain it while delivering key features, it was put to one side. We eventually got back to it, starting again from scratch.\n\nOf course, we wanted Android and iOS apps which allowed you to do everything you could already do in Teamwork Chat. Push notifications and being able to share a file to the app were minimum requirements as well. Unlike other apps where you could get away without those, they’re critical for any chat app. We imagined that the least the Teamwork Chat mobile apps could do is allow you to contact someone while on the go and stay in the loop, as well as quickly share a photo you’ve just taken, for example.\n\nOur intention, as much now as it was then, is to have a consistent and familiar experience across all of our apps. Someone should be easily able to start a conversation on one device and carry it on elsewhere.\n\n### Reusing our Web app\n\nBy this stage, users were crying out for mobile apps. Our plan was to get mobile apps out there and improve on them. We planned to reuse our Web app and see how far we could get. We took ownership of (most of) the app as apposed to our mobile team here at Teamwork. We got a lot of the way for free as we had already fought to maintain (mobile-first) reponsiveness and touch-friendliness throughout. We got an iPad app for free due to the fact our app is responsive. Note: we’ve never used device-orientated breakpoints in our designs.\n\nNow, mobile apps are also considered in every feature from the beginning. Reusing code between our Web, desktop, and mobile apps enables us to fix a bug once and it’s fixed everywhere. As I said in last year’s post, we use Node.js on the server-side, so we have some modules which are used in our Web app, our Mac & Windows desktop apps, our Android & iOS apps, and some services. Imagine that.\n\nIt was more difficult than we had anticipated. Debugging was trickier for one, and sure we had made an app that was responsive, but it wasn’t *responsible*. I wish Teamwork Chat really was mobile-first. We should have worked on mobile apps or at least made the Web version first and used it in mobile Web browsers often. The app was far too bloated, it was doing too much all of the time, and so on. A lot of improvements came from making the mobile apps, which in turn improved every Teamwork Chat client as a result. All Teamwork Chat (mobile, Web, and desktop) apps now load faster, take less time to render, and so on, but we still have work to do.\n\n:::figure under-the-hood-of-a-hybrid-app/nav.png A navigation menu we tweaked.\n:::\n\nWe forced ourselves to use our mobile apps exclusively; any interaction we made in Teamwork Chat during the day had to be done in the mobile app. This really helped. We completely redesigned some navigation menus, made some tweaks around touch input, and more. Sure, we already designed our app for touch, but how often did we really use a touch laptop or heavily use the app in a mobile Web browser? Well, clearly not enough. So we fine-grained a few things, including the swipe to show or hide the sidebar.\n\n### Native wrappers\n\nEnough about the WebView. In this iteration, we decided to drop Appcelerator and go with some native code instead. Sure, this means we’d need two implementations, one in Java and one in Swift, but it’s not so bad. It’s not a lot of code, the end result is better, and it’s what our mobile devs would prefer to work with.\n\nThe native “wrappers” need to show our app in a WebView (which is stored locally), handle notifications, and so on. We found a way to communicate between our app, the native side, and vice versa. I must say it was pretty interesting to co-operate with native mobile developers on this. Once we agreed on the events to be sent back and forth, we were adding little touches which made the app feel a lot more native in no time. For example, if you were to tap the back button on Android, an event is sent into the WebView, and we then close whatever’s open, or hide the sidebar, etc.\n\nNotifications are another good example. The native side gives us an access token for the app instance on each launch, we send that off to our API and then send you push notifications based on that. We send metadata like the conversation ID in the push, so if you were to tap on it, the native side of our app would instruct our Web app to open the conversation in question, and voilà.\n\nYou can go a step further and clear existing notifications on Android, which is a nice touch. If you were to receive a push notification about a message, but then view it in one of our desktop or Web apps, then the notification would disappear as you’ve already seen the message. When you view a conversation, an event is sent to from your client to ones of our services, and eventually a “silent” (invisible) notification is sent out to your device. Our Java code grabs the conversation ID and clears all associated notifications.\n\n### But what about *real* mobile apps?\n\nOK, fine! Let’s talk about Web versus native for a second. Web apps on mobile have gotten a bad name, unfairly. “Our biggest mistake was betting too much on HTML5” is commonly attributed to Mark Zuckerberg. Even though I don’t think this is actually what Mark said, people have latched onto this. It’s rubbish. Facebook’s HTML5 push wasn’t very successful at that time for a few reasons, one of which was down to process, for example. They had a dedicated mobile team. Mobile was always an afterthought, and it showed. Now they have mobile developers on every team. Mobile developers are involved and mobile apps are considered from beginning of any feature. If it was up to me, Teamwork Chat would eventually have some mobile developers of its own too.\n\nA lot of apps you use are hybrid apps but they don’t announce it due to the stigma involved. The feed you see in the Instagram app, who’re owned by Facebook, is HTML.\n\nWe put in the effort to make a responsive app, why not try to flex it? Sure, I’m biased; I want the Web to win and it is possible to do what we had aimed to do. Don’t get me wrong though, fully native apps are the way to go for Teamwork Chat. At the end of this post, I’ll cover what the plans are for our mobile apps and the future of Teamwork Chat in general.\n\n### Sharing\n\n:::figure under-the-hood-of-a-hybrid-app/sharing.png The screen shown when something is shared to our Android app.\n:::\n\nAndroid and iOS diverge when it comes to the concept of sharing. For awhile now on Android, you can easily share anything from one app to another; once you tap the share icon, all apps which can handle files of that type will be shown. Typically, once you select an app, you’re then brought into said app, and how the app handles the rest varies. For example, the Twitter app will show a form to compose a tweet with the image already attached. Once you’re done, you’re still in the app. So we didn’t need to do much on the native side to achieve this. We pass the image data in an event from Java to JavaScript, and show a screen inside the WebView allowing you to choose which conversation to share the file to.\n\nOnce the user selects a conversation or decides to create a new one, we attach the image to the message form. Images are just one example though.\n\nThese days, the right thing to do on iOS is to have a “share extension.” This is almost like a separate app. It lives completely outside your app. What I mean is that when you decide to share something, a completely iOS-y dialog appears, in which the entire flow is contained, and you stay wherever you were once you’re done. So this is written completely in Swift and solely interacts with our API.\n\n### Feature parity\n\nThis is something I strongly believe in. I’ll strive to make sure every feature of Teamwork Chat ever released will be released on all platforms and apps at once. There’s nothing worse than seeing a press release for a really cool feature in an app you use, only to realise you’ll have to wait awhile longer than everyone else. You don’t want to alienate your loyal users.\n\nThis certainly applies to mobile apps. Everyone, please stop delivering your app to one platform before the other. Don’t punish anyone because of the device they happened to buy.\n\nYes, this means that I believe every feature should be accessible from anywhere, on any device. It’s 2016, I shouldn’t have to defend this. Nowadays it’s really hard to even define what “mobile” means anyway. Screen size? Hmm not really anymore. Touch? Not unique. On-the-go? No, a lot of real usage happens on the couch. I won’t go on. The lines are blurred.\n\nIn order to create an app for everywhere, you must design for touch everywhere and strive for simplicity. On the most narrow screen, you need to decide what’s critical for your users, moving on and up from there.\n\nThis comes with some fresh challenges. Releasing both Android and iOS apps at the same time is tough. Especially when there’s internal pressure to release one or the other. It’s hard to convince people at times. We’re users after all, we make stuff to scratch our own itch at Teamwork. I must admit I gave in once or twice, but I’ll continue to fight for it. As it is in general, internal perception is important here.\n\nI wish more people wrote about feature parity, mobile-first workflows, and the transition from something more archaic. It affects the process of delivering an app in a lot of unexpected ways. For example, I remember having to push back when it came to marketing videos, which typically featured iPhones and iOS only. These growing pains are good though.\n\nTo make this work, more people need to work together and in parallel to deliver something great together. It doesn’t help that your mobile app needs to be reviewed. Android app submissions may only take up to a day to go through validation at worse, but the Apple review process could be anywhere from a few days to a couple of weeks. Not only is it difficult to align all of the releases, but what if a submission gets rejected?\n\n### Living with a mobile app\n\nWorking on a mobile app is completely alien to Web developers. If you introduce a bug, you can’t just roll out a quick fix and forget about it. It can take a lot of time to release the fix and you’re not guaranteed every user will even accept the update. Luckily, we were already in this frame of mind as we have desktop apps which follow pretty much the same flow.\n\nEven though we’re used to pushing out desktop app releases, the delay and uncertainty involved here is a pain point. A workaround we’re looking at is updating our app without going through the app store. What I mean is that we ship our mobile app with our Web app inside as usual but when the app is launched, it hits an API or S3, checks for a newer version and downloads it in the background if one exists. Then this version would be used in the WebView on next launch. This would allow us to roll out changes on a whim.\n\nBy changes, I mean changes to the WebView only. Anything else will require a proper app store update. Full updates should be done regularly anyway so it doesn’t look we have never released an update. Also, so we can update the changelogs on the app store listing. It would feel weird to put stuff in the changelogs which have been in the app for awhile though. Yes, I’ve been told I’m paying too much attention to changelogs. We could run into the situation where the WebView or native wrapper sends an event which crashes the app if we were to make a breaking change in our event API.\n\nThis is interesting though; it makes me wonder about how we update our desktop apps. Maybe we could transition to an update process like this. The jury is still out yet though, the implications of a possible move from [NW.js](http://nwjs.io/) to [Electron](http://electron.atom.io/) would need to be taken into account here. You might see a post on this in the future.\n\n### Feature flags\n\nWe’ve been talking about using [proper feature flags](https://www.youtube.com/watch?v=JR-ccCTmMKY) for awhile now, but this could be something else which would help us achieve feature parity. The idea would be to put the code for a feature out there on every platform behind a flag. We have this already for tiny things, some code is conditionally ran for just us, etc. When I say “proper features flags” I mean we’d hit an API to get this setting. Once all of the releases are out, we’d enable toggle the feature flag and on next reload or relaunch, the feature would be there.\n\nTeamwork Chat is very much a single page app though, so it would be even better if a feature could be toggled at runtime. For example, we could enable search for everyone and boom, the search icon appears for everyone. This opens the door for progressively rolling stuff out, to certain accounts, to a percentage of our users, as well as A/B testing, and even disabling the feature again if the fan requires some cleaning.\n\n### The release\n\n<iframe width="560" height="315" src="https://www.youtube.com/embed/deorlUmLsdI" frameborder="0" allowfullscreen></iframe>\n\nExpecting that we’d be waiting awhile, we submitted our iOS app first. The terrible piece of software that is iTunes Connect gives you the option to release the app immediately once it has been validated, on or past a certain date, as well as a manual release. We opted for a manual release. The plan was that was once we were alerted that the app was ready, we’d submit the Android app, and once that was out, we’d hit the publish button. Note: the Google Play Developer Console (which is awful too) has added a manual release option since then.\n\nOur iOS app was rejected. Argh! We had marketing campaigns ongoing teasing something big, we had to quickly come up with a plan B. We didn’t want to be empty handed when the end of the month came by. Why did it fail? Basically, there was a misunderstanding in what our app was, and who it was targeted at. We promptly submitted an appeal, and even though we knew we were right, we were amazed to see the decision overturned a couple of days later. The Android release took a couple of hours, and that was it, the Teamwork Chat mobile apps were out there. We were ecstatic.\n\n### The future\n\nThere is definitely room for improvement, I’ll be the first to say it. They could be faster, start up quicker, be less janky, and so on. We’re going to work hard on this. The great thing is that this these efforts will translate into improvements in the Web and desktop apps as well.\n\nWe will be making native mobile apps. We have planned to for awhile now. We have some mobile developers in-house dying for a crack at it. Expect a couple of great apps that really feel at home in your OS. One upside to going down the native route is that users can see you care as you’ve tailored an app to their OS. Sure they’ll be distinct, the Android one will have a strong material design feel, but we’ll strive to keep in sync with each other and Teamwork Chat in general when it comes to features as well as the overall experience.\n\nSure, this means we’ll have fewer eyes on our Web app on a mobile Web browser or narrow screen, but it’s worth it.\n\n### Automation and deployment\n\nRight now, our desktop apps need to built on Windows for Windows and on Mac for Mac. This takes time. We’ve added more update channels which compounds the problem. I’d love to automate this. Mobile app builds and deployments could also be automated in a similar fashion. Watch this space.\n\nWhile we’re on the topic, I’m happy to say we’ve moved from DeployBot (formerly dploy.io) to [CodeShip](https://codeship.com/) for all continuous integration and deployment. DeployBot wasn’t reliable enough for us. One time I decided to roll back and it deployed the wrong commit. As well as incidents like that, their frequent maintenance windows seemed to always coincide with when we needed them the most.\n\nAll of our services are now deployed once we push to `master`. Same goes for the Web version, but we don’t roll out as often as I’d like. Continuous delivery is a target though, for the desktop apps as well as our Web app. Although, to get there, we need more automated tests. We’ve heavily tested certain critical pieces and at least 85% of new services are covered with tests, but we need more. Especially integration tests for clients, ran in multiple browsers concurrently. This is possible, I’ve done it previously with Selenium Grid, etc., we just haven’t made the time for it yet.\n\nThere are also a few tools out there now for testing responsive designs. We could, for example, take screenshots of pages at multiple breakpoints, compare them with the most recent stable ones, and fail the build if the visual diff is too much. Although this might not be a great fit for continuous integration; I’m not sure how it would work if you intentionally introduced a significant visual change. You could disable the test if a certain `[skip-resp-tests]` exists in the commit message, but what if you accidentally broke something else? Food for thought.\n\n### Lessons learned\n\nWe haven’t had too many scale-related pains, although we’ve found ourselves making more changes lately to take some load off [Teamwork Projects](https://teamwork.com/projects). Our (email and push) notifications service could certainly be more fault tolerant. We’ve made more use of Node.js’ [**cluster**](https://nodejs.org/api/cluster.html) module which allows us to use all of the cores on any given machine, and might yet solve another problem.\n\nAs I described in last year’s post, our clients connect directly to our WebSocket servers. This means a server rollout will result in users’ clients temporarily disconnecting (plus each of them hitting the API at the same time to get any messages they’ve missed). We’re going to workaround this by effectively hot reloading via `cluster` or having a dedicated instance in front of our WebSocket servers with the sole duty of accepting WebSocket connections and load-balancing the events that come over them.\n\nHow our services communicate is a bit simplistic in general. We’re going to switch over to RabbitMQ from Redis, re-do a lot of the messaging, and try to remove the dependency on a shared database at the same time.\n\n### Fire in the hole\n\nAs well as improving areas we’ve neglected, these are some of the bigger higher level features we have coming down the line:\n\n-  API\n-  Bots (prepared third-party bots and a bot API/platform)\n-  Conversation switcher\n-  Deeper integrations with [Teamwork Desk](https://teamwork.com/desk) and [Teamwork Projects](https://teamwork.com/projects)\n-  Email improvements\n-  Independent signup\n-  Linux desktop app\n-  More third-party integrations (including cards, bots, etc.)\n-  Native (Android & iOS) mobile apps\n-  Noise reduction (do not disturb, muting, notification settings, etc.)\n-  Opening Teamwork Chat to users outside the owner company\n-  Search\n\nThat’s all folks! We’ll catch up again next year. Feel free to reach out to us at [chat@teamwork.com](mailto:chat@teamwork.com) with any API or bot-related ideas or features requests. We’d love to know what you’d expect to see in our API. If you’d like to kick the tires of our hybrid, follow one of the following links:\n\n- [Android](https://play.google.com/store/apps/details?id=com.teamwork.chat&hl=en) \n- [iOS](https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8)\n\n---\n\n_Pssst!_ Did you know that Teamwork Chat developers get to do whatever they like after lunch every Friday? Including improving something which annoys them (even in other Teamwork projects), hacking away on a cool open-source project, learning something completely new, or even playing around with fun just for the sake of it. We have ambitious plans, we now have five apps to maintain, and a lot of interesting challenges ahead of us. Come [join the crew](https://www.teamwork.com/jobs/chat-developer).\n',unfilteredRenderedBody:'<h2><a id="under-the-hood-of-a-hybrid-app" class="post-header-anchor" href="#under-the-hood-of-a-hybrid-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Under the hood of a hybrid (app)</h2>\n<p>It has been about a year since we had <a href="http://engineroom.teamwork.com/under-the-hood-of-teamwork-chat/" rel="noopener">A peek under the hood of Teamwork Chat</a>. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More and more companies are using our app, including some really famous ones. At the time of writing this, over 12 million messages have been sent. Teamwork has grown three times in size, and the Teamwork Chat team with it, thanks to some great hires.</p>\n<p>Let’s take a look at some of my predictions from last year’s post;</p>\n<blockquote>\n<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture.</p>\n</blockquote>\n<p>Along with our Windows and Mac OS X desktop apps, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> is now available in your favourite Web browser. This was almost as easy as we expected. See <a href="http://engineroom.teamwork.com/author/donal/" rel="noopener">Donal’s</a> recent <a href="http://engineroom.teamwork.com/how-we-sped-up-serving-static-files-in-teamwork-chat/" rel="noopener">Deploying the Teamwork Chat Web app</a> post for more.</p>\n<p>Sure, Teamwork Chat is a mobile-first responsive app, so yes, users could access Teamwork Chat on their phones. This was welcomed with open arms, but did I make any mobile <em>app</em> predictions?</p>\n<blockquote>\n<p>Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>\n</blockquote>\n<p>Yep, and that’s what we’ve done. In this post, I’m going to describe how our <a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a> and <a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a> apps came to be, lessons we’ve learned along the way, and where we’re headed. Not only in respect to mobile apps, but Teamwork Chat as a whole.</p>\n<h3><a id="mobile-apps-finally" class="post-header-anchor" href="#mobile-apps-finally" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mobile apps, finally</h3>\n<p>We released our first internal prototype about a year ago; a mash of Appcelerator and some Web code. It wasn’t as nice as we thought it would be. We would’ve needed to put in a lot more work to make it really usable. We had bigger fish to fry though. After a painful period of trying to maintain it while delivering key features, it was put to one side. We eventually got back to it, starting again from scratch.</p>\n<p>Of course, we wanted Android and iOS apps which allowed you to do everything you could already do in Teamwork Chat. Push notifications and being able to share a file to the app were minimum requirements as well. Unlike other apps where you could get away without those, they’re critical for any chat app. We imagined that the least the Teamwork Chat mobile apps could do is allow you to contact someone while on the go and stay in the loop, as well as quickly share a photo you’ve just taken, for example.</p>\n<p>Our intention, as much now as it was then, is to have a consistent and familiar experience across all of our apps. Someone should be easily able to start a conversation on one device and carry it on elsewhere.</p>\n<h3><a id="reusing-our-web-app" class="post-header-anchor" href="#reusing-our-web-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Reusing our Web app</h3>\n<p>By this stage, users were crying out for mobile apps. Our plan was to get mobile apps out there and improve on them. We planned to reuse our Web app and see how far we could get. We took ownership of (most of) the app as apposed to our mobile team here at Teamwork. We got a lot of the way for free as we had already fought to maintain (mobile-first) reponsiveness and touch-friendliness throughout. We got an iPad app for free due to the fact our app is responsive. Note: we’ve never used device-orientated breakpoints in our designs.</p>\n<p>Now, mobile apps are also considered in every feature from the beginning. Reusing code between our Web, desktop, and mobile apps enables us to fix a bug once and it’s fixed everywhere. As I said in last year’s post, we use Node.js on the server-side, so we have some modules which are used in our Web app, our Mac &amp; Windows desktop apps, our Android &amp; iOS apps, and some services. Imagine that.</p>\n<p>It was more difficult than we had anticipated. Debugging was trickier for one, and sure we had made an app that was responsive, but it wasn’t <em>responsible</em>. I wish Teamwork Chat really was mobile-first. We should have worked on mobile apps or at least made the Web version first and used it in mobile Web browsers often. The app was far too bloated, it was doing too much all of the time, and so on. A lot of improvements came from making the mobile apps, which in turn improved every Teamwork Chat client as a result. All Teamwork Chat (mobile, Web, and desktop) apps now load faster, take less time to render, and so on, but we still have work to do.</p>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png" alt=""/></a>\n          <figcaption><p>A navigation menu we tweaked.</p>\n</figcaption>\n        </figure><p>We forced ourselves to use our mobile apps exclusively; any interaction we made in Teamwork Chat during the day had to be done in the mobile app. This really helped. We completely redesigned some navigation menus, made some tweaks around touch input, and more. Sure, we already designed our app for touch, but how often did we really use a touch laptop or heavily use the app in a mobile Web browser? Well, clearly not enough. So we fine-grained a few things, including the swipe to show or hide the sidebar.</p>\n<h3><a id="native-wrappers" class="post-header-anchor" href="#native-wrappers" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Native wrappers</h3>\n<p>Enough about the WebView. In this iteration, we decided to drop Appcelerator and go with some native code instead. Sure, this means we’d need two implementations, one in Java and one in Swift, but it’s not so bad. It’s not a lot of code, the end result is better, and it’s what our mobile devs would prefer to work with.</p>\n<p>The native “wrappers” need to show our app in a WebView (which is stored locally), handle notifications, and so on. We found a way to communicate between our app, the native side, and vice versa. I must say it was pretty interesting to co-operate with native mobile developers on this. Once we agreed on the events to be sent back and forth, we were adding little touches which made the app feel a lot more native in no time. For example, if you were to tap the back button on Android, an event is sent into the WebView, and we then close whatever’s open, or hide the sidebar, etc.</p>\n<p>Notifications are another good example. The native side gives us an access token for the app instance on each launch, we send that off to our API and then send you push notifications based on that. We send metadata like the conversation ID in the push, so if you were to tap on it, the native side of our app would instruct our Web app to open the conversation in question, and voilà.</p>\n<p>You can go a step further and clear existing notifications on Android, which is a nice touch. If you were to receive a push notification about a message, but then view it in one of our desktop or Web apps, then the notification would disappear as you’ve already seen the message. When you view a conversation, an event is sent to from your client to ones of our services, and eventually a “silent” (invisible) notification is sent out to your device. Our Java code grabs the conversation ID and clears all associated notifications.</p>\n<h3><a id="but-what-about-real-mobile-apps" class="post-header-anchor" href="#but-what-about-real-mobile-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>But what about <em>real</em> mobile apps?</h3>\n<p>OK, fine! Let’s talk about Web versus native for a second. Web apps on mobile have gotten a bad name, unfairly. “Our biggest mistake was betting too much on HTML5” is commonly attributed to Mark Zuckerberg. Even though I don’t think this is actually what Mark said, people have latched onto this. It’s rubbish. Facebook’s HTML5 push wasn’t very successful at that time for a few reasons, one of which was down to process, for example. They had a dedicated mobile team. Mobile was always an afterthought, and it showed. Now they have mobile developers on every team. Mobile developers are involved and mobile apps are considered from beginning of any feature. If it was up to me, Teamwork Chat would eventually have some mobile developers of its own too.</p>\n<p>A lot of apps you use are hybrid apps but they don’t announce it due to the stigma involved. The feed you see in the Instagram app, who’re owned by Facebook, is HTML.</p>\n<p>We put in the effort to make a responsive app, why not try to flex it? Sure, I’m biased; I want the Web to win and it is possible to do what we had aimed to do. Don’t get me wrong though, fully native apps are the way to go for Teamwork Chat. At the end of this post, I’ll cover what the plans are for our mobile apps and the future of Teamwork Chat in general.</p>\n<h3><a id="sharing" class="post-header-anchor" href="#sharing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Sharing</h3>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png" alt=""/></a>\n          <figcaption><p>The screen shown when something is shared to our Android app.</p>\n</figcaption>\n        </figure><p>Android and iOS diverge when it comes to the concept of sharing. For awhile now on Android, you can easily share anything from one app to another; once you tap the share icon, all apps which can handle files of that type will be shown. Typically, once you select an app, you’re then brought into said app, and how the app handles the rest varies. For example, the Twitter app will show a form to compose a tweet with the image already attached. Once you’re done, you’re still in the app. So we didn’t need to do much on the native side to achieve this. We pass the image data in an event from Java to JavaScript, and show a screen inside the WebView allowing you to choose which conversation to share the file to.</p>\n<p>Once the user selects a conversation or decides to create a new one, we attach the image to the message form. Images are just one example though.</p>\n<p>These days, the right thing to do on iOS is to have a “share extension.” This is almost like a separate app. It lives completely outside your app. What I mean is that when you decide to share something, a completely iOS-y dialog appears, in which the entire flow is contained, and you stay wherever you were once you’re done. So this is written completely in Swift and solely interacts with our API.</p>\n<h3><a id="feature-parity" class="post-header-anchor" href="#feature-parity" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature parity</h3>\n<p>This is something I strongly believe in. I’ll strive to make sure every feature of Teamwork Chat ever released will be released on all platforms and apps at once. There’s nothing worse than seeing a press release for a really cool feature in an app you use, only to realise you’ll have to wait awhile longer than everyone else. You don’t want to alienate your loyal users.</p>\n<p>This certainly applies to mobile apps. Everyone, please stop delivering your app to one platform before the other. Don’t punish anyone because of the device they happened to buy.</p>\n<p>Yes, this means that I believe every feature should be accessible from anywhere, on any device. It’s 2016, I shouldn’t have to defend this. Nowadays it’s really hard to even define what “mobile” means anyway. Screen size? Hmm not really anymore. Touch? Not unique. On-the-go? No, a lot of real usage happens on the couch. I won’t go on. The lines are blurred.</p>\n<p>In order to create an app for everywhere, you must design for touch everywhere and strive for simplicity. On the most narrow screen, you need to decide what’s critical for your users, moving on and up from there.</p>\n<p>This comes with some fresh challenges. Releasing both Android and iOS apps at the same time is tough. Especially when there’s internal pressure to release one or the other. It’s hard to convince people at times. We’re users after all, we make stuff to scratch our own itch at Teamwork. I must admit I gave in once or twice, but I’ll continue to fight for it. As it is in general, internal perception is important here.</p>\n<p>I wish more people wrote about feature parity, mobile-first workflows, and the transition from something more archaic. It affects the process of delivering an app in a lot of unexpected ways. For example, I remember having to push back when it came to marketing videos, which typically featured iPhones and iOS only. These growing pains are good though.</p>\n<p>To make this work, more people need to work together and in parallel to deliver something great together. It doesn’t help that your mobile app needs to be reviewed. Android app submissions may only take up to a day to go through validation at worse, but the Apple review process could be anywhere from a few days to a couple of weeks. Not only is it difficult to align all of the releases, but what if a submission gets rejected?</p>\n<h3><a id="living-with-a-mobile-app" class="post-header-anchor" href="#living-with-a-mobile-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Living with a mobile app</h3>\n<p>Working on a mobile app is completely alien to Web developers. If you introduce a bug, you can’t just roll out a quick fix and forget about it. It can take a lot of time to release the fix and you’re not guaranteed every user will even accept the update. Luckily, we were already in this frame of mind as we have desktop apps which follow pretty much the same flow.</p>\n<p>Even though we’re used to pushing out desktop app releases, the delay and uncertainty involved here is a pain point. A workaround we’re looking at is updating our app without going through the app store. What I mean is that we ship our mobile app with our Web app inside as usual but when the app is launched, it hits an API or S3, checks for a newer version and downloads it in the background if one exists. Then this version would be used in the WebView on next launch. This would allow us to roll out changes on a whim.</p>\n<p>By changes, I mean changes to the WebView only. Anything else will require a proper app store update. Full updates should be done regularly anyway so it doesn’t look we have never released an update. Also, so we can update the changelogs on the app store listing. It would feel weird to put stuff in the changelogs which have been in the app for awhile though. Yes, I’ve been told I’m paying too much attention to changelogs. We could run into the situation where the WebView or native wrapper sends an event which crashes the app if we were to make a breaking change in our event API.</p>\n<p>This is interesting though; it makes me wonder about how we update our desktop apps. Maybe we could transition to an update process like this. The jury is still out yet though, the implications of a possible move from <a href="http://nwjs.io/" rel="noopener">NW.js</a> to <a href="http://electron.atom.io/" rel="noopener">Electron</a> would need to be taken into account here. You might see a post on this in the future.</p>\n<h3><a id="feature-flags" class="post-header-anchor" href="#feature-flags" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature flags</h3>\n<p>We’ve been talking about using <a href="https://www.youtube.com/watch?v=JR-ccCTmMKY" rel="noopener">proper feature flags</a> for awhile now, but this could be something else which would help us achieve feature parity. The idea would be to put the code for a feature out there on every platform behind a flag. We have this already for tiny things, some code is conditionally ran for just us, etc. When I say “proper features flags” I mean we’d hit an API to get this setting. Once all of the releases are out, we’d enable toggle the feature flag and on next reload or relaunch, the feature would be there.</p>\n<p>Teamwork Chat is very much a single page app though, so it would be even better if a feature could be toggled at runtime. For example, we could enable search for everyone and boom, the search icon appears for everyone. This opens the door for progressively rolling stuff out, to certain accounts, to a percentage of our users, as well as A/B testing, and even disabling the feature again if the fan requires some cleaning.</p>\n<h3><a id="the-release" class="post-header-anchor" href="#the-release" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The release</h3>\n<iframe width="560" height="315" src="https://www.youtube.com/embed/deorlUmLsdI" frameborder="0" allowfullscreen></iframe>\n<p>Expecting that we’d be waiting awhile, we submitted our iOS app first. The terrible piece of software that is iTunes Connect gives you the option to release the app immediately once it has been validated, on or past a certain date, as well as a manual release. We opted for a manual release. The plan was that was once we were alerted that the app was ready, we’d submit the Android app, and once that was out, we’d hit the publish button. Note: the Google Play Developer Console (which is awful too) has added a manual release option since then.</p>\n<p>Our iOS app was rejected. Argh! We had marketing campaigns ongoing teasing something big, we had to quickly come up with a plan B. We didn’t want to be empty handed when the end of the month came by. Why did it fail? Basically, there was a misunderstanding in what our app was, and who it was targeted at. We promptly submitted an appeal, and even though we knew we were right, we were amazed to see the decision overturned a couple of days later. The Android release took a couple of hours, and that was it, the Teamwork Chat mobile apps were out there. We were ecstatic.</p>\n<h3><a id="the-future" class="post-header-anchor" href="#the-future" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The future</h3>\n<p>There is definitely room for improvement, I’ll be the first to say it. They could be faster, start up quicker, be less janky, and so on. We’re going to work hard on this. The great thing is that this these efforts will translate into improvements in the Web and desktop apps as well.</p>\n<p>We will be making native mobile apps. We have planned to for awhile now. We have some mobile developers in-house dying for a crack at it. Expect a couple of great apps that really feel at home in your OS. One upside to going down the native route is that users can see you care as you’ve tailored an app to their OS. Sure they’ll be distinct, the Android one will have a strong material design feel, but we’ll strive to keep in sync with each other and Teamwork Chat in general when it comes to features as well as the overall experience.</p>\n<p>Sure, this means we’ll have fewer eyes on our Web app on a mobile Web browser or narrow screen, but it’s worth it.</p>\n<h3><a id="automation-and-deployment" class="post-header-anchor" href="#automation-and-deployment" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Automation and deployment</h3>\n<p>Right now, our desktop apps need to built on Windows for Windows and on Mac for Mac. This takes time. We’ve added more update channels which compounds the problem. I’d love to automate this. Mobile app builds and deployments could also be automated in a similar fashion. Watch this space.</p>\n<p>While we’re on the topic, I’m happy to say we’ve moved from DeployBot (formerly <a href="http://dploy.io" rel="noopener">dploy.io</a>) to <a href="https://codeship.com/" rel="noopener">CodeShip</a> for all continuous integration and deployment. DeployBot wasn’t reliable enough for us. One time I decided to roll back and it deployed the wrong commit. As well as incidents like that, their frequent maintenance windows seemed to always coincide with when we needed them the most.</p>\n<p>All of our services are now deployed once we push to <code>master</code>. Same goes for the Web version, but we don’t roll out as often as I’d like. Continuous delivery is a target though, for the desktop apps as well as our Web app. Although, to get there, we need more automated tests. We’ve heavily tested certain critical pieces and at least 85% of new services are covered with tests, but we need more. Especially integration tests for clients, ran in multiple browsers concurrently. This is possible, I’ve done it previously with Selenium Grid, etc., we just haven’t made the time for it yet.</p>\n<p>There are also a few tools out there now for testing responsive designs. We could, for example, take screenshots of pages at multiple breakpoints, compare them with the most recent stable ones, and fail the build if the visual diff is too much. Although this might not be a great fit for continuous integration; I’m not sure how it would work if you intentionally introduced a significant visual change. You could disable the test if a certain <code>[skip-resp-tests]</code> exists in the commit message, but what if you accidentally broke something else? Food for thought.</p>\n<h3><a id="lessons-learned" class="post-header-anchor" href="#lessons-learned" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Lessons learned</h3>\n<p>We haven’t had too many scale-related pains, although we’ve found ourselves making more changes lately to take some load off <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a>. Our (email and push) notifications service could certainly be more fault tolerant. We’ve made more use of Node.js’ <a href="https://nodejs.org/api/cluster.html" rel="noopener"><strong>cluster</strong></a> module which allows us to use all of the cores on any given machine, and might yet solve another problem.</p>\n<p>As I described in last year’s post, our clients connect directly to our WebSocket servers. This means a server rollout will result in users’ clients temporarily disconnecting (plus each of them hitting the API at the same time to get any messages they’ve missed). We’re going to workaround this by effectively hot reloading via <code>cluster</code> or having a dedicated instance in front of our WebSocket servers with the sole duty of accepting WebSocket connections and load-balancing the events that come over them.</p>\n<p>How our services communicate is a bit simplistic in general. We’re going to switch over to RabbitMQ from Redis, re-do a lot of the messaging, and try to remove the dependency on a shared database at the same time.</p>\n<h3><a id="fire-in-the-hole" class="post-header-anchor" href="#fire-in-the-hole" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fire in the hole</h3>\n<p>As well as improving areas we’ve neglected, these are some of the bigger higher level features we have coming down the line:</p>\n<ul>\n<li>API</li>\n<li>Bots (prepared third-party bots and a bot API/platform)</li>\n<li>Conversation switcher</li>\n<li>Deeper integrations with <a href="https://teamwork.com/desk" rel="noopener">Teamwork Desk</a> and <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a></li>\n<li>Email improvements</li>\n<li>Independent signup</li>\n<li>Linux desktop app</li>\n<li>More third-party integrations (including cards, bots, etc.)</li>\n<li>Native (Android &amp; iOS) mobile apps</li>\n<li>Noise reduction (do not disturb, muting, notification settings, etc.)</li>\n<li>Opening Teamwork Chat to users outside the owner company</li>\n<li>Search</li>\n</ul>\n<p>That’s all folks! We’ll catch up again next year. Feel free to reach out to us at <a href="mailto:chat@teamwork.com">chat@teamwork.com</a> with any API or bot-related ideas or features requests. We’d love to know what you’d expect to see in our API. If you’d like to kick the tires of our hybrid, follow one of the following links:</p>\n<ul>\n<li><a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a></li>\n<li><a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a></li>\n</ul>\n<hr>\n<p><em>Pssst!</em> Did you know that Teamwork Chat developers get to do whatever they like after lunch every Friday? Including improving something which annoys them (even in other Teamwork projects), hacking away on a cool open-source project, learning something completely new, or even playing around with fun just for the sake of it. We have ambitious plans, we now have five apps to maintain, and a lot of interesting challenges ahead of us. Come <a href="https://www.teamwork.com/jobs/chat-developer" rel="noopener">join the crew</a>.</p>\n',attributes:{date:"2016-04-16T00:00:00.000Z",summary:"It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/under-the-hood-of-a-hybrid-app-2215ce6e342a"},tags:[{id:"product",name:"product"},{id:"web",name:"web"},{id:"javascript",name:"javascript"},{id:"nwjs",name:"NW.js"},{id:"node-webkit",name:"node-webkit"},{id:"desktop",name:"desktop"},{id:"hybrid",name:"hybrid"},{id:"mobile",name:"mobile"},{id:"development",name:"development"}],title:"Under the hood of a hybrid (app)",updated_at:"2019-05-22T08:26:38.756Z",photo:"/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png"},title:"Under the hood of a hybrid (app)",renderedSummary:"<p>It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...</p>\n",rendered:'<h2><a id="under-the-hood-of-a-hybrid-app" class="post-header-anchor" href="#under-the-hood-of-a-hybrid-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Under the hood of a hybrid (app)</h2>\n<p>It has been about a year since we had <a href="http://engineroom.teamwork.com/under-the-hood-of-teamwork-chat/" rel="noopener">A peek under the hood of Teamwork Chat</a>. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More and more companies are using our app, including some really famous ones. At the time of writing this, over 12 million messages have been sent. Teamwork has grown three times in size, and the Teamwork Chat team with it, thanks to some great hires.</p>\n<p>Let’s take a look at some of my predictions from last year’s post;</p>\n<blockquote>\n<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture.</p>\n</blockquote>\n<p>Along with our Windows and Mac OS X desktop apps, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> is now available in your favourite Web browser. This was almost as easy as we expected. See <a href="http://engineroom.teamwork.com/author/donal/" rel="noopener">Donal’s</a> recent <a href="http://engineroom.teamwork.com/how-we-sped-up-serving-static-files-in-teamwork-chat/" rel="noopener">Deploying the Teamwork Chat Web app</a> post for more.</p>\n<p>Sure, Teamwork Chat is a mobile-first responsive app, so yes, users could access Teamwork Chat on their phones. This was welcomed with open arms, but did I make any mobile <em>app</em> predictions?</p>\n<blockquote>\n<p>Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>\n</blockquote>\n<p>Yep, and that’s what we’ve done. In this post, I’m going to describe how our <a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a> and <a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a> apps came to be, lessons we’ve learned along the way, and where we’re headed. Not only in respect to mobile apps, but Teamwork Chat as a whole.</p>\n<h3><a id="mobile-apps-finally" class="post-header-anchor" href="#mobile-apps-finally" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mobile apps, finally</h3>\n<p>We released our first internal prototype about a year ago; a mash of Appcelerator and some Web code. It wasn’t as nice as we thought it would be. We would’ve needed to put in a lot more work to make it really usable. We had bigger fish to fry though. After a painful period of trying to maintain it while delivering key features, it was put to one side. We eventually got back to it, starting again from scratch.</p>\n<p>Of course, we wanted Android and iOS apps which allowed you to do everything you could already do in Teamwork Chat. Push notifications and being able to share a file to the app were minimum requirements as well. Unlike other apps where you could get away without those, they’re critical for any chat app. We imagined that the least the Teamwork Chat mobile apps could do is allow you to contact someone while on the go and stay in the loop, as well as quickly share a photo you’ve just taken, for example.</p>\n<p>Our intention, as much now as it was then, is to have a consistent and familiar experience across all of our apps. Someone should be easily able to start a conversation on one device and carry it on elsewhere.</p>\n<h3><a id="reusing-our-web-app" class="post-header-anchor" href="#reusing-our-web-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Reusing our Web app</h3>\n<p>By this stage, users were crying out for mobile apps. Our plan was to get mobile apps out there and improve on them. We planned to reuse our Web app and see how far we could get. We took ownership of (most of) the app as apposed to our mobile team here at Teamwork. We got a lot of the way for free as we had already fought to maintain (mobile-first) reponsiveness and touch-friendliness throughout. We got an iPad app for free due to the fact our app is responsive. Note: we’ve never used device-orientated breakpoints in our designs.</p>\n<p>Now, mobile apps are also considered in every feature from the beginning. Reusing code between our Web, desktop, and mobile apps enables us to fix a bug once and it’s fixed everywhere. As I said in last year’s post, we use Node.js on the server-side, so we have some modules which are used in our Web app, our Mac &amp; Windows desktop apps, our Android &amp; iOS apps, and some services. Imagine that.</p>\n<p>It was more difficult than we had anticipated. Debugging was trickier for one, and sure we had made an app that was responsive, but it wasn’t <em>responsible</em>. I wish Teamwork Chat really was mobile-first. We should have worked on mobile apps or at least made the Web version first and used it in mobile Web browsers often. The app was far too bloated, it was doing too much all of the time, and so on. A lot of improvements came from making the mobile apps, which in turn improved every Teamwork Chat client as a result. All Teamwork Chat (mobile, Web, and desktop) apps now load faster, take less time to render, and so on, but we still have work to do.</p>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png" alt=""/></a>\n          <figcaption><p>A navigation menu we tweaked.</p>\n</figcaption>\n        </figure><p>We forced ourselves to use our mobile apps exclusively; any interaction we made in Teamwork Chat during the day had to be done in the mobile app. This really helped. We completely redesigned some navigation menus, made some tweaks around touch input, and more. Sure, we already designed our app for touch, but how often did we really use a touch laptop or heavily use the app in a mobile Web browser? Well, clearly not enough. So we fine-grained a few things, including the swipe to show or hide the sidebar.</p>\n<h3><a id="native-wrappers" class="post-header-anchor" href="#native-wrappers" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Native wrappers</h3>\n<p>Enough about the WebView. In this iteration, we decided to drop Appcelerator and go with some native code instead. Sure, this means we’d need two implementations, one in Java and one in Swift, but it’s not so bad. It’s not a lot of code, the end result is better, and it’s what our mobile devs would prefer to work with.</p>\n<p>The native “wrappers” need to show our app in a WebView (which is stored locally), handle notifications, and so on. We found a way to communicate between our app, the native side, and vice versa. I must say it was pretty interesting to co-operate with native mobile developers on this. Once we agreed on the events to be sent back and forth, we were adding little touches which made the app feel a lot more native in no time. For example, if you were to tap the back button on Android, an event is sent into the WebView, and we then close whatever’s open, or hide the sidebar, etc.</p>\n<p>Notifications are another good example. The native side gives us an access token for the app instance on each launch, we send that off to our API and then send you push notifications based on that. We send metadata like the conversation ID in the push, so if you were to tap on it, the native side of our app would instruct our Web app to open the conversation in question, and voilà.</p>\n<p>You can go a step further and clear existing notifications on Android, which is a nice touch. If you were to receive a push notification about a message, but then view it in one of our desktop or Web apps, then the notification would disappear as you’ve already seen the message. When you view a conversation, an event is sent to from your client to ones of our services, and eventually a “silent” (invisible) notification is sent out to your device. Our Java code grabs the conversation ID and clears all associated notifications.</p>\n<h3><a id="but-what-about-real-mobile-apps" class="post-header-anchor" href="#but-what-about-real-mobile-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>But what about <em>real</em> mobile apps?</h3>\n<p>OK, fine! Let’s talk about Web versus native for a second. Web apps on mobile have gotten a bad name, unfairly. “Our biggest mistake was betting too much on HTML5” is commonly attributed to Mark Zuckerberg. Even though I don’t think this is actually what Mark said, people have latched onto this. It’s rubbish. Facebook’s HTML5 push wasn’t very successful at that time for a few reasons, one of which was down to process, for example. They had a dedicated mobile team. Mobile was always an afterthought, and it showed. Now they have mobile developers on every team. Mobile developers are involved and mobile apps are considered from beginning of any feature. If it was up to me, Teamwork Chat would eventually have some mobile developers of its own too.</p>\n<p>A lot of apps you use are hybrid apps but they don’t announce it due to the stigma involved. The feed you see in the Instagram app, who’re owned by Facebook, is HTML.</p>\n<p>We put in the effort to make a responsive app, why not try to flex it? Sure, I’m biased; I want the Web to win and it is possible to do what we had aimed to do. Don’t get me wrong though, fully native apps are the way to go for Teamwork Chat. At the end of this post, I’ll cover what the plans are for our mobile apps and the future of Teamwork Chat in general.</p>\n<h3><a id="sharing" class="post-header-anchor" href="#sharing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Sharing</h3>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png" alt=""/></a>\n          <figcaption><p>The screen shown when something is shared to our Android app.</p>\n</figcaption>\n        </figure><p>Android and iOS diverge when it comes to the concept of sharing. For awhile now on Android, you can easily share anything from one app to another; once you tap the share icon, all apps which can handle files of that type will be shown. Typically, once you select an app, you’re then brought into said app, and how the app handles the rest varies. For example, the Twitter app will show a form to compose a tweet with the image already attached. Once you’re done, you’re still in the app. So we didn’t need to do much on the native side to achieve this. We pass the image data in an event from Java to JavaScript, and show a screen inside the WebView allowing you to choose which conversation to share the file to.</p>\n<p>Once the user selects a conversation or decides to create a new one, we attach the image to the message form. Images are just one example though.</p>\n<p>These days, the right thing to do on iOS is to have a “share extension.” This is almost like a separate app. It lives completely outside your app. What I mean is that when you decide to share something, a completely iOS-y dialog appears, in which the entire flow is contained, and you stay wherever you were once you’re done. So this is written completely in Swift and solely interacts with our API.</p>\n<h3><a id="feature-parity" class="post-header-anchor" href="#feature-parity" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature parity</h3>\n<p>This is something I strongly believe in. I’ll strive to make sure every feature of Teamwork Chat ever released will be released on all platforms and apps at once. There’s nothing worse than seeing a press release for a really cool feature in an app you use, only to realise you’ll have to wait awhile longer than everyone else. You don’t want to alienate your loyal users.</p>\n<p>This certainly applies to mobile apps. Everyone, please stop delivering your app to one platform before the other. Don’t punish anyone because of the device they happened to buy.</p>\n<p>Yes, this means that I believe every feature should be accessible from anywhere, on any device. It’s 2016, I shouldn’t have to defend this. Nowadays it’s really hard to even define what “mobile” means anyway. Screen size? Hmm not really anymore. Touch? Not unique. On-the-go? No, a lot of real usage happens on the couch. I won’t go on. The lines are blurred.</p>\n<p>In order to create an app for everywhere, you must design for touch everywhere and strive for simplicity. On the most narrow screen, you need to decide what’s critical for your users, moving on and up from there.</p>\n<p>This comes with some fresh challenges. Releasing both Android and iOS apps at the same time is tough. Especially when there’s internal pressure to release one or the other. It’s hard to convince people at times. We’re users after all, we make stuff to scratch our own itch at Teamwork. I must admit I gave in once or twice, but I’ll continue to fight for it. As it is in general, internal perception is important here.</p>\n<p>I wish more people wrote about feature parity, mobile-first workflows, and the transition from something more archaic. It affects the process of delivering an app in a lot of unexpected ways. For example, I remember having to push back when it came to marketing videos, which typically featured iPhones and iOS only. These growing pains are good though.</p>\n<p>To make this work, more people need to work together and in parallel to deliver something great together. It doesn’t help that your mobile app needs to be reviewed. Android app submissions may only take up to a day to go through validation at worse, but the Apple review process could be anywhere from a few days to a couple of weeks. Not only is it difficult to align all of the releases, but what if a submission gets rejected?</p>\n<h3><a id="living-with-a-mobile-app" class="post-header-anchor" href="#living-with-a-mobile-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Living with a mobile app</h3>\n<p>Working on a mobile app is completely alien to Web developers. If you introduce a bug, you can’t just roll out a quick fix and forget about it. It can take a lot of time to release the fix and you’re not guaranteed every user will even accept the update. Luckily, we were already in this frame of mind as we have desktop apps which follow pretty much the same flow.</p>\n<p>Even though we’re used to pushing out desktop app releases, the delay and uncertainty involved here is a pain point. A workaround we’re looking at is updating our app without going through the app store. What I mean is that we ship our mobile app with our Web app inside as usual but when the app is launched, it hits an API or S3, checks for a newer version and downloads it in the background if one exists. Then this version would be used in the WebView on next launch. This would allow us to roll out changes on a whim.</p>\n<p>By changes, I mean changes to the WebView only. Anything else will require a proper app store update. Full updates should be done regularly anyway so it doesn’t look we have never released an update. Also, so we can update the changelogs on the app store listing. It would feel weird to put stuff in the changelogs which have been in the app for awhile though. Yes, I’ve been told I’m paying too much attention to changelogs. We could run into the situation where the WebView or native wrapper sends an event which crashes the app if we were to make a breaking change in our event API.</p>\n<p>This is interesting though; it makes me wonder about how we update our desktop apps. Maybe we could transition to an update process like this. The jury is still out yet though, the implications of a possible move from <a href="http://nwjs.io/" rel="noopener">NW.js</a> to <a href="http://electron.atom.io/" rel="noopener">Electron</a> would need to be taken into account here. You might see a post on this in the future.</p>\n<h3><a id="feature-flags" class="post-header-anchor" href="#feature-flags" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature flags</h3>\n<p>We’ve been talking about using <a href="https://www.youtube.com/watch?v=JR-ccCTmMKY" rel="noopener">proper feature flags</a> for awhile now, but this could be something else which would help us achieve feature parity. The idea would be to put the code for a feature out there on every platform behind a flag. We have this already for tiny things, some code is conditionally ran for just us, etc. When I say “proper features flags” I mean we’d hit an API to get this setting. Once all of the releases are out, we’d enable toggle the feature flag and on next reload or relaunch, the feature would be there.</p>\n<p>Teamwork Chat is very much a single page app though, so it would be even better if a feature could be toggled at runtime. For example, we could enable search for everyone and boom, the search icon appears for everyone. This opens the door for progressively rolling stuff out, to certain accounts, to a percentage of our users, as well as A/B testing, and even disabling the feature again if the fan requires some cleaning.</p>\n<h3><a id="the-release" class="post-header-anchor" href="#the-release" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The release</h3>\n<iframe width="560" height="315" src="https://www.youtube.com/embed/deorlUmLsdI" frameborder="0" allowfullscreen></iframe>\n<p>Expecting that we’d be waiting awhile, we submitted our iOS app first. The terrible piece of software that is iTunes Connect gives you the option to release the app immediately once it has been validated, on or past a certain date, as well as a manual release. We opted for a manual release. The plan was that was once we were alerted that the app was ready, we’d submit the Android app, and once that was out, we’d hit the publish button. Note: the Google Play Developer Console (which is awful too) has added a manual release option since then.</p>\n<p>Our iOS app was rejected. Argh! We had marketing campaigns ongoing teasing something big, we had to quickly come up with a plan B. We didn’t want to be empty handed when the end of the month came by. Why did it fail? Basically, there was a misunderstanding in what our app was, and who it was targeted at. We promptly submitted an appeal, and even though we knew we were right, we were amazed to see the decision overturned a couple of days later. The Android release took a couple of hours, and that was it, the Teamwork Chat mobile apps were out there. We were ecstatic.</p>\n<h3><a id="the-future" class="post-header-anchor" href="#the-future" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The future</h3>\n<p>There is definitely room for improvement, I’ll be the first to say it. They could be faster, start up quicker, be less janky, and so on. We’re going to work hard on this. The great thing is that this these efforts will translate into improvements in the Web and desktop apps as well.</p>\n<p>We will be making native mobile apps. We have planned to for awhile now. We have some mobile developers in-house dying for a crack at it. Expect a couple of great apps that really feel at home in your OS. One upside to going down the native route is that users can see you care as you’ve tailored an app to their OS. Sure they’ll be distinct, the Android one will have a strong material design feel, but we’ll strive to keep in sync with each other and Teamwork Chat in general when it comes to features as well as the overall experience.</p>\n<p>Sure, this means we’ll have fewer eyes on our Web app on a mobile Web browser or narrow screen, but it’s worth it.</p>\n<h3><a id="automation-and-deployment" class="post-header-anchor" href="#automation-and-deployment" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Automation and deployment</h3>\n<p>Right now, our desktop apps need to built on Windows for Windows and on Mac for Mac. This takes time. We’ve added more update channels which compounds the problem. I’d love to automate this. Mobile app builds and deployments could also be automated in a similar fashion. Watch this space.</p>\n<p>While we’re on the topic, I’m happy to say we’ve moved from DeployBot (formerly <a href="http://dploy.io" rel="noopener">dploy.io</a>) to <a href="https://codeship.com/" rel="noopener">CodeShip</a> for all continuous integration and deployment. DeployBot wasn’t reliable enough for us. One time I decided to roll back and it deployed the wrong commit. As well as incidents like that, their frequent maintenance windows seemed to always coincide with when we needed them the most.</p>\n<p>All of our services are now deployed once we push to <code>master</code>. Same goes for the Web version, but we don’t roll out as often as I’d like. Continuous delivery is a target though, for the desktop apps as well as our Web app. Although, to get there, we need more automated tests. We’ve heavily tested certain critical pieces and at least 85% of new services are covered with tests, but we need more. Especially integration tests for clients, ran in multiple browsers concurrently. This is possible, I’ve done it previously with Selenium Grid, etc., we just haven’t made the time for it yet.</p>\n<p>There are also a few tools out there now for testing responsive designs. We could, for example, take screenshots of pages at multiple breakpoints, compare them with the most recent stable ones, and fail the build if the visual diff is too much. Although this might not be a great fit for continuous integration; I’m not sure how it would work if you intentionally introduced a significant visual change. You could disable the test if a certain <code>[skip-resp-tests]</code> exists in the commit message, but what if you accidentally broke something else? Food for thought.</p>\n<h3><a id="lessons-learned" class="post-header-anchor" href="#lessons-learned" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Lessons learned</h3>\n<p>We haven’t had too many scale-related pains, although we’ve found ourselves making more changes lately to take some load off <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a>. Our (email and push) notifications service could certainly be more fault tolerant. We’ve made more use of Node.js’ <a href="https://nodejs.org/api/cluster.html" rel="noopener"><strong>cluster</strong></a> module which allows us to use all of the cores on any given machine, and might yet solve another problem.</p>\n<p>As I described in last year’s post, our clients connect directly to our WebSocket servers. This means a server rollout will result in users’ clients temporarily disconnecting (plus each of them hitting the API at the same time to get any messages they’ve missed). We’re going to workaround this by effectively hot reloading via <code>cluster</code> or having a dedicated instance in front of our WebSocket servers with the sole duty of accepting WebSocket connections and load-balancing the events that come over them.</p>\n<p>How our services communicate is a bit simplistic in general. We’re going to switch over to RabbitMQ from Redis, re-do a lot of the messaging, and try to remove the dependency on a shared database at the same time.</p>\n<h3><a id="fire-in-the-hole" class="post-header-anchor" href="#fire-in-the-hole" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fire in the hole</h3>\n<p>As well as improving areas we’ve neglected, these are some of the bigger higher level features we have coming down the line:</p>\n<ul>\n<li>API</li>\n<li>Bots (prepared third-party bots and a bot API/platform)</li>\n<li>Conversation switcher</li>\n<li>Deeper integrations with <a href="https://teamwork.com/desk" rel="noopener">Teamwork Desk</a> and <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a></li>\n<li>Email improvements</li>\n<li>Independent signup</li>\n<li>Linux desktop app</li>\n<li>More third-party integrations (including cards, bots, etc.)</li>\n<li>Native (Android &amp; iOS) mobile apps</li>\n<li>Noise reduction (do not disturb, muting, notification settings, etc.)</li>\n<li>Opening Teamwork Chat to users outside the owner company</li>\n<li>Search</li>\n</ul>\n<p>That’s all folks! We’ll catch up again next year. Feel free to reach out to us at <a href="mailto:chat@teamwork.com">chat@teamwork.com</a> with any API or bot-related ideas or features requests. We’d love to know what you’d expect to see in our API. If you’d like to kick the tires of our hybrid, follow one of the following links:</p>\n<ul>\n<li><a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a></li>\n<li><a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a></li>\n</ul>\n<hr>\n<p><em>Pssst!</em> Did you know that Teamwork Chat developers get to do whatever they like after lunch every Friday? Including improving something which annoys them (even in other Teamwork projects), hacking away on a cool open-source project, learning something completely new, or even playing around with fun just for the sake of it. We have ambitious plans, we now have five apps to maintain, and a lot of interesting challenges ahead of us. Come <a href="https://www.teamwork.com/jobs/chat-developer" rel="noopener">join the crew</a>.</p>\n',summary:"It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/under-the-hood-of-a-hybrid-app-2215ce6e342a"},photo:"/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png",keywords:["product","web","javascript","NW.js","node-webkit","desktop","hybrid","mobile","development"],published_at:"2016-04-16T00:00:00.000Z",updated_at:"2019-05-22T08:26:38.756Z",year:2016,month:4,day:17,relevanceScore:.45833333333333326},{id:"resurrecting-clippy",slug:"resurrecting-clippy",highlightedLanguages:["javascript","css"],source:'---\ndate: 2016-03-08\nsummary: Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork\'s Engine Room\n  url: https://engineroom.teamwork.com/resurrecting-clippy-89843fcc9871\ntags:\n  - clippy\n  - desktop\n  - app\n  - nw.js\n  - node-webkit\n  - javascript\n  - development\n---\n\n## Resurrecting Clippy\n\n![Clippy on Mac OS X](/images/blog-content/resurrecting-clippy/osx.png)\n\nRemember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat Clippy? Yeah, you should be ashamed of yourself. You either loved or hated Clippy. **Spoiler**: after a lot of backlash, Microsoft secretly ran a smear campaign against its own little paperclip, including an anti-Clippy Website, a “Kill Clippy” game, and more. _“I see you’re trying to destroy me, would you like help with that?”_ Clippy said. Eventually retiring Clippy to fanfare, Microsoft masterfully spun your anger into positive press. Shame on all of you.\n\nI’m sure you’ve only recently stopped having guilt-ridden nightmares of a dancing paperclip, but I’ve good news. I’ve made a desktop application which not only brings Clippy back to Windows, but introduces Mac and Linux users to 90’s Siri too! Clippy.desktop is available for download at [teamwork.github.io/clippy.desktop](https://teamwork.github.io/clippy.desktop).\n\nWhy? Because I can. There’s just something satisfying about seeing Clippy on Windows 10 or El Capitan. It wasn’t even hard; I feel like an imposter for simply throwing together a few open-source things, so I’m going to use this an opportunity to share how easy it is to make a desktop app with NW.js (and a few pitfalls). For extra measure, here’s an embarrassing photo of me as a child:\n\n:::figure resurrecting-clippy/embarrassing.jpg Look at those curls.\n:::\n\n### Desktop (Web) apps\n\nQuickly moving on, [NW.js](http://nwjs.io/) was an obvious choice to make the app as we built the [Teamwork Chat](https://teamwork.com/chat) desktop apps with it. NW.js, along with the trendier [Electron](http://electron.atom.io/), combines Chromium and Node.js to allow you to create a desktop application from a Web application. So the resultant executable is a standalone appplication just like Chrome which has access to all of the Node.js API as well. It’s great.\n\nIt doesn’t take long to get up and running either. You technically don’t need Node.js to develop an NW.js app, but I’ll assume you have it. First, grab the offical npm package; run `npm install -g nw` to make it available from anywhere on your machine. In a new directory named `clippy-desktop`, create a HTML file with whatever content you\'d like. All we need now is an "app manifest"; run `npm init` and follow the steps the generate one. Enter the name of your HTML file when asked for the `main` file. Why `npm init`? The app manifest is basically the same as any npm module\'s `package.json` (where its dependencies are listed, and so on.). So, now you have a basic manifest looks something like this:\n\n```javascript\n{\n  "name": "clippy-desktop",\n  "version": "0.0.1",\n  "main": "index.html",\n  "dependencies": {}\n}\n```\n\nNow, run `nw clippy-desktop`.\n\n:::figure resurrecting-clippy/running.png\n:::\n\nTa-da! Your app is running. If you don’t believe me, click the hamburger icon in the top right to access the DevTools and inspect the HTML.\n\n### Hello, Clippy!\n\nOk, ok, I’ll get to Clippy already. All credit to [Smore](https://www.smore.com) for creating a HTML, CSS, and JavaScript implementation of clippy **in a weekend**; [ClippyJS](https://www.smore.com/clippy-js) is impressive! Let’s use it in our app.\n\nSmore recommend downloading the CSS and JavaScript files from the ClippyJS GitHub repository, but let’s use this as an oppurtunity to learn how using dependencies from npm works. npm is Node.js’ package manager we used earlier to install `nw`. ClippyJS isn\'t on npm (yet) but it is on GitHub and npm allows us to install it straight from GitHub by running `npm install --save smore-inc/clippy.js`. That would work but if the ClippyJS repository wasn\'t missing the manifest every Node.js module needs. So I\'ve forked the ClippyJS repository and added the `package.json` (note that I\'ve added jQuery under `dependencies`). Now, running `npm install --save adam-lynch/clippy.js#pkg` will install ClippyJS into `clippy-desktop/node_modules`. To include ClippyJS we have to reference the CSS and JavaScript files just like we would in any Web app, adding `<link href="node_modules/clippy.js/build/clippy.css" rel="stylesheet"/>` and `<script src="node_modules/clippy.js/build/clippy.min.js"><\/script>` to the correct files.\n\nNote: Just in case you’ve noticed that Clippy.desktop’s `index.html` doesn\'t reference each file like I\'ve just said; I\'ve combined the dependencies into `third-party.js` just to make it cleaner, similarly to what\'s described in [Hassle-free third-party dependencies](https://adamlynch.com/hassle-free-third-party-dependencies/).\n\nThe ClippyJS site says we’ll need to programatically show Clippy ourselves, so let’s create a `script.js` with the following contents:\n\n```javascript\nclippy.load(\'Clippy\', function(agent) {\n    agent.show();\n});\n```\n\nTo resurrect Clippy:\n\n- Make sure you’ve added a `<script>` linking to your `script.js`.\n- Kill the running app.\n- Run `nw clippy-desktop` again.\n\n### What now?!\n\nHuh. It’s not working. Open the DevTools and check for any errors. Hmm…\n\n```javascript\nFailed to load resource: net::ERR\\_FILE\\_NOT\\_FOUND\n```\n\nAh, the problem is [this line](https://github.com/smore-inc/clippy.js/blob/master/src/load.js#L1) in the ClippyJS source:\n\n```javascript\nclippy.BASE_PATH = \'//s3.amazonaws.com/clippy.js/Agents/\';\n```\n\nThe main ClippyJS file seems to be requesting more scripts from Amazon S3\\. See that the URL begins with `//` That\'s a [protocol-relative URL](http://www.paulirish.com/2010/the-protocol-relative-url/), i.e. if the current site was accessed over HTTPS, HTTPS will be used as the protocol when requesting this URL, or HTTP if the site was accessed over HTTP. But the protocol in our case is neither HTTP nor HTTPs; our `index.html` is a local file and accessed as such. In our case, this URL would be expanded tofile:///s3.amazonaws.com.... So if you want your Web app to work on the desktop, avoid protocol-relative URLs. To fix this line, you would need to have something like the following:\n\n```javascript\nclippy.BASE_PATH = (window.location.protocol === \'file:\' ? \'https:\' : window.location.protocol) + \'//s3.amazonaws.com/clippy.js/Agents/\';\n```\n\nSo, after I updated this in my fork of ClippyJS, I re-ran the `npm install` command and re-launched the app.\n\n### Think outside the box\n\nIt could be prettier though right? Let’s start by making the window a bit smaller, removing the frame, and removing the toolbar (the search bar, etc.). Add the following to the app manifest:\n\n```javascript\n"window": {\n  "frame": false,\n  "toolbar": false,\n  "width": 300,\n  "height": 300\n}\n```\n\nThat’s it.\n\nAlthough if you’re on Mac OS X you’ll notice there’s a [weird bug](https://github.com/nwjs/nw.js/issues/3645) where the window title is still shown. To workaround this, we can give the window a dummy title. We only want to do this if the app is running on Mac though, so let’s use Node.js’ core `os` module to detect the platform. Adding this to our `script.js` should be enough to solve the problem:\n\n```javascript\nvar isMac = require(\'os\').platform() === \'darwin\';\n\nif (isMac) {\n    document.title = \'\\u3000\'; // to get around https://github.com/nwjs/nw.js/issues/3645\n}\n```\n\n:::figure resurrecting-clippy/frameless.png The frameless app.\n:::\n\nOk, it’s better but let’s ditch that background.\n\nTransparency\n\nLet’s go back to our manifest and add a `transparent` property inside `window`;\n\n```javascript\n"window": {\n  "frame": false,\n  "toolbar": false,\n  "width": 300,\n  "height": 300,\n  "transparent": true\n}\n```\n\nThis gives the app the _ability_ to be transparent, but doesn’t make it transparent. This can be toggled programmatically as well. Note: depending on the platform, you may need to jump through some extra hoops, see [Transparency and NW.js](https://www.packtpub.com/books/content/transparency-and-nwjs). All that’s left is to make sure your elements are not\n\nAll that’s left is to make sure your elements are not opague; for example:\n\n```css\nbody {\n  background: transparent;\n}\n```\n\n### Dragging\n\nWe no longer have a window title bar so we can’t drag it around anymore. CSS to the rescue, again!\n\n```css\nbody {\n  -webkit-app-region: drag;\n}\n```\n\nNow you can drag the app by clicking and holding anywhere on the `body`.\n\nUnfortunately, double-clicking a draggable area triggers the window to maximize on some platforms. So what we’ll do is tell the user that double clicking will close clippy.desktop, thanks to clippy.js’ `agent.speak` method which shows a speech bubble. Just to annoy the user even more, we won’t. Instead, Clippy will disappear and reappear again after a couple of seconds. This is done in the `clippy.load` callback:\n\n```javascript\n// show clippy\nclippy.load(\'Clippy\', function(agent){\n    agent.show();\n    var intiialSpeechTimeoutId = setTimeout(function() {\n        agent.speak("Need some help closing me? Try double-clicking...");\n    }, 20000);\n\n    var windowX = null;\n    var windowY = null;\n    setTimeout(function(){\n        windowX = win.x;\n        windowY = win.y;\n    }, 250);\n\n    // ...\n\n    // Since double-clicking draggable areas triggers maximizing on some platforms, when tell the user double-clicking\n    // closes clippy but actually we\'ll hide the window, unmaximize, resize back to the normal size and show again\n    // with a speech bubble\n    win.on(\'maximize\', function(){\n        document.body.classList.add(\'hidden\');\n        win.hide();\n        if(intiialSpeechTimeoutId) {\n            clearTimeout(intiialSpeechTimeoutId);\n            intiialSpeechTimeoutId = null;\n        }\n\n        setTimeout(function(){\n            win.unmaximize();\n            win.resizeTo(gui.App.manifest.window.width, gui.App.manifest.window.height);\n            win.moveTo(windowX, windowY);\n        }, 250);\n\n        setTimeout(function(){\n            win.show();\n            document.body.classList.remove(\'hidden\');\n            setTimeout(function(){\n                agent.speak("Need some help?");\n            }, 500);\n        }, 2000);\n    });\n});\n```\n\n### Events\n\nSpeaking of clicking, we also block clippy.js from adding any event handlers itself with jQuery;\n\n```javascript\n$.fn.on = function(){};\n```\n\nThis is before `clippy.load` is called. We want to handle clicks and everything else ourselves.\n\nAnimating Clippy on click should be easy right? You might not be aware but if a window is not focused on Mac OS X, the first click focuses the window and the second click actually clicks the element. This is expected behavior on Mac OS X. Note: This is why you never create HTML window controls and bars when using NW.js or Electron, as it would take two clicks to minimize a window for example.\n\nThis is why I use the window’s `focus` event instead. Whenever the window is focused, I trigger an animation and blur the window.\n\n```javascript\n// to be safe: use focus as a click handler kinda, to trigger animations. Blur when done so every click triggers\n// an animation\nwin.on(‘focus’, function() {\n  agent.animate();\n  win.blur();\n});\n```\n\nNote: Cross-platform support for blurring isn’t 100% solid so it’s best to just trigger an animation every once in awhile anyway as well.\n\n### I see you have no internet connection\n\nIf you’re offline, clippy.desktop doesn’t show anything. Why? Let’s take a look at the line in clippy.js again:\n\n```javascript\nclippy.BASE_PATH = (window.location.protocol === ‘file:’ ? ‘https:’ : window.location.protocol) + ‘//s3.amazonaws.com/clippy.js/Agents/’;\n```\n\nWhy is it doing anything at all with URLs? I’m not sure why it wasn’t bundled into one script but ClippyJS requests additional (remote) scripts from within the base clippy.js script. This doesn’t make sense for a desktop app.\n\n![](/images/blog-content/resurrecting-clippy/mental.png)\n\n### Mental mode\n\nThis is where you come in. This implementation is just a start. Feel free to [improve it in a pull-request](https://github.com/teamwork/clippy.desktop). After all, it’s just HTML, CSS, and Javascript. I’m not suggesting that you add a mode which makes Clippy disappear on `mouseover`, reappear elsewhere, jump around the place, driving the user insane. Definitely not.\n\n### TL;DR\n\n- It’s easy to make a desktop (Web) app with NW.js.\n- You can access all of Node.js, its module system and npm.\n- Don’t use protocol-less URIs.\n- Be aware of how Mac OS X treats clicks on unfocused windows.\n- Make sure your app works offline.\n- Have fun.\n',unfilteredRenderedBody:'<h2><a id="resurrecting-clippy" class="post-header-anchor" href="#resurrecting-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resurrecting Clippy</h2>\n<p><img src="/images/blog-content/resurrecting-clippy/osx.png" alt="Clippy on Mac OS X"></p>\n<p>Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat Clippy? Yeah, you should be ashamed of yourself. You either loved or hated Clippy. <strong>Spoiler</strong>: after a lot of backlash, Microsoft secretly ran a smear campaign against its own little paperclip, including an anti-Clippy Website, a “Kill Clippy” game, and more. <em>“I see you’re trying to destroy me, would you like help with that?”</em> Clippy said. Eventually retiring Clippy to fanfare, Microsoft masterfully spun your anger into positive press. Shame on all of you.</p>\n<p>I’m sure you’ve only recently stopped having guilt-ridden nightmares of a dancing paperclip, but I’ve good news. I’ve made a desktop application which not only brings Clippy back to Windows, but introduces Mac and Linux users to 90’s Siri too! Clippy.desktop is available for download at <a href="https://teamwork.github.io/clippy.desktop" rel="noopener">teamwork.github.io/clippy.desktop</a>.</p>\n<p>Why? Because I can. There’s just something satisfying about seeing Clippy on Windows 10 or El Capitan. It wasn’t even hard; I feel like an imposter for simply throwing together a few open-source things, so I’m going to use this an opportunity to share how easy it is to make a desktop app with NW.js (and a few pitfalls). For extra measure, here’s an embarrassing photo of me as a child:</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/embarrassing.jpg"><img src="/images/blog-content/resurrecting-clippy/embarrassing.jpg" alt=""/></a>\n          <figcaption><p>Look at those curls.</p>\n</figcaption>\n        </figure><h3><a id="desktop-web-apps" class="post-header-anchor" href="#desktop-web-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Desktop (Web) apps</h3>\n<p>Quickly moving on, <a href="http://nwjs.io/" rel="noopener">NW.js</a> was an obvious choice to make the app as we built the <a href="https://teamwork.com/chat" rel="noopener">Teamwork Chat</a> desktop apps with it. NW.js, along with the trendier <a href="http://electron.atom.io/" rel="noopener">Electron</a>, combines Chromium and Node.js to allow you to create a desktop application from a Web application. So the resultant executable is a standalone appplication just like Chrome which has access to all of the Node.js API as well. It’s great.</p>\n<p>It doesn’t take long to get up and running either. You technically don’t need Node.js to develop an NW.js app, but I’ll assume you have it. First, grab the offical npm package; run <code>npm install -g nw</code> to make it available from anywhere on your machine. In a new directory named <code>clippy-desktop</code>, create a HTML file with whatever content you\'d like. All we need now is an &quot;app manifest&quot;; run <code>npm init</code> and follow the steps the generate one. Enter the name of your HTML file when asked for the <code>main</code> file. Why <code>npm init</code>? The app manifest is basically the same as any npm module\'s <code>package.json</code> (where its dependencies are listed, and so on.). So, now you have a basic manifest looks something like this:</p>\n<pre><code class="language-javascript"><span class="token punctuation">{</span>\n  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"clippy-desktop"</span><span class="token punctuation">,</span>\n  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>\n  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span>\n  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now, run <code>nw clippy-desktop</code>.</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/running.png"><img src="/images/blog-content/resurrecting-clippy/running.png" alt=""/></a>\n          \n        </figure><p>Ta-da! Your app is running. If you don’t believe me, click the hamburger icon in the top right to access the DevTools and inspect the HTML.</p>\n<h3><a id="hello-clippy" class="post-header-anchor" href="#hello-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Hello, Clippy!</h3>\n<p>Ok, ok, I’ll get to Clippy already. All credit to <a href="https://www.smore.com" rel="noopener">Smore</a> for creating a HTML, CSS, and JavaScript implementation of clippy <strong>in a weekend</strong>; <a href="https://www.smore.com/clippy-js" rel="noopener">ClippyJS</a> is impressive! Let’s use it in our app.</p>\n<p>Smore recommend downloading the CSS and JavaScript files from the ClippyJS GitHub repository, but let’s use this as an oppurtunity to learn how using dependencies from npm works. npm is Node.js’ package manager we used earlier to install <code>nw</code>. ClippyJS isn\'t on npm (yet) but it is on GitHub and npm allows us to install it straight from GitHub by running <code>npm install --save smore-inc/clippy.js</code>. That would work but if the ClippyJS repository wasn\'t missing the manifest every Node.js module needs. So I\'ve forked the ClippyJS repository and added the <code>package.json</code> (note that I\'ve added jQuery under <code>dependencies</code>). Now, running <code>npm install --save adam-lynch/clippy.js#pkg</code> will install ClippyJS into <code>clippy-desktop/node_modules</code>. To include ClippyJS we have to reference the CSS and JavaScript files just like we would in any Web app, adding <code>&lt;link href=&quot;node_modules/clippy.js/build/clippy.css&quot; rel=&quot;stylesheet&quot;/&gt;</code> and <code>&lt;script src=&quot;node_modules/clippy.js/build/clippy.min.js&quot;&gt;&lt;/script&gt;</code> to the correct files.</p>\n<p>Note: Just in case you’ve noticed that Clippy.desktop’s <code>index.html</code> doesn\'t reference each file like I\'ve just said; I\'ve combined the dependencies into <code>third-party.js</code> just to make it cleaner, similarly to what\'s described in <a href="https://adamlynch.com/hassle-free-third-party-dependencies/" rel="noopener">Hassle-free third-party dependencies</a>.</p>\n<p>The ClippyJS site says we’ll need to programatically show Clippy ourselves, so let’s create a <code>script.js</code> with the following contents:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>To resurrect Clippy:</p>\n<ul>\n<li>Make sure you’ve added a <code>&lt;script&gt;</code> linking to your <code>script.js</code>.</li>\n<li>Kill the running app.</li>\n<li>Run <code>nw clippy-desktop</code> again.</li>\n</ul>\n<h3><a id="what-now" class="post-header-anchor" href="#what-now" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>What now?!</h3>\n<p>Huh. It’s not working. Open the DevTools and check for any errors. Hmm…</p>\n<pre><code class="language-javascript">Failed to load resource<span class="token punctuation">:</span> net<span class="token punctuation">:</span><span class="token punctuation">:</span>ERR\\_FILE\\_NOT\\_FOUND\n</code></pre>\n<p>Ah, the problem is <a href="https://github.com/smore-inc/clippy.js/blob/master/src/load.js#L1" rel="noopener">this line</a> in the ClippyJS source:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>The main ClippyJS file seems to be requesting more scripts from Amazon S3. See that the URL begins with <code>//</code> That\'s a <a href="http://www.paulirish.com/2010/the-protocol-relative-url/" rel="noopener">protocol-relative URL</a>, i.e. if the current site was accessed over HTTPS, HTTPS will be used as the protocol when requesting this URL, or HTTP if the site was accessed over HTTP. But the protocol in our case is neither HTTP nor HTTPs; our <code>index.html</code> is a local file and accessed as such. In our case, this URL would be expanded tofile:///s3.amazonaws.com.... So if you want your Web app to work on the desktop, avoid protocol-relative URLs. To fix this line, you would need to have something like the following:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">\'file:\'</span> <span class="token operator">?</span> <span class="token string">\'https:\'</span> <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So, after I updated this in my fork of ClippyJS, I re-ran the <code>npm install</code> command and re-launched the app.</p>\n<h3><a id="think-outside-the-box" class="post-header-anchor" href="#think-outside-the-box" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Think outside the box</h3>\n<p>It could be prettier though right? Let’s start by making the window a bit smaller, removing the frame, and removing the toolbar (the search bar, etc.). Add the following to the app manifest:</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>That’s it.</p>\n<p>Although if you’re on Mac OS X you’ll notice there’s a <a href="https://github.com/nwjs/nw.js/issues/3645" rel="noopener">weird bug</a> where the window title is still shown. To workaround this, we can give the window a dummy title. We only want to do this if the app is running on Mac though, so let’s use Node.js’ core <code>os</code> module to detect the platform. Adding this to our <code>script.js</code> should be enough to solve the problem:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> isMac <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'os\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'darwin\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>isMac<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">\'\\u3000\'</span><span class="token punctuation">;</span> <span class="token comment">// to get around https://github.com/nwjs/nw.js/issues/3645</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/frameless.png"><img src="/images/blog-content/resurrecting-clippy/frameless.png" alt=""/></a>\n          <figcaption><p>The frameless app.</p>\n</figcaption>\n        </figure><p>Ok, it’s better but let’s ditch that background.</p>\n<p>Transparency</p>\n<p>Let’s go back to our manifest and add a <code>transparent</code> property inside <code>window</code>;</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"transparent"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>This gives the app the <em>ability</em> to be transparent, but doesn’t make it transparent. This can be toggled programmatically as well. Note: depending on the platform, you may need to jump through some extra hoops, see <a href="https://www.packtpub.com/books/content/transparency-and-nwjs" rel="noopener">Transparency and NW.js</a>. All that’s left is to make sure your elements are not</p>\n<p>All that’s left is to make sure your elements are not opague; for example:</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<h3><a id="dragging" class="post-header-anchor" href="#dragging" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dragging</h3>\n<p>We no longer have a window title bar so we can’t drag it around anymore. CSS to the rescue, again!</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">-webkit-app-region</span><span class="token punctuation">:</span> drag<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now you can drag the app by clicking and holding anywhere on the <code>body</code>.</p>\n<p>Unfortunately, double-clicking a draggable area triggers the window to maximize on some platforms. So what we’ll do is tell the user that double clicking will close clippy.desktop, thanks to clippy.js’ <code>agent.speak</code> method which shows a speech bubble. Just to annoy the user even more, we won’t. Instead, Clippy will disappear and reappear again after a couple of seconds. This is done in the <code>clippy.load</code> callback:</p>\n<pre><code class="language-javascript"><span class="token comment">// show clippy</span>\nclippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help closing me? Try double-clicking..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> windowX <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> windowY <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        windowX <span class="token operator">=</span> win<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n        windowY <span class="token operator">=</span> win<span class="token punctuation">.</span>y<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...</span>\n\n    <span class="token comment">// Since double-clicking draggable areas triggers maximizing on some platforms, when tell the user double-clicking</span>\n    <span class="token comment">// closes clippy but actually we\'ll hide the window, unmaximize, resize back to the normal size and show again</span>\n    <span class="token comment">// with a speech bubble</span>\n    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'maximize\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        win<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">unmaximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">resizeTo</span><span class="token punctuation">(</span>gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>windowX<span class="token punctuation">,</span> windowY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n                agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<h3><a id="events" class="post-header-anchor" href="#events" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Events</h3>\n<p>Speaking of clicking, we also block clippy.js from adding any event handlers itself with jQuery;</p>\n<pre><code class="language-javascript">$<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is before <code>clippy.load</code> is called. We want to handle clicks and everything else ourselves.</p>\n<p>Animating Clippy on click should be easy right? You might not be aware but if a window is not focused on Mac OS X, the first click focuses the window and the second click actually clicks the element. This is expected behavior on Mac OS X. Note: This is why you never create HTML window controls and bars when using NW.js or Electron, as it would take two clicks to minimize a window for example.</p>\n<p>This is why I use the window’s <code>focus</code> event instead. Whenever the window is focused, I trigger an animation and blur the window.</p>\n<pre><code class="language-javascript"><span class="token comment">// to be safe: use focus as a click handler kinda, to trigger animations. Blur when done so every click triggers</span>\n<span class="token comment">// an animation</span>\nwin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>‘focus’<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  agent<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  win<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note: Cross-platform support for blurring isn’t 100% solid so it’s best to just trigger an animation every once in awhile anyway as well.</p>\n<h3><a id="i-see-you-have-no-internet-connection" class="post-header-anchor" href="#i-see-you-have-no-internet-connection" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I see you have no internet connection</h3>\n<p>If you’re offline, clippy.desktop doesn’t show anything. Why? Let’s take a look at the line in clippy.js again:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> ‘file<span class="token punctuation">:</span>’ <span class="token operator">?</span> ‘https<span class="token punctuation">:</span>’ <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> ‘<span class="token comment">//s3.amazonaws.com/clippy.js/Agents/’;</span>\n</code></pre>\n<p>Why is it doing anything at all with URLs? I’m not sure why it wasn’t bundled into one script but ClippyJS requests additional (remote) scripts from within the base clippy.js script. This doesn’t make sense for a desktop app.</p>\n<p><img src="/images/blog-content/resurrecting-clippy/mental.png" alt=""></p>\n<h3><a id="mental-mode" class="post-header-anchor" href="#mental-mode" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mental mode</h3>\n<p>This is where you come in. This implementation is just a start. Feel free to <a href="https://github.com/teamwork/clippy.desktop" rel="noopener">improve it in a pull-request</a>. After all, it’s just HTML, CSS, and Javascript. I’m not suggesting that you add a mode which makes Clippy disappear on <code>mouseover</code>, reappear elsewhere, jump around the place, driving the user insane. Definitely not.</p>\n<h3><a id="tldr" class="post-header-anchor" href="#tldr" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>TL;DR</h3>\n<ul>\n<li>It’s easy to make a desktop (Web) app with NW.js.</li>\n<li>You can access all of Node.js, its module system and npm.</li>\n<li>Don’t use protocol-less URIs.</li>\n<li>Be aware of how Mac OS X treats clicks on unfocused windows.</li>\n<li>Make sure your app works offline.</li>\n<li>Have fun.</li>\n</ul>\n',attributes:{date:"2016-03-08T00:00:00.000Z",summary:"Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/resurrecting-clippy-89843fcc9871"},tags:[{id:"clippy",name:"clippy"},{id:"desktop",name:"desktop"},{id:"app",name:"app"},{id:"nwjs",name:"NW.js"},{id:"node-webkit",name:"node-webkit"},{id:"javascript",name:"javascript"},{id:"development",name:"development"}],title:"Resurrecting Clippy",updated_at:"2019-05-22T08:26:22.959Z",photo:"/images/blog-content/resurrecting-clippy/osx.png"},title:"Resurrecting Clippy",renderedSummary:"<p>Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...</p>\n",rendered:'<h2><a id="resurrecting-clippy" class="post-header-anchor" href="#resurrecting-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resurrecting Clippy</h2>\n<p><img src="/images/blog-content/resurrecting-clippy/osx.png" alt="Clippy on Mac OS X"></p>\n<p>Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat Clippy? Yeah, you should be ashamed of yourself. You either loved or hated Clippy. <strong>Spoiler</strong>: after a lot of backlash, Microsoft secretly ran a smear campaign against its own little paperclip, including an anti-Clippy Website, a “Kill Clippy” game, and more. <em>“I see you’re trying to destroy me, would you like help with that?”</em> Clippy said. Eventually retiring Clippy to fanfare, Microsoft masterfully spun your anger into positive press. Shame on all of you.</p>\n<p>I’m sure you’ve only recently stopped having guilt-ridden nightmares of a dancing paperclip, but I’ve good news. I’ve made a desktop application which not only brings Clippy back to Windows, but introduces Mac and Linux users to 90’s Siri too! Clippy.desktop is available for download at <a href="https://teamwork.github.io/clippy.desktop" rel="noopener">teamwork.github.io/clippy.desktop</a>.</p>\n<p>Why? Because I can. There’s just something satisfying about seeing Clippy on Windows 10 or El Capitan. It wasn’t even hard; I feel like an imposter for simply throwing together a few open-source things, so I’m going to use this an opportunity to share how easy it is to make a desktop app with NW.js (and a few pitfalls). For extra measure, here’s an embarrassing photo of me as a child:</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/embarrassing.jpg"><img src="/images/blog-content/resurrecting-clippy/embarrassing.jpg" alt=""/></a>\n          <figcaption><p>Look at those curls.</p>\n</figcaption>\n        </figure><h3><a id="desktop-web-apps" class="post-header-anchor" href="#desktop-web-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Desktop (Web) apps</h3>\n<p>Quickly moving on, <a href="http://nwjs.io/" rel="noopener">NW.js</a> was an obvious choice to make the app as we built the <a href="https://teamwork.com/chat" rel="noopener">Teamwork Chat</a> desktop apps with it. NW.js, along with the trendier <a href="http://electron.atom.io/" rel="noopener">Electron</a>, combines Chromium and Node.js to allow you to create a desktop application from a Web application. So the resultant executable is a standalone appplication just like Chrome which has access to all of the Node.js API as well. It’s great.</p>\n<p>It doesn’t take long to get up and running either. You technically don’t need Node.js to develop an NW.js app, but I’ll assume you have it. First, grab the offical npm package; run <code>npm install -g nw</code> to make it available from anywhere on your machine. In a new directory named <code>clippy-desktop</code>, create a HTML file with whatever content you\'d like. All we need now is an &quot;app manifest&quot;; run <code>npm init</code> and follow the steps the generate one. Enter the name of your HTML file when asked for the <code>main</code> file. Why <code>npm init</code>? The app manifest is basically the same as any npm module\'s <code>package.json</code> (where its dependencies are listed, and so on.). So, now you have a basic manifest looks something like this:</p>\n<pre><code class="language-javascript"><span class="token punctuation">{</span>\n  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"clippy-desktop"</span><span class="token punctuation">,</span>\n  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>\n  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span>\n  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now, run <code>nw clippy-desktop</code>.</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/running.png"><img src="/images/blog-content/resurrecting-clippy/running.png" alt=""/></a>\n          \n        </figure><p>Ta-da! Your app is running. If you don’t believe me, click the hamburger icon in the top right to access the DevTools and inspect the HTML.</p>\n<h3><a id="hello-clippy" class="post-header-anchor" href="#hello-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Hello, Clippy!</h3>\n<p>Ok, ok, I’ll get to Clippy already. All credit to <a href="https://www.smore.com" rel="noopener">Smore</a> for creating a HTML, CSS, and JavaScript implementation of clippy <strong>in a weekend</strong>; <a href="https://www.smore.com/clippy-js" rel="noopener">ClippyJS</a> is impressive! Let’s use it in our app.</p>\n<p>Smore recommend downloading the CSS and JavaScript files from the ClippyJS GitHub repository, but let’s use this as an oppurtunity to learn how using dependencies from npm works. npm is Node.js’ package manager we used earlier to install <code>nw</code>. ClippyJS isn\'t on npm (yet) but it is on GitHub and npm allows us to install it straight from GitHub by running <code>npm install --save smore-inc/clippy.js</code>. That would work but if the ClippyJS repository wasn\'t missing the manifest every Node.js module needs. So I\'ve forked the ClippyJS repository and added the <code>package.json</code> (note that I\'ve added jQuery under <code>dependencies</code>). Now, running <code>npm install --save adam-lynch/clippy.js#pkg</code> will install ClippyJS into <code>clippy-desktop/node_modules</code>. To include ClippyJS we have to reference the CSS and JavaScript files just like we would in any Web app, adding <code>&lt;link href=&quot;node_modules/clippy.js/build/clippy.css&quot; rel=&quot;stylesheet&quot;/&gt;</code> and <code>&lt;script src=&quot;node_modules/clippy.js/build/clippy.min.js&quot;&gt;&lt;/script&gt;</code> to the correct files.</p>\n<p>Note: Just in case you’ve noticed that Clippy.desktop’s <code>index.html</code> doesn\'t reference each file like I\'ve just said; I\'ve combined the dependencies into <code>third-party.js</code> just to make it cleaner, similarly to what\'s described in <a href="https://adamlynch.com/hassle-free-third-party-dependencies/" rel="noopener">Hassle-free third-party dependencies</a>.</p>\n<p>The ClippyJS site says we’ll need to programatically show Clippy ourselves, so let’s create a <code>script.js</code> with the following contents:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>To resurrect Clippy:</p>\n<ul>\n<li>Make sure you’ve added a <code>&lt;script&gt;</code> linking to your <code>script.js</code>.</li>\n<li>Kill the running app.</li>\n<li>Run <code>nw clippy-desktop</code> again.</li>\n</ul>\n<h3><a id="what-now" class="post-header-anchor" href="#what-now" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>What now?!</h3>\n<p>Huh. It’s not working. Open the DevTools and check for any errors. Hmm…</p>\n<pre><code class="language-javascript">Failed to load resource<span class="token punctuation">:</span> net<span class="token punctuation">:</span><span class="token punctuation">:</span>ERR\\_FILE\\_NOT\\_FOUND\n</code></pre>\n<p>Ah, the problem is <a href="https://github.com/smore-inc/clippy.js/blob/master/src/load.js#L1" rel="noopener">this line</a> in the ClippyJS source:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>The main ClippyJS file seems to be requesting more scripts from Amazon S3. See that the URL begins with <code>//</code> That\'s a <a href="http://www.paulirish.com/2010/the-protocol-relative-url/" rel="noopener">protocol-relative URL</a>, i.e. if the current site was accessed over HTTPS, HTTPS will be used as the protocol when requesting this URL, or HTTP if the site was accessed over HTTP. But the protocol in our case is neither HTTP nor HTTPs; our <code>index.html</code> is a local file and accessed as such. In our case, this URL would be expanded tofile:///s3.amazonaws.com.... So if you want your Web app to work on the desktop, avoid protocol-relative URLs. To fix this line, you would need to have something like the following:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">\'file:\'</span> <span class="token operator">?</span> <span class="token string">\'https:\'</span> <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So, after I updated this in my fork of ClippyJS, I re-ran the <code>npm install</code> command and re-launched the app.</p>\n<h3><a id="think-outside-the-box" class="post-header-anchor" href="#think-outside-the-box" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Think outside the box</h3>\n<p>It could be prettier though right? Let’s start by making the window a bit smaller, removing the frame, and removing the toolbar (the search bar, etc.). Add the following to the app manifest:</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>That’s it.</p>\n<p>Although if you’re on Mac OS X you’ll notice there’s a <a href="https://github.com/nwjs/nw.js/issues/3645" rel="noopener">weird bug</a> where the window title is still shown. To workaround this, we can give the window a dummy title. We only want to do this if the app is running on Mac though, so let’s use Node.js’ core <code>os</code> module to detect the platform. Adding this to our <code>script.js</code> should be enough to solve the problem:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> isMac <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'os\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'darwin\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>isMac<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">\'\\u3000\'</span><span class="token punctuation">;</span> <span class="token comment">// to get around https://github.com/nwjs/nw.js/issues/3645</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/frameless.png"><img src="/images/blog-content/resurrecting-clippy/frameless.png" alt=""/></a>\n          <figcaption><p>The frameless app.</p>\n</figcaption>\n        </figure><p>Ok, it’s better but let’s ditch that background.</p>\n<p>Transparency</p>\n<p>Let’s go back to our manifest and add a <code>transparent</code> property inside <code>window</code>;</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"transparent"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>This gives the app the <em>ability</em> to be transparent, but doesn’t make it transparent. This can be toggled programmatically as well. Note: depending on the platform, you may need to jump through some extra hoops, see <a href="https://www.packtpub.com/books/content/transparency-and-nwjs" rel="noopener">Transparency and NW.js</a>. All that’s left is to make sure your elements are not</p>\n<p>All that’s left is to make sure your elements are not opague; for example:</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<h3><a id="dragging" class="post-header-anchor" href="#dragging" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dragging</h3>\n<p>We no longer have a window title bar so we can’t drag it around anymore. CSS to the rescue, again!</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">-webkit-app-region</span><span class="token punctuation">:</span> drag<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now you can drag the app by clicking and holding anywhere on the <code>body</code>.</p>\n<p>Unfortunately, double-clicking a draggable area triggers the window to maximize on some platforms. So what we’ll do is tell the user that double clicking will close clippy.desktop, thanks to clippy.js’ <code>agent.speak</code> method which shows a speech bubble. Just to annoy the user even more, we won’t. Instead, Clippy will disappear and reappear again after a couple of seconds. This is done in the <code>clippy.load</code> callback:</p>\n<pre><code class="language-javascript"><span class="token comment">// show clippy</span>\nclippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help closing me? Try double-clicking..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> windowX <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> windowY <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        windowX <span class="token operator">=</span> win<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n        windowY <span class="token operator">=</span> win<span class="token punctuation">.</span>y<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...</span>\n\n    <span class="token comment">// Since double-clicking draggable areas triggers maximizing on some platforms, when tell the user double-clicking</span>\n    <span class="token comment">// closes clippy but actually we\'ll hide the window, unmaximize, resize back to the normal size and show again</span>\n    <span class="token comment">// with a speech bubble</span>\n    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'maximize\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        win<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">unmaximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">resizeTo</span><span class="token punctuation">(</span>gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>windowX<span class="token punctuation">,</span> windowY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n                agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<h3><a id="events" class="post-header-anchor" href="#events" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Events</h3>\n<p>Speaking of clicking, we also block clippy.js from adding any event handlers itself with jQuery;</p>\n<pre><code class="language-javascript">$<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is before <code>clippy.load</code> is called. We want to handle clicks and everything else ourselves.</p>\n<p>Animating Clippy on click should be easy right? You might not be aware but if a window is not focused on Mac OS X, the first click focuses the window and the second click actually clicks the element. This is expected behavior on Mac OS X. Note: This is why you never create HTML window controls and bars when using NW.js or Electron, as it would take two clicks to minimize a window for example.</p>\n<p>This is why I use the window’s <code>focus</code> event instead. Whenever the window is focused, I trigger an animation and blur the window.</p>\n<pre><code class="language-javascript"><span class="token comment">// to be safe: use focus as a click handler kinda, to trigger animations. Blur when done so every click triggers</span>\n<span class="token comment">// an animation</span>\nwin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>‘focus’<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  agent<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  win<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note: Cross-platform support for blurring isn’t 100% solid so it’s best to just trigger an animation every once in awhile anyway as well.</p>\n<h3><a id="i-see-you-have-no-internet-connection" class="post-header-anchor" href="#i-see-you-have-no-internet-connection" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I see you have no internet connection</h3>\n<p>If you’re offline, clippy.desktop doesn’t show anything. Why? Let’s take a look at the line in clippy.js again:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> ‘file<span class="token punctuation">:</span>’ <span class="token operator">?</span> ‘https<span class="token punctuation">:</span>’ <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> ‘<span class="token comment">//s3.amazonaws.com/clippy.js/Agents/’;</span>\n</code></pre>\n<p>Why is it doing anything at all with URLs? I’m not sure why it wasn’t bundled into one script but ClippyJS requests additional (remote) scripts from within the base clippy.js script. This doesn’t make sense for a desktop app.</p>\n<p><img src="/images/blog-content/resurrecting-clippy/mental.png" alt=""></p>\n<h3><a id="mental-mode" class="post-header-anchor" href="#mental-mode" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mental mode</h3>\n<p>This is where you come in. This implementation is just a start. Feel free to <a href="https://github.com/teamwork/clippy.desktop" rel="noopener">improve it in a pull-request</a>. After all, it’s just HTML, CSS, and Javascript. I’m not suggesting that you add a mode which makes Clippy disappear on <code>mouseover</code>, reappear elsewhere, jump around the place, driving the user insane. Definitely not.</p>\n<h3><a id="tldr" class="post-header-anchor" href="#tldr" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>TL;DR</h3>\n<ul>\n<li>It’s easy to make a desktop (Web) app with NW.js.</li>\n<li>You can access all of Node.js, its module system and npm.</li>\n<li>Don’t use protocol-less URIs.</li>\n<li>Be aware of how Mac OS X treats clicks on unfocused windows.</li>\n<li>Make sure your app works offline.</li>\n<li>Have fun.</li>\n</ul>\n',summary:"Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/resurrecting-clippy-89843fcc9871"},photo:"/images/blog-content/resurrecting-clippy/osx.png",keywords:["clippy","desktop","app","NW.js","node-webkit","javascript","development"],published_at:"2016-03-08T00:00:00.000Z",updated_at:"2019-05-22T08:26:22.959Z",year:2016,month:3,day:9,relevanceScore:.41666666666666674}]}}],error:null,state:{nameToShow:"Adam Lynch",githubAccountUrl:"https://github.com/adam-lynch",siteUrl:"https://adamlynch.com",siteTitle:"Adam Lynch",repositoryUrl:"https://github.com/adam-lynch/adam-lynch.github.io"},serverRendered:!0}</script><script src="/_nuxt/manifest.2d9a9011fe1c2094eaa3.js" defer></script><script src="/_nuxt/layouts/default.8ce3dde6452dcf1cfcac.js" defer></script><script src="/_nuxt/1.6c5ddda757f906a1b66c.js" defer></script><script src="/_nuxt/vendor.ce05078a33ab89125ee8.js" defer></script><script src="/_nuxt/app.47e50bb931a38adb894d.js" defer></script>

    <script src="https://use.typekit.net/tci5xbk.js"></script>
    <script>try{Typekit.load({async:!0})}catch(a){}</script>
    <script>!function(e,a,t,n,c,g,s){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,g=a.createElement("script"),s=a.getElementsByTagName("script")[0],g.async=1,g.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(g,s)}(window,document),ga("create","UA-31546953-1","auto"),ga("send","pageview")</script>
  

