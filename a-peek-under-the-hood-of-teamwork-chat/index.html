<!DOCTYPE html>
<html data-n-head="" data-n-head-ssr>
  <head>
    <meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="#ffffff" theme-color="theme-color"><meta data-n-head="true" content="The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…
" name="description" data-hid="description"><meta data-n-head="true" content="teamwork, chat, node.js, javascript, node-webkit, NW.js, development" name="keywords" data-hid="keywords"><meta data-n-head="true" content="summary" name="twitter:card" data-hid="twitter:card"><meta data-n-head="true" content="A peek under the hood of Teamwork Chat" name="twitter:title" data-hid="twitter:title"><meta data-n-head="true" content="The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…
" name="twitter:description" data-hid="twitter:description"><meta data-n-head="true" content="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png" name="twitter:image"><meta data-n-head="true" content="/a-peek-under-the-hood-of-teamwork-chat" name="twitter:url" data-hid="twitter:url"><meta data-n-head="true" content="article" name="og:type" data-hid="og:type"><meta data-n-head="true" content="A peek under the hood of Teamwork Chat" name="og:title" data-hid="og:title"><meta data-n-head="true" content="The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…
" name="og:description" data-hid="og:description"><meta data-n-head="true" content="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png" name="og:image" data-hid="og:image"><meta data-n-head="true" content="/a-peek-under-the-hood-of-teamwork-chat" name="og:url" data-hid="og:url"><title data-n-head="true">A peek under the hood of Teamwork Chat</title><link href="/apple-touch-icon.png" rel="apple-touch-icon" data-n-head="true" sizes="76x76"><link href="/favicon-32x32.png" rel="icon" data-n-head="true" sizes="32x32" type="image/x-icon"><link href="/favicon-16x16.png" rel="icon" data-n-head="true" sizes="16x16" type="image/png"><link href="/safari-pinned-tab.svg" rel="mask-icon" data-n-head="true" color="#53687a"><link href="//unpkg.com/prismjs/themes/prism.css" rel="stylesheet" data-n-head="true"><link href="/_nuxt/manifest.d5526f8927565c068c7a.js" rel="preload" as="script"><link href="/_nuxt/vendor.ce05078a33ab89125ee8.js" rel="preload" as="script"><link href="/_nuxt/app.0d49d9ad47bd79d551b9.js" rel="preload" as="script"><link href="/_nuxt/layouts/default.8ce3dde6452dcf1cfcac.js" rel="preload" as="script"><link href="/_nuxt/1.03bda2e583db241630d8.js" rel="preload" as="script"><link href="/_nuxt/pages/index.5bad6aa85a4e69648400.js" rel="prefetch"><style data-vue-ssr-id="6dd13fd5:0">*{-webkit-box-sizing:border-box;box-sizing:border-box}body,html{margin:0;padding:0}ol,ul{list-style:none;padding-left:0;margin:0}a{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;text-decoration:none;color:inherit}body{font-family:Arial,sans-serif;line-height:1.55;letter-spacing:-.25px;-webkit-font-smoothing:antialiased}.wf-active body{font-family:Lato,Arial,sans-serif}html{font-size:14px}@media (min-width:470px){html{font-size:16px}}body{background:#ececec;color:#333;padding-top:28px;padding-top:2rem}.wrapper{max-width:840px;max-width:60rem;margin:0 auto}.header{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0 14px;padding:0 1rem;background:#ececec}@media (min-width:59rem){.header{-ms-flex-wrap:nowrap;flex-wrap:nowrap}}@media (min-width:470px){.header{padding-left:2rem;padding-right:2rem}}.site-title{margin:0;text-align:center;-webkit-transition:opacity .25s ease-in;transition:opacity .25s ease-in;min-width:100%;max-width:84px;max-width:6rem}@media (min-width:42rem){.site-title{min-width:0;-webkit-box-flex:1;-ms-flex:1;flex:1}}@media (min-width:59rem){.site-title{-webkit-box-flex:initial;-ms-flex:initial;flex:initial}}.site-title:hover{opacity:.9}.site-link{display:inline-block;background:url(/_nuxt/img/Logo.542e06c.png) 0 no-repeat;background-size:5.99rem;height:126px;height:9rem;width:84px;width:6rem;margin:0 auto;text-indent:-9999px}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.site-link{background-image:url(/_nuxt/img/Logo@2x.b121531.png)}}.site-happy-text-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;margin:0 auto;padding:0;width:100%;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:18.2px;font-size:1.3rem}@media (min-width:42rem){.site-happy-text-wrapper{-webkit-box-flex:2;-ms-flex:2;flex:2;padding:0 0 0 2rem}}@media (min-width:59rem){.site-happy-text-wrapper{-webkit-box-flex:1;-ms-flex:1;flex:1;font-size:1.2rem}}@media (min-width:61rem){.site-happy-text-wrapper{font-size:1.3rem}}.site-happy-text{-webkit-box-flex:1;-ms-flex:1;flex:1;margin:0;text-align:center}@media (min-width:42rem){.site-happy-text{text-align:left}}.site-happy-text-headline{display:block}.site-happy-text-headline,.wf-active .site-happy-text-headline{font-size:26.599px;font-size:1.9rem;font-weight:700}@media (min-width:25rem){.site-happy-text-headline{font-size:2.3rem;line-height:1.7}.wf-active .site-happy-text-headline{line-height:1.5;font-size:2.5rem}}@media (min-width:59rem){.site-happy-text-headline{font-size:2.9rem}.wf-active .site-happy-text-headline{font-size:3.1rem}}@media (min-width:61rem){.site-happy-text-headline{font-size:2.92rem;line-height:1.7}.wf-active .site-happy-text-headline{line-height:1.5;font-size:3.2rem}}.site-happy-text-tagline{display:inline}@media (min-width:42rem){.site-happy-text-tagline{display:block}}.navigation-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;padding:28px 0 0;padding:2rem 0 0;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}@media (min-width:59rem){.navigation-wrapper{max-width:23rem;padding:0 0 0 2rem}}.navigation{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;min-width:100%;width:100%}@media (min-width:59rem){.navigation{-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-width:0}}.navigation-item{-webkit-box-flex:1;-ms-flex:1 1 33%;flex:1 1 33%;min-width:33%;display:-webkit-box;display:-ms-flexbox;display:flex;position:relative;cursor:pointer;font-size:11.9px;font-size:.85rem;font-weight:200;-webkit-transition:background-color .25s;transition:background-color .25s}@media (min-width:25rem){.navigation-item{font-size:.9rem}}@media (min-width:45rem){.navigation-item{min-width:0;-webkit-box-flex:1;-ms-flex:1;flex:1}}@media (min-width:59rem){.navigation-item{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;min-width:33%}}.navigation-item:first-child{background:#e2e2e2}.navigation-item:first-child:hover{background:#ddd}.navigation-item:nth-child(2){background:#e8e8e8}.navigation-item:nth-child(2):hover{background:#e3e3e3}.navigation-item:nth-child(3){background:#efefef}.navigation-item:nth-child(3):hover{background:#eaeaea}.navigation-item:nth-child(4){background:#ddd}.navigation-item:nth-child(4):hover{background:#d8d8d8}.navigation-item:nth-child(5){background:#e3e3e3}.navigation-item:nth-child(5):hover{background:#dedede}.navigation-item:nth-child(6){background:#eaeaea}.navigation-item:nth-child(6):hover{background:#e4e4e4}.navigation-link{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:14px;padding:1rem;text-decoration:none;font-size:12.6px;font-size:.9rem;color:#000;-webkit-transition:color .25s;transition:color .25s}@media (min-width:25rem){.navigation-link{padding:1.4rem}}.navigation-link:after{content:"";position:absolute;top:100%;left:0;bottom:0;right:0;height:0;width:100%;background:#fff;opacity:.1;cursor:pointer;-webkit-transition:all .2s ease-out;transition:all .2s ease-out}.navigation-link:hover:after{top:50%;height:50%}.navigation-item-text{-webkit-box-flex:1;-ms-flex:1;flex:1}.posts{padding:28px 14px;padding:2rem 1rem}@media (min-width:470px){.posts{padding:2rem}}.post-wrapper{padding-bottom:28px;padding-bottom:2rem}.post-wrapper:last-child{padding-bottom:0}.post{padding:28px 14px;padding:2rem 1rem;margin:28px 0;margin:2rem 0;background:#fff;max-width:840px;max-width:60rem;overflow:hidden;position:relative}@media (min-width:470px){.post{padding:2rem}}.post:before{background:linear-gradient(180deg,hsla(0,0%,100%,0) 0,#fff 1500px);-webkit-animation:fadein 1s ease-in;animation:fadein 1s ease-in}.post:after,.post:before{content:" ";position:absolute;top:0;left:50%;bottom:0;width:100vw;-webkit-transform:translateX(-50%);transform:translateX(-50%);z-index:-1}.post:after{background:linear-gradient(0deg,#ececec 0,hsla(0,0%,100%,0) 1000px)}.posts .post{margin:0 auto}.posts .post:after,.posts .post:before{content:none}.posts .post:before{-webkit-animation:none;animation:none}.post>:first-child{margin-top:0}@media (min-width:62rem){.post-page-post-wrapper{margin-left:2rem;margin-right:2rem}}.post-content{font-size:15.4px;font-size:1.1rem;line-height:1.55}.post-content>*{margin:21px 0 0;margin:1.5rem 0 0}.post-content :not(figure)>a{color:#4580a7;padding-bottom:.7px;padding-bottom:.05rem;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(104,130,197,.4)),to(rgba(104,130,197,.4)));background-image:linear-gradient(rgba(104,130,197,.4),rgba(104,130,197,.4));background-repeat:no-repeat;background-size:100% 1.5px;background-position:center bottom 10%;background-origin:padding-box;text-shadow:3px 0 #fff,2px 0 #fff,1px 0 #fff,-1px 0 #fff,-2px 0 #fff,-3px 0 #fff;-webkit-transition:color .25s;transition:color .25s}.post-content :not(figure)>a:hover{color:#6882c5}.post-content blockquote{position:relative;font-size:18.2px;font-size:1.3rem;font-size:21.98px;font-size:1.57rem;font-style:italic;font-weight:100;padding-left:28px;padding-left:2rem;line-height:1.48;margin-top:28px;margin-top:2rem}.post-content blockquote:before{content:"\201C";position:absolute;top:-21px;top:-1.5rem;left:-7px;left:-.5rem;height:42px;height:3rem;width:25px;color:#f5f5f5;font-size:84px;font-size:6rem;font-style:normal;line-height:1}.post-content blockquote footer{margin-top:14px;margin-top:1rem;font-size:12.6px;font-size:.9rem;text-align:right}.post-content blockquote cite{display:inline-block;margin-left:7px;margin-left:.5rem}.post-content figure{text-align:center}.post-content figcaption{color:#666;font-size:12.6px;font-size:.9rem;font-style:italic}.post-content img{display:block;max-width:100%;height:auto;margin:0 auto;min-height:50px;min-width:150px;position:relative;color:#b6b6b6;font-size:12.6px;font-size:.9rem;text-align:center}.post-content img:before{content:"Image failed to load :/";display:block;font-size:13.299px;font-size:.95rem}.post-content code,.post-content pre{font-family:Consolas,Monaco,Andale Mono,monospace;text-shadow:0 1px #fff;white-space:pre;word-spacing:normal;word-break:normal;-webkit-font-feature-settings:none;font-feature-settings:none;-webkit-font-variant-ligatures:none;font-variant-ligatures:none;word-wrap:normal;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.post-content :not(h3):not(h4):not(h5):not(h6)>code,.post-content pre{font-size:11.9px;font-size:.85rem}.post-content :not(pre)>code,.post-content pre{background:#f5f5f5}.post-content pre{padding:14px;padding:1rem;overflow:auto;color:#000}.post-content :not(pre)>code{display:inline-block;padding:0 3.815px;padding:0 .2725rem;white-space:normal}.post-content a code{background:transparent none repeat 0 0/auto auto padding-box border-box scroll;background:initial;font-size:13.719px;font-size:.98rem;padding:0;padding:initial}.post-content p:first-child{margin-top:0}.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{position:relative}.post-content h3{font-size:22.75px;font-size:1.625rem}.post-content h4{font-size:19.446px;font-size:1.389rem}.post-content h5{font-size:16.142px;font-size:1.153rem}.post-content h6{font-size:13.034px;font-size:.931rem}.post-content .post-header-anchor{position:absolute;left:-14px;left:-1rem;top:20px;width:14px;width:1rem;-webkit-transform:translateY(-50%);transform:translateY(-50%);background:0 0;text-align:center;line-height:1;text-shadow:none;-webkit-transition:opacity .25s ease-in-out;transition:opacity .25s ease-in-out}@media (min-width:470px){.post-content .post-header-anchor{left:-2rem;top:20px;width:2rem}}.post-content .post-header-anchor:focus{outline:0}.post-content .post-header-anchor:hover svg{opacity:1}.post-content .post-header-anchor:after{content:" copied";position:absolute;bottom:-14px;left:0;right:0;font-size:.6em;color:gray;opacity:0;visibility:none;-webkit-transition:opacity 2s;transition:opacity 2s}.post-content .post-header-anchor svg{opacity:.2}.post-content h4 .post-header-anchor{top:18px}.post-content h5 .post-header-anchor{top:16px}.post-content h6 .post-header-anchor{top:14px}.post-content .post-header-anchor--copied:after{opacity:1}.post-content p:last-of-type{margin-bottom:0}.post-content h3,.post-content h4,.post-content h5,.post-content h6{position:relative}.post-content h3+p,.post-content h4+p,.post-content h5+p,.post-content h6+p{margin-top:7px;margin-top:.5rem}.post-content p+h3,.post-content p+h4,.post-content p+h5,.post-content p+h6{margin-top:28px;margin-top:2rem}.post-content ol,.post-content ul{padding-left:1.25em;list-style:disc outside none;list-style:initial}.post-content ol{list-style-type:decimal}.post-content li{margin-bottom:7px;margin-bottom:.5rem}.post-summary .post-content,.post-summary .post-content>*{display:inline}.post-content table{border-spacing:0;border-collapse:collapse}.post-content td,.post-content th{padding:0;padding:6px 13px;border:1px solid #dfe2e5}.post-content th{font-weight:600;text-align:left}.post-title-wrapper{margin:0}.post-title{line-height:1.4;font-size:19.599px;font-size:1.4rem;font-weight:700}.wf-active .post-title{font-size:21px;font-size:1.5rem;line-height:1.2}@media (min-width:30rem){.post-title{line-height:1.6;font-size:1.85rem}.wf-active .post-title{line-height:1.5;font-size:2rem}}.post-title-label{display:inline-block;position:relative;bottom:.3em;padding:.2em .4em;margin-left:.3em;font-size:.5em;background:#e3e3e3;color:#9e9e9e;border-radius:5%;font-weight:400;-webkit-transition:opacity .25s ease-in;transition:opacity .25s ease-in}.post-title:hover .post-title-label{opacity:.9}.post-title-label-parenthesis{display:none}.post-meta{font-size:12.6px;font-size:.9rem;margin:14px 0;margin:1rem 0;color:#a2a2a2}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.post-meta{color:#000;font-weight:300}}.post-blog-date{display:block;margin-top:7px;margin-top:.5rem}@media (min-width:30rem){.post-blog-date{display:inline;margin-top:0}.post-blog-date+.post-blog-title:before{display:inline-block;content:" \2014   ";margin:0 .25rem 0 .5rem}}.post-blog-link{font-weight:400;font-style:italic}.footer-link,.post-blog-link,.post-read-more-link,.post-title,.site-happy-text-tagline-link{-webkit-transition:color .25s;transition:color .25s}.footer-link:hover,.post-blog-link:hover,.post-read-more-link:hover,.post-title:hover,.site-happy-text-tagline-link:hover{color:#6882c5;background:-webkit-gradient(linear,left top,right top,from(#5c7b8f),to(#6882c5));background:linear-gradient(90deg,#5c7b8f,#6882c5);background-clip:border-box;-webkit-background-clip:text;-webkit-text-fill-color:transparent;-webkit-box-decoration-break:clone;box-decoration-break:clone}.site-happy-text-headline-link{-webkit-transition:color .25s;transition:color .25s}.footer-link,.post-read-more-link,.post-title,.site-happy-text-headline-link:hover,.site-happy-text-tagline-link{color:#5c7b8f}.post-read-more-link{display:inline-block;font-weight:700;margin:0}.post-comments{margin:28px 28px 0;margin:2rem 2rem 0;padding:28px;padding:2rem;background:#fff}@media (min-width:62rem){.post-comments{margin-left:0;margin-right:0}}.post-comments a{color:#5c7b8f;padding-bottom:.7px;padding-bottom:.05rem;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(rgba(0,0,0,.2)));background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2));background-repeat:no-repeat;background-size:100% 1.5px;background-position:center bottom 10%;background-origin:padding-box;text-shadow:3px 0 #fff,2px 0 #fff,1px 0 #fff,-1px 0 #fff,-2px 0 #fff,-3px 0 #fff;-webkit-transition:color .25s;transition:color .25s}.post-comments a:hover{color:#6882c5}@media (min-width:62rem){.more-articles{padding-left:0;padding-right:0}}.footer{text-align:center;font-size:11.2px;font-size:.8rem;margin-bottom:28px;margin-bottom:2rem}.footer-text{margin:0}.footer-link{font-weight:700}.copyright{display:block;color:gray}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.copyright{font-weight:100}}.fix-bug-ignore{color:red}.posts{position:relative}.post-wrapper{-webkit-transition:padding .5s ease-in-out,-webkit-transform .3s ease-in-out;transition:padding .5s ease-in-out,-webkit-transform .3s ease-in-out;transition:padding .5s ease-in-out,transform .3s ease-in-out;transition:padding .5s ease-in-out,transform .3s ease-in-out,-webkit-transform .3s ease-in-out}.post{-webkit-transition:opacity .1s ease-in-out,-webkit-transform .1s ease-in-out;transition:opacity .1s ease-in-out,-webkit-transform .1s ease-in-out;transition:opacity .1s ease-in-out,transform .1s ease-in-out;transition:opacity .1s ease-in-out,transform .1s ease-in-out,-webkit-transform .1s ease-in-out}.posts--entering-post .post-wrapper:not(.post-wrapper--entering-from-posts) .post{opacity:.2;-webkit-transform:scale(.8);transform:scale(.8)}.posts--entering-post .post-wrapper--entering-from-posts{left:0;right:0}@media (min-width:62rem){.posts--entering-post .post-wrapper--entering-from-posts{margin-left:2rem;margin-right:2rem}}.post-skeleton{line-height:1.55;position:relative;opacity:0;max-height:0;overflow:hidden}.post-skeleton.post-skeleton--visible,.post-wrapper--entering-from-posts .post-skeleton{opacity:1;margin-top:28px;margin-top:2rem;max-height:none}.post-skeleton:after{content:" ";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;opacity:.2;-webkit-animation:1s skeleton infinite ease-in-out;animation:1s skeleton infinite ease-in-out}.post-skeleton-word{height:15.4px;height:1.1rem;background:#f7f7f7;width:46px;display:inline-block;margin:4px 6px 0 0}.post-skeleton-word:nth-child(2n){width:36px}.post-skeleton-word:nth-child(3n){width:76px}.post-skeleton+.post-skeleton .post-skeleton-word:nth-child(3n){width:71px}.post-skeleton-word:nth-child(5n){width:96px}.post-skeleton-word:nth-child(6n){width:63px}.post-skeleton-word:nth-child(7n){width:26px}@-webkit-keyframes skeleton{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}98%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}99%{-webkit-transform:translate3d(100%,100%,0);transform:translate3d(100%,100%,0)}to{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@keyframes skeleton{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}98%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}99%{-webkit-transform:translate3d(100%,100%,0);transform:translate3d(100%,100%,0)}to{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@-webkit-keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes fadein{0%{opacity:0}to{opacity:1}}</style><style data-vue-ssr-id="1629eadd:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}</style>
    <script src="https://unpkg.com/scrollto-with-animation/dist/scrollto-with-animation.min.js"></script>
  </head>
  <body data-n-head="">
    <div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#869bad;opacity:0"></div><div id="__layout"><div class="wrapper"><main class="content"><header class="header"><h1 class="site-title"><a href="/" class="site-link nuxt-link-active">Adam Lynch</a></h1><div class="site-happy-text-wrapper"><p class="site-happy-text"><span class="site-happy-text-headline">
                I'm <a href="/" class="site-happy-text-headline-link nuxt-link-active">Adam Lynch</a>.
            </span><span class="site-happy-text-tagline">
                I like to
                <a href="https://github.com/adam-lynch" class="site-happy-text-tagline-link">code</a>,
                <a href="/" class="site-happy-text-tagline-link nuxt-link-active">write</a>, and dabble in design.
            </span><span class="site-happy-text-tagline">
                I lead <a href="https://www.teamwork.com" class="site-happy-text-tagline-link">Teamwork.com</a>'s next product.
            </span></div><nav class="navigation-wrapper" role="navigation"><ul class="navigation"><li class="navigation-item writing-navigation-item"><a href="/" class="navigation-link nuxt-link-active"><span class="navigation-item-text">Writing</span></a><li class="navigation-item code-navigation-item"><a href="https://github.com/adam-lynch" class="navigation-link" rel="noopener"><span class="navigation-item-text">Code</span></a><li class="navigation-item edit-navigation-item"><a href="https://github.com/adam-lynch/adam-lynch.github.io" class="navigation-link" rel="noopener"><span class="navigation-item-text">Edit page</span></a><li class="navigation-item twitter-navigation-item"><a href="https://twitter.com/lynchy010/" class="navigation-link" rel="noopener"><span class="navigation-item-text">Twitter</span></a><li class="navigation-item email-navigation-item"><a href="mailto:contact@adamlynch.com" class="navigation-link" rel="noopener"><span class="navigation-item-text">Email</span></a><li class="navigation-item linkedin-navigation-item"><a href="https://www.linkedin.com/in/adamlynch010/" class="navigation-link" rel="noopener"><span class="navigation-item-text">LinkedIn</span></a></ul></nav></header><div class="post-page-post-wrapper"><article class="post"><h2 class="post-title-wrapper"><a href="/a-peek-under-the-hood-of-teamwork-chat" class="post-title nuxt-link-exact-active nuxt-link-active">A peek under the hood of Teamwork Chat</a></h2><div class="post-meta"><time class="post-blog-date">April 28th, 2015</time><div class="no-ssr-placeholder"></div></div><div class="post-content">
<p>The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> was intended to tie our whole suite of products together. Being able to have a quick conversation about a project, seeing support tickets automatically as they came in, and creating a task, all without leaving the app.</p>
<p>The first prototype was put together by a small team in Cork roughly a year ago. While attending O’Reilly’s <a href="http://fluentconf.com/" rel="noopener">Fluent Conference</a> in San Francisco, this was fleshed out a bit more. Thousands and thousands of hours, way more lines of code, and even a complete redesign later; <a href="https://blog.teamwork.com/announcing-teamwork-chat/" rel="noopener">Teamwork Chat was released to the world</a>.</p>
<figure>
          <a href="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png"><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png" alt=""></a>
          <figcaption><p>The Teamwork Chat logo</p>
</figcaption>
        </figure><p>From back to front, our stack begins with twenty MySQL shards. We have four Node.js <code>chat-server</code>s and an nginx load balancer per Amazon EC2 instance. The <code>chat-server</code>s communicate via Redis (pub/sub). In front of these EC2 instances we have an Elastic Load Balancer. We also have <code>chat-notify-server</code>s which listen for events over a Redis channel and handle the sending of email and push notifications. <a href="http://adamlynch.com/coffeescript-at-teamwork/" rel="noopener">Everything is written in CoffeeScript</a> and server updates are rolled out using a continuous deployment service once we push to <code>master</code>.</p>
<h4><a href="#crashy" class="post-header-anchor" id="crashy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Crashy</h4>
<p>We’ve been overly cautious. Load is quite thinly spread and everything is fault-tolerant. Our Node servers restart themselves on failure and connected clients migrate to other chat-servers. Errors and events like these are monitored using <a href="https://getsentry.com/" rel="noopener">Sentry</a>. As some last-minute pre-release jitters were setting in, we added the following code to the chat-server to test the fault-tolerance again just to be safe:</p>
<p>If anyone sent a message containing exactly <code>crashy</code>, the chat-server they were connected to would die, anyone connected would be routed to a different chat-server and the server would restart. This bit of code was still there in production up to a week <em>after</em> we released. Yep. We're human after all.</p>
<pre><code class="language-coffeescript"><span class="token keyword">if</span> contents<span class="token punctuation">.</span>body <span class="token keyword">is</span> <span class="token string">'crashy'</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token string">'crashy crashy'</span>
</code></pre>
<figure>
          <a href="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/eek.gif"><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/eek.gif" alt=""></a>
          <figcaption><p>Eek!</p>
</figcaption>
        </figure><h4><a href="#the-clients" class="post-header-anchor" id="the-clients" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The client(s)</h4>
<p>We use Node on the server and the client. If that sounds crazy, have a look at <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> (formerly known as node-webkit). NW.js combines chromium and <a href="http://readwrite.com/2015/02/27/node-js-io-js-reconciliation-near" rel="noopener">io.js</a>. This enables you to quickly create a desktop application using HTML, CSS and JavaScript (just like you would be able to in Chrome) with access to the all of the power of io.js. As Web developers, this is a major win for us.</p>
<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture. Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>
<p>For the client, we use Knockout.js (as does every <a href="http://Teamwork.com" rel="noopener">Teamwork.com</a> product) extensively, Browserify, jQuery, and many many more modules and libraries. Our clients and servers communicate back and forth via pure WebSockets. We’ve built a custom in-app auto-updater using <a href="https://github.com/edjafarov/node-webkit-updater" rel="noopener"><code>node-webkit-updater</code></a>.</p>
<p>Teamwork Chat is a mobile-first responsive app. Our stylesheets are written in LESS and are littered with mixins, variables, and <code>em</code> values. We tend to base a lot of our variables on common / base variables using color functions, mathematic operations, etc... This makes it very easy to tweak the interface significantly by changing a variable or two. There aren't any prefixes to be found (thanks to <a href="https://github.com/postcss/autoprefixer" rel="noopener"><code>autoprefixer</code></a>), flexbox is used for layout where it really saves us hassle, and we also use SVGs exclusively. Teamwork Chat wasn't always responsive though. As I mentioned earlier, we completely changed the direction of Teamwork Chat at one point. While doing this, we also re-wrote the markup and styles, but more about that in a future post.</p>
<p>Our build system of choice is <a href="http://www.adamlynch.com/rome-wasnt-built-with-gulp/" rel="noopener">gulp</a>. Teamwork Chat uses gulp heavily, including for building <code>.app</code>s and <code>.exe</code>s, creating installers, signing executables, as well as all of typical stuff like compilation.</p>
<p>We’ve contributed to a lot of open-source projects we’ve built Teamwork Chat on, including <a href="https://github.com/mllrsohn/node-webkit-builder" rel="noopener"><code>node-webkit-builder</code></a> and <code>node-webkit-updater</code>, which I help maintain. We have open-sourced some of our own modules and plan to release even more. Watch this space.</p>
<h4><a href="#one-language-one-platform" class="post-header-anchor" id="one-language-one-platform" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>One language, one platform</h4>
<p><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/javascript.png" alt="The Java logo photoshopped to be a JavaScript logo"></p>
<p>Switching between writing client and server-side code is a breeze; everything is written in CoffeeScript on Node.js. This speeds up development and drastically reduces the amount of time it takes new developers to get up to speed.</p>
<p>Setting up an npm registry with <a href="https://www.npmjs.com/package/sinopia" rel="noopener"><code>sinopia</code></a> allowed us to create private npm modules which can be used on both the client and server. This allowed us to break up our application into easily testable chunks for consumption by the client, chat-server, and the chat-notify server. Small tested modules which do one thing well and follow <a href="http://semver.org" rel="noopener">semantic versioning</a>. That gives us a lot of confidence and ensures consistency across client and server.</p>
</div></article><aside><div class="post-comments"><p>Feedback is more than welcome via <a href="https://twitter.com/lynchy010">@lynchy010</a> or <a href="mailto:contact@adamlynch.com">contact@adamlynch.com</a></div><div class="no-ssr-placeholder"></div></aside></div><footer class="footer"><p class="footer-text"><a href="https://github.com/adam-lynch/adam-lynch.github.io" class="footer-link">This site is open source</a><span class="copyright">© 2019 Adam Lynch</span></footer></main></div></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{article:{id:"a-peek-under-the-hood-of-teamwork-chat",slug:"a-peek-under-the-hood-of-teamwork-chat",highlightedLanguages:["coffeescript"],source:"---\ndate: 2015-04-28\nsummary: The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork's Engine Room\n  url: https://engineroom.teamwork.com/dealing-with-long-paths-fcf412649a01\ntags:\n  - teamwork\n  - chat\n  - node.js\n  - javascript\n  - node-webkit\n  - NW.js\n  - development\n---\n\n## A peek under the hood of Teamwork Chat\n\nThe idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, [Teamwork Chat](https://www.teamwork.com/chat) was intended to tie our whole suite of products together. Being able to have a quick conversation about a project, seeing support tickets automatically as they came in, and creating a task, all without leaving the app.\n\nThe first prototype was put together by a small team in Cork roughly a year ago. While attending O’Reilly’s [Fluent Conference](http://fluentconf.com/) in San Francisco, this was fleshed out a bit more. Thousands and thousands of hours, way more lines of code, and even a complete redesign later; [Teamwork Chat was released to the world](https://blog.teamwork.com/announcing-teamwork-chat/).\n\n\n:::figure a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png The Teamwork Chat logo\n:::\n\nFrom back to front, our stack begins with twenty MySQL shards. We have four Node.js `chat-server`s and an nginx load balancer per Amazon EC2 instance. The `chat-server`s communicate via Redis (pub/sub). In front of these EC2 instances we have an Elastic Load Balancer. We also have `chat-notify-server`s which listen for events over a Redis channel and handle the sending of email and push notifications. [Everything is written in CoffeeScript](http://adamlynch.com/coffeescript-at-teamwork/) and server updates are rolled out using a continuous deployment service once we push to `master`.\n\n#### Crashy\n\nWe’ve been overly cautious. Load is quite thinly spread and everything is fault-tolerant. Our Node servers restart themselves on failure and connected clients migrate to other chat-servers. Errors and events like these are monitored using [Sentry](https://getsentry.com/). As some last-minute pre-release jitters were setting in, we added the following code to the chat-server to test the fault-tolerance again just to be safe:\n\nIf anyone sent a message containing exactly `crashy`, the chat-server they were connected to would die, anyone connected would be routed to a different chat-server and the server would restart. This bit of code was still there in production up to a week _after_ we released. Yep. We're human after all.\n\n```coffeescript\nif contents.body is 'crashy'\n  throw new Error 'crashy crashy'\n```\n\n:::figure a-peek-under-the-hood-of-teamwork-chat/eek.gif Eek!\n:::\n\n#### The client(s)\n\nWe use Node on the server and the client. If that sounds crazy, have a look at [NW.js](https://github.com/nwjs/nw.js) (formerly known as node-webkit). NW.js combines chromium and [io.js](http://readwrite.com/2015/02/27/node-js-io-js-reconciliation-near). This enables you to quickly create a desktop application using HTML, CSS and JavaScript (just like you would be able to in Chrome) with access to the all of the power of io.js. As Web developers, this is a major win for us.\n\nAs NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture. Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.\n\nFor the client, we use Knockout.js (as does every Teamwork.com product) extensively, Browserify, jQuery, and many many more modules and libraries. Our clients and servers communicate back and forth via pure WebSockets. We’ve built a custom in-app auto-updater using [`node-webkit-updater`](https://github.com/edjafarov/node-webkit-updater).\n\nTeamwork Chat is a mobile-first responsive app. Our stylesheets are written in LESS and are littered with mixins, variables, and `em` values. We tend to base a lot of our variables on common / base variables using color functions, mathematic operations, etc... This makes it very easy to tweak the interface significantly by changing a variable or two. There aren't any prefixes to be found (thanks to [`autoprefixer`](https://github.com/postcss/autoprefixer)), flexbox is used for layout where it really saves us hassle, and we also use SVGs exclusively. Teamwork Chat wasn't always responsive though. As I mentioned earlier, we completely changed the direction of Teamwork Chat at one point. While doing this, we also re-wrote the markup and styles, but more about that in a future post.\n\nOur build system of choice is [gulp](http://www.adamlynch.com/rome-wasnt-built-with-gulp/). Teamwork Chat uses gulp heavily, including for building `.app`s and `.exe`s, creating installers, signing executables, as well as all of typical stuff like compilation.\n\nWe’ve contributed to a lot of open-source projects we’ve built Teamwork Chat on, including [`node-webkit-builder`](https://github.com/mllrsohn/node-webkit-builder) and `node-webkit-updater`, which I help maintain. We have open-sourced some of our own modules and plan to release even more. Watch this space.\n\n#### One language, one platform\n\n![The Java logo photoshopped to be a JavaScript logo](/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/javascript.png)\n\nSwitching between writing client and server-side code is a breeze; everything is written in CoffeeScript on Node.js. This speeds up development and drastically reduces the amount of time it takes new developers to get up to speed.\n\nSetting up an npm registry with [`sinopia`](https://www.npmjs.com/package/sinopia) allowed us to create private npm modules which can be used on both the client and server. This allowed us to break up our application into easily testable chunks for consumption by the client, chat-server, and the chat-notify server. Small tested modules which do one thing well and follow [semantic versioning](http://semver.org). That gives us a lot of confidence and ensures consistency across client and server.\n",unfilteredRenderedBody:'<h2><a id="a-peek-under-the-hood-of-teamwork-chat" class="post-header-anchor" href="#a-peek-under-the-hood-of-teamwork-chat" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>A peek under the hood of Teamwork Chat</h2>\n<p>The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> was intended to tie our whole suite of products together. Being able to have a quick conversation about a project, seeing support tickets automatically as they came in, and creating a task, all without leaving the app.</p>\n<p>The first prototype was put together by a small team in Cork roughly a year ago. While attending O’Reilly’s <a href="http://fluentconf.com/" rel="noopener">Fluent Conference</a> in San Francisco, this was fleshed out a bit more. Thousands and thousands of hours, way more lines of code, and even a complete redesign later; <a href="https://blog.teamwork.com/announcing-teamwork-chat/" rel="noopener">Teamwork Chat was released to the world</a>.</p>\n<figure>\n          <a href="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png"><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png" alt=""/></a>\n          <figcaption><p>The Teamwork Chat logo</p>\n</figcaption>\n        </figure><p>From back to front, our stack begins with twenty MySQL shards. We have four Node.js <code>chat-server</code>s and an nginx load balancer per Amazon EC2 instance. The <code>chat-server</code>s communicate via Redis (pub/sub). In front of these EC2 instances we have an Elastic Load Balancer. We also have <code>chat-notify-server</code>s which listen for events over a Redis channel and handle the sending of email and push notifications. <a href="http://adamlynch.com/coffeescript-at-teamwork/" rel="noopener">Everything is written in CoffeeScript</a> and server updates are rolled out using a continuous deployment service once we push to <code>master</code>.</p>\n<h4><a id="crashy" class="post-header-anchor" href="#crashy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Crashy</h4>\n<p>We’ve been overly cautious. Load is quite thinly spread and everything is fault-tolerant. Our Node servers restart themselves on failure and connected clients migrate to other chat-servers. Errors and events like these are monitored using <a href="https://getsentry.com/" rel="noopener">Sentry</a>. As some last-minute pre-release jitters were setting in, we added the following code to the chat-server to test the fault-tolerance again just to be safe:</p>\n<p>If anyone sent a message containing exactly <code>crashy</code>, the chat-server they were connected to would die, anyone connected would be routed to a different chat-server and the server would restart. This bit of code was still there in production up to a week <em>after</em> we released. Yep. We\'re human after all.</p>\n<pre><code class="language-coffeescript"><span class="token keyword">if</span> contents<span class="token punctuation">.</span>body <span class="token keyword">is</span> <span class="token string">\'crashy\'</span>\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token string">\'crashy crashy\'</span>\n</code></pre>\n<figure>\n          <a href="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/eek.gif"><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/eek.gif" alt=""/></a>\n          <figcaption><p>Eek!</p>\n</figcaption>\n        </figure><h4><a id="the-clients" class="post-header-anchor" href="#the-clients" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The client(s)</h4>\n<p>We use Node on the server and the client. If that sounds crazy, have a look at <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> (formerly known as node-webkit). NW.js combines chromium and <a href="http://readwrite.com/2015/02/27/node-js-io-js-reconciliation-near" rel="noopener">io.js</a>. This enables you to quickly create a desktop application using HTML, CSS and JavaScript (just like you would be able to in Chrome) with access to the all of the power of io.js. As Web developers, this is a major win for us.</p>\n<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture. Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>\n<p>For the client, we use Knockout.js (as does every <a href="http://Teamwork.com" rel="noopener">Teamwork.com</a> product) extensively, Browserify, jQuery, and many many more modules and libraries. Our clients and servers communicate back and forth via pure WebSockets. We’ve built a custom in-app auto-updater using <a href="https://github.com/edjafarov/node-webkit-updater" rel="noopener"><code>node-webkit-updater</code></a>.</p>\n<p>Teamwork Chat is a mobile-first responsive app. Our stylesheets are written in LESS and are littered with mixins, variables, and <code>em</code> values. We tend to base a lot of our variables on common / base variables using color functions, mathematic operations, etc... This makes it very easy to tweak the interface significantly by changing a variable or two. There aren\'t any prefixes to be found (thanks to <a href="https://github.com/postcss/autoprefixer" rel="noopener"><code>autoprefixer</code></a>), flexbox is used for layout where it really saves us hassle, and we also use SVGs exclusively. Teamwork Chat wasn\'t always responsive though. As I mentioned earlier, we completely changed the direction of Teamwork Chat at one point. While doing this, we also re-wrote the markup and styles, but more about that in a future post.</p>\n<p>Our build system of choice is <a href="http://www.adamlynch.com/rome-wasnt-built-with-gulp/" rel="noopener">gulp</a>. Teamwork Chat uses gulp heavily, including for building <code>.app</code>s and <code>.exe</code>s, creating installers, signing executables, as well as all of typical stuff like compilation.</p>\n<p>We’ve contributed to a lot of open-source projects we’ve built Teamwork Chat on, including <a href="https://github.com/mllrsohn/node-webkit-builder" rel="noopener"><code>node-webkit-builder</code></a> and <code>node-webkit-updater</code>, which I help maintain. We have open-sourced some of our own modules and plan to release even more. Watch this space.</p>\n<h4><a id="one-language-one-platform" class="post-header-anchor" href="#one-language-one-platform" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>One language, one platform</h4>\n<p><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/javascript.png" alt="The Java logo photoshopped to be a JavaScript logo"></p>\n<p>Switching between writing client and server-side code is a breeze; everything is written in CoffeeScript on Node.js. This speeds up development and drastically reduces the amount of time it takes new developers to get up to speed.</p>\n<p>Setting up an npm registry with <a href="https://www.npmjs.com/package/sinopia" rel="noopener"><code>sinopia</code></a> allowed us to create private npm modules which can be used on both the client and server. This allowed us to break up our application into easily testable chunks for consumption by the client, chat-server, and the chat-notify server. Small tested modules which do one thing well and follow <a href="http://semver.org" rel="noopener">semantic versioning</a>. That gives us a lot of confidence and ensures consistency across client and server.</p>\n',attributes:{date:"2015-04-28T00:00:00.000Z",summary:"The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/dealing-with-long-paths-fcf412649a01"},tags:[{id:"teamwork",name:"teamwork"},{id:"chat",name:"chat"},{id:"nodejs",name:"node.js"},{id:"javascript",name:"javascript"},{id:"node-webkit",name:"node-webkit"},{id:"nwjs",name:"NW.js"},{id:"development",name:"development"}],title:"A peek under the hood of Teamwork Chat",updated_at:"2019-05-22T08:25:26.523Z",photo:"/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png"},title:"A peek under the hood of Teamwork Chat",renderedSummary:"<p>The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…</p>\n",rendered:'<h2><a id="a-peek-under-the-hood-of-teamwork-chat" class="post-header-anchor" href="#a-peek-under-the-hood-of-teamwork-chat" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>A peek under the hood of Teamwork Chat</h2>\n<p>The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> was intended to tie our whole suite of products together. Being able to have a quick conversation about a project, seeing support tickets automatically as they came in, and creating a task, all without leaving the app.</p>\n<p>The first prototype was put together by a small team in Cork roughly a year ago. While attending O’Reilly’s <a href="http://fluentconf.com/" rel="noopener">Fluent Conference</a> in San Francisco, this was fleshed out a bit more. Thousands and thousands of hours, way more lines of code, and even a complete redesign later; <a href="https://blog.teamwork.com/announcing-teamwork-chat/" rel="noopener">Teamwork Chat was released to the world</a>.</p>\n<figure>\n          <a href="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png"><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png" alt=""/></a>\n          <figcaption><p>The Teamwork Chat logo</p>\n</figcaption>\n        </figure><p>From back to front, our stack begins with twenty MySQL shards. We have four Node.js <code>chat-server</code>s and an nginx load balancer per Amazon EC2 instance. The <code>chat-server</code>s communicate via Redis (pub/sub). In front of these EC2 instances we have an Elastic Load Balancer. We also have <code>chat-notify-server</code>s which listen for events over a Redis channel and handle the sending of email and push notifications. <a href="http://adamlynch.com/coffeescript-at-teamwork/" rel="noopener">Everything is written in CoffeeScript</a> and server updates are rolled out using a continuous deployment service once we push to <code>master</code>.</p>\n<h4><a id="crashy" class="post-header-anchor" href="#crashy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Crashy</h4>\n<p>We’ve been overly cautious. Load is quite thinly spread and everything is fault-tolerant. Our Node servers restart themselves on failure and connected clients migrate to other chat-servers. Errors and events like these are monitored using <a href="https://getsentry.com/" rel="noopener">Sentry</a>. As some last-minute pre-release jitters were setting in, we added the following code to the chat-server to test the fault-tolerance again just to be safe:</p>\n<p>If anyone sent a message containing exactly <code>crashy</code>, the chat-server they were connected to would die, anyone connected would be routed to a different chat-server and the server would restart. This bit of code was still there in production up to a week <em>after</em> we released. Yep. We\'re human after all.</p>\n<pre><code class="language-coffeescript"><span class="token keyword">if</span> contents<span class="token punctuation">.</span>body <span class="token keyword">is</span> <span class="token string">\'crashy\'</span>\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token string">\'crashy crashy\'</span>\n</code></pre>\n<figure>\n          <a href="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/eek.gif"><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/eek.gif" alt=""/></a>\n          <figcaption><p>Eek!</p>\n</figcaption>\n        </figure><h4><a id="the-clients" class="post-header-anchor" href="#the-clients" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The client(s)</h4>\n<p>We use Node on the server and the client. If that sounds crazy, have a look at <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> (formerly known as node-webkit). NW.js combines chromium and <a href="http://readwrite.com/2015/02/27/node-js-io-js-reconciliation-near" rel="noopener">io.js</a>. This enables you to quickly create a desktop application using HTML, CSS and JavaScript (just like you would be able to in Chrome) with access to the all of the power of io.js. As Web developers, this is a major win for us.</p>\n<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture. Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>\n<p>For the client, we use Knockout.js (as does every <a href="http://Teamwork.com" rel="noopener">Teamwork.com</a> product) extensively, Browserify, jQuery, and many many more modules and libraries. Our clients and servers communicate back and forth via pure WebSockets. We’ve built a custom in-app auto-updater using <a href="https://github.com/edjafarov/node-webkit-updater" rel="noopener"><code>node-webkit-updater</code></a>.</p>\n<p>Teamwork Chat is a mobile-first responsive app. Our stylesheets are written in LESS and are littered with mixins, variables, and <code>em</code> values. We tend to base a lot of our variables on common / base variables using color functions, mathematic operations, etc... This makes it very easy to tweak the interface significantly by changing a variable or two. There aren\'t any prefixes to be found (thanks to <a href="https://github.com/postcss/autoprefixer" rel="noopener"><code>autoprefixer</code></a>), flexbox is used for layout where it really saves us hassle, and we also use SVGs exclusively. Teamwork Chat wasn\'t always responsive though. As I mentioned earlier, we completely changed the direction of Teamwork Chat at one point. While doing this, we also re-wrote the markup and styles, but more about that in a future post.</p>\n<p>Our build system of choice is <a href="http://www.adamlynch.com/rome-wasnt-built-with-gulp/" rel="noopener">gulp</a>. Teamwork Chat uses gulp heavily, including for building <code>.app</code>s and <code>.exe</code>s, creating installers, signing executables, as well as all of typical stuff like compilation.</p>\n<p>We’ve contributed to a lot of open-source projects we’ve built Teamwork Chat on, including <a href="https://github.com/mllrsohn/node-webkit-builder" rel="noopener"><code>node-webkit-builder</code></a> and <code>node-webkit-updater</code>, which I help maintain. We have open-sourced some of our own modules and plan to release even more. Watch this space.</p>\n<h4><a id="one-language-one-platform" class="post-header-anchor" href="#one-language-one-platform" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>One language, one platform</h4>\n<p><img src="/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/javascript.png" alt="The Java logo photoshopped to be a JavaScript logo"></p>\n<p>Switching between writing client and server-side code is a breeze; everything is written in CoffeeScript on Node.js. This speeds up development and drastically reduces the amount of time it takes new developers to get up to speed.</p>\n<p>Setting up an npm registry with <a href="https://www.npmjs.com/package/sinopia" rel="noopener"><code>sinopia</code></a> allowed us to create private npm modules which can be used on both the client and server. This allowed us to break up our application into easily testable chunks for consumption by the client, chat-server, and the chat-notify server. Small tested modules which do one thing well and follow <a href="http://semver.org" rel="noopener">semantic versioning</a>. That gives us a lot of confidence and ensures consistency across client and server.</p>\n',summary:"The idea was to build a chat application of our own. A whole new standalone product to raise the bar for team communication and collaboration. From the beginning, Teamwork Chat was intended to tie our whole suite of…\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/dealing-with-long-paths-fcf412649a01"},photo:"/images/blog-content/a-peek-under-the-hood-of-teamwork-chat/teamwork-chat.png",keywords:["teamwork","chat","node.js","javascript","node-webkit","NW.js","development"],published_at:"2015-04-28T00:00:00.000Z",updated_at:"2019-05-22T08:25:26.523Z",year:2015,month:4,day:29,relevanceScore:.9583333333333335,moreArticles:[{id:"under-the-hood-of-a-hybrid-app",slug:"under-the-hood-of-a-hybrid-app",highlightedLanguages:[],source:'---\ndate: 2016-04-16\nsummary: It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork\'s Engine Room\n  url: https://engineroom.teamwork.com/under-the-hood-of-a-hybrid-app-2215ce6e342a\ntags:\n  - product\n  - web\n  - javascript\n  - nw.js\n  - node-webkit\n  - desktop\n  - hybrid\n  - mobile\n  - development\n---\n\n## Under the hood of a hybrid (app)\n\nIt has been about a year since we had [A peek under the hood of Teamwork Chat](http://engineroom.teamwork.com/under-the-hood-of-teamwork-chat/). Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More and more companies are using our app, including some really famous ones. At the time of writing this, over 12 million messages have been sent. Teamwork has grown three times in size, and the Teamwork Chat team with it, thanks to some great hires.\n\nLet’s take a look at some of my predictions from last year’s post;\n\n> As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture.\n\nAlong with our Windows and Mac OS X desktop apps, [Teamwork Chat](https://www.teamwork.com/chat) is now available in your favourite Web browser. This was almost as easy as we expected. See [Donal’s](http://engineroom.teamwork.com/author/donal/) recent [Deploying the Teamwork Chat Web app](http://engineroom.teamwork.com/how-we-sped-up-serving-static-files-in-teamwork-chat/) post for more.\n\nSure, Teamwork Chat is a mobile-first responsive app, so yes, users could access Teamwork Chat on their phones. This was welcomed with open arms, but did I make any mobile *app* predictions?\n\n> Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.\n\nYep, and that’s what we’ve done. In this post, I’m going to describe how our [Android](https://play.google.com/store/apps/details?id=com.teamwork.chat&hl=en) and [iOS](https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8) apps came to be, lessons we’ve learned along the way, and where we’re headed. Not only in respect to mobile apps, but Teamwork Chat as a whole.\n\n### Mobile apps, finally\n\nWe released our first internal prototype about a year ago; a mash of Appcelerator and some Web code. It wasn’t as nice as we thought it would be. We would’ve needed to put in a lot more work to make it really usable. We had bigger fish to fry though. After a painful period of trying to maintain it while delivering key features, it was put to one side. We eventually got back to it, starting again from scratch.\n\nOf course, we wanted Android and iOS apps which allowed you to do everything you could already do in Teamwork Chat. Push notifications and being able to share a file to the app were minimum requirements as well. Unlike other apps where you could get away without those, they’re critical for any chat app. We imagined that the least the Teamwork Chat mobile apps could do is allow you to contact someone while on the go and stay in the loop, as well as quickly share a photo you’ve just taken, for example.\n\nOur intention, as much now as it was then, is to have a consistent and familiar experience across all of our apps. Someone should be easily able to start a conversation on one device and carry it on elsewhere.\n\n### Reusing our Web app\n\nBy this stage, users were crying out for mobile apps. Our plan was to get mobile apps out there and improve on them. We planned to reuse our Web app and see how far we could get. We took ownership of (most of) the app as apposed to our mobile team here at Teamwork. We got a lot of the way for free as we had already fought to maintain (mobile-first) reponsiveness and touch-friendliness throughout. We got an iPad app for free due to the fact our app is responsive. Note: we’ve never used device-orientated breakpoints in our designs.\n\nNow, mobile apps are also considered in every feature from the beginning. Reusing code between our Web, desktop, and mobile apps enables us to fix a bug once and it’s fixed everywhere. As I said in last year’s post, we use Node.js on the server-side, so we have some modules which are used in our Web app, our Mac & Windows desktop apps, our Android & iOS apps, and some services. Imagine that.\n\nIt was more difficult than we had anticipated. Debugging was trickier for one, and sure we had made an app that was responsive, but it wasn’t *responsible*. I wish Teamwork Chat really was mobile-first. We should have worked on mobile apps or at least made the Web version first and used it in mobile Web browsers often. The app was far too bloated, it was doing too much all of the time, and so on. A lot of improvements came from making the mobile apps, which in turn improved every Teamwork Chat client as a result. All Teamwork Chat (mobile, Web, and desktop) apps now load faster, take less time to render, and so on, but we still have work to do.\n\n:::figure under-the-hood-of-a-hybrid-app/nav.png A navigation menu we tweaked.\n:::\n\nWe forced ourselves to use our mobile apps exclusively; any interaction we made in Teamwork Chat during the day had to be done in the mobile app. This really helped. We completely redesigned some navigation menus, made some tweaks around touch input, and more. Sure, we already designed our app for touch, but how often did we really use a touch laptop or heavily use the app in a mobile Web browser? Well, clearly not enough. So we fine-grained a few things, including the swipe to show or hide the sidebar.\n\n### Native wrappers\n\nEnough about the WebView. In this iteration, we decided to drop Appcelerator and go with some native code instead. Sure, this means we’d need two implementations, one in Java and one in Swift, but it’s not so bad. It’s not a lot of code, the end result is better, and it’s what our mobile devs would prefer to work with.\n\nThe native “wrappers” need to show our app in a WebView (which is stored locally), handle notifications, and so on. We found a way to communicate between our app, the native side, and vice versa. I must say it was pretty interesting to co-operate with native mobile developers on this. Once we agreed on the events to be sent back and forth, we were adding little touches which made the app feel a lot more native in no time. For example, if you were to tap the back button on Android, an event is sent into the WebView, and we then close whatever’s open, or hide the sidebar, etc.\n\nNotifications are another good example. The native side gives us an access token for the app instance on each launch, we send that off to our API and then send you push notifications based on that. We send metadata like the conversation ID in the push, so if you were to tap on it, the native side of our app would instruct our Web app to open the conversation in question, and voilà.\n\nYou can go a step further and clear existing notifications on Android, which is a nice touch. If you were to receive a push notification about a message, but then view it in one of our desktop or Web apps, then the notification would disappear as you’ve already seen the message. When you view a conversation, an event is sent to from your client to ones of our services, and eventually a “silent” (invisible) notification is sent out to your device. Our Java code grabs the conversation ID and clears all associated notifications.\n\n### But what about *real* mobile apps?\n\nOK, fine! Let’s talk about Web versus native for a second. Web apps on mobile have gotten a bad name, unfairly. “Our biggest mistake was betting too much on HTML5” is commonly attributed to Mark Zuckerberg. Even though I don’t think this is actually what Mark said, people have latched onto this. It’s rubbish. Facebook’s HTML5 push wasn’t very successful at that time for a few reasons, one of which was down to process, for example. They had a dedicated mobile team. Mobile was always an afterthought, and it showed. Now they have mobile developers on every team. Mobile developers are involved and mobile apps are considered from beginning of any feature. If it was up to me, Teamwork Chat would eventually have some mobile developers of its own too.\n\nA lot of apps you use are hybrid apps but they don’t announce it due to the stigma involved. The feed you see in the Instagram app, who’re owned by Facebook, is HTML.\n\nWe put in the effort to make a responsive app, why not try to flex it? Sure, I’m biased; I want the Web to win and it is possible to do what we had aimed to do. Don’t get me wrong though, fully native apps are the way to go for Teamwork Chat. At the end of this post, I’ll cover what the plans are for our mobile apps and the future of Teamwork Chat in general.\n\n### Sharing\n\n:::figure under-the-hood-of-a-hybrid-app/sharing.png The screen shown when something is shared to our Android app.\n:::\n\nAndroid and iOS diverge when it comes to the concept of sharing. For awhile now on Android, you can easily share anything from one app to another; once you tap the share icon, all apps which can handle files of that type will be shown. Typically, once you select an app, you’re then brought into said app, and how the app handles the rest varies. For example, the Twitter app will show a form to compose a tweet with the image already attached. Once you’re done, you’re still in the app. So we didn’t need to do much on the native side to achieve this. We pass the image data in an event from Java to JavaScript, and show a screen inside the WebView allowing you to choose which conversation to share the file to.\n\nOnce the user selects a conversation or decides to create a new one, we attach the image to the message form. Images are just one example though.\n\nThese days, the right thing to do on iOS is to have a “share extension.” This is almost like a separate app. It lives completely outside your app. What I mean is that when you decide to share something, a completely iOS-y dialog appears, in which the entire flow is contained, and you stay wherever you were once you’re done. So this is written completely in Swift and solely interacts with our API.\n\n### Feature parity\n\nThis is something I strongly believe in. I’ll strive to make sure every feature of Teamwork Chat ever released will be released on all platforms and apps at once. There’s nothing worse than seeing a press release for a really cool feature in an app you use, only to realise you’ll have to wait awhile longer than everyone else. You don’t want to alienate your loyal users.\n\nThis certainly applies to mobile apps. Everyone, please stop delivering your app to one platform before the other. Don’t punish anyone because of the device they happened to buy.\n\nYes, this means that I believe every feature should be accessible from anywhere, on any device. It’s 2016, I shouldn’t have to defend this. Nowadays it’s really hard to even define what “mobile” means anyway. Screen size? Hmm not really anymore. Touch? Not unique. On-the-go? No, a lot of real usage happens on the couch. I won’t go on. The lines are blurred.\n\nIn order to create an app for everywhere, you must design for touch everywhere and strive for simplicity. On the most narrow screen, you need to decide what’s critical for your users, moving on and up from there.\n\nThis comes with some fresh challenges. Releasing both Android and iOS apps at the same time is tough. Especially when there’s internal pressure to release one or the other. It’s hard to convince people at times. We’re users after all, we make stuff to scratch our own itch at Teamwork. I must admit I gave in once or twice, but I’ll continue to fight for it. As it is in general, internal perception is important here.\n\nI wish more people wrote about feature parity, mobile-first workflows, and the transition from something more archaic. It affects the process of delivering an app in a lot of unexpected ways. For example, I remember having to push back when it came to marketing videos, which typically featured iPhones and iOS only. These growing pains are good though.\n\nTo make this work, more people need to work together and in parallel to deliver something great together. It doesn’t help that your mobile app needs to be reviewed. Android app submissions may only take up to a day to go through validation at worse, but the Apple review process could be anywhere from a few days to a couple of weeks. Not only is it difficult to align all of the releases, but what if a submission gets rejected?\n\n### Living with a mobile app\n\nWorking on a mobile app is completely alien to Web developers. If you introduce a bug, you can’t just roll out a quick fix and forget about it. It can take a lot of time to release the fix and you’re not guaranteed every user will even accept the update. Luckily, we were already in this frame of mind as we have desktop apps which follow pretty much the same flow.\n\nEven though we’re used to pushing out desktop app releases, the delay and uncertainty involved here is a pain point. A workaround we’re looking at is updating our app without going through the app store. What I mean is that we ship our mobile app with our Web app inside as usual but when the app is launched, it hits an API or S3, checks for a newer version and downloads it in the background if one exists. Then this version would be used in the WebView on next launch. This would allow us to roll out changes on a whim.\n\nBy changes, I mean changes to the WebView only. Anything else will require a proper app store update. Full updates should be done regularly anyway so it doesn’t look we have never released an update. Also, so we can update the changelogs on the app store listing. It would feel weird to put stuff in the changelogs which have been in the app for awhile though. Yes, I’ve been told I’m paying too much attention to changelogs. We could run into the situation where the WebView or native wrapper sends an event which crashes the app if we were to make a breaking change in our event API.\n\nThis is interesting though; it makes me wonder about how we update our desktop apps. Maybe we could transition to an update process like this. The jury is still out yet though, the implications of a possible move from [NW.js](http://nwjs.io/) to [Electron](http://electron.atom.io/) would need to be taken into account here. You might see a post on this in the future.\n\n### Feature flags\n\nWe’ve been talking about using [proper feature flags](https://www.youtube.com/watch?v=JR-ccCTmMKY) for awhile now, but this could be something else which would help us achieve feature parity. The idea would be to put the code for a feature out there on every platform behind a flag. We have this already for tiny things, some code is conditionally ran for just us, etc. When I say “proper features flags” I mean we’d hit an API to get this setting. Once all of the releases are out, we’d enable toggle the feature flag and on next reload or relaunch, the feature would be there.\n\nTeamwork Chat is very much a single page app though, so it would be even better if a feature could be toggled at runtime. For example, we could enable search for everyone and boom, the search icon appears for everyone. This opens the door for progressively rolling stuff out, to certain accounts, to a percentage of our users, as well as A/B testing, and even disabling the feature again if the fan requires some cleaning.\n\n### The release\n\n<iframe width="560" height="315" src="https://www.youtube.com/embed/deorlUmLsdI" frameborder="0" allowfullscreen></iframe>\n\nExpecting that we’d be waiting awhile, we submitted our iOS app first. The terrible piece of software that is iTunes Connect gives you the option to release the app immediately once it has been validated, on or past a certain date, as well as a manual release. We opted for a manual release. The plan was that was once we were alerted that the app was ready, we’d submit the Android app, and once that was out, we’d hit the publish button. Note: the Google Play Developer Console (which is awful too) has added a manual release option since then.\n\nOur iOS app was rejected. Argh! We had marketing campaigns ongoing teasing something big, we had to quickly come up with a plan B. We didn’t want to be empty handed when the end of the month came by. Why did it fail? Basically, there was a misunderstanding in what our app was, and who it was targeted at. We promptly submitted an appeal, and even though we knew we were right, we were amazed to see the decision overturned a couple of days later. The Android release took a couple of hours, and that was it, the Teamwork Chat mobile apps were out there. We were ecstatic.\n\n### The future\n\nThere is definitely room for improvement, I’ll be the first to say it. They could be faster, start up quicker, be less janky, and so on. We’re going to work hard on this. The great thing is that this these efforts will translate into improvements in the Web and desktop apps as well.\n\nWe will be making native mobile apps. We have planned to for awhile now. We have some mobile developers in-house dying for a crack at it. Expect a couple of great apps that really feel at home in your OS. One upside to going down the native route is that users can see you care as you’ve tailored an app to their OS. Sure they’ll be distinct, the Android one will have a strong material design feel, but we’ll strive to keep in sync with each other and Teamwork Chat in general when it comes to features as well as the overall experience.\n\nSure, this means we’ll have fewer eyes on our Web app on a mobile Web browser or narrow screen, but it’s worth it.\n\n### Automation and deployment\n\nRight now, our desktop apps need to built on Windows for Windows and on Mac for Mac. This takes time. We’ve added more update channels which compounds the problem. I’d love to automate this. Mobile app builds and deployments could also be automated in a similar fashion. Watch this space.\n\nWhile we’re on the topic, I’m happy to say we’ve moved from DeployBot (formerly dploy.io) to [CodeShip](https://codeship.com/) for all continuous integration and deployment. DeployBot wasn’t reliable enough for us. One time I decided to roll back and it deployed the wrong commit. As well as incidents like that, their frequent maintenance windows seemed to always coincide with when we needed them the most.\n\nAll of our services are now deployed once we push to `master`. Same goes for the Web version, but we don’t roll out as often as I’d like. Continuous delivery is a target though, for the desktop apps as well as our Web app. Although, to get there, we need more automated tests. We’ve heavily tested certain critical pieces and at least 85% of new services are covered with tests, but we need more. Especially integration tests for clients, ran in multiple browsers concurrently. This is possible, I’ve done it previously with Selenium Grid, etc., we just haven’t made the time for it yet.\n\nThere are also a few tools out there now for testing responsive designs. We could, for example, take screenshots of pages at multiple breakpoints, compare them with the most recent stable ones, and fail the build if the visual diff is too much. Although this might not be a great fit for continuous integration; I’m not sure how it would work if you intentionally introduced a significant visual change. You could disable the test if a certain `[skip-resp-tests]` exists in the commit message, but what if you accidentally broke something else? Food for thought.\n\n### Lessons learned\n\nWe haven’t had too many scale-related pains, although we’ve found ourselves making more changes lately to take some load off [Teamwork Projects](https://teamwork.com/projects). Our (email and push) notifications service could certainly be more fault tolerant. We’ve made more use of Node.js’ [**cluster**](https://nodejs.org/api/cluster.html) module which allows us to use all of the cores on any given machine, and might yet solve another problem.\n\nAs I described in last year’s post, our clients connect directly to our WebSocket servers. This means a server rollout will result in users’ clients temporarily disconnecting (plus each of them hitting the API at the same time to get any messages they’ve missed). We’re going to workaround this by effectively hot reloading via `cluster` or having a dedicated instance in front of our WebSocket servers with the sole duty of accepting WebSocket connections and load-balancing the events that come over them.\n\nHow our services communicate is a bit simplistic in general. We’re going to switch over to RabbitMQ from Redis, re-do a lot of the messaging, and try to remove the dependency on a shared database at the same time.\n\n### Fire in the hole\n\nAs well as improving areas we’ve neglected, these are some of the bigger higher level features we have coming down the line:\n\n-  API\n-  Bots (prepared third-party bots and a bot API/platform)\n-  Conversation switcher\n-  Deeper integrations with [Teamwork Desk](https://teamwork.com/desk) and [Teamwork Projects](https://teamwork.com/projects)\n-  Email improvements\n-  Independent signup\n-  Linux desktop app\n-  More third-party integrations (including cards, bots, etc.)\n-  Native (Android & iOS) mobile apps\n-  Noise reduction (do not disturb, muting, notification settings, etc.)\n-  Opening Teamwork Chat to users outside the owner company\n-  Search\n\nThat’s all folks! We’ll catch up again next year. Feel free to reach out to us at [chat@teamwork.com](mailto:chat@teamwork.com) with any API or bot-related ideas or features requests. We’d love to know what you’d expect to see in our API. If you’d like to kick the tires of our hybrid, follow one of the following links:\n\n- [Android](https://play.google.com/store/apps/details?id=com.teamwork.chat&hl=en) \n- [iOS](https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8)\n\n---\n\n_Pssst!_ Did you know that Teamwork Chat developers get to do whatever they like after lunch every Friday? Including improving something which annoys them (even in other Teamwork projects), hacking away on a cool open-source project, learning something completely new, or even playing around with fun just for the sake of it. We have ambitious plans, we now have five apps to maintain, and a lot of interesting challenges ahead of us. Come [join the crew](https://www.teamwork.com/jobs/chat-developer).\n',unfilteredRenderedBody:'<h2><a id="under-the-hood-of-a-hybrid-app" class="post-header-anchor" href="#under-the-hood-of-a-hybrid-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Under the hood of a hybrid (app)</h2>\n<p>It has been about a year since we had <a href="http://engineroom.teamwork.com/under-the-hood-of-teamwork-chat/" rel="noopener">A peek under the hood of Teamwork Chat</a>. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More and more companies are using our app, including some really famous ones. At the time of writing this, over 12 million messages have been sent. Teamwork has grown three times in size, and the Teamwork Chat team with it, thanks to some great hires.</p>\n<p>Let’s take a look at some of my predictions from last year’s post;</p>\n<blockquote>\n<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture.</p>\n</blockquote>\n<p>Along with our Windows and Mac OS X desktop apps, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> is now available in your favourite Web browser. This was almost as easy as we expected. See <a href="http://engineroom.teamwork.com/author/donal/" rel="noopener">Donal’s</a> recent <a href="http://engineroom.teamwork.com/how-we-sped-up-serving-static-files-in-teamwork-chat/" rel="noopener">Deploying the Teamwork Chat Web app</a> post for more.</p>\n<p>Sure, Teamwork Chat is a mobile-first responsive app, so yes, users could access Teamwork Chat on their phones. This was welcomed with open arms, but did I make any mobile <em>app</em> predictions?</p>\n<blockquote>\n<p>Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>\n</blockquote>\n<p>Yep, and that’s what we’ve done. In this post, I’m going to describe how our <a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a> and <a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a> apps came to be, lessons we’ve learned along the way, and where we’re headed. Not only in respect to mobile apps, but Teamwork Chat as a whole.</p>\n<h3><a id="mobile-apps-finally" class="post-header-anchor" href="#mobile-apps-finally" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mobile apps, finally</h3>\n<p>We released our first internal prototype about a year ago; a mash of Appcelerator and some Web code. It wasn’t as nice as we thought it would be. We would’ve needed to put in a lot more work to make it really usable. We had bigger fish to fry though. After a painful period of trying to maintain it while delivering key features, it was put to one side. We eventually got back to it, starting again from scratch.</p>\n<p>Of course, we wanted Android and iOS apps which allowed you to do everything you could already do in Teamwork Chat. Push notifications and being able to share a file to the app were minimum requirements as well. Unlike other apps where you could get away without those, they’re critical for any chat app. We imagined that the least the Teamwork Chat mobile apps could do is allow you to contact someone while on the go and stay in the loop, as well as quickly share a photo you’ve just taken, for example.</p>\n<p>Our intention, as much now as it was then, is to have a consistent and familiar experience across all of our apps. Someone should be easily able to start a conversation on one device and carry it on elsewhere.</p>\n<h3><a id="reusing-our-web-app" class="post-header-anchor" href="#reusing-our-web-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Reusing our Web app</h3>\n<p>By this stage, users were crying out for mobile apps. Our plan was to get mobile apps out there and improve on them. We planned to reuse our Web app and see how far we could get. We took ownership of (most of) the app as apposed to our mobile team here at Teamwork. We got a lot of the way for free as we had already fought to maintain (mobile-first) reponsiveness and touch-friendliness throughout. We got an iPad app for free due to the fact our app is responsive. Note: we’ve never used device-orientated breakpoints in our designs.</p>\n<p>Now, mobile apps are also considered in every feature from the beginning. Reusing code between our Web, desktop, and mobile apps enables us to fix a bug once and it’s fixed everywhere. As I said in last year’s post, we use Node.js on the server-side, so we have some modules which are used in our Web app, our Mac &amp; Windows desktop apps, our Android &amp; iOS apps, and some services. Imagine that.</p>\n<p>It was more difficult than we had anticipated. Debugging was trickier for one, and sure we had made an app that was responsive, but it wasn’t <em>responsible</em>. I wish Teamwork Chat really was mobile-first. We should have worked on mobile apps or at least made the Web version first and used it in mobile Web browsers often. The app was far too bloated, it was doing too much all of the time, and so on. A lot of improvements came from making the mobile apps, which in turn improved every Teamwork Chat client as a result. All Teamwork Chat (mobile, Web, and desktop) apps now load faster, take less time to render, and so on, but we still have work to do.</p>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png" alt=""/></a>\n          <figcaption><p>A navigation menu we tweaked.</p>\n</figcaption>\n        </figure><p>We forced ourselves to use our mobile apps exclusively; any interaction we made in Teamwork Chat during the day had to be done in the mobile app. This really helped. We completely redesigned some navigation menus, made some tweaks around touch input, and more. Sure, we already designed our app for touch, but how often did we really use a touch laptop or heavily use the app in a mobile Web browser? Well, clearly not enough. So we fine-grained a few things, including the swipe to show or hide the sidebar.</p>\n<h3><a id="native-wrappers" class="post-header-anchor" href="#native-wrappers" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Native wrappers</h3>\n<p>Enough about the WebView. In this iteration, we decided to drop Appcelerator and go with some native code instead. Sure, this means we’d need two implementations, one in Java and one in Swift, but it’s not so bad. It’s not a lot of code, the end result is better, and it’s what our mobile devs would prefer to work with.</p>\n<p>The native “wrappers” need to show our app in a WebView (which is stored locally), handle notifications, and so on. We found a way to communicate between our app, the native side, and vice versa. I must say it was pretty interesting to co-operate with native mobile developers on this. Once we agreed on the events to be sent back and forth, we were adding little touches which made the app feel a lot more native in no time. For example, if you were to tap the back button on Android, an event is sent into the WebView, and we then close whatever’s open, or hide the sidebar, etc.</p>\n<p>Notifications are another good example. The native side gives us an access token for the app instance on each launch, we send that off to our API and then send you push notifications based on that. We send metadata like the conversation ID in the push, so if you were to tap on it, the native side of our app would instruct our Web app to open the conversation in question, and voilà.</p>\n<p>You can go a step further and clear existing notifications on Android, which is a nice touch. If you were to receive a push notification about a message, but then view it in one of our desktop or Web apps, then the notification would disappear as you’ve already seen the message. When you view a conversation, an event is sent to from your client to ones of our services, and eventually a “silent” (invisible) notification is sent out to your device. Our Java code grabs the conversation ID and clears all associated notifications.</p>\n<h3><a id="but-what-about-real-mobile-apps" class="post-header-anchor" href="#but-what-about-real-mobile-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>But what about <em>real</em> mobile apps?</h3>\n<p>OK, fine! Let’s talk about Web versus native for a second. Web apps on mobile have gotten a bad name, unfairly. “Our biggest mistake was betting too much on HTML5” is commonly attributed to Mark Zuckerberg. Even though I don’t think this is actually what Mark said, people have latched onto this. It’s rubbish. Facebook’s HTML5 push wasn’t very successful at that time for a few reasons, one of which was down to process, for example. They had a dedicated mobile team. Mobile was always an afterthought, and it showed. Now they have mobile developers on every team. Mobile developers are involved and mobile apps are considered from beginning of any feature. If it was up to me, Teamwork Chat would eventually have some mobile developers of its own too.</p>\n<p>A lot of apps you use are hybrid apps but they don’t announce it due to the stigma involved. The feed you see in the Instagram app, who’re owned by Facebook, is HTML.</p>\n<p>We put in the effort to make a responsive app, why not try to flex it? Sure, I’m biased; I want the Web to win and it is possible to do what we had aimed to do. Don’t get me wrong though, fully native apps are the way to go for Teamwork Chat. At the end of this post, I’ll cover what the plans are for our mobile apps and the future of Teamwork Chat in general.</p>\n<h3><a id="sharing" class="post-header-anchor" href="#sharing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Sharing</h3>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png" alt=""/></a>\n          <figcaption><p>The screen shown when something is shared to our Android app.</p>\n</figcaption>\n        </figure><p>Android and iOS diverge when it comes to the concept of sharing. For awhile now on Android, you can easily share anything from one app to another; once you tap the share icon, all apps which can handle files of that type will be shown. Typically, once you select an app, you’re then brought into said app, and how the app handles the rest varies. For example, the Twitter app will show a form to compose a tweet with the image already attached. Once you’re done, you’re still in the app. So we didn’t need to do much on the native side to achieve this. We pass the image data in an event from Java to JavaScript, and show a screen inside the WebView allowing you to choose which conversation to share the file to.</p>\n<p>Once the user selects a conversation or decides to create a new one, we attach the image to the message form. Images are just one example though.</p>\n<p>These days, the right thing to do on iOS is to have a “share extension.” This is almost like a separate app. It lives completely outside your app. What I mean is that when you decide to share something, a completely iOS-y dialog appears, in which the entire flow is contained, and you stay wherever you were once you’re done. So this is written completely in Swift and solely interacts with our API.</p>\n<h3><a id="feature-parity" class="post-header-anchor" href="#feature-parity" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature parity</h3>\n<p>This is something I strongly believe in. I’ll strive to make sure every feature of Teamwork Chat ever released will be released on all platforms and apps at once. There’s nothing worse than seeing a press release for a really cool feature in an app you use, only to realise you’ll have to wait awhile longer than everyone else. You don’t want to alienate your loyal users.</p>\n<p>This certainly applies to mobile apps. Everyone, please stop delivering your app to one platform before the other. Don’t punish anyone because of the device they happened to buy.</p>\n<p>Yes, this means that I believe every feature should be accessible from anywhere, on any device. It’s 2016, I shouldn’t have to defend this. Nowadays it’s really hard to even define what “mobile” means anyway. Screen size? Hmm not really anymore. Touch? Not unique. On-the-go? No, a lot of real usage happens on the couch. I won’t go on. The lines are blurred.</p>\n<p>In order to create an app for everywhere, you must design for touch everywhere and strive for simplicity. On the most narrow screen, you need to decide what’s critical for your users, moving on and up from there.</p>\n<p>This comes with some fresh challenges. Releasing both Android and iOS apps at the same time is tough. Especially when there’s internal pressure to release one or the other. It’s hard to convince people at times. We’re users after all, we make stuff to scratch our own itch at Teamwork. I must admit I gave in once or twice, but I’ll continue to fight for it. As it is in general, internal perception is important here.</p>\n<p>I wish more people wrote about feature parity, mobile-first workflows, and the transition from something more archaic. It affects the process of delivering an app in a lot of unexpected ways. For example, I remember having to push back when it came to marketing videos, which typically featured iPhones and iOS only. These growing pains are good though.</p>\n<p>To make this work, more people need to work together and in parallel to deliver something great together. It doesn’t help that your mobile app needs to be reviewed. Android app submissions may only take up to a day to go through validation at worse, but the Apple review process could be anywhere from a few days to a couple of weeks. Not only is it difficult to align all of the releases, but what if a submission gets rejected?</p>\n<h3><a id="living-with-a-mobile-app" class="post-header-anchor" href="#living-with-a-mobile-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Living with a mobile app</h3>\n<p>Working on a mobile app is completely alien to Web developers. If you introduce a bug, you can’t just roll out a quick fix and forget about it. It can take a lot of time to release the fix and you’re not guaranteed every user will even accept the update. Luckily, we were already in this frame of mind as we have desktop apps which follow pretty much the same flow.</p>\n<p>Even though we’re used to pushing out desktop app releases, the delay and uncertainty involved here is a pain point. A workaround we’re looking at is updating our app without going through the app store. What I mean is that we ship our mobile app with our Web app inside as usual but when the app is launched, it hits an API or S3, checks for a newer version and downloads it in the background if one exists. Then this version would be used in the WebView on next launch. This would allow us to roll out changes on a whim.</p>\n<p>By changes, I mean changes to the WebView only. Anything else will require a proper app store update. Full updates should be done regularly anyway so it doesn’t look we have never released an update. Also, so we can update the changelogs on the app store listing. It would feel weird to put stuff in the changelogs which have been in the app for awhile though. Yes, I’ve been told I’m paying too much attention to changelogs. We could run into the situation where the WebView or native wrapper sends an event which crashes the app if we were to make a breaking change in our event API.</p>\n<p>This is interesting though; it makes me wonder about how we update our desktop apps. Maybe we could transition to an update process like this. The jury is still out yet though, the implications of a possible move from <a href="http://nwjs.io/" rel="noopener">NW.js</a> to <a href="http://electron.atom.io/" rel="noopener">Electron</a> would need to be taken into account here. You might see a post on this in the future.</p>\n<h3><a id="feature-flags" class="post-header-anchor" href="#feature-flags" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature flags</h3>\n<p>We’ve been talking about using <a href="https://www.youtube.com/watch?v=JR-ccCTmMKY" rel="noopener">proper feature flags</a> for awhile now, but this could be something else which would help us achieve feature parity. The idea would be to put the code for a feature out there on every platform behind a flag. We have this already for tiny things, some code is conditionally ran for just us, etc. When I say “proper features flags” I mean we’d hit an API to get this setting. Once all of the releases are out, we’d enable toggle the feature flag and on next reload or relaunch, the feature would be there.</p>\n<p>Teamwork Chat is very much a single page app though, so it would be even better if a feature could be toggled at runtime. For example, we could enable search for everyone and boom, the search icon appears for everyone. This opens the door for progressively rolling stuff out, to certain accounts, to a percentage of our users, as well as A/B testing, and even disabling the feature again if the fan requires some cleaning.</p>\n<h3><a id="the-release" class="post-header-anchor" href="#the-release" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The release</h3>\n<iframe width="560" height="315" src="https://www.youtube.com/embed/deorlUmLsdI" frameborder="0" allowfullscreen></iframe>\n<p>Expecting that we’d be waiting awhile, we submitted our iOS app first. The terrible piece of software that is iTunes Connect gives you the option to release the app immediately once it has been validated, on or past a certain date, as well as a manual release. We opted for a manual release. The plan was that was once we were alerted that the app was ready, we’d submit the Android app, and once that was out, we’d hit the publish button. Note: the Google Play Developer Console (which is awful too) has added a manual release option since then.</p>\n<p>Our iOS app was rejected. Argh! We had marketing campaigns ongoing teasing something big, we had to quickly come up with a plan B. We didn’t want to be empty handed when the end of the month came by. Why did it fail? Basically, there was a misunderstanding in what our app was, and who it was targeted at. We promptly submitted an appeal, and even though we knew we were right, we were amazed to see the decision overturned a couple of days later. The Android release took a couple of hours, and that was it, the Teamwork Chat mobile apps were out there. We were ecstatic.</p>\n<h3><a id="the-future" class="post-header-anchor" href="#the-future" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The future</h3>\n<p>There is definitely room for improvement, I’ll be the first to say it. They could be faster, start up quicker, be less janky, and so on. We’re going to work hard on this. The great thing is that this these efforts will translate into improvements in the Web and desktop apps as well.</p>\n<p>We will be making native mobile apps. We have planned to for awhile now. We have some mobile developers in-house dying for a crack at it. Expect a couple of great apps that really feel at home in your OS. One upside to going down the native route is that users can see you care as you’ve tailored an app to their OS. Sure they’ll be distinct, the Android one will have a strong material design feel, but we’ll strive to keep in sync with each other and Teamwork Chat in general when it comes to features as well as the overall experience.</p>\n<p>Sure, this means we’ll have fewer eyes on our Web app on a mobile Web browser or narrow screen, but it’s worth it.</p>\n<h3><a id="automation-and-deployment" class="post-header-anchor" href="#automation-and-deployment" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Automation and deployment</h3>\n<p>Right now, our desktop apps need to built on Windows for Windows and on Mac for Mac. This takes time. We’ve added more update channels which compounds the problem. I’d love to automate this. Mobile app builds and deployments could also be automated in a similar fashion. Watch this space.</p>\n<p>While we’re on the topic, I’m happy to say we’ve moved from DeployBot (formerly <a href="http://dploy.io" rel="noopener">dploy.io</a>) to <a href="https://codeship.com/" rel="noopener">CodeShip</a> for all continuous integration and deployment. DeployBot wasn’t reliable enough for us. One time I decided to roll back and it deployed the wrong commit. As well as incidents like that, their frequent maintenance windows seemed to always coincide with when we needed them the most.</p>\n<p>All of our services are now deployed once we push to <code>master</code>. Same goes for the Web version, but we don’t roll out as often as I’d like. Continuous delivery is a target though, for the desktop apps as well as our Web app. Although, to get there, we need more automated tests. We’ve heavily tested certain critical pieces and at least 85% of new services are covered with tests, but we need more. Especially integration tests for clients, ran in multiple browsers concurrently. This is possible, I’ve done it previously with Selenium Grid, etc., we just haven’t made the time for it yet.</p>\n<p>There are also a few tools out there now for testing responsive designs. We could, for example, take screenshots of pages at multiple breakpoints, compare them with the most recent stable ones, and fail the build if the visual diff is too much. Although this might not be a great fit for continuous integration; I’m not sure how it would work if you intentionally introduced a significant visual change. You could disable the test if a certain <code>[skip-resp-tests]</code> exists in the commit message, but what if you accidentally broke something else? Food for thought.</p>\n<h3><a id="lessons-learned" class="post-header-anchor" href="#lessons-learned" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Lessons learned</h3>\n<p>We haven’t had too many scale-related pains, although we’ve found ourselves making more changes lately to take some load off <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a>. Our (email and push) notifications service could certainly be more fault tolerant. We’ve made more use of Node.js’ <a href="https://nodejs.org/api/cluster.html" rel="noopener"><strong>cluster</strong></a> module which allows us to use all of the cores on any given machine, and might yet solve another problem.</p>\n<p>As I described in last year’s post, our clients connect directly to our WebSocket servers. This means a server rollout will result in users’ clients temporarily disconnecting (plus each of them hitting the API at the same time to get any messages they’ve missed). We’re going to workaround this by effectively hot reloading via <code>cluster</code> or having a dedicated instance in front of our WebSocket servers with the sole duty of accepting WebSocket connections and load-balancing the events that come over them.</p>\n<p>How our services communicate is a bit simplistic in general. We’re going to switch over to RabbitMQ from Redis, re-do a lot of the messaging, and try to remove the dependency on a shared database at the same time.</p>\n<h3><a id="fire-in-the-hole" class="post-header-anchor" href="#fire-in-the-hole" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fire in the hole</h3>\n<p>As well as improving areas we’ve neglected, these are some of the bigger higher level features we have coming down the line:</p>\n<ul>\n<li>API</li>\n<li>Bots (prepared third-party bots and a bot API/platform)</li>\n<li>Conversation switcher</li>\n<li>Deeper integrations with <a href="https://teamwork.com/desk" rel="noopener">Teamwork Desk</a> and <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a></li>\n<li>Email improvements</li>\n<li>Independent signup</li>\n<li>Linux desktop app</li>\n<li>More third-party integrations (including cards, bots, etc.)</li>\n<li>Native (Android &amp; iOS) mobile apps</li>\n<li>Noise reduction (do not disturb, muting, notification settings, etc.)</li>\n<li>Opening Teamwork Chat to users outside the owner company</li>\n<li>Search</li>\n</ul>\n<p>That’s all folks! We’ll catch up again next year. Feel free to reach out to us at <a href="mailto:chat@teamwork.com">chat@teamwork.com</a> with any API or bot-related ideas or features requests. We’d love to know what you’d expect to see in our API. If you’d like to kick the tires of our hybrid, follow one of the following links:</p>\n<ul>\n<li><a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a></li>\n<li><a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a></li>\n</ul>\n<hr>\n<p><em>Pssst!</em> Did you know that Teamwork Chat developers get to do whatever they like after lunch every Friday? Including improving something which annoys them (even in other Teamwork projects), hacking away on a cool open-source project, learning something completely new, or even playing around with fun just for the sake of it. We have ambitious plans, we now have five apps to maintain, and a lot of interesting challenges ahead of us. Come <a href="https://www.teamwork.com/jobs/chat-developer" rel="noopener">join the crew</a>.</p>\n',attributes:{date:"2016-04-16T00:00:00.000Z",summary:"It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/under-the-hood-of-a-hybrid-app-2215ce6e342a"},tags:[{id:"product",name:"product"},{id:"web",name:"web"},{id:"javascript",name:"javascript"},{id:"nwjs",name:"NW.js"},{id:"node-webkit",name:"node-webkit"},{id:"desktop",name:"desktop"},{id:"hybrid",name:"hybrid"},{id:"mobile",name:"mobile"},{id:"development",name:"development"}],title:"Under the hood of a hybrid (app)",updated_at:"2019-05-22T08:26:38.756Z",photo:"/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png"},title:"Under the hood of a hybrid (app)",renderedSummary:"<p>It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...</p>\n",rendered:'<h2><a id="under-the-hood-of-a-hybrid-app" class="post-header-anchor" href="#under-the-hood-of-a-hybrid-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Under the hood of a hybrid (app)</h2>\n<p>It has been about a year since we had <a href="http://engineroom.teamwork.com/under-the-hood-of-teamwork-chat/" rel="noopener">A peek under the hood of Teamwork Chat</a>. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More and more companies are using our app, including some really famous ones. At the time of writing this, over 12 million messages have been sent. Teamwork has grown three times in size, and the Teamwork Chat team with it, thanks to some great hires.</p>\n<p>Let’s take a look at some of my predictions from last year’s post;</p>\n<blockquote>\n<p>As NW.js (0.12.0) is basically Chrome (41), we can just put our desktop app on the Web and it will basically just work. That’s a simplification but you get the picture.</p>\n</blockquote>\n<p>Along with our Windows and Mac OS X desktop apps, <a href="https://www.teamwork.com/chat" rel="noopener">Teamwork Chat</a> is now available in your favourite Web browser. This was almost as easy as we expected. See <a href="http://engineroom.teamwork.com/author/donal/" rel="noopener">Donal’s</a> recent <a href="http://engineroom.teamwork.com/how-we-sped-up-serving-static-files-in-teamwork-chat/" rel="noopener">Deploying the Teamwork Chat Web app</a> post for more.</p>\n<p>Sure, Teamwork Chat is a mobile-first responsive app, so yes, users could access Teamwork Chat on their phones. This was welcomed with open arms, but did I make any mobile <em>app</em> predictions?</p>\n<blockquote>\n<p>Even further, we should be able to create Android and iOS apps by sticking our app in a WebView. We’re attempting to build a consistent experience across all platforms from the one codebase. It’s not as easy as I make out though; expect more posts to follow up on this.</p>\n</blockquote>\n<p>Yep, and that’s what we’ve done. In this post, I’m going to describe how our <a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a> and <a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a> apps came to be, lessons we’ve learned along the way, and where we’re headed. Not only in respect to mobile apps, but Teamwork Chat as a whole.</p>\n<h3><a id="mobile-apps-finally" class="post-header-anchor" href="#mobile-apps-finally" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mobile apps, finally</h3>\n<p>We released our first internal prototype about a year ago; a mash of Appcelerator and some Web code. It wasn’t as nice as we thought it would be. We would’ve needed to put in a lot more work to make it really usable. We had bigger fish to fry though. After a painful period of trying to maintain it while delivering key features, it was put to one side. We eventually got back to it, starting again from scratch.</p>\n<p>Of course, we wanted Android and iOS apps which allowed you to do everything you could already do in Teamwork Chat. Push notifications and being able to share a file to the app were minimum requirements as well. Unlike other apps where you could get away without those, they’re critical for any chat app. We imagined that the least the Teamwork Chat mobile apps could do is allow you to contact someone while on the go and stay in the loop, as well as quickly share a photo you’ve just taken, for example.</p>\n<p>Our intention, as much now as it was then, is to have a consistent and familiar experience across all of our apps. Someone should be easily able to start a conversation on one device and carry it on elsewhere.</p>\n<h3><a id="reusing-our-web-app" class="post-header-anchor" href="#reusing-our-web-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Reusing our Web app</h3>\n<p>By this stage, users were crying out for mobile apps. Our plan was to get mobile apps out there and improve on them. We planned to reuse our Web app and see how far we could get. We took ownership of (most of) the app as apposed to our mobile team here at Teamwork. We got a lot of the way for free as we had already fought to maintain (mobile-first) reponsiveness and touch-friendliness throughout. We got an iPad app for free due to the fact our app is responsive. Note: we’ve never used device-orientated breakpoints in our designs.</p>\n<p>Now, mobile apps are also considered in every feature from the beginning. Reusing code between our Web, desktop, and mobile apps enables us to fix a bug once and it’s fixed everywhere. As I said in last year’s post, we use Node.js on the server-side, so we have some modules which are used in our Web app, our Mac &amp; Windows desktop apps, our Android &amp; iOS apps, and some services. Imagine that.</p>\n<p>It was more difficult than we had anticipated. Debugging was trickier for one, and sure we had made an app that was responsive, but it wasn’t <em>responsible</em>. I wish Teamwork Chat really was mobile-first. We should have worked on mobile apps or at least made the Web version first and used it in mobile Web browsers often. The app was far too bloated, it was doing too much all of the time, and so on. A lot of improvements came from making the mobile apps, which in turn improved every Teamwork Chat client as a result. All Teamwork Chat (mobile, Web, and desktop) apps now load faster, take less time to render, and so on, but we still have work to do.</p>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png" alt=""/></a>\n          <figcaption><p>A navigation menu we tweaked.</p>\n</figcaption>\n        </figure><p>We forced ourselves to use our mobile apps exclusively; any interaction we made in Teamwork Chat during the day had to be done in the mobile app. This really helped. We completely redesigned some navigation menus, made some tweaks around touch input, and more. Sure, we already designed our app for touch, but how often did we really use a touch laptop or heavily use the app in a mobile Web browser? Well, clearly not enough. So we fine-grained a few things, including the swipe to show or hide the sidebar.</p>\n<h3><a id="native-wrappers" class="post-header-anchor" href="#native-wrappers" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Native wrappers</h3>\n<p>Enough about the WebView. In this iteration, we decided to drop Appcelerator and go with some native code instead. Sure, this means we’d need two implementations, one in Java and one in Swift, but it’s not so bad. It’s not a lot of code, the end result is better, and it’s what our mobile devs would prefer to work with.</p>\n<p>The native “wrappers” need to show our app in a WebView (which is stored locally), handle notifications, and so on. We found a way to communicate between our app, the native side, and vice versa. I must say it was pretty interesting to co-operate with native mobile developers on this. Once we agreed on the events to be sent back and forth, we were adding little touches which made the app feel a lot more native in no time. For example, if you were to tap the back button on Android, an event is sent into the WebView, and we then close whatever’s open, or hide the sidebar, etc.</p>\n<p>Notifications are another good example. The native side gives us an access token for the app instance on each launch, we send that off to our API and then send you push notifications based on that. We send metadata like the conversation ID in the push, so if you were to tap on it, the native side of our app would instruct our Web app to open the conversation in question, and voilà.</p>\n<p>You can go a step further and clear existing notifications on Android, which is a nice touch. If you were to receive a push notification about a message, but then view it in one of our desktop or Web apps, then the notification would disappear as you’ve already seen the message. When you view a conversation, an event is sent to from your client to ones of our services, and eventually a “silent” (invisible) notification is sent out to your device. Our Java code grabs the conversation ID and clears all associated notifications.</p>\n<h3><a id="but-what-about-real-mobile-apps" class="post-header-anchor" href="#but-what-about-real-mobile-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>But what about <em>real</em> mobile apps?</h3>\n<p>OK, fine! Let’s talk about Web versus native for a second. Web apps on mobile have gotten a bad name, unfairly. “Our biggest mistake was betting too much on HTML5” is commonly attributed to Mark Zuckerberg. Even though I don’t think this is actually what Mark said, people have latched onto this. It’s rubbish. Facebook’s HTML5 push wasn’t very successful at that time for a few reasons, one of which was down to process, for example. They had a dedicated mobile team. Mobile was always an afterthought, and it showed. Now they have mobile developers on every team. Mobile developers are involved and mobile apps are considered from beginning of any feature. If it was up to me, Teamwork Chat would eventually have some mobile developers of its own too.</p>\n<p>A lot of apps you use are hybrid apps but they don’t announce it due to the stigma involved. The feed you see in the Instagram app, who’re owned by Facebook, is HTML.</p>\n<p>We put in the effort to make a responsive app, why not try to flex it? Sure, I’m biased; I want the Web to win and it is possible to do what we had aimed to do. Don’t get me wrong though, fully native apps are the way to go for Teamwork Chat. At the end of this post, I’ll cover what the plans are for our mobile apps and the future of Teamwork Chat in general.</p>\n<h3><a id="sharing" class="post-header-anchor" href="#sharing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Sharing</h3>\n<figure>\n          <a href="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png"><img src="/images/blog-content/under-the-hood-of-a-hybrid-app/sharing.png" alt=""/></a>\n          <figcaption><p>The screen shown when something is shared to our Android app.</p>\n</figcaption>\n        </figure><p>Android and iOS diverge when it comes to the concept of sharing. For awhile now on Android, you can easily share anything from one app to another; once you tap the share icon, all apps which can handle files of that type will be shown. Typically, once you select an app, you’re then brought into said app, and how the app handles the rest varies. For example, the Twitter app will show a form to compose a tweet with the image already attached. Once you’re done, you’re still in the app. So we didn’t need to do much on the native side to achieve this. We pass the image data in an event from Java to JavaScript, and show a screen inside the WebView allowing you to choose which conversation to share the file to.</p>\n<p>Once the user selects a conversation or decides to create a new one, we attach the image to the message form. Images are just one example though.</p>\n<p>These days, the right thing to do on iOS is to have a “share extension.” This is almost like a separate app. It lives completely outside your app. What I mean is that when you decide to share something, a completely iOS-y dialog appears, in which the entire flow is contained, and you stay wherever you were once you’re done. So this is written completely in Swift and solely interacts with our API.</p>\n<h3><a id="feature-parity" class="post-header-anchor" href="#feature-parity" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature parity</h3>\n<p>This is something I strongly believe in. I’ll strive to make sure every feature of Teamwork Chat ever released will be released on all platforms and apps at once. There’s nothing worse than seeing a press release for a really cool feature in an app you use, only to realise you’ll have to wait awhile longer than everyone else. You don’t want to alienate your loyal users.</p>\n<p>This certainly applies to mobile apps. Everyone, please stop delivering your app to one platform before the other. Don’t punish anyone because of the device they happened to buy.</p>\n<p>Yes, this means that I believe every feature should be accessible from anywhere, on any device. It’s 2016, I shouldn’t have to defend this. Nowadays it’s really hard to even define what “mobile” means anyway. Screen size? Hmm not really anymore. Touch? Not unique. On-the-go? No, a lot of real usage happens on the couch. I won’t go on. The lines are blurred.</p>\n<p>In order to create an app for everywhere, you must design for touch everywhere and strive for simplicity. On the most narrow screen, you need to decide what’s critical for your users, moving on and up from there.</p>\n<p>This comes with some fresh challenges. Releasing both Android and iOS apps at the same time is tough. Especially when there’s internal pressure to release one or the other. It’s hard to convince people at times. We’re users after all, we make stuff to scratch our own itch at Teamwork. I must admit I gave in once or twice, but I’ll continue to fight for it. As it is in general, internal perception is important here.</p>\n<p>I wish more people wrote about feature parity, mobile-first workflows, and the transition from something more archaic. It affects the process of delivering an app in a lot of unexpected ways. For example, I remember having to push back when it came to marketing videos, which typically featured iPhones and iOS only. These growing pains are good though.</p>\n<p>To make this work, more people need to work together and in parallel to deliver something great together. It doesn’t help that your mobile app needs to be reviewed. Android app submissions may only take up to a day to go through validation at worse, but the Apple review process could be anywhere from a few days to a couple of weeks. Not only is it difficult to align all of the releases, but what if a submission gets rejected?</p>\n<h3><a id="living-with-a-mobile-app" class="post-header-anchor" href="#living-with-a-mobile-app" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Living with a mobile app</h3>\n<p>Working on a mobile app is completely alien to Web developers. If you introduce a bug, you can’t just roll out a quick fix and forget about it. It can take a lot of time to release the fix and you’re not guaranteed every user will even accept the update. Luckily, we were already in this frame of mind as we have desktop apps which follow pretty much the same flow.</p>\n<p>Even though we’re used to pushing out desktop app releases, the delay and uncertainty involved here is a pain point. A workaround we’re looking at is updating our app without going through the app store. What I mean is that we ship our mobile app with our Web app inside as usual but when the app is launched, it hits an API or S3, checks for a newer version and downloads it in the background if one exists. Then this version would be used in the WebView on next launch. This would allow us to roll out changes on a whim.</p>\n<p>By changes, I mean changes to the WebView only. Anything else will require a proper app store update. Full updates should be done regularly anyway so it doesn’t look we have never released an update. Also, so we can update the changelogs on the app store listing. It would feel weird to put stuff in the changelogs which have been in the app for awhile though. Yes, I’ve been told I’m paying too much attention to changelogs. We could run into the situation where the WebView or native wrapper sends an event which crashes the app if we were to make a breaking change in our event API.</p>\n<p>This is interesting though; it makes me wonder about how we update our desktop apps. Maybe we could transition to an update process like this. The jury is still out yet though, the implications of a possible move from <a href="http://nwjs.io/" rel="noopener">NW.js</a> to <a href="http://electron.atom.io/" rel="noopener">Electron</a> would need to be taken into account here. You might see a post on this in the future.</p>\n<h3><a id="feature-flags" class="post-header-anchor" href="#feature-flags" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Feature flags</h3>\n<p>We’ve been talking about using <a href="https://www.youtube.com/watch?v=JR-ccCTmMKY" rel="noopener">proper feature flags</a> for awhile now, but this could be something else which would help us achieve feature parity. The idea would be to put the code for a feature out there on every platform behind a flag. We have this already for tiny things, some code is conditionally ran for just us, etc. When I say “proper features flags” I mean we’d hit an API to get this setting. Once all of the releases are out, we’d enable toggle the feature flag and on next reload or relaunch, the feature would be there.</p>\n<p>Teamwork Chat is very much a single page app though, so it would be even better if a feature could be toggled at runtime. For example, we could enable search for everyone and boom, the search icon appears for everyone. This opens the door for progressively rolling stuff out, to certain accounts, to a percentage of our users, as well as A/B testing, and even disabling the feature again if the fan requires some cleaning.</p>\n<h3><a id="the-release" class="post-header-anchor" href="#the-release" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The release</h3>\n<iframe width="560" height="315" src="https://www.youtube.com/embed/deorlUmLsdI" frameborder="0" allowfullscreen></iframe>\n<p>Expecting that we’d be waiting awhile, we submitted our iOS app first. The terrible piece of software that is iTunes Connect gives you the option to release the app immediately once it has been validated, on or past a certain date, as well as a manual release. We opted for a manual release. The plan was that was once we were alerted that the app was ready, we’d submit the Android app, and once that was out, we’d hit the publish button. Note: the Google Play Developer Console (which is awful too) has added a manual release option since then.</p>\n<p>Our iOS app was rejected. Argh! We had marketing campaigns ongoing teasing something big, we had to quickly come up with a plan B. We didn’t want to be empty handed when the end of the month came by. Why did it fail? Basically, there was a misunderstanding in what our app was, and who it was targeted at. We promptly submitted an appeal, and even though we knew we were right, we were amazed to see the decision overturned a couple of days later. The Android release took a couple of hours, and that was it, the Teamwork Chat mobile apps were out there. We were ecstatic.</p>\n<h3><a id="the-future" class="post-header-anchor" href="#the-future" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The future</h3>\n<p>There is definitely room for improvement, I’ll be the first to say it. They could be faster, start up quicker, be less janky, and so on. We’re going to work hard on this. The great thing is that this these efforts will translate into improvements in the Web and desktop apps as well.</p>\n<p>We will be making native mobile apps. We have planned to for awhile now. We have some mobile developers in-house dying for a crack at it. Expect a couple of great apps that really feel at home in your OS. One upside to going down the native route is that users can see you care as you’ve tailored an app to their OS. Sure they’ll be distinct, the Android one will have a strong material design feel, but we’ll strive to keep in sync with each other and Teamwork Chat in general when it comes to features as well as the overall experience.</p>\n<p>Sure, this means we’ll have fewer eyes on our Web app on a mobile Web browser or narrow screen, but it’s worth it.</p>\n<h3><a id="automation-and-deployment" class="post-header-anchor" href="#automation-and-deployment" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Automation and deployment</h3>\n<p>Right now, our desktop apps need to built on Windows for Windows and on Mac for Mac. This takes time. We’ve added more update channels which compounds the problem. I’d love to automate this. Mobile app builds and deployments could also be automated in a similar fashion. Watch this space.</p>\n<p>While we’re on the topic, I’m happy to say we’ve moved from DeployBot (formerly <a href="http://dploy.io" rel="noopener">dploy.io</a>) to <a href="https://codeship.com/" rel="noopener">CodeShip</a> for all continuous integration and deployment. DeployBot wasn’t reliable enough for us. One time I decided to roll back and it deployed the wrong commit. As well as incidents like that, their frequent maintenance windows seemed to always coincide with when we needed them the most.</p>\n<p>All of our services are now deployed once we push to <code>master</code>. Same goes for the Web version, but we don’t roll out as often as I’d like. Continuous delivery is a target though, for the desktop apps as well as our Web app. Although, to get there, we need more automated tests. We’ve heavily tested certain critical pieces and at least 85% of new services are covered with tests, but we need more. Especially integration tests for clients, ran in multiple browsers concurrently. This is possible, I’ve done it previously with Selenium Grid, etc., we just haven’t made the time for it yet.</p>\n<p>There are also a few tools out there now for testing responsive designs. We could, for example, take screenshots of pages at multiple breakpoints, compare them with the most recent stable ones, and fail the build if the visual diff is too much. Although this might not be a great fit for continuous integration; I’m not sure how it would work if you intentionally introduced a significant visual change. You could disable the test if a certain <code>[skip-resp-tests]</code> exists in the commit message, but what if you accidentally broke something else? Food for thought.</p>\n<h3><a id="lessons-learned" class="post-header-anchor" href="#lessons-learned" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Lessons learned</h3>\n<p>We haven’t had too many scale-related pains, although we’ve found ourselves making more changes lately to take some load off <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a>. Our (email and push) notifications service could certainly be more fault tolerant. We’ve made more use of Node.js’ <a href="https://nodejs.org/api/cluster.html" rel="noopener"><strong>cluster</strong></a> module which allows us to use all of the cores on any given machine, and might yet solve another problem.</p>\n<p>As I described in last year’s post, our clients connect directly to our WebSocket servers. This means a server rollout will result in users’ clients temporarily disconnecting (plus each of them hitting the API at the same time to get any messages they’ve missed). We’re going to workaround this by effectively hot reloading via <code>cluster</code> or having a dedicated instance in front of our WebSocket servers with the sole duty of accepting WebSocket connections and load-balancing the events that come over them.</p>\n<p>How our services communicate is a bit simplistic in general. We’re going to switch over to RabbitMQ from Redis, re-do a lot of the messaging, and try to remove the dependency on a shared database at the same time.</p>\n<h3><a id="fire-in-the-hole" class="post-header-anchor" href="#fire-in-the-hole" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fire in the hole</h3>\n<p>As well as improving areas we’ve neglected, these are some of the bigger higher level features we have coming down the line:</p>\n<ul>\n<li>API</li>\n<li>Bots (prepared third-party bots and a bot API/platform)</li>\n<li>Conversation switcher</li>\n<li>Deeper integrations with <a href="https://teamwork.com/desk" rel="noopener">Teamwork Desk</a> and <a href="https://teamwork.com/projects" rel="noopener">Teamwork Projects</a></li>\n<li>Email improvements</li>\n<li>Independent signup</li>\n<li>Linux desktop app</li>\n<li>More third-party integrations (including cards, bots, etc.)</li>\n<li>Native (Android &amp; iOS) mobile apps</li>\n<li>Noise reduction (do not disturb, muting, notification settings, etc.)</li>\n<li>Opening Teamwork Chat to users outside the owner company</li>\n<li>Search</li>\n</ul>\n<p>That’s all folks! We’ll catch up again next year. Feel free to reach out to us at <a href="mailto:chat@teamwork.com">chat@teamwork.com</a> with any API or bot-related ideas or features requests. We’d love to know what you’d expect to see in our API. If you’d like to kick the tires of our hybrid, follow one of the following links:</p>\n<ul>\n<li><a href="https://play.google.com/store/apps/details?id=com.teamwork.chat&amp;hl=en" rel="noopener">Android</a></li>\n<li><a href="https://itunes.apple.com/us/app/teamwork-chat/id978062035?mt=8" rel="noopener">iOS</a></li>\n</ul>\n<hr>\n<p><em>Pssst!</em> Did you know that Teamwork Chat developers get to do whatever they like after lunch every Friday? Including improving something which annoys them (even in other Teamwork projects), hacking away on a cool open-source project, learning something completely new, or even playing around with fun just for the sake of it. We have ambitious plans, we now have five apps to maintain, and a lot of interesting challenges ahead of us. Come <a href="https://www.teamwork.com/jobs/chat-developer" rel="noopener">join the crew</a>.</p>\n',summary:"It has been about a year since we had A peek under the hood of Teamwork Chat. Since then, we’ve added a few nice features, fixed some bugs, and introduced a couple. You know how it goes. More...\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/under-the-hood-of-a-hybrid-app-2215ce6e342a"},photo:"/images/blog-content/under-the-hood-of-a-hybrid-app/nav.png",keywords:["product","web","javascript","NW.js","node-webkit","desktop","hybrid","mobile","development"],published_at:"2016-04-16T00:00:00.000Z",updated_at:"2019-05-22T08:26:38.756Z",year:2016,month:4,day:17,relevanceScore:.45833333333333326},{id:"resurrecting-clippy",slug:"resurrecting-clippy",highlightedLanguages:["javascript","css"],source:'---\ndate: 2016-03-08\nsummary: Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork\'s Engine Room\n  url: https://engineroom.teamwork.com/resurrecting-clippy-89843fcc9871\ntags:\n  - clippy\n  - desktop\n  - app\n  - nw.js\n  - node-webkit\n  - javascript\n  - development\n---\n\n## Resurrecting Clippy\n\n![Clippy on Mac OS X](/images/blog-content/resurrecting-clippy/osx.png)\n\nRemember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat Clippy? Yeah, you should be ashamed of yourself. You either loved or hated Clippy. **Spoiler**: after a lot of backlash, Microsoft secretly ran a smear campaign against its own little paperclip, including an anti-Clippy Website, a “Kill Clippy” game, and more. _“I see you’re trying to destroy me, would you like help with that?”_ Clippy said. Eventually retiring Clippy to fanfare, Microsoft masterfully spun your anger into positive press. Shame on all of you.\n\nI’m sure you’ve only recently stopped having guilt-ridden nightmares of a dancing paperclip, but I’ve good news. I’ve made a desktop application which not only brings Clippy back to Windows, but introduces Mac and Linux users to 90’s Siri too! Clippy.desktop is available for download at [teamwork.github.io/clippy.desktop](https://teamwork.github.io/clippy.desktop).\n\nWhy? Because I can. There’s just something satisfying about seeing Clippy on Windows 10 or El Capitan. It wasn’t even hard; I feel like an imposter for simply throwing together a few open-source things, so I’m going to use this an opportunity to share how easy it is to make a desktop app with NW.js (and a few pitfalls). For extra measure, here’s an embarrassing photo of me as a child:\n\n:::figure resurrecting-clippy/embarrassing.jpg Look at those curls.\n:::\n\n### Desktop (Web) apps\n\nQuickly moving on, [NW.js](http://nwjs.io/) was an obvious choice to make the app as we built the [Teamwork Chat](https://teamwork.com/chat) desktop apps with it. NW.js, along with the trendier [Electron](http://electron.atom.io/), combines Chromium and Node.js to allow you to create a desktop application from a Web application. So the resultant executable is a standalone appplication just like Chrome which has access to all of the Node.js API as well. It’s great.\n\nIt doesn’t take long to get up and running either. You technically don’t need Node.js to develop an NW.js app, but I’ll assume you have it. First, grab the offical npm package; run `npm install -g nw` to make it available from anywhere on your machine. In a new directory named `clippy-desktop`, create a HTML file with whatever content you\'d like. All we need now is an "app manifest"; run `npm init` and follow the steps the generate one. Enter the name of your HTML file when asked for the `main` file. Why `npm init`? The app manifest is basically the same as any npm module\'s `package.json` (where its dependencies are listed, and so on.). So, now you have a basic manifest looks something like this:\n\n```javascript\n{\n  "name": "clippy-desktop",\n  "version": "0.0.1",\n  "main": "index.html",\n  "dependencies": {}\n}\n```\n\nNow, run `nw clippy-desktop`.\n\n:::figure resurrecting-clippy/running.png\n:::\n\nTa-da! Your app is running. If you don’t believe me, click the hamburger icon in the top right to access the DevTools and inspect the HTML.\n\n### Hello, Clippy!\n\nOk, ok, I’ll get to Clippy already. All credit to [Smore](https://www.smore.com) for creating a HTML, CSS, and JavaScript implementation of clippy **in a weekend**; [ClippyJS](https://www.smore.com/clippy-js) is impressive! Let’s use it in our app.\n\nSmore recommend downloading the CSS and JavaScript files from the ClippyJS GitHub repository, but let’s use this as an oppurtunity to learn how using dependencies from npm works. npm is Node.js’ package manager we used earlier to install `nw`. ClippyJS isn\'t on npm (yet) but it is on GitHub and npm allows us to install it straight from GitHub by running `npm install --save smore-inc/clippy.js`. That would work but if the ClippyJS repository wasn\'t missing the manifest every Node.js module needs. So I\'ve forked the ClippyJS repository and added the `package.json` (note that I\'ve added jQuery under `dependencies`). Now, running `npm install --save adam-lynch/clippy.js#pkg` will install ClippyJS into `clippy-desktop/node_modules`. To include ClippyJS we have to reference the CSS and JavaScript files just like we would in any Web app, adding `<link href="node_modules/clippy.js/build/clippy.css" rel="stylesheet"/>` and `<script src="node_modules/clippy.js/build/clippy.min.js"><\/script>` to the correct files.\n\nNote: Just in case you’ve noticed that Clippy.desktop’s `index.html` doesn\'t reference each file like I\'ve just said; I\'ve combined the dependencies into `third-party.js` just to make it cleaner, similarly to what\'s described in [Hassle-free third-party dependencies](https://adamlynch.com/hassle-free-third-party-dependencies/).\n\nThe ClippyJS site says we’ll need to programatically show Clippy ourselves, so let’s create a `script.js` with the following contents:\n\n```javascript\nclippy.load(\'Clippy\', function(agent) {\n    agent.show();\n});\n```\n\nTo resurrect Clippy:\n\n- Make sure you’ve added a `<script>` linking to your `script.js`.\n- Kill the running app.\n- Run `nw clippy-desktop` again.\n\n### What now?!\n\nHuh. It’s not working. Open the DevTools and check for any errors. Hmm…\n\n```javascript\nFailed to load resource: net::ERR\\_FILE\\_NOT\\_FOUND\n```\n\nAh, the problem is [this line](https://github.com/smore-inc/clippy.js/blob/master/src/load.js#L1) in the ClippyJS source:\n\n```javascript\nclippy.BASE_PATH = \'//s3.amazonaws.com/clippy.js/Agents/\';\n```\n\nThe main ClippyJS file seems to be requesting more scripts from Amazon S3\\. See that the URL begins with `//` That\'s a [protocol-relative URL](http://www.paulirish.com/2010/the-protocol-relative-url/), i.e. if the current site was accessed over HTTPS, HTTPS will be used as the protocol when requesting this URL, or HTTP if the site was accessed over HTTP. But the protocol in our case is neither HTTP nor HTTPs; our `index.html` is a local file and accessed as such. In our case, this URL would be expanded tofile:///s3.amazonaws.com.... So if you want your Web app to work on the desktop, avoid protocol-relative URLs. To fix this line, you would need to have something like the following:\n\n```javascript\nclippy.BASE_PATH = (window.location.protocol === \'file:\' ? \'https:\' : window.location.protocol) + \'//s3.amazonaws.com/clippy.js/Agents/\';\n```\n\nSo, after I updated this in my fork of ClippyJS, I re-ran the `npm install` command and re-launched the app.\n\n### Think outside the box\n\nIt could be prettier though right? Let’s start by making the window a bit smaller, removing the frame, and removing the toolbar (the search bar, etc.). Add the following to the app manifest:\n\n```javascript\n"window": {\n  "frame": false,\n  "toolbar": false,\n  "width": 300,\n  "height": 300\n}\n```\n\nThat’s it.\n\nAlthough if you’re on Mac OS X you’ll notice there’s a [weird bug](https://github.com/nwjs/nw.js/issues/3645) where the window title is still shown. To workaround this, we can give the window a dummy title. We only want to do this if the app is running on Mac though, so let’s use Node.js’ core `os` module to detect the platform. Adding this to our `script.js` should be enough to solve the problem:\n\n```javascript\nvar isMac = require(\'os\').platform() === \'darwin\';\n\nif (isMac) {\n    document.title = \'\\u3000\'; // to get around https://github.com/nwjs/nw.js/issues/3645\n}\n```\n\n:::figure resurrecting-clippy/frameless.png The frameless app.\n:::\n\nOk, it’s better but let’s ditch that background.\n\nTransparency\n\nLet’s go back to our manifest and add a `transparent` property inside `window`;\n\n```javascript\n"window": {\n  "frame": false,\n  "toolbar": false,\n  "width": 300,\n  "height": 300,\n  "transparent": true\n}\n```\n\nThis gives the app the _ability_ to be transparent, but doesn’t make it transparent. This can be toggled programmatically as well. Note: depending on the platform, you may need to jump through some extra hoops, see [Transparency and NW.js](https://www.packtpub.com/books/content/transparency-and-nwjs). All that’s left is to make sure your elements are not\n\nAll that’s left is to make sure your elements are not opague; for example:\n\n```css\nbody {\n  background: transparent;\n}\n```\n\n### Dragging\n\nWe no longer have a window title bar so we can’t drag it around anymore. CSS to the rescue, again!\n\n```css\nbody {\n  -webkit-app-region: drag;\n}\n```\n\nNow you can drag the app by clicking and holding anywhere on the `body`.\n\nUnfortunately, double-clicking a draggable area triggers the window to maximize on some platforms. So what we’ll do is tell the user that double clicking will close clippy.desktop, thanks to clippy.js’ `agent.speak` method which shows a speech bubble. Just to annoy the user even more, we won’t. Instead, Clippy will disappear and reappear again after a couple of seconds. This is done in the `clippy.load` callback:\n\n```javascript\n// show clippy\nclippy.load(\'Clippy\', function(agent){\n    agent.show();\n    var intiialSpeechTimeoutId = setTimeout(function() {\n        agent.speak("Need some help closing me? Try double-clicking...");\n    }, 20000);\n\n    var windowX = null;\n    var windowY = null;\n    setTimeout(function(){\n        windowX = win.x;\n        windowY = win.y;\n    }, 250);\n\n    // ...\n\n    // Since double-clicking draggable areas triggers maximizing on some platforms, when tell the user double-clicking\n    // closes clippy but actually we\'ll hide the window, unmaximize, resize back to the normal size and show again\n    // with a speech bubble\n    win.on(\'maximize\', function(){\n        document.body.classList.add(\'hidden\');\n        win.hide();\n        if(intiialSpeechTimeoutId) {\n            clearTimeout(intiialSpeechTimeoutId);\n            intiialSpeechTimeoutId = null;\n        }\n\n        setTimeout(function(){\n            win.unmaximize();\n            win.resizeTo(gui.App.manifest.window.width, gui.App.manifest.window.height);\n            win.moveTo(windowX, windowY);\n        }, 250);\n\n        setTimeout(function(){\n            win.show();\n            document.body.classList.remove(\'hidden\');\n            setTimeout(function(){\n                agent.speak("Need some help?");\n            }, 500);\n        }, 2000);\n    });\n});\n```\n\n### Events\n\nSpeaking of clicking, we also block clippy.js from adding any event handlers itself with jQuery;\n\n```javascript\n$.fn.on = function(){};\n```\n\nThis is before `clippy.load` is called. We want to handle clicks and everything else ourselves.\n\nAnimating Clippy on click should be easy right? You might not be aware but if a window is not focused on Mac OS X, the first click focuses the window and the second click actually clicks the element. This is expected behavior on Mac OS X. Note: This is why you never create HTML window controls and bars when using NW.js or Electron, as it would take two clicks to minimize a window for example.\n\nThis is why I use the window’s `focus` event instead. Whenever the window is focused, I trigger an animation and blur the window.\n\n```javascript\n// to be safe: use focus as a click handler kinda, to trigger animations. Blur when done so every click triggers\n// an animation\nwin.on(‘focus’, function() {\n  agent.animate();\n  win.blur();\n});\n```\n\nNote: Cross-platform support for blurring isn’t 100% solid so it’s best to just trigger an animation every once in awhile anyway as well.\n\n### I see you have no internet connection\n\nIf you’re offline, clippy.desktop doesn’t show anything. Why? Let’s take a look at the line in clippy.js again:\n\n```javascript\nclippy.BASE_PATH = (window.location.protocol === ‘file:’ ? ‘https:’ : window.location.protocol) + ‘//s3.amazonaws.com/clippy.js/Agents/’;\n```\n\nWhy is it doing anything at all with URLs? I’m not sure why it wasn’t bundled into one script but ClippyJS requests additional (remote) scripts from within the base clippy.js script. This doesn’t make sense for a desktop app.\n\n![](/images/blog-content/resurrecting-clippy/mental.png)\n\n### Mental mode\n\nThis is where you come in. This implementation is just a start. Feel free to [improve it in a pull-request](https://github.com/teamwork/clippy.desktop). After all, it’s just HTML, CSS, and Javascript. I’m not suggesting that you add a mode which makes Clippy disappear on `mouseover`, reappear elsewhere, jump around the place, driving the user insane. Definitely not.\n\n### TL;DR\n\n- It’s easy to make a desktop (Web) app with NW.js.\n- You can access all of Node.js, its module system and npm.\n- Don’t use protocol-less URIs.\n- Be aware of how Mac OS X treats clicks on unfocused windows.\n- Make sure your app works offline.\n- Have fun.\n',unfilteredRenderedBody:'<h2><a id="resurrecting-clippy" class="post-header-anchor" href="#resurrecting-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resurrecting Clippy</h2>\n<p><img src="/images/blog-content/resurrecting-clippy/osx.png" alt="Clippy on Mac OS X"></p>\n<p>Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat Clippy? Yeah, you should be ashamed of yourself. You either loved or hated Clippy. <strong>Spoiler</strong>: after a lot of backlash, Microsoft secretly ran a smear campaign against its own little paperclip, including an anti-Clippy Website, a “Kill Clippy” game, and more. <em>“I see you’re trying to destroy me, would you like help with that?”</em> Clippy said. Eventually retiring Clippy to fanfare, Microsoft masterfully spun your anger into positive press. Shame on all of you.</p>\n<p>I’m sure you’ve only recently stopped having guilt-ridden nightmares of a dancing paperclip, but I’ve good news. I’ve made a desktop application which not only brings Clippy back to Windows, but introduces Mac and Linux users to 90’s Siri too! Clippy.desktop is available for download at <a href="https://teamwork.github.io/clippy.desktop" rel="noopener">teamwork.github.io/clippy.desktop</a>.</p>\n<p>Why? Because I can. There’s just something satisfying about seeing Clippy on Windows 10 or El Capitan. It wasn’t even hard; I feel like an imposter for simply throwing together a few open-source things, so I’m going to use this an opportunity to share how easy it is to make a desktop app with NW.js (and a few pitfalls). For extra measure, here’s an embarrassing photo of me as a child:</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/embarrassing.jpg"><img src="/images/blog-content/resurrecting-clippy/embarrassing.jpg" alt=""/></a>\n          <figcaption><p>Look at those curls.</p>\n</figcaption>\n        </figure><h3><a id="desktop-web-apps" class="post-header-anchor" href="#desktop-web-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Desktop (Web) apps</h3>\n<p>Quickly moving on, <a href="http://nwjs.io/" rel="noopener">NW.js</a> was an obvious choice to make the app as we built the <a href="https://teamwork.com/chat" rel="noopener">Teamwork Chat</a> desktop apps with it. NW.js, along with the trendier <a href="http://electron.atom.io/" rel="noopener">Electron</a>, combines Chromium and Node.js to allow you to create a desktop application from a Web application. So the resultant executable is a standalone appplication just like Chrome which has access to all of the Node.js API as well. It’s great.</p>\n<p>It doesn’t take long to get up and running either. You technically don’t need Node.js to develop an NW.js app, but I’ll assume you have it. First, grab the offical npm package; run <code>npm install -g nw</code> to make it available from anywhere on your machine. In a new directory named <code>clippy-desktop</code>, create a HTML file with whatever content you\'d like. All we need now is an &quot;app manifest&quot;; run <code>npm init</code> and follow the steps the generate one. Enter the name of your HTML file when asked for the <code>main</code> file. Why <code>npm init</code>? The app manifest is basically the same as any npm module\'s <code>package.json</code> (where its dependencies are listed, and so on.). So, now you have a basic manifest looks something like this:</p>\n<pre><code class="language-javascript"><span class="token punctuation">{</span>\n  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"clippy-desktop"</span><span class="token punctuation">,</span>\n  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>\n  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span>\n  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now, run <code>nw clippy-desktop</code>.</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/running.png"><img src="/images/blog-content/resurrecting-clippy/running.png" alt=""/></a>\n          \n        </figure><p>Ta-da! Your app is running. If you don’t believe me, click the hamburger icon in the top right to access the DevTools and inspect the HTML.</p>\n<h3><a id="hello-clippy" class="post-header-anchor" href="#hello-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Hello, Clippy!</h3>\n<p>Ok, ok, I’ll get to Clippy already. All credit to <a href="https://www.smore.com" rel="noopener">Smore</a> for creating a HTML, CSS, and JavaScript implementation of clippy <strong>in a weekend</strong>; <a href="https://www.smore.com/clippy-js" rel="noopener">ClippyJS</a> is impressive! Let’s use it in our app.</p>\n<p>Smore recommend downloading the CSS and JavaScript files from the ClippyJS GitHub repository, but let’s use this as an oppurtunity to learn how using dependencies from npm works. npm is Node.js’ package manager we used earlier to install <code>nw</code>. ClippyJS isn\'t on npm (yet) but it is on GitHub and npm allows us to install it straight from GitHub by running <code>npm install --save smore-inc/clippy.js</code>. That would work but if the ClippyJS repository wasn\'t missing the manifest every Node.js module needs. So I\'ve forked the ClippyJS repository and added the <code>package.json</code> (note that I\'ve added jQuery under <code>dependencies</code>). Now, running <code>npm install --save adam-lynch/clippy.js#pkg</code> will install ClippyJS into <code>clippy-desktop/node_modules</code>. To include ClippyJS we have to reference the CSS and JavaScript files just like we would in any Web app, adding <code>&lt;link href=&quot;node_modules/clippy.js/build/clippy.css&quot; rel=&quot;stylesheet&quot;/&gt;</code> and <code>&lt;script src=&quot;node_modules/clippy.js/build/clippy.min.js&quot;&gt;&lt;/script&gt;</code> to the correct files.</p>\n<p>Note: Just in case you’ve noticed that Clippy.desktop’s <code>index.html</code> doesn\'t reference each file like I\'ve just said; I\'ve combined the dependencies into <code>third-party.js</code> just to make it cleaner, similarly to what\'s described in <a href="https://adamlynch.com/hassle-free-third-party-dependencies/" rel="noopener">Hassle-free third-party dependencies</a>.</p>\n<p>The ClippyJS site says we’ll need to programatically show Clippy ourselves, so let’s create a <code>script.js</code> with the following contents:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>To resurrect Clippy:</p>\n<ul>\n<li>Make sure you’ve added a <code>&lt;script&gt;</code> linking to your <code>script.js</code>.</li>\n<li>Kill the running app.</li>\n<li>Run <code>nw clippy-desktop</code> again.</li>\n</ul>\n<h3><a id="what-now" class="post-header-anchor" href="#what-now" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>What now?!</h3>\n<p>Huh. It’s not working. Open the DevTools and check for any errors. Hmm…</p>\n<pre><code class="language-javascript">Failed to load resource<span class="token punctuation">:</span> net<span class="token punctuation">:</span><span class="token punctuation">:</span>ERR\\_FILE\\_NOT\\_FOUND\n</code></pre>\n<p>Ah, the problem is <a href="https://github.com/smore-inc/clippy.js/blob/master/src/load.js#L1" rel="noopener">this line</a> in the ClippyJS source:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>The main ClippyJS file seems to be requesting more scripts from Amazon S3. See that the URL begins with <code>//</code> That\'s a <a href="http://www.paulirish.com/2010/the-protocol-relative-url/" rel="noopener">protocol-relative URL</a>, i.e. if the current site was accessed over HTTPS, HTTPS will be used as the protocol when requesting this URL, or HTTP if the site was accessed over HTTP. But the protocol in our case is neither HTTP nor HTTPs; our <code>index.html</code> is a local file and accessed as such. In our case, this URL would be expanded tofile:///s3.amazonaws.com.... So if you want your Web app to work on the desktop, avoid protocol-relative URLs. To fix this line, you would need to have something like the following:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">\'file:\'</span> <span class="token operator">?</span> <span class="token string">\'https:\'</span> <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So, after I updated this in my fork of ClippyJS, I re-ran the <code>npm install</code> command and re-launched the app.</p>\n<h3><a id="think-outside-the-box" class="post-header-anchor" href="#think-outside-the-box" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Think outside the box</h3>\n<p>It could be prettier though right? Let’s start by making the window a bit smaller, removing the frame, and removing the toolbar (the search bar, etc.). Add the following to the app manifest:</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>That’s it.</p>\n<p>Although if you’re on Mac OS X you’ll notice there’s a <a href="https://github.com/nwjs/nw.js/issues/3645" rel="noopener">weird bug</a> where the window title is still shown. To workaround this, we can give the window a dummy title. We only want to do this if the app is running on Mac though, so let’s use Node.js’ core <code>os</code> module to detect the platform. Adding this to our <code>script.js</code> should be enough to solve the problem:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> isMac <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'os\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'darwin\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>isMac<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">\'\\u3000\'</span><span class="token punctuation">;</span> <span class="token comment">// to get around https://github.com/nwjs/nw.js/issues/3645</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/frameless.png"><img src="/images/blog-content/resurrecting-clippy/frameless.png" alt=""/></a>\n          <figcaption><p>The frameless app.</p>\n</figcaption>\n        </figure><p>Ok, it’s better but let’s ditch that background.</p>\n<p>Transparency</p>\n<p>Let’s go back to our manifest and add a <code>transparent</code> property inside <code>window</code>;</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"transparent"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>This gives the app the <em>ability</em> to be transparent, but doesn’t make it transparent. This can be toggled programmatically as well. Note: depending on the platform, you may need to jump through some extra hoops, see <a href="https://www.packtpub.com/books/content/transparency-and-nwjs" rel="noopener">Transparency and NW.js</a>. All that’s left is to make sure your elements are not</p>\n<p>All that’s left is to make sure your elements are not opague; for example:</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<h3><a id="dragging" class="post-header-anchor" href="#dragging" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dragging</h3>\n<p>We no longer have a window title bar so we can’t drag it around anymore. CSS to the rescue, again!</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">-webkit-app-region</span><span class="token punctuation">:</span> drag<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now you can drag the app by clicking and holding anywhere on the <code>body</code>.</p>\n<p>Unfortunately, double-clicking a draggable area triggers the window to maximize on some platforms. So what we’ll do is tell the user that double clicking will close clippy.desktop, thanks to clippy.js’ <code>agent.speak</code> method which shows a speech bubble. Just to annoy the user even more, we won’t. Instead, Clippy will disappear and reappear again after a couple of seconds. This is done in the <code>clippy.load</code> callback:</p>\n<pre><code class="language-javascript"><span class="token comment">// show clippy</span>\nclippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help closing me? Try double-clicking..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> windowX <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> windowY <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        windowX <span class="token operator">=</span> win<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n        windowY <span class="token operator">=</span> win<span class="token punctuation">.</span>y<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...</span>\n\n    <span class="token comment">// Since double-clicking draggable areas triggers maximizing on some platforms, when tell the user double-clicking</span>\n    <span class="token comment">// closes clippy but actually we\'ll hide the window, unmaximize, resize back to the normal size and show again</span>\n    <span class="token comment">// with a speech bubble</span>\n    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'maximize\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        win<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">unmaximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">resizeTo</span><span class="token punctuation">(</span>gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>windowX<span class="token punctuation">,</span> windowY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n                agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<h3><a id="events" class="post-header-anchor" href="#events" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Events</h3>\n<p>Speaking of clicking, we also block clippy.js from adding any event handlers itself with jQuery;</p>\n<pre><code class="language-javascript">$<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is before <code>clippy.load</code> is called. We want to handle clicks and everything else ourselves.</p>\n<p>Animating Clippy on click should be easy right? You might not be aware but if a window is not focused on Mac OS X, the first click focuses the window and the second click actually clicks the element. This is expected behavior on Mac OS X. Note: This is why you never create HTML window controls and bars when using NW.js or Electron, as it would take two clicks to minimize a window for example.</p>\n<p>This is why I use the window’s <code>focus</code> event instead. Whenever the window is focused, I trigger an animation and blur the window.</p>\n<pre><code class="language-javascript"><span class="token comment">// to be safe: use focus as a click handler kinda, to trigger animations. Blur when done so every click triggers</span>\n<span class="token comment">// an animation</span>\nwin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>‘focus’<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  agent<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  win<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note: Cross-platform support for blurring isn’t 100% solid so it’s best to just trigger an animation every once in awhile anyway as well.</p>\n<h3><a id="i-see-you-have-no-internet-connection" class="post-header-anchor" href="#i-see-you-have-no-internet-connection" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I see you have no internet connection</h3>\n<p>If you’re offline, clippy.desktop doesn’t show anything. Why? Let’s take a look at the line in clippy.js again:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> ‘file<span class="token punctuation">:</span>’ <span class="token operator">?</span> ‘https<span class="token punctuation">:</span>’ <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> ‘<span class="token comment">//s3.amazonaws.com/clippy.js/Agents/’;</span>\n</code></pre>\n<p>Why is it doing anything at all with URLs? I’m not sure why it wasn’t bundled into one script but ClippyJS requests additional (remote) scripts from within the base clippy.js script. This doesn’t make sense for a desktop app.</p>\n<p><img src="/images/blog-content/resurrecting-clippy/mental.png" alt=""></p>\n<h3><a id="mental-mode" class="post-header-anchor" href="#mental-mode" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mental mode</h3>\n<p>This is where you come in. This implementation is just a start. Feel free to <a href="https://github.com/teamwork/clippy.desktop" rel="noopener">improve it in a pull-request</a>. After all, it’s just HTML, CSS, and Javascript. I’m not suggesting that you add a mode which makes Clippy disappear on <code>mouseover</code>, reappear elsewhere, jump around the place, driving the user insane. Definitely not.</p>\n<h3><a id="tldr" class="post-header-anchor" href="#tldr" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>TL;DR</h3>\n<ul>\n<li>It’s easy to make a desktop (Web) app with NW.js.</li>\n<li>You can access all of Node.js, its module system and npm.</li>\n<li>Don’t use protocol-less URIs.</li>\n<li>Be aware of how Mac OS X treats clicks on unfocused windows.</li>\n<li>Make sure your app works offline.</li>\n<li>Have fun.</li>\n</ul>\n',attributes:{date:"2016-03-08T00:00:00.000Z",summary:"Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/resurrecting-clippy-89843fcc9871"},tags:[{id:"clippy",name:"clippy"},{id:"desktop",name:"desktop"},{id:"app",name:"app"},{id:"nwjs",name:"NW.js"},{id:"node-webkit",name:"node-webkit"},{id:"javascript",name:"javascript"},{id:"development",name:"development"}],title:"Resurrecting Clippy",updated_at:"2019-05-22T08:26:22.959Z",photo:"/images/blog-content/resurrecting-clippy/osx.png"},title:"Resurrecting Clippy",renderedSummary:"<p>Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...</p>\n",rendered:'<h2><a id="resurrecting-clippy" class="post-header-anchor" href="#resurrecting-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resurrecting Clippy</h2>\n<p><img src="/images/blog-content/resurrecting-clippy/osx.png" alt="Clippy on Mac OS X"></p>\n<p>Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat Clippy? Yeah, you should be ashamed of yourself. You either loved or hated Clippy. <strong>Spoiler</strong>: after a lot of backlash, Microsoft secretly ran a smear campaign against its own little paperclip, including an anti-Clippy Website, a “Kill Clippy” game, and more. <em>“I see you’re trying to destroy me, would you like help with that?”</em> Clippy said. Eventually retiring Clippy to fanfare, Microsoft masterfully spun your anger into positive press. Shame on all of you.</p>\n<p>I’m sure you’ve only recently stopped having guilt-ridden nightmares of a dancing paperclip, but I’ve good news. I’ve made a desktop application which not only brings Clippy back to Windows, but introduces Mac and Linux users to 90’s Siri too! Clippy.desktop is available for download at <a href="https://teamwork.github.io/clippy.desktop" rel="noopener">teamwork.github.io/clippy.desktop</a>.</p>\n<p>Why? Because I can. There’s just something satisfying about seeing Clippy on Windows 10 or El Capitan. It wasn’t even hard; I feel like an imposter for simply throwing together a few open-source things, so I’m going to use this an opportunity to share how easy it is to make a desktop app with NW.js (and a few pitfalls). For extra measure, here’s an embarrassing photo of me as a child:</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/embarrassing.jpg"><img src="/images/blog-content/resurrecting-clippy/embarrassing.jpg" alt=""/></a>\n          <figcaption><p>Look at those curls.</p>\n</figcaption>\n        </figure><h3><a id="desktop-web-apps" class="post-header-anchor" href="#desktop-web-apps" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Desktop (Web) apps</h3>\n<p>Quickly moving on, <a href="http://nwjs.io/" rel="noopener">NW.js</a> was an obvious choice to make the app as we built the <a href="https://teamwork.com/chat" rel="noopener">Teamwork Chat</a> desktop apps with it. NW.js, along with the trendier <a href="http://electron.atom.io/" rel="noopener">Electron</a>, combines Chromium and Node.js to allow you to create a desktop application from a Web application. So the resultant executable is a standalone appplication just like Chrome which has access to all of the Node.js API as well. It’s great.</p>\n<p>It doesn’t take long to get up and running either. You technically don’t need Node.js to develop an NW.js app, but I’ll assume you have it. First, grab the offical npm package; run <code>npm install -g nw</code> to make it available from anywhere on your machine. In a new directory named <code>clippy-desktop</code>, create a HTML file with whatever content you\'d like. All we need now is an &quot;app manifest&quot;; run <code>npm init</code> and follow the steps the generate one. Enter the name of your HTML file when asked for the <code>main</code> file. Why <code>npm init</code>? The app manifest is basically the same as any npm module\'s <code>package.json</code> (where its dependencies are listed, and so on.). So, now you have a basic manifest looks something like this:</p>\n<pre><code class="language-javascript"><span class="token punctuation">{</span>\n  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"clippy-desktop"</span><span class="token punctuation">,</span>\n  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>\n  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span>\n  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now, run <code>nw clippy-desktop</code>.</p>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/running.png"><img src="/images/blog-content/resurrecting-clippy/running.png" alt=""/></a>\n          \n        </figure><p>Ta-da! Your app is running. If you don’t believe me, click the hamburger icon in the top right to access the DevTools and inspect the HTML.</p>\n<h3><a id="hello-clippy" class="post-header-anchor" href="#hello-clippy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Hello, Clippy!</h3>\n<p>Ok, ok, I’ll get to Clippy already. All credit to <a href="https://www.smore.com" rel="noopener">Smore</a> for creating a HTML, CSS, and JavaScript implementation of clippy <strong>in a weekend</strong>; <a href="https://www.smore.com/clippy-js" rel="noopener">ClippyJS</a> is impressive! Let’s use it in our app.</p>\n<p>Smore recommend downloading the CSS and JavaScript files from the ClippyJS GitHub repository, but let’s use this as an oppurtunity to learn how using dependencies from npm works. npm is Node.js’ package manager we used earlier to install <code>nw</code>. ClippyJS isn\'t on npm (yet) but it is on GitHub and npm allows us to install it straight from GitHub by running <code>npm install --save smore-inc/clippy.js</code>. That would work but if the ClippyJS repository wasn\'t missing the manifest every Node.js module needs. So I\'ve forked the ClippyJS repository and added the <code>package.json</code> (note that I\'ve added jQuery under <code>dependencies</code>). Now, running <code>npm install --save adam-lynch/clippy.js#pkg</code> will install ClippyJS into <code>clippy-desktop/node_modules</code>. To include ClippyJS we have to reference the CSS and JavaScript files just like we would in any Web app, adding <code>&lt;link href=&quot;node_modules/clippy.js/build/clippy.css&quot; rel=&quot;stylesheet&quot;/&gt;</code> and <code>&lt;script src=&quot;node_modules/clippy.js/build/clippy.min.js&quot;&gt;&lt;/script&gt;</code> to the correct files.</p>\n<p>Note: Just in case you’ve noticed that Clippy.desktop’s <code>index.html</code> doesn\'t reference each file like I\'ve just said; I\'ve combined the dependencies into <code>third-party.js</code> just to make it cleaner, similarly to what\'s described in <a href="https://adamlynch.com/hassle-free-third-party-dependencies/" rel="noopener">Hassle-free third-party dependencies</a>.</p>\n<p>The ClippyJS site says we’ll need to programatically show Clippy ourselves, so let’s create a <code>script.js</code> with the following contents:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>To resurrect Clippy:</p>\n<ul>\n<li>Make sure you’ve added a <code>&lt;script&gt;</code> linking to your <code>script.js</code>.</li>\n<li>Kill the running app.</li>\n<li>Run <code>nw clippy-desktop</code> again.</li>\n</ul>\n<h3><a id="what-now" class="post-header-anchor" href="#what-now" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>What now?!</h3>\n<p>Huh. It’s not working. Open the DevTools and check for any errors. Hmm…</p>\n<pre><code class="language-javascript">Failed to load resource<span class="token punctuation">:</span> net<span class="token punctuation">:</span><span class="token punctuation">:</span>ERR\\_FILE\\_NOT\\_FOUND\n</code></pre>\n<p>Ah, the problem is <a href="https://github.com/smore-inc/clippy.js/blob/master/src/load.js#L1" rel="noopener">this line</a> in the ClippyJS source:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>The main ClippyJS file seems to be requesting more scripts from Amazon S3. See that the URL begins with <code>//</code> That\'s a <a href="http://www.paulirish.com/2010/the-protocol-relative-url/" rel="noopener">protocol-relative URL</a>, i.e. if the current site was accessed over HTTPS, HTTPS will be used as the protocol when requesting this URL, or HTTP if the site was accessed over HTTP. But the protocol in our case is neither HTTP nor HTTPs; our <code>index.html</code> is a local file and accessed as such. In our case, this URL would be expanded tofile:///s3.amazonaws.com.... So if you want your Web app to work on the desktop, avoid protocol-relative URLs. To fix this line, you would need to have something like the following:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> <span class="token string">\'file:\'</span> <span class="token operator">?</span> <span class="token string">\'https:\'</span> <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'//s3.amazonaws.com/clippy.js/Agents/\'</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So, after I updated this in my fork of ClippyJS, I re-ran the <code>npm install</code> command and re-launched the app.</p>\n<h3><a id="think-outside-the-box" class="post-header-anchor" href="#think-outside-the-box" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Think outside the box</h3>\n<p>It could be prettier though right? Let’s start by making the window a bit smaller, removing the frame, and removing the toolbar (the search bar, etc.). Add the following to the app manifest:</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>That’s it.</p>\n<p>Although if you’re on Mac OS X you’ll notice there’s a <a href="https://github.com/nwjs/nw.js/issues/3645" rel="noopener">weird bug</a> where the window title is still shown. To workaround this, we can give the window a dummy title. We only want to do this if the app is running on Mac though, so let’s use Node.js’ core <code>os</code> module to detect the platform. Adding this to our <code>script.js</code> should be enough to solve the problem:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> isMac <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'os\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">platform</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'darwin\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>isMac<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">\'\\u3000\'</span><span class="token punctuation">;</span> <span class="token comment">// to get around https://github.com/nwjs/nw.js/issues/3645</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<figure>\n          <a href="/images/blog-content/resurrecting-clippy/frameless.png"><img src="/images/blog-content/resurrecting-clippy/frameless.png" alt=""/></a>\n          <figcaption><p>The frameless app.</p>\n</figcaption>\n        </figure><p>Ok, it’s better but let’s ditch that background.</p>\n<p>Transparency</p>\n<p>Let’s go back to our manifest and add a <code>transparent</code> property inside <code>window</code>;</p>\n<pre><code class="language-javascript"><span class="token string">"window"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  <span class="token string">"frame"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"toolbar"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  <span class="token string">"transparent"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>This gives the app the <em>ability</em> to be transparent, but doesn’t make it transparent. This can be toggled programmatically as well. Note: depending on the platform, you may need to jump through some extra hoops, see <a href="https://www.packtpub.com/books/content/transparency-and-nwjs" rel="noopener">Transparency and NW.js</a>. All that’s left is to make sure your elements are not</p>\n<p>All that’s left is to make sure your elements are not opague; for example:</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<h3><a id="dragging" class="post-header-anchor" href="#dragging" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dragging</h3>\n<p>We no longer have a window title bar so we can’t drag it around anymore. CSS to the rescue, again!</p>\n<pre><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n  <span class="token property">-webkit-app-region</span><span class="token punctuation">:</span> drag<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now you can drag the app by clicking and holding anywhere on the <code>body</code>.</p>\n<p>Unfortunately, double-clicking a draggable area triggers the window to maximize on some platforms. So what we’ll do is tell the user that double clicking will close clippy.desktop, thanks to clippy.js’ <code>agent.speak</code> method which shows a speech bubble. Just to annoy the user even more, we won’t. Instead, Clippy will disappear and reappear again after a couple of seconds. This is done in the <code>clippy.load</code> callback:</p>\n<pre><code class="language-javascript"><span class="token comment">// show clippy</span>\nclippy<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">\'Clippy\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>agent<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    agent<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help closing me? Try double-clicking..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> windowX <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> windowY <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        windowX <span class="token operator">=</span> win<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n        windowY <span class="token operator">=</span> win<span class="token punctuation">.</span>y<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...</span>\n\n    <span class="token comment">// Since double-clicking draggable areas triggers maximizing on some platforms, when tell the user double-clicking</span>\n    <span class="token comment">// closes clippy but actually we\'ll hide the window, unmaximize, resize back to the normal size and show again</span>\n    <span class="token comment">// with a speech bubble</span>\n    win<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'maximize\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        win<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>intiialSpeechTimeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            intiialSpeechTimeoutId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">unmaximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">resizeTo</span><span class="token punctuation">(</span>gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gui<span class="token punctuation">.</span>App<span class="token punctuation">.</span>manifest<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            win<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>windowX<span class="token punctuation">,</span> windowY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n            win<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'hidden\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n                agent<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token string">"Need some help?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<h3><a id="events" class="post-header-anchor" href="#events" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Events</h3>\n<p>Speaking of clicking, we also block clippy.js from adding any event handlers itself with jQuery;</p>\n<pre><code class="language-javascript">$<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is before <code>clippy.load</code> is called. We want to handle clicks and everything else ourselves.</p>\n<p>Animating Clippy on click should be easy right? You might not be aware but if a window is not focused on Mac OS X, the first click focuses the window and the second click actually clicks the element. This is expected behavior on Mac OS X. Note: This is why you never create HTML window controls and bars when using NW.js or Electron, as it would take two clicks to minimize a window for example.</p>\n<p>This is why I use the window’s <code>focus</code> event instead. Whenever the window is focused, I trigger an animation and blur the window.</p>\n<pre><code class="language-javascript"><span class="token comment">// to be safe: use focus as a click handler kinda, to trigger animations. Blur when done so every click triggers</span>\n<span class="token comment">// an animation</span>\nwin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>‘focus’<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  agent<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  win<span class="token punctuation">.</span><span class="token function">blur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note: Cross-platform support for blurring isn’t 100% solid so it’s best to just trigger an animation every once in awhile anyway as well.</p>\n<h3><a id="i-see-you-have-no-internet-connection" class="post-header-anchor" href="#i-see-you-have-no-internet-connection" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I see you have no internet connection</h3>\n<p>If you’re offline, clippy.desktop doesn’t show anything. Why? Let’s take a look at the line in clippy.js again:</p>\n<pre><code class="language-javascript">clippy<span class="token punctuation">.</span>BASE_PATH <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">===</span> ‘file<span class="token punctuation">:</span>’ <span class="token operator">?</span> ‘https<span class="token punctuation">:</span>’ <span class="token punctuation">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token punctuation">)</span> <span class="token operator">+</span> ‘<span class="token comment">//s3.amazonaws.com/clippy.js/Agents/’;</span>\n</code></pre>\n<p>Why is it doing anything at all with URLs? I’m not sure why it wasn’t bundled into one script but ClippyJS requests additional (remote) scripts from within the base clippy.js script. This doesn’t make sense for a desktop app.</p>\n<p><img src="/images/blog-content/resurrecting-clippy/mental.png" alt=""></p>\n<h3><a id="mental-mode" class="post-header-anchor" href="#mental-mode" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Mental mode</h3>\n<p>This is where you come in. This implementation is just a start. Feel free to <a href="https://github.com/teamwork/clippy.desktop" rel="noopener">improve it in a pull-request</a>. After all, it’s just HTML, CSS, and Javascript. I’m not suggesting that you add a mode which makes Clippy disappear on <code>mouseover</code>, reappear elsewhere, jump around the place, driving the user insane. Definitely not.</p>\n<h3><a id="tldr" class="post-header-anchor" href="#tldr" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>TL;DR</h3>\n<ul>\n<li>It’s easy to make a desktop (Web) app with NW.js.</li>\n<li>You can access all of Node.js, its module system and npm.</li>\n<li>Don’t use protocol-less URIs.</li>\n<li>Be aware of how Mac OS X treats clicks on unfocused windows.</li>\n<li>Make sure your app works offline.</li>\n<li>Have fun.</li>\n</ul>\n',summary:"Remember Clippy? First shipped with Windows 97, Clippy was a “smart” assistant for Microsoft Office. A selfless shape-shifting paperclip who would appear out of nowhere to help you in any way it could. And how did you treat...\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/resurrecting-clippy-89843fcc9871"},photo:"/images/blog-content/resurrecting-clippy/osx.png",keywords:["clippy","desktop","app","NW.js","node-webkit","javascript","development"],published_at:"2016-03-08T00:00:00.000Z",updated_at:"2019-05-22T08:26:22.959Z",year:2016,month:3,day:9,relevanceScore:.41666666666666674},{id:"flexible-data-tables-with-css-grid",slug:"flexible-data-tables-with-css-grid",highlightedLanguages:["css"],source:'---\ndate: 2019-05-12\ntags:\n  - css grid\n  - css\n  - javascript\n  - table\n  - data\n  - responsive design\n  - responsive\n  - flexbox\n  - resize column\n  - web app\n  - development\n  - crm\n  - sales\n---\n\n## Flexible data tables with CSS Grid\n\n::: summary\n\nNow that we\'ve launched, I can finally talk about the secret project I\'ve been working on for the last two years. One interesting piece of the [Teamwork CRM](https://www.teamwork.com/crm) puzzle was the "list view". \n\nIt\'s a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won\'t bore you. I\'ll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.\n\n:::\n\n\nFirst, I need to give some more context, starting with the purpose and design goals of these screens. Feel free to [skip to the CSS Grid bit](#just-get-to-css-grid-already).\n\n:::figure flexible-data-tables-with-css-grid/wide3.png The leads list view.\n:::\n\nPrimarily it allows salespeople to scan a list of items like their leads or contacts, and find anything important they need to take action on. It\'s not like an Excel spreadsheet — we can do a better job at laying out the data, which there will be a lot of.\n\nEverything we do is responsively designed. We start with the most narrow / constrained variant first and tweak the layout based on content, design, use cases (we don\'t have device-orientated breakpoints). \n\nAt its most minimal, the columns are stacked vertically within rows, spanning the full width of the screen. \n\n:::figure flexible-data-tables-with-css-grid/narrow.png What a list view looks like on a narrow screen.\n:::\n\nResponsive tables are tricky. There are [several existing patterns](https://bradfrost.github.io/this-is-responsive/patterns.html) you could pick from. Consider what your users are trying to achieve and choose wisely. \n\nOnce we have enough pixels in our canvas to play with, we switch to a more typical table layout such that the columns are... well, columns. There are no major layout changes beyond this point but we still want to display the columns as best as we can for the salesperson viewing it.\n\nAssume there are a lot of columns (we\'ll look at how the user can configure the columns in more detail later). The table should fill the width of the screen (at least). Column widths then should be determined by their content and the type of values they contain; e.g. short / long text, date, number, URL, etc. Date columns should take up less room than long text columns. \n\nColumns must have a minimum width and therefore only so many can fit into the viewport. As a result this table will be vertically and horizontally scrollable for a lot of salespeople.\n\n:::figure flexible-data-tables-with-css-grid/resizing-window.gif How the layout varies per window width. Sorry the GIF is a bit janky, I provide some interactive examples below.\n:::\n\nTo begin with, we lay the table out as best we can using regular old-school table-layout CSS. Next, I\'ll show you how we enhance it with CSS Grid. Following that, how we leverage Grid to allow users to resize columns, which would be a lot more awkward with regular table-layout CSS.\n\n## Just get to CSS Grid already\n\nI\'m no CSS Grid expert but I love it. It\'s extremely powerful and simple, allowing you to implement previously tricky layouts with minute amounts of code. I\'ll skip giving an introduction to Grid in this article. Go read Rachel Andrew\'s [The New CSS Layout](https://abookapart.com/products/the-new-css-layout) or [A Complete Guide to Grid](https://css-tricks.com/snippets/css/complete-guide-grid/) and when you\'re done wondering where Grid was all your life, come back to me.\n\nThe first thing we do is apply `display: grid` to the `<table>` to make it a grid. This won\'t break anything if the browser doesn\'t support it (it will carry on using `display:table`). Its children become grid items; the `<thead>` and `<tbody>`. It\'s not the `<thead>`, `<tbody>`, or even the `<tr>`s we\'re concerned with though. What we want to do is lay out our `<th>`s and `<td>`s on this grid. We could apply `display: grid` to each of these too (i.e. grids within grids), but that\'s not ideal. Each `<tr>` grid would be independent of others and that\'s not good (you\'ll see later that I had the same problem with Flexbox).\n\nA workaround is to use `display: contents` on the `<thead>`, `<tbody>`, and `<tr>`s. This basically removes the them from the Grid layout, bypassing them, and promotes their children (the `<th>`s and `<td>`s) to participate in the the `<table>` grid instead. \n\nThen we use the magic `grid-template-columns` to control the grid items. Yes, one line of CSS. For example, if we had one date column and one URL column, it might be something like:\n\n```css\ngrid-template-columns: minmax(150px, 1.33fr) minmax(150px, 2.33fr);\n```\n\nWe use the same minimum size for all columns but the max (`fr`) value is determined by the column data type. I tried using Grid\'s`auto` and `max-content` too but what we\'ve ended up with seems to produce the best result.\n\nHere is a simplified example:\n\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="XwKWdG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/XwKWdG/" target="_blank">\n  Flexible data table with CSS Grid</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nYou should <a href="https://codepen.io/adam-lynch/debug/XwKWdG" target="_blank">open it in a new tab</a> as it\'s a bit constrained embedded here like this. Then try resizing the window.\n\n## Resizing columns with Grid\n\nOn top of this, we support reordering, resizing, and toggling which columns are shown. The lists of possible columns are long, including properties of the item (e.g. leads) itself, properties of related items (e.g. the company linked to the lead), and custom fields. \n\nFor example, a user could create a (date) custom field for contacts called "Date of birth" so that can be tracked in the system for each contact. \n\nSince a type like "Date" is selected when creating a custom field, our system already handles custom fields. There\'s more to think about when columns are toggled, but first I need to explain how resizing works.\n\n1. The user hovers over a column header, a resize handle is shown on the right hand side. We\'re listening for `mousedown` on the resize handle.\n2. When the user clicks the handle, we bind some more `mousemove` and `mousedown` event listeners (to the `window`). We also add some classes for decoration at this point.\n3. When the user moves their mouse, we calculate the new column width. This takes the cursor position, the table\'s scroll position, and our minimum into account. Then we re-set the `<table>`\'s `grid-template-columns`s rule (via `style` attribute), this time replacing the max (`fr`) value with a pixel value. For example, `grid-template-columns: minmax(150px, 1.33fr) 296px;`. We do this using `requestAnimationFrame` to keep it as smooth as possible.\n4. When `mouseup` is fired, we unbind event listeners and remove classes.\n\nTry this simplified example (or ideally <a href="https://codepen.io/adam-lynch/pen/GaqgXP" target="_blank">open it in a new tab</a>):\n\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="GaqgXP" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with good UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/GaqgXP/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with good UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nWhat\'s great here is that we only need to update one element in the DOM, not each cell.\n\nWe always build with touch users in mind, but it\'s OK not to support this via touch. It\'s a very precise action. Even if I wanted to resize a column using touch, I\'d probably expect a different interaction, like a multi-touch spread gesture.\n\n## Fixed column widths\n\nYou might have noticed I didn\'t tell the whole truth. Not only do we "fix" the width of the column you\'re resizing, we make all column widths fixed. Maybe you didn\'t even notice, because that\'s exactly how it should work.\n\nI originally thought that users would like that when they stretched or squeezed columns, the other ones could adjust too. If the columns filled the screen width nicely and you make one smaller, one (or some) of the others could grow if they had more content to show. Try this example for yourself below (or ideally <a href="https://codepen.io/adam-lynch/pen/wbWvep" target="_blank">open it in a new tab</a>):\n\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="wbWvep" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with bad UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/wbWvep/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with bad UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p> \n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nAfter some user testing, it was clear this is unexpected behaviour. As a user, I feel less in control when there are unpredictable side-effects to my actions. \n\nWe shouldn\'t make assumptions based on which column was or wasn\'t interacted with. When resizing one column, a user could have already made an implicit decision that the rest were perfect.\n\nTherefore, if you open the app for the first time, the columns are laid out as best as possible. If you resize your screen, they resize using the same ratios. Once you touch the resize handler of any column, all of the visible columns become fixed width.\n\n:::figure flexible-data-tables-with-css-grid/resizing-columns.gif Before, during, and after resizing a column. Sorry the GIF is a bit janky.\n:::\n\nOnce someone takes the time to tailor the screen to their needs, we take note. Any time a column is resized or made fixed, we create an independent localStorage entry mapping a column identifier to a pixel value.\n\nI can\'t remember exactly why we decided to set the fixed value using pixels, rather than something more fluid. Maybe it was just to keep it simple. Maybe it\'s because we do actually fall back to using a more archaic approach to setting column widths if Grid and `display: contents` aren\'t supported. You don\'t have to do this, it would have been too important to leave out for our users.\n\nUsing something fluid probably wouldn\'t align with the user\'s intentions anyway. We can\'t assume that making all columns smaller in order to keep more of them in the screen is the most important thing. If they had resized a column, it\'s to see a certain amount of content in that column. If we used a fluid unit, and then they made the screen narrower, we\'d be disregarding the choice they made. They\'d have to resize the column again to see the same content. Users are unlikely to be thinking "Hmm, I want this column to take up 20% of the window even if I resize it". Anyway, users rarely resize windows; I\'m going into too much detail on an edge case here.\n\n## Toggling columns\n\n:::figure flexible-data-tables-with-css-grid/manage-columns.png Our modal for customizing which columns are shown.\n:::\n\nImagine a salesperson has changed the column set using the above modal. If none of the chosen columns have been resized previously, they get laid out using the default `grid-template-column` values depending on their data type. For example, `minmax(150px, 3.33fr)`.\n\nIf any of the columns has a fixed width stored in localStorage, we make *all* of the chosen columns fixed width (and store those widths in localStorage too).\n\nOver time, more and more columns will become fixed. The only way for users to get back to fluid columns is if they were to reset the columns.\n\nWe also store an array of column identifiers in localStorage, separate to the column width entries.\n\n## "Why didn\'t you just use {{ libraryName }}?"\n\nI didn\'t want to just offload the problem to a heavy JavaScript library. It would be heavy, janky, wouldn\'t be responsive, and might not even use `<table>` at all. I also didn\'t want to write something like that myself. There must be a better way, I thought.\n\n## "Why didn\'t you just use Flexbox?"\n\nEach row would be evaluated / spaced independently of each other. A column might not be aligned with the column above it because of varying content length.\n\nI could have switched to `<div>`s representing the column containing the vertically stacked cells within. I didn\'t want to have to do this though. I wanted to use a `<table>`. On top of that, I could have easily ran into issues from the reverse angle anyway, like cells not matching in height across columns.\n\n## "Why didn\'t you just use a `<colgroup>`?"\n\nCheck out [`<colgroup>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup), it\'s a handy old element. Once you define your columns using `<col>`s, styles applied to one will effectively be applied to all of the cells in that column. \n\nIn the end though, it was simply too limited for what I needed to do. It didn\'t take long to realise it was a no-go. So much so, that I can\'t remember exactly what the problems were. I\'m pretty sure it was impossible to achieve the level of fluidity I wanted, and it didn\'t work well with Flexbox or Grid.\n\n## "Why didn\'t you just use table-layout: fixed?"\n\nI could have use `table-layout: fixed` on the `<table>` and set the column widths using percentages. However, from looking at examples and playing around, this only seems to work if the table is 100% in width. Also resizing one column causes the other columns to resize to fill the 100% width.\n\n## "But you could still have used a table!"\n\nYes, tables can do a lot of smart things out of the box, but they can\'t efficiently support everything I wanted to do. Still disagree? OK you wizard, teach me.\n\n## Don\'t go overboard with display: contents\n\n`display:contents` allowed us to keep our table markup. Use it only when you really have to though. There is, or at least were, issues in some browsers around accessibility and how screen readers would read the content. \n\nWe discovered a [strange bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1550728) when combining it with native drag & drop in Firefox.\n\nFortunately, subgrid on the way which will properly allow descendants to participate in grids. Our use case is simple in that we want to effectively flatten the markup but subgrid will open the door for wilder multi-dimensional grid orgies. See [Why display: contents is not CSS Grid Layout subgrid](https://rachelandrew.co.uk/archives/2017/07/20/why-display-contents-is-not-css-grid-layout-subgrid/).\n\n## I\'m probably forgetting something\n\nThere\'s a lot more to this screen. I think there was some text-overflow issue when resizing columns but I can\'t remember anymore. \n\nWe use `position: sticky` to keep the table headers in place as you scroll down. It\'s a lovely enhancement and it degrades nicely. However, we do have a JavaScript fallback for IE11 users. I really wouldn\'t recommend doing that. It\'s tricky to achieve with horizontally scrollable tables.\n\nI didn\'t even touch on all of the features of these list views. Users can apply, save, and share custom filters (e.g. show me leads over $500 or where the contact is in Europe). These column filters can be set to remember the column set you had when you created them, because you might always want to see certain columns for a given workflow.\n\nWe\'ll soon support bulk editing via the list view, as well exporting your tailored view to CSV.\n\nAnyway, thanks for reading.\n',unfilteredRenderedBody:'<h2><a id="flexible-data-tables-with-css-grid" class="post-header-anchor" href="#flexible-data-tables-with-css-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Flexible data tables with CSS Grid</h2>\n<article-summary><p>Now that we\'ve launched, I can finally talk about the secret project I\'ve been working on for the last two years. One interesting piece of the <a href="https://www.teamwork.com/crm" rel="noopener">Teamwork CRM</a> puzzle was the &quot;list view&quot;.</p>\n<p>It\'s a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won\'t bore you. I\'ll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.</p>\n</article-summary><p>First, I need to give some more context, starting with the purpose and design goals of these screens. Feel free to <a href="#just-get-to-css-grid-already">skip to the CSS Grid bit</a>.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png" alt=""/></a>\n          <figcaption><p>The leads list view.</p>\n</figcaption>\n        </figure><p>Primarily it allows salespeople to scan a list of items like their leads or contacts, and find anything important they need to take action on. It\'s not like an Excel spreadsheet — we can do a better job at laying out the data, which there will be a lot of.</p>\n<p>Everything we do is responsively designed. We start with the most narrow / constrained variant first and tweak the layout based on content, design, use cases (we don\'t have device-orientated breakpoints).</p>\n<p>At its most minimal, the columns are stacked vertically within rows, spanning the full width of the screen.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png" alt=""/></a>\n          <figcaption><p>What a list view looks like on a narrow screen.</p>\n</figcaption>\n        </figure><p>Responsive tables are tricky. There are <a href="https://bradfrost.github.io/this-is-responsive/patterns.html" rel="noopener">several existing patterns</a> you could pick from. Consider what your users are trying to achieve and choose wisely.</p>\n<p>Once we have enough pixels in our canvas to play with, we switch to a more typical table layout such that the columns are... well, columns. There are no major layout changes beyond this point but we still want to display the columns as best as we can for the salesperson viewing it.</p>\n<p>Assume there are a lot of columns (we\'ll look at how the user can configure the columns in more detail later). The table should fill the width of the screen (at least). Column widths then should be determined by their content and the type of values they contain; e.g. short / long text, date, number, URL, etc. Date columns should take up less room than long text columns.</p>\n<p>Columns must have a minimum width and therefore only so many can fit into the viewport. As a result this table will be vertically and horizontally scrollable for a lot of salespeople.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif" alt=""/></a>\n          <figcaption><p>How the layout varies per window width. Sorry the GIF is a bit janky, I provide some interactive examples below.</p>\n</figcaption>\n        </figure><p>To begin with, we lay the table out as best we can using regular old-school table-layout CSS. Next, I\'ll show you how we enhance it with CSS Grid. Following that, how we leverage Grid to allow users to resize columns, which would be a lot more awkward with regular table-layout CSS.</p>\n<h2><a id="just-get-to-css-grid-already" class="post-header-anchor" href="#just-get-to-css-grid-already" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Just get to CSS Grid already</h2>\n<p>I\'m no CSS Grid expert but I love it. It\'s extremely powerful and simple, allowing you to implement previously tricky layouts with minute amounts of code. I\'ll skip giving an introduction to Grid in this article. Go read Rachel Andrew\'s <a href="https://abookapart.com/products/the-new-css-layout" rel="noopener">The New CSS Layout</a> or <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" rel="noopener">A Complete Guide to Grid</a> and when you\'re done wondering where Grid was all your life, come back to me.</p>\n<p>The first thing we do is apply <code>display: grid</code> to the <code>&lt;table&gt;</code> to make it a grid. This won\'t break anything if the browser doesn\'t support it (it will carry on using <code>display:table</code>). Its children become grid items; the <code>&lt;thead&gt;</code> and <code>&lt;tbody&gt;</code>. It\'s not the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, or even the <code>&lt;tr&gt;</code>s we\'re concerned with though. What we want to do is lay out our <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s on this grid. We could apply <code>display: grid</code> to each of these too (i.e. grids within grids), but that\'s not ideal. Each <code>&lt;tr&gt;</code> grid would be independent of others and that\'s not good (you\'ll see later that I had the same problem with Flexbox).</p>\n<p>A workaround is to use <code>display: contents</code> on the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, and <code>&lt;tr&gt;</code>s. This basically removes the them from the Grid layout, bypassing them, and promotes their children (the <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s) to participate in the the <code>&lt;table&gt;</code> grid instead.</p>\n<p>Then we use the magic <code>grid-template-columns</code> to control the grid items. Yes, one line of CSS. For example, if we had one date column and one URL column, it might be something like:</p>\n<pre><code class="language-css"><span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 1.33fr<span class="token punctuation">)</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 2.33fr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>We use the same minimum size for all columns but the max (<code>fr</code>) value is determined by the column data type. I tried using Grid\'s<code>auto</code> and <code>max-content</code> too but what we\'ve ended up with seems to produce the best result.</p>\n<p>Here is a simplified example:</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="XwKWdG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/XwKWdG/" target="_blank">\n  Flexible data table with CSS Grid</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>You should <a href="https://codepen.io/adam-lynch/debug/XwKWdG" target="_blank">open it in a new tab</a> as it\'s a bit constrained embedded here like this. Then try resizing the window.</p>\n<h2><a id="resizing-columns-with-grid" class="post-header-anchor" href="#resizing-columns-with-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resizing columns with Grid</h2>\n<p>On top of this, we support reordering, resizing, and toggling which columns are shown. The lists of possible columns are long, including properties of the item (e.g. leads) itself, properties of related items (e.g. the company linked to the lead), and custom fields.</p>\n<p>For example, a user could create a (date) custom field for contacts called &quot;Date of birth&quot; so that can be tracked in the system for each contact.</p>\n<p>Since a type like &quot;Date&quot; is selected when creating a custom field, our system already handles custom fields. There\'s more to think about when columns are toggled, but first I need to explain how resizing works.</p>\n<ol>\n<li>The user hovers over a column header, a resize handle is shown on the right hand side. We\'re listening for <code>mousedown</code> on the resize handle.</li>\n<li>When the user clicks the handle, we bind some more <code>mousemove</code> and <code>mousedown</code> event listeners (to the <code>window</code>). We also add some classes for decoration at this point.</li>\n<li>When the user moves their mouse, we calculate the new column width. This takes the cursor position, the table\'s scroll position, and our minimum into account. Then we re-set the <code>&lt;table&gt;</code>\'s <code>grid-template-columns</code>s rule (via <code>style</code> attribute), this time replacing the max (<code>fr</code>) value with a pixel value. For example, <code>grid-template-columns: minmax(150px, 1.33fr) 296px;</code>. We do this using <code>requestAnimationFrame</code> to keep it as smooth as possible.</li>\n<li>When <code>mouseup</code> is fired, we unbind event listeners and remove classes.</li>\n</ol>\n<p>Try this simplified example (or ideally <a href="https://codepen.io/adam-lynch/pen/GaqgXP" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="GaqgXP" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with good UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/GaqgXP/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with good UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>What\'s great here is that we only need to update one element in the DOM, not each cell.</p>\n<p>We always build with touch users in mind, but it\'s OK not to support this via touch. It\'s a very precise action. Even if I wanted to resize a column using touch, I\'d probably expect a different interaction, like a multi-touch spread gesture.</p>\n<h2><a id="fixed-column-widths" class="post-header-anchor" href="#fixed-column-widths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fixed column widths</h2>\n<p>You might have noticed I didn\'t tell the whole truth. Not only do we &quot;fix&quot; the width of the column you\'re resizing, we make all column widths fixed. Maybe you didn\'t even notice, because that\'s exactly how it should work.</p>\n<p>I originally thought that users would like that when they stretched or squeezed columns, the other ones could adjust too. If the columns filled the screen width nicely and you make one smaller, one (or some) of the others could grow if they had more content to show. Try this example for yourself below (or ideally <a href="https://codepen.io/adam-lynch/pen/wbWvep" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="wbWvep" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with bad UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/wbWvep/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with bad UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p> \n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>After some user testing, it was clear this is unexpected behaviour. As a user, I feel less in control when there are unpredictable side-effects to my actions.</p>\n<p>We shouldn\'t make assumptions based on which column was or wasn\'t interacted with. When resizing one column, a user could have already made an implicit decision that the rest were perfect.</p>\n<p>Therefore, if you open the app for the first time, the columns are laid out as best as possible. If you resize your screen, they resize using the same ratios. Once you touch the resize handler of any column, all of the visible columns become fixed width.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif" alt=""/></a>\n          <figcaption><p>Before, during, and after resizing a column. Sorry the GIF is a bit janky.</p>\n</figcaption>\n        </figure><p>Once someone takes the time to tailor the screen to their needs, we take note. Any time a column is resized or made fixed, we create an independent localStorage entry mapping a column identifier to a pixel value.</p>\n<p>I can\'t remember exactly why we decided to set the fixed value using pixels, rather than something more fluid. Maybe it was just to keep it simple. Maybe it\'s because we do actually fall back to using a more archaic approach to setting column widths if Grid and <code>display: contents</code> aren\'t supported. You don\'t have to do this, it would have been too important to leave out for our users.</p>\n<p>Using something fluid probably wouldn\'t align with the user\'s intentions anyway. We can\'t assume that making all columns smaller in order to keep more of them in the screen is the most important thing. If they had resized a column, it\'s to see a certain amount of content in that column. If we used a fluid unit, and then they made the screen narrower, we\'d be disregarding the choice they made. They\'d have to resize the column again to see the same content. Users are unlikely to be thinking &quot;Hmm, I want this column to take up 20% of the window even if I resize it&quot;. Anyway, users rarely resize windows; I\'m going into too much detail on an edge case here.</p>\n<h2><a id="toggling-columns" class="post-header-anchor" href="#toggling-columns" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Toggling columns</h2>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png" alt=""/></a>\n          <figcaption><p>Our modal for customizing which columns are shown.</p>\n</figcaption>\n        </figure><p>Imagine a salesperson has changed the column set using the above modal. If none of the chosen columns have been resized previously, they get laid out using the default <code>grid-template-column</code> values depending on their data type. For example, <code>minmax(150px, 3.33fr)</code>.</p>\n<p>If any of the columns has a fixed width stored in localStorage, we make <em>all</em> of the chosen columns fixed width (and store those widths in localStorage too).</p>\n<p>Over time, more and more columns will become fixed. The only way for users to get back to fluid columns is if they were to reset the columns.</p>\n<p>We also store an array of column identifiers in localStorage, separate to the column width entries.</p>\n<h2><a id="why-didnt-you-just-use--libraryname-" class="post-header-anchor" href="#why-didnt-you-just-use--libraryname-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use {{ libraryName }}?&quot;</h2>\n<p>I didn\'t want to just offload the problem to a heavy JavaScript library. It would be heavy, janky, wouldn\'t be responsive, and might not even use <code>&lt;table&gt;</code> at all. I also didn\'t want to write something like that myself. There must be a better way, I thought.</p>\n<h2><a id="why-didnt-you-just-use-flexbox" class="post-header-anchor" href="#why-didnt-you-just-use-flexbox" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use Flexbox?&quot;</h2>\n<p>Each row would be evaluated / spaced independently of each other. A column might not be aligned with the column above it because of varying content length.</p>\n<p>I could have switched to <code>&lt;div&gt;</code>s representing the column containing the vertically stacked cells within. I didn\'t want to have to do this though. I wanted to use a <code>&lt;table&gt;</code>. On top of that, I could have easily ran into issues from the reverse angle anyway, like cells not matching in height across columns.</p>\n<h2><a id="why-didnt-you-just-use-a-colgroup-" class="post-header-anchor" href="#why-didnt-you-just-use-a-colgroup-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use a <code>&lt;colgroup&gt;</code>?&quot;</h2>\n<p>Check out <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup" rel="noopener"><code>&lt;colgroup&gt;</code></a>, it\'s a handy old element. Once you define your columns using <code>&lt;col&gt;</code>s, styles applied to one will effectively be applied to all of the cells in that column.</p>\n<p>In the end though, it was simply too limited for what I needed to do. It didn\'t take long to realise it was a no-go. So much so, that I can\'t remember exactly what the problems were. I\'m pretty sure it was impossible to achieve the level of fluidity I wanted, and it didn\'t work well with Flexbox or Grid.</p>\n<h2><a id="why-didnt-you-just-use-table-layout-fixed" class="post-header-anchor" href="#why-didnt-you-just-use-table-layout-fixed" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use table-layout: fixed?&quot;</h2>\n<p>I could have use <code>table-layout: fixed</code> on the <code>&lt;table&gt;</code> and set the column widths using percentages. However, from looking at examples and playing around, this only seems to work if the table is 100% in width. Also resizing one column causes the other columns to resize to fill the 100% width.</p>\n<h2><a id="but-you-could-still-have-used-a-table" class="post-header-anchor" href="#but-you-could-still-have-used-a-table" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;But you could still have used a table!&quot;</h2>\n<p>Yes, tables can do a lot of smart things out of the box, but they can\'t efficiently support everything I wanted to do. Still disagree? OK you wizard, teach me.</p>\n<h2><a id="dont-go-overboard-with-display-contents" class="post-header-anchor" href="#dont-go-overboard-with-display-contents" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Don\'t go overboard with display: contents</h2>\n<p><code>display:contents</code> allowed us to keep our table markup. Use it only when you really have to though. There is, or at least were, issues in some browsers around accessibility and how screen readers would read the content.</p>\n<p>We discovered a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1550728" rel="noopener">strange bug</a> when combining it with native drag &amp; drop in Firefox.</p>\n<p>Fortunately, subgrid on the way which will properly allow descendants to participate in grids. Our use case is simple in that we want to effectively flatten the markup but subgrid will open the door for wilder multi-dimensional grid orgies. See <a href="https://rachelandrew.co.uk/archives/2017/07/20/why-display-contents-is-not-css-grid-layout-subgrid/" rel="noopener">Why display: contents is not CSS Grid Layout subgrid</a>.</p>\n<h2><a id="im-probably-forgetting-something" class="post-header-anchor" href="#im-probably-forgetting-something" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I\'m probably forgetting something</h2>\n<p>There\'s a lot more to this screen. I think there was some text-overflow issue when resizing columns but I can\'t remember anymore.</p>\n<p>We use <code>position: sticky</code> to keep the table headers in place as you scroll down. It\'s a lovely enhancement and it degrades nicely. However, we do have a JavaScript fallback for IE11 users. I really wouldn\'t recommend doing that. It\'s tricky to achieve with horizontally scrollable tables.</p>\n<p>I didn\'t even touch on all of the features of these list views. Users can apply, save, and share custom filters (e.g. show me leads over $500 or where the contact is in Europe). These column filters can be set to remember the column set you had when you created them, because you might always want to see certain columns for a given workflow.</p>\n<p>We\'ll soon support bulk editing via the list view, as well exporting your tailored view to CSV.</p>\n<p>Anyway, thanks for reading.</p>\n',attributes:{date:"2019-05-12T00:00:00.000Z",tags:[{id:"css-grid",name:"css grid"},{id:"css",name:"css"},{id:"javascript",name:"javascript"},{id:"table",name:"table"},{id:"data",name:"data"},{id:"responsive-design",name:"responsive design"},{id:"responsive",name:"responsive"},{id:"flexbox",name:"flexbox"},{id:"resize-column",name:"resize column"},{id:"web-app",name:"web app"},{id:"development",name:"development"},{id:"crm",name:"crm"},{id:"sales",name:"sales"}],title:"Flexible data tables with CSS Grid",updated_at:"2019-05-12T15:23:45.287Z",photo:"/images/blog-content/flexible-data-tables-with-css-grid/wide3.png"},title:"Flexible data tables with CSS Grid",renderedSummary:"<p>Now that we've launched, I can finally talk about the secret project I've been working on for the last two years. One interesting piece of the <a href=\"https://www.teamwork.com/crm\" rel=\"noopener\">Teamwork CRM</a> puzzle was the &quot;list view&quot;.</p>\n<p>It's a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won't bore you. I'll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.</p>\n",rendered:'<h2><a id="flexible-data-tables-with-css-grid" class="post-header-anchor" href="#flexible-data-tables-with-css-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Flexible data tables with CSS Grid</h2>\n<p>Now that we\'ve launched, I can finally talk about the secret project I\'ve been working on for the last two years. One interesting piece of the <a href="https://www.teamwork.com/crm" rel="noopener">Teamwork CRM</a> puzzle was the &quot;list view&quot;.</p>\n<p>It\'s a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won\'t bore you. I\'ll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.</p>\n<p>First, I need to give some more context, starting with the purpose and design goals of these screens. Feel free to <a href="#just-get-to-css-grid-already">skip to the CSS Grid bit</a>.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png" alt=""/></a>\n          <figcaption><p>The leads list view.</p>\n</figcaption>\n        </figure><p>Primarily it allows salespeople to scan a list of items like their leads or contacts, and find anything important they need to take action on. It\'s not like an Excel spreadsheet — we can do a better job at laying out the data, which there will be a lot of.</p>\n<p>Everything we do is responsively designed. We start with the most narrow / constrained variant first and tweak the layout based on content, design, use cases (we don\'t have device-orientated breakpoints).</p>\n<p>At its most minimal, the columns are stacked vertically within rows, spanning the full width of the screen.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png" alt=""/></a>\n          <figcaption><p>What a list view looks like on a narrow screen.</p>\n</figcaption>\n        </figure><p>Responsive tables are tricky. There are <a href="https://bradfrost.github.io/this-is-responsive/patterns.html" rel="noopener">several existing patterns</a> you could pick from. Consider what your users are trying to achieve and choose wisely.</p>\n<p>Once we have enough pixels in our canvas to play with, we switch to a more typical table layout such that the columns are... well, columns. There are no major layout changes beyond this point but we still want to display the columns as best as we can for the salesperson viewing it.</p>\n<p>Assume there are a lot of columns (we\'ll look at how the user can configure the columns in more detail later). The table should fill the width of the screen (at least). Column widths then should be determined by their content and the type of values they contain; e.g. short / long text, date, number, URL, etc. Date columns should take up less room than long text columns.</p>\n<p>Columns must have a minimum width and therefore only so many can fit into the viewport. As a result this table will be vertically and horizontally scrollable for a lot of salespeople.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif" alt=""/></a>\n          <figcaption><p>How the layout varies per window width. Sorry the GIF is a bit janky, I provide some interactive examples below.</p>\n</figcaption>\n        </figure><p>To begin with, we lay the table out as best we can using regular old-school table-layout CSS. Next, I\'ll show you how we enhance it with CSS Grid. Following that, how we leverage Grid to allow users to resize columns, which would be a lot more awkward with regular table-layout CSS.</p>\n<h2><a id="just-get-to-css-grid-already" class="post-header-anchor" href="#just-get-to-css-grid-already" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Just get to CSS Grid already</h2>\n<p>I\'m no CSS Grid expert but I love it. It\'s extremely powerful and simple, allowing you to implement previously tricky layouts with minute amounts of code. I\'ll skip giving an introduction to Grid in this article. Go read Rachel Andrew\'s <a href="https://abookapart.com/products/the-new-css-layout" rel="noopener">The New CSS Layout</a> or <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" rel="noopener">A Complete Guide to Grid</a> and when you\'re done wondering where Grid was all your life, come back to me.</p>\n<p>The first thing we do is apply <code>display: grid</code> to the <code>&lt;table&gt;</code> to make it a grid. This won\'t break anything if the browser doesn\'t support it (it will carry on using <code>display:table</code>). Its children become grid items; the <code>&lt;thead&gt;</code> and <code>&lt;tbody&gt;</code>. It\'s not the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, or even the <code>&lt;tr&gt;</code>s we\'re concerned with though. What we want to do is lay out our <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s on this grid. We could apply <code>display: grid</code> to each of these too (i.e. grids within grids), but that\'s not ideal. Each <code>&lt;tr&gt;</code> grid would be independent of others and that\'s not good (you\'ll see later that I had the same problem with Flexbox).</p>\n<p>A workaround is to use <code>display: contents</code> on the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, and <code>&lt;tr&gt;</code>s. This basically removes the them from the Grid layout, bypassing them, and promotes their children (the <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s) to participate in the the <code>&lt;table&gt;</code> grid instead.</p>\n<p>Then we use the magic <code>grid-template-columns</code> to control the grid items. Yes, one line of CSS. For example, if we had one date column and one URL column, it might be something like:</p>\n<pre><code class="language-css"><span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 1.33fr<span class="token punctuation">)</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 2.33fr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>We use the same minimum size for all columns but the max (<code>fr</code>) value is determined by the column data type. I tried using Grid\'s<code>auto</code> and <code>max-content</code> too but what we\'ve ended up with seems to produce the best result.</p>\n<p>Here is a simplified example:</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="XwKWdG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/XwKWdG/" target="_blank">\n  Flexible data table with CSS Grid</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>You should <a href="https://codepen.io/adam-lynch/debug/XwKWdG" target="_blank">open it in a new tab</a> as it\'s a bit constrained embedded here like this. Then try resizing the window.</p>\n<h2><a id="resizing-columns-with-grid" class="post-header-anchor" href="#resizing-columns-with-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resizing columns with Grid</h2>\n<p>On top of this, we support reordering, resizing, and toggling which columns are shown. The lists of possible columns are long, including properties of the item (e.g. leads) itself, properties of related items (e.g. the company linked to the lead), and custom fields.</p>\n<p>For example, a user could create a (date) custom field for contacts called &quot;Date of birth&quot; so that can be tracked in the system for each contact.</p>\n<p>Since a type like &quot;Date&quot; is selected when creating a custom field, our system already handles custom fields. There\'s more to think about when columns are toggled, but first I need to explain how resizing works.</p>\n<ol>\n<li>The user hovers over a column header, a resize handle is shown on the right hand side. We\'re listening for <code>mousedown</code> on the resize handle.</li>\n<li>When the user clicks the handle, we bind some more <code>mousemove</code> and <code>mousedown</code> event listeners (to the <code>window</code>). We also add some classes for decoration at this point.</li>\n<li>When the user moves their mouse, we calculate the new column width. This takes the cursor position, the table\'s scroll position, and our minimum into account. Then we re-set the <code>&lt;table&gt;</code>\'s <code>grid-template-columns</code>s rule (via <code>style</code> attribute), this time replacing the max (<code>fr</code>) value with a pixel value. For example, <code>grid-template-columns: minmax(150px, 1.33fr) 296px;</code>. We do this using <code>requestAnimationFrame</code> to keep it as smooth as possible.</li>\n<li>When <code>mouseup</code> is fired, we unbind event listeners and remove classes.</li>\n</ol>\n<p>Try this simplified example (or ideally <a href="https://codepen.io/adam-lynch/pen/GaqgXP" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="GaqgXP" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with good UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/GaqgXP/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with good UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>What\'s great here is that we only need to update one element in the DOM, not each cell.</p>\n<p>We always build with touch users in mind, but it\'s OK not to support this via touch. It\'s a very precise action. Even if I wanted to resize a column using touch, I\'d probably expect a different interaction, like a multi-touch spread gesture.</p>\n<h2><a id="fixed-column-widths" class="post-header-anchor" href="#fixed-column-widths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fixed column widths</h2>\n<p>You might have noticed I didn\'t tell the whole truth. Not only do we &quot;fix&quot; the width of the column you\'re resizing, we make all column widths fixed. Maybe you didn\'t even notice, because that\'s exactly how it should work.</p>\n<p>I originally thought that users would like that when they stretched or squeezed columns, the other ones could adjust too. If the columns filled the screen width nicely and you make one smaller, one (or some) of the others could grow if they had more content to show. Try this example for yourself below (or ideally <a href="https://codepen.io/adam-lynch/pen/wbWvep" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="wbWvep" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with bad UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/wbWvep/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with bad UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p> \n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>After some user testing, it was clear this is unexpected behaviour. As a user, I feel less in control when there are unpredictable side-effects to my actions.</p>\n<p>We shouldn\'t make assumptions based on which column was or wasn\'t interacted with. When resizing one column, a user could have already made an implicit decision that the rest were perfect.</p>\n<p>Therefore, if you open the app for the first time, the columns are laid out as best as possible. If you resize your screen, they resize using the same ratios. Once you touch the resize handler of any column, all of the visible columns become fixed width.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif" alt=""/></a>\n          <figcaption><p>Before, during, and after resizing a column. Sorry the GIF is a bit janky.</p>\n</figcaption>\n        </figure><p>Once someone takes the time to tailor the screen to their needs, we take note. Any time a column is resized or made fixed, we create an independent localStorage entry mapping a column identifier to a pixel value.</p>\n<p>I can\'t remember exactly why we decided to set the fixed value using pixels, rather than something more fluid. Maybe it was just to keep it simple. Maybe it\'s because we do actually fall back to using a more archaic approach to setting column widths if Grid and <code>display: contents</code> aren\'t supported. You don\'t have to do this, it would have been too important to leave out for our users.</p>\n<p>Using something fluid probably wouldn\'t align with the user\'s intentions anyway. We can\'t assume that making all columns smaller in order to keep more of them in the screen is the most important thing. If they had resized a column, it\'s to see a certain amount of content in that column. If we used a fluid unit, and then they made the screen narrower, we\'d be disregarding the choice they made. They\'d have to resize the column again to see the same content. Users are unlikely to be thinking &quot;Hmm, I want this column to take up 20% of the window even if I resize it&quot;. Anyway, users rarely resize windows; I\'m going into too much detail on an edge case here.</p>\n<h2><a id="toggling-columns" class="post-header-anchor" href="#toggling-columns" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Toggling columns</h2>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png" alt=""/></a>\n          <figcaption><p>Our modal for customizing which columns are shown.</p>\n</figcaption>\n        </figure><p>Imagine a salesperson has changed the column set using the above modal. If none of the chosen columns have been resized previously, they get laid out using the default <code>grid-template-column</code> values depending on their data type. For example, <code>minmax(150px, 3.33fr)</code>.</p>\n<p>If any of the columns has a fixed width stored in localStorage, we make <em>all</em> of the chosen columns fixed width (and store those widths in localStorage too).</p>\n<p>Over time, more and more columns will become fixed. The only way for users to get back to fluid columns is if they were to reset the columns.</p>\n<p>We also store an array of column identifiers in localStorage, separate to the column width entries.</p>\n<h2><a id="why-didnt-you-just-use--libraryname-" class="post-header-anchor" href="#why-didnt-you-just-use--libraryname-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use {{ libraryName }}?&quot;</h2>\n<p>I didn\'t want to just offload the problem to a heavy JavaScript library. It would be heavy, janky, wouldn\'t be responsive, and might not even use <code>&lt;table&gt;</code> at all. I also didn\'t want to write something like that myself. There must be a better way, I thought.</p>\n<h2><a id="why-didnt-you-just-use-flexbox" class="post-header-anchor" href="#why-didnt-you-just-use-flexbox" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use Flexbox?&quot;</h2>\n<p>Each row would be evaluated / spaced independently of each other. A column might not be aligned with the column above it because of varying content length.</p>\n<p>I could have switched to <code>&lt;div&gt;</code>s representing the column containing the vertically stacked cells within. I didn\'t want to have to do this though. I wanted to use a <code>&lt;table&gt;</code>. On top of that, I could have easily ran into issues from the reverse angle anyway, like cells not matching in height across columns.</p>\n<h2><a id="why-didnt-you-just-use-a-colgroup-" class="post-header-anchor" href="#why-didnt-you-just-use-a-colgroup-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use a <code>&lt;colgroup&gt;</code>?&quot;</h2>\n<p>Check out <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup" rel="noopener"><code>&lt;colgroup&gt;</code></a>, it\'s a handy old element. Once you define your columns using <code>&lt;col&gt;</code>s, styles applied to one will effectively be applied to all of the cells in that column.</p>\n<p>In the end though, it was simply too limited for what I needed to do. It didn\'t take long to realise it was a no-go. So much so, that I can\'t remember exactly what the problems were. I\'m pretty sure it was impossible to achieve the level of fluidity I wanted, and it didn\'t work well with Flexbox or Grid.</p>\n<h2><a id="why-didnt-you-just-use-table-layout-fixed" class="post-header-anchor" href="#why-didnt-you-just-use-table-layout-fixed" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use table-layout: fixed?&quot;</h2>\n<p>I could have use <code>table-layout: fixed</code> on the <code>&lt;table&gt;</code> and set the column widths using percentages. However, from looking at examples and playing around, this only seems to work if the table is 100% in width. Also resizing one column causes the other columns to resize to fill the 100% width.</p>\n<h2><a id="but-you-could-still-have-used-a-table" class="post-header-anchor" href="#but-you-could-still-have-used-a-table" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;But you could still have used a table!&quot;</h2>\n<p>Yes, tables can do a lot of smart things out of the box, but they can\'t efficiently support everything I wanted to do. Still disagree? OK you wizard, teach me.</p>\n<h2><a id="dont-go-overboard-with-display-contents" class="post-header-anchor" href="#dont-go-overboard-with-display-contents" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Don\'t go overboard with display: contents</h2>\n<p><code>display:contents</code> allowed us to keep our table markup. Use it only when you really have to though. There is, or at least were, issues in some browsers around accessibility and how screen readers would read the content.</p>\n<p>We discovered a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1550728" rel="noopener">strange bug</a> when combining it with native drag &amp; drop in Firefox.</p>\n<p>Fortunately, subgrid on the way which will properly allow descendants to participate in grids. Our use case is simple in that we want to effectively flatten the markup but subgrid will open the door for wilder multi-dimensional grid orgies. See <a href="https://rachelandrew.co.uk/archives/2017/07/20/why-display-contents-is-not-css-grid-layout-subgrid/" rel="noopener">Why display: contents is not CSS Grid Layout subgrid</a>.</p>\n<h2><a id="im-probably-forgetting-something" class="post-header-anchor" href="#im-probably-forgetting-something" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I\'m probably forgetting something</h2>\n<p>There\'s a lot more to this screen. I think there was some text-overflow issue when resizing columns but I can\'t remember anymore.</p>\n<p>We use <code>position: sticky</code> to keep the table headers in place as you scroll down. It\'s a lovely enhancement and it degrades nicely. However, we do have a JavaScript fallback for IE11 users. I really wouldn\'t recommend doing that. It\'s tricky to achieve with horizontally scrollable tables.</p>\n<p>I didn\'t even touch on all of the features of these list views. Users can apply, save, and share custom filters (e.g. show me leads over $500 or where the contact is in Europe). These column filters can be set to remember the column set you had when you created them, because you might always want to see certain columns for a given workflow.</p>\n<p>We\'ll soon support bulk editing via the list view, as well exporting your tailored view to CSV.</p>\n<p>Anyway, thanks for reading.</p>\n',summary:"Now that we've launched, I can finally talk about the secret project I've been working on for the last two years. One interesting piece of the Teamwork CRM puzzle was the &quot;list view&quot;.\nIt's a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won't bore you. I'll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.\n",photo:"/images/blog-content/flexible-data-tables-with-css-grid/wide3.png",keywords:["css grid","css","javascript","table","data","responsive design","responsive","flexbox","resize column","web app","development","crm","sales"],published_at:"2019-05-12T00:00:00.000Z",updated_at:"2019-05-12T15:23:45.287Z",year:2019,month:5,day:13,relevanceScore:2}]}}],error:null,state:{nameToShow:"Adam Lynch",githubAccountUrl:"https://github.com/adam-lynch",siteUrl:"https://adamlynch.com",siteTitle:"Adam Lynch",repositoryUrl:"https://github.com/adam-lynch/adam-lynch.github.io"},serverRendered:!0}</script><script src="/_nuxt/manifest.d5526f8927565c068c7a.js" defer></script><script src="/_nuxt/layouts/default.8ce3dde6452dcf1cfcac.js" defer></script><script src="/_nuxt/1.03bda2e583db241630d8.js" defer></script><script src="/_nuxt/vendor.ce05078a33ab89125ee8.js" defer></script><script src="/_nuxt/app.0d49d9ad47bd79d551b9.js" defer></script>

    <script src="https://use.typekit.net/tci5xbk.js"></script>
    <script>try{Typekit.load({async:!0})}catch(a){}</script>
    <script>!function(e,a,t,n,c,g,s){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,g=a.createElement("script"),s=a.getElementsByTagName("script")[0],g.async=1,g.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(g,s)}(window,document),ga("create","UA-31546953-1","auto"),ga("send","pageview")</script>
  

