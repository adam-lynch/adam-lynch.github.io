<!DOCTYPE html>
<html data-n-head="" data-n-head-ssr>
  <head>
    <meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="#ffffff" theme-color="theme-color"><meta data-n-head="true" content="NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.
" name="description" data-hid="description"><meta data-n-head="true" content="gulp, build, build system, javascript, node.js, development" name="keywords" data-hid="keywords"><meta data-n-head="true" content="summary" name="twitter:card" data-hid="twitter:card"><meta data-n-head="true" content="10 things to know about Gulp" name="twitter:title" data-hid="twitter:title"><meta data-n-head="true" content="NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.
" name="twitter:description" data-hid="twitter:description"><meta data-n-head="true" content="/images/blog-content/10-things-to-know-about-gulp/gulp.png" name="twitter:image"><meta data-n-head="true" content="/10-things-to-know-about-gulp" name="twitter:url" data-hid="twitter:url"><meta data-n-head="true" content="article" name="og:type" data-hid="og:type"><meta data-n-head="true" content="10 things to know about Gulp" name="og:title" data-hid="og:title"><meta data-n-head="true" content="NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.
" name="og:description" data-hid="og:description"><meta data-n-head="true" content="/images/blog-content/10-things-to-know-about-gulp/gulp.png" name="og:image" data-hid="og:image"><meta data-n-head="true" content="/10-things-to-know-about-gulp" name="og:url" data-hid="og:url"><title data-n-head="true">10 things to know about Gulp</title><link href="/apple-touch-icon.png" rel="apple-touch-icon" data-n-head="true" sizes="76x76"><link href="/favicon-32x32.png" rel="icon" data-n-head="true" sizes="32x32" type="image/x-icon"><link href="/favicon-16x16.png" rel="icon" data-n-head="true" sizes="16x16" type="image/png"><link href="/safari-pinned-tab.svg" rel="mask-icon" data-n-head="true" color="#53687a"><link href="//unpkg.com/prismjs/themes/prism.css" rel="stylesheet" data-n-head="true"><link href="/_nuxt/manifest.25595636d53df74f38ab.js" rel="preload" as="script"><link href="/_nuxt/vendor.ce05078a33ab89125ee8.js" rel="preload" as="script"><link href="/_nuxt/app.7fd5760da80466c89126.js" rel="preload" as="script"><link href="/_nuxt/layouts/default.8ce3dde6452dcf1cfcac.js" rel="preload" as="script"><link href="/_nuxt/1.03bda2e583db241630d8.js" rel="preload" as="script"><link href="/_nuxt/pages/index.5bad6aa85a4e69648400.js" rel="prefetch"><style data-vue-ssr-id="6dd13fd5:0">*{-webkit-box-sizing:border-box;box-sizing:border-box}body,html{margin:0;padding:0}ol,ul{list-style:none;padding-left:0;margin:0}a{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;text-decoration:none;color:inherit}body{font-family:Arial,sans-serif;line-height:1.55;letter-spacing:-.25px;-webkit-font-smoothing:antialiased}.wf-active body{font-family:Lato,Arial,sans-serif}html{font-size:14px}@media (min-width:470px){html{font-size:16px}}body{background:#ececec;color:#333;padding-top:28px;padding-top:2rem;overflow-x:hidden}.wrapper{max-width:840px;max-width:60rem;margin:0 auto}.header{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0 14px;padding:0 1rem;background:#ececec}@media (min-width:59rem){.header{-ms-flex-wrap:nowrap;flex-wrap:nowrap}}@media (min-width:470px){.header{padding-left:2rem;padding-right:2rem}}.site-title{margin:0;text-align:center;-webkit-transition:opacity .25s ease-in;transition:opacity .25s ease-in;min-width:100%;max-width:84px;max-width:6rem}@media (min-width:42rem){.site-title{min-width:0;-webkit-box-flex:1;-ms-flex:1;flex:1}}@media (min-width:59rem){.site-title{-webkit-box-flex:initial;-ms-flex:initial;flex:initial}}.site-title:hover{opacity:.9}.site-link{display:inline-block;background:url(/_nuxt/img/Logo.542e06c.png) 0 no-repeat;background-size:6.09rem;height:126px;height:9rem;width:84px;width:6rem;margin:0 auto;text-indent:-9999px}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.site-link{background-image:url(/_nuxt/img/Logo@2x.b121531.png)}}.site-happy-text-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;margin:0 auto;padding:0;width:100%;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:18.2px;font-size:1.3rem}@media (min-width:42rem){.site-happy-text-wrapper{-webkit-box-flex:2;-ms-flex:2;flex:2;padding:0 0 0 2rem}}@media (min-width:59rem){.site-happy-text-wrapper{-webkit-box-flex:1;-ms-flex:1;flex:1;font-size:1.2rem}}@media (min-width:61rem){.site-happy-text-wrapper{font-size:1.3rem}}.site-happy-text{-webkit-box-flex:1;-ms-flex:1;flex:1;margin:0;text-align:center}@media (min-width:42rem){.site-happy-text{text-align:left}}.site-happy-text-headline{display:block}.site-happy-text-headline,.wf-active .site-happy-text-headline{font-size:26.599px;font-size:1.9rem;font-weight:700}@media (min-width:25rem){.site-happy-text-headline{font-size:2.3rem;line-height:1.7}.wf-active .site-happy-text-headline{line-height:1.5;font-size:2.5rem}}@media (min-width:59rem){.site-happy-text-headline{font-size:2.9rem}.wf-active .site-happy-text-headline{font-size:3.1rem}}@media (min-width:61rem){.site-happy-text-headline{font-size:2.92rem;line-height:1.7}.wf-active .site-happy-text-headline{line-height:1.5;font-size:3.2rem}}.site-happy-text-tagline{display:inline}@media (min-width:42rem){.site-happy-text-tagline{display:block}}.navigation-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;padding:28px 0 0;padding:2rem 0 0;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}@media (min-width:59rem){.navigation-wrapper{max-width:23rem;padding:0 0 0 2rem}}.navigation{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;min-width:100%;width:100%}@media (min-width:59rem){.navigation{-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-width:0}}.navigation-item{-webkit-box-flex:1;-ms-flex:1 1 33%;flex:1 1 33%;min-width:33%;display:-webkit-box;display:-ms-flexbox;display:flex;position:relative;cursor:pointer;font-size:11.9px;font-size:.85rem;font-weight:200;-webkit-transition:background-color .25s;transition:background-color .25s}@media (min-width:25rem){.navigation-item{font-size:.9rem}}@media (min-width:45rem){.navigation-item{min-width:0;-webkit-box-flex:1;-ms-flex:1;flex:1}}@media (min-width:59rem){.navigation-item{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;min-width:33%}}.navigation-item:first-child{background:#e2e2e2}.navigation-item:first-child:hover{background:#ddd}.navigation-item:nth-child(2){background:#e8e8e8}.navigation-item:nth-child(2):hover{background:#e3e3e3}.navigation-item:nth-child(3){background:#efefef}.navigation-item:nth-child(3):hover{background:#eaeaea}.navigation-item:nth-child(4){background:#ddd}.navigation-item:nth-child(4):hover{background:#d8d8d8}.navigation-item:nth-child(5){background:#e3e3e3}.navigation-item:nth-child(5):hover{background:#dedede}.navigation-item:nth-child(6){background:#eaeaea}.navigation-item:nth-child(6):hover{background:#e4e4e4}.navigation-link{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:14px;padding:1rem;text-decoration:none;font-size:12.6px;font-size:.9rem;color:#000;-webkit-transition:color .25s;transition:color .25s}@media (min-width:25rem){.navigation-link{padding:1.4rem}}.navigation-link:after{content:"";position:absolute;top:100%;left:0;bottom:0;right:0;height:0;width:100%;background:#fff;opacity:.1;cursor:pointer;-webkit-transition:all .2s ease-out;transition:all .2s ease-out}.navigation-link:hover:after{top:50%;height:50%}.navigation-item-text{-webkit-box-flex:1;-ms-flex:1;flex:1}.posts{padding:28px 14px;padding:2rem 1rem}@media (min-width:470px){.posts{padding:2rem}}.post-wrapper{padding-bottom:28px;padding-bottom:2rem}.post-wrapper:last-child{padding-bottom:0}.post{padding:28px 14px;padding:2rem 1rem;margin:28px 0;margin:2rem 0;background:#fff;max-width:840px;max-width:60rem;position:relative}@media (min-width:470px){.post{padding:2rem}}.post:before{background:linear-gradient(180deg,hsla(0,0%,100%,0) 0,#fff 1500px);-webkit-animation:fadein 1s ease-in;animation:fadein 1s ease-in}.post:after,.post:before{content:" ";position:absolute;top:0;left:50%;bottom:0;width:100vw;-webkit-transform:translateX(-50%);transform:translateX(-50%);z-index:-1}.post:after{background:linear-gradient(0deg,#ececec 0,hsla(0,0%,100%,0) 1000px)}.posts .post{margin:0 auto}.posts .post:after,.posts .post:before{content:none}.posts .post:before{-webkit-animation:none;animation:none}.post>:first-child{margin-top:0}@media (min-width:62rem){.post-page-post-wrapper{margin-left:2rem;margin-right:2rem}}.post-content{font-size:15.4px;font-size:1.1rem;line-height:1.55}.post-content>*{margin:21px 0 0;margin:1.5rem 0 0}.post-content :not(figure)>a{color:#4580a7;padding-bottom:.7px;padding-bottom:.05rem;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(104,130,197,.4)),to(rgba(104,130,197,.4)));background-image:linear-gradient(rgba(104,130,197,.4),rgba(104,130,197,.4));background-repeat:no-repeat;background-size:100% 1.5px;background-position:center bottom 10%;background-origin:padding-box;text-shadow:3px 0 #fff,2px 0 #fff,1px 0 #fff,-1px 0 #fff,-2px 0 #fff,-3px 0 #fff;-webkit-transition:color .25s;transition:color .25s}.post-content :not(figure)>a:hover{color:#6882c5}.post-content blockquote{position:relative;font-size:18.2px;font-size:1.3rem;font-size:21.98px;font-size:1.57rem;font-style:italic;font-weight:100;padding-left:28px;padding-left:2rem;line-height:1.48;margin-top:28px;margin-top:2rem}.post-content blockquote:before{content:"\201C";position:absolute;top:-21px;top:-1.5rem;left:-7px;left:-.5rem;height:42px;height:3rem;width:25px;color:#f5f5f5;font-size:84px;font-size:6rem;font-style:normal;line-height:1}.post-content blockquote footer{margin-top:14px;margin-top:1rem;font-size:12.6px;font-size:.9rem;text-align:right}.post-content blockquote cite{display:inline-block;margin-left:7px;margin-left:.5rem}.post-content figure{text-align:center}.post-content figcaption{color:#666;font-size:12.6px;font-size:.9rem;font-style:italic}.post-content img{display:block;max-width:100%;height:auto;margin:0 auto;min-height:50px;min-width:150px;position:relative;color:#b6b6b6;font-size:12.6px;font-size:.9rem;text-align:center}.post-content img:before{content:"Image failed to load :/";display:block;font-size:13.299px;font-size:.95rem}.post-content code,.post-content pre{font-family:Consolas,Monaco,Andale Mono,monospace;text-shadow:0 1px #fff;white-space:pre;word-spacing:normal;word-break:normal;-webkit-font-feature-settings:none;font-feature-settings:none;-webkit-font-variant-ligatures:none;font-variant-ligatures:none;word-wrap:normal;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.post-content :not(h3):not(h4):not(h5):not(h6)>code,.post-content pre{font-size:11.9px;font-size:.85rem}.post-content :not(pre)>code,.post-content pre{background:#f5f5f5}.post-content pre{padding:14px;padding:1rem;overflow:auto;color:#000}.post-content :not(pre)>code{display:inline-block;padding:0 3.815px;padding:0 .2725rem;white-space:normal}.post-content a code{background:transparent none repeat 0 0/auto auto padding-box border-box scroll;background:initial;font-size:13.719px;font-size:.98rem;padding:0;padding:initial}.post-content p:first-child{margin-top:0}.post-content h2,.post-content h3,.post-content h4,.post-content h5,.post-content h6{position:relative}.post-content h3{font-size:22.75px;font-size:1.625rem}.post-content h4{font-size:19.446px;font-size:1.389rem}.post-content h5{font-size:16.142px;font-size:1.153rem}.post-content h6{font-size:13.034px;font-size:.931rem}.post-content .post-header-anchor{position:absolute;left:-14px;left:-1rem;top:20px;width:14px;width:1rem;-webkit-transform:translateY(-50%);transform:translateY(-50%);background:0 0;text-align:center;line-height:1;text-shadow:none;-webkit-transition:opacity .25s ease-in-out;transition:opacity .25s ease-in-out}@media (min-width:470px){.post-content .post-header-anchor{left:-2rem;top:20px;width:2rem}}.post-content .post-header-anchor:focus{outline:0}.post-content .post-header-anchor:hover svg{opacity:1}.post-content .post-header-anchor:after{content:" copied";position:absolute;bottom:-14px;left:0;right:0;font-size:.6em;color:gray;opacity:0;visibility:none;-webkit-transition:opacity 2s;transition:opacity 2s}.post-content .post-header-anchor svg{opacity:.2}.post-content h4 .post-header-anchor{top:18px}.post-content h5 .post-header-anchor{top:16px}.post-content h6 .post-header-anchor{top:14px}.post-content .post-header-anchor--copied:after{opacity:1}.post-content p:last-of-type{margin-bottom:0}.post-content h3,.post-content h4,.post-content h5,.post-content h6{position:relative}.post-content h3+p,.post-content h4+p,.post-content h5+p,.post-content h6+p{margin-top:7px;margin-top:.5rem}.post-content p+h3,.post-content p+h4,.post-content p+h5,.post-content p+h6{margin-top:28px;margin-top:2rem}.post-content ol,.post-content ul{padding-left:1.25em;list-style:disc outside none;list-style:initial}.post-content ol{list-style-type:decimal}.post-content li{margin-bottom:7px;margin-bottom:.5rem}.post-summary .post-content,.post-summary .post-content>*{display:inline}.post-content table{border-spacing:0;border-collapse:collapse}.post-content td,.post-content th{padding:0;padding:6px 13px;border:1px solid #dfe2e5}.post-content th{font-weight:600;text-align:left}.post-title-wrapper{margin:0}.post-title{line-height:1.4;font-size:19.599px;font-size:1.4rem;font-weight:700}.wf-active .post-title{font-size:21px;font-size:1.5rem;line-height:1.2}@media (min-width:30rem){.post-title{line-height:1.6;font-size:1.85rem}.wf-active .post-title{line-height:1.5;font-size:2rem}}.post-title-label{display:inline-block;position:relative;bottom:.3em;padding:.2em .4em;margin-left:.3em;font-size:.5em;background:#e3e3e3;color:#9e9e9e;border-radius:5%;font-weight:400;-webkit-transition:opacity .25s ease-in;transition:opacity .25s ease-in}.post-title:hover .post-title-label{opacity:.9}.post-title-label-parenthesis{display:none}.post-meta{font-size:12.6px;font-size:.9rem;margin:14px 0;margin:1rem 0;color:#a2a2a2}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.post-meta{color:#000;font-weight:300}}.post-blog-date{display:block;margin-top:7px;margin-top:.5rem}@media (min-width:30rem){.post-blog-date{display:inline;margin-top:0}.post-blog-date+.post-blog-title:before{display:inline-block;content:" \2014   ";margin:0 .25rem 0 .5rem}}.post-blog-link{font-weight:400;font-style:italic}.footer-link,.post-blog-link,.post-read-more-link,.post-title,.site-happy-text-headline-link,.site-happy-text-tagline-link{-webkit-transition:color .25s;transition:color .25s}.footer-link:hover,.post-blog-link:hover,.post-read-more-link:hover,.post-title:hover,.site-happy-text-headline-link:hover,.site-happy-text-tagline-link:hover{color:#6882c5;background:-webkit-gradient(linear,left top,right top,from(#5c7b8f),to(#6882c5));background:linear-gradient(90deg,#5c7b8f,#6882c5);background-clip:border-box;-webkit-background-clip:text;-webkit-text-fill-color:transparent;-webkit-box-decoration-break:clone;box-decoration-break:clone}.footer-link,.post-read-more-link,.post-title,.site-happy-text-tagline-link{color:#5c7b8f}.post-read-more-link{display:inline-block;font-weight:700;margin:0}.post-comments{margin:28px 28px 0;margin:2rem 2rem 0;padding:28px;padding:2rem;background:#fff}@media (min-width:62rem){.post-comments{margin-left:0;margin-right:0}}.post-comments a{color:#5c7b8f;padding-bottom:.7px;padding-bottom:.05rem;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(rgba(0,0,0,.2)));background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2));background-repeat:no-repeat;background-size:100% 1.5px;background-position:center bottom 10%;background-origin:padding-box;text-shadow:3px 0 #fff,2px 0 #fff,1px 0 #fff,-1px 0 #fff,-2px 0 #fff,-3px 0 #fff;-webkit-transition:color .25s;transition:color .25s}.post-comments a:hover{color:#6882c5}@media (min-width:62rem){.more-articles{padding-left:0;padding-right:0}}.footer{text-align:center;font-size:11.2px;font-size:.8rem;margin-bottom:28px;margin-bottom:2rem}.footer-text{margin:0}.footer-link{font-weight:700}.copyright{display:block;color:gray}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2),(min-resolution:192dpi){.copyright{font-weight:100}}.fix-bug-ignore{color:red}.posts{position:relative}.post-wrapper{-webkit-transition:padding .5s ease-in-out,-webkit-transform .3s ease-in-out;transition:padding .5s ease-in-out,-webkit-transform .3s ease-in-out;transition:padding .5s ease-in-out,transform .3s ease-in-out;transition:padding .5s ease-in-out,transform .3s ease-in-out,-webkit-transform .3s ease-in-out}.post{-webkit-transition:opacity .1s ease-in-out,-webkit-transform .1s ease-in-out;transition:opacity .1s ease-in-out,-webkit-transform .1s ease-in-out;transition:opacity .1s ease-in-out,transform .1s ease-in-out;transition:opacity .1s ease-in-out,transform .1s ease-in-out,-webkit-transform .1s ease-in-out}.posts--entering-post .post-wrapper:not(.post-wrapper--entering-from-posts) .post{opacity:.2;-webkit-transform:scale(.8);transform:scale(.8)}.posts--entering-post .post-wrapper--entering-from-posts{left:0;right:0}@media (min-width:62rem){.posts--entering-post .post-wrapper--entering-from-posts{margin-left:2rem;margin-right:2rem}}.post-skeleton{line-height:1.55;position:relative;opacity:0;max-height:0;overflow:hidden}.post-skeleton.post-skeleton--visible,.post-wrapper--entering-from-posts .post-skeleton{opacity:1;margin-top:28px;margin-top:2rem;max-height:none}.post-skeleton:after{content:" ";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;opacity:.2;-webkit-animation:1s skeleton infinite ease-in-out;animation:1s skeleton infinite ease-in-out}.post-skeleton-word{height:15.4px;height:1.1rem;background:#f7f7f7;width:46px;display:inline-block;margin:4px 6px 0 0}.post-skeleton-word:nth-child(2n){width:36px}.post-skeleton-word:nth-child(3n){width:76px}.post-skeleton+.post-skeleton .post-skeleton-word:nth-child(3n){width:71px}.post-skeleton-word:nth-child(5n){width:96px}.post-skeleton-word:nth-child(6n){width:63px}.post-skeleton-word:nth-child(7n){width:26px}@-webkit-keyframes skeleton{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}98%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}99%{-webkit-transform:translate3d(100%,100%,0);transform:translate3d(100%,100%,0)}to{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@keyframes skeleton{0%{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}98%{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}99%{-webkit-transform:translate3d(100%,100%,0);transform:translate3d(100%,100%,0)}to{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}}@-webkit-keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes fadein{0%{opacity:0}to{opacity:1}}</style><style data-vue-ssr-id="1629eadd:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}</style>
    <script src="https://unpkg.com/scrollto-with-animation/dist/scrollto-with-animation.min.js"></script>
  </head>
  <body data-n-head="">
    <div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#869bad;opacity:0"></div><div id="__layout"><div class="wrapper"><main class="content"><header class="header"><h1 class="site-title"><a href="/" class="site-link nuxt-link-active">Adam Lynch</a></h1><div class="site-happy-text-wrapper"><p class="site-happy-text"><span class="site-happy-text-headline">
                I'm <a href="/" class="site-happy-text-headline-link nuxt-link-active">Adam Lynch</a>.
            </span><span class="site-happy-text-tagline">
                I like to
                <a href="https://github.com/adam-lynch" class="site-happy-text-tagline-link">code</a>,
                <a href="/" class="site-happy-text-tagline-link nuxt-link-active">write</a>, and dabble in design.
            </span><span class="site-happy-text-tagline">
                I lead <a href="https://www.teamwork.com" class="site-happy-text-tagline-link">Teamwork.com</a>'s next product.
            </span></div><nav class="navigation-wrapper" role="navigation"><ul class="navigation"><li class="navigation-item writing-navigation-item"><a href="/" class="navigation-link nuxt-link-active"><span class="navigation-item-text">Writing</span></a><li class="navigation-item code-navigation-item"><a href="https://github.com/adam-lynch" class="navigation-link" rel="noopener"><span class="navigation-item-text">Code</span></a><li class="navigation-item edit-navigation-item"><a href="https://github.com/adam-lynch/adam-lynch.github.io" class="navigation-link" rel="noopener"><span class="navigation-item-text">Edit page</span></a><li class="navigation-item twitter-navigation-item"><a href="https://twitter.com/lynchy010/" class="navigation-link" rel="noopener"><span class="navigation-item-text">Twitter</span></a><li class="navigation-item email-navigation-item"><a href="mailto:contact@adamlynch.com" class="navigation-link" rel="noopener"><span class="navigation-item-text">Email</span></a><li class="navigation-item linkedin-navigation-item"><a href="https://www.linkedin.com/in/adamlynch010/" class="navigation-link" rel="noopener"><span class="navigation-item-text">LinkedIn</span></a></ul></nav></header><div class="post-page-post-wrapper"><article class="post"><h2 class="post-title-wrapper"><a href="/10-things-to-know-about-gulp" class="post-title nuxt-link-exact-active nuxt-link-active">10 things to know about Gulp</a></h2><div class="post-meta"><time class="post-blog-date">November 24th, 2015</time><div class="no-ssr-placeholder"></div></div><div class="post-content">
<p><img src="/images/blog-content/10-things-to-know-about-gulp/gulp.png" alt=""></p>
<p>I love <a href="http://gulpjs.com/" rel="noopener">Gulp</a>. It’s great in so many ways and for so many purposes. I’ve been putting off writing a post on it forever. There’s just too much to write about; I could write a book on it. So instead, I’m going to give a quick introduction and share a few tips.</p>
<p>Never heard of Gulp? It’s a build system or task runner like Maven, Ant, Grunt, and so on, except much much better. A few other key points:</p>
<ul>
<li>Based on Node.js streams.</li>
<li>Aims to avoid writing to disk unnecessarily for performance.</li>
<li>The API is really simple. There are four methods.</li>
<li>Code is favoured over configuration.</li>
<li>It’s really intuitive. You take some files, you do this, that, and that other thing to them, and then store them somewhere.</li>
<li>Plugins are really simple and easy to use.</li>
<li>Takes advantage of existing modules on npm (which has now reached over 200,000 modules by the way), but more about that later.</li>
</ul>
<p>I’m unlucky enough to have had experience with a host of build systems. My introduction to Gulp happened not long after I joined Teamwork when it was added to one project to begin with. I’ve latched onto it ever since. Now, Gulp is used in every project here for all sorts. I’ve even written and contributed to a lot of Gulp plugins / Gulp-friendly modules, beginning with <a href="https://github.com/BlessCSS/gulp-bless" rel="noopener">gulp-bless</a>. It’s really easy! Most Gulp plugins have one source file, less than a hundred lines long.</p>
<p>If you’d like to get up to speed with Gulp, make sure to read <a href="https://css-tricks.com/gulp-for-beginners/" rel="noopener">Gulp for Beginners</a> by Zell Liew (and there’s more where that came from; his <a href="http://automateyourworkflow.com/" rel="noopener">Automate Your Workflow</a> book). Now, onto some tips.</p>
<h3><a href="#1-gulp-doesnt-just-compile--minify-assets" class="post-header-anchor" id="1-gulp-doesnt-just-compile--minify-assets" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#1: Gulp doesn’t just compile & minify assets</h3>
<p>Don’t get me wrong, there are some great plugins for the frontend (shout out to <a href="https://github.com/sindresorhus/gulp-autoprefixer" rel="noopener">gulp-autoprefixer</a>), but that’s not all the Gulp community has to offer. Pretty much anything you can think of; there’s a plugin for that. Some other uses we’ve found for Gulp include:</p>
<ul>
<li>Building desktop apps from Web apps, signing executables, etc.</li>
<li>Linting, validation and analysis.</li>
<li>Deploying over FTP, to AWS S3, GitHub pages, etc.</li>
<li>Generating documentation.</li>
<li>Static site generation.</li>
<li>And a lot lot more.</li>
</ul>
<h3><a href="#2-gulpdest-isnt-the-end" class="post-header-anchor" id="2-gulpdest-isnt-the-end" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#2: <code>gulp.dest</code> isn’t the end</h3>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> rename <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-rename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'*.md'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      extname<span class="token punctuation">:</span> <span class="token string">'.txt'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./yet-another'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This is a simple but noteworthy one as it's not immediately obvious to everyone. You can save files to disk as many times as you'd like in a pipeline.</p>
<h3><a href="#3-clean-up-that-gulpfile" class="post-header-anchor" id="3-clean-up-that-gulpfile" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#3: Clean up that gulpfile</h3>
<p>Despite how very very simple it is, <code>gulp-load-plugins</code> has to be my favourite Gulp plugin. Since <s>"no one plugin should have all that power"</s> Gulp plugins do one thing and one thing well, it's easy to end up with an uncomfortable amount of <code>require</code>s at the top of your gulpfile.</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./input/*'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>gulp-load-plugins</code> makes all of your plugins (i.e. anything named <code>gulp-*</code> in your <code>package.json</code>) available to you to as properties of the single object. This has a great side-effect in that for a plugin to be usable at all, for anyone, it must be in your <code>package.json</code>. This removes the opportunity for someone to install a plugin (like <code>npm install gulp-filter</code>) forgetting the <code>--save-dev</code> flag (resulting in it working for them but not the next person on the team to pull their changes and npm install).</p>
<h3><a href="#4-bend-the-stream-to-your-will" class="post-header-anchor" id="4-bend-the-stream-to-your-will" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#4: Bend the stream to your will</h3>
<p>You'll inevitably need a bit of flexibility in your tasks. For example, you might want to apply some manipulations exclusively to a subset of files within the stream;</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> pngFilter <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'*.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./images/*'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output/images'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>pngFilter<span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output/raster'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>pngFilter<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">...</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output/other'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>gulp-filter</code> accepts a single glob, an array of globs or a function which returns a Boolean (in case your step depends on properties of the files coming down the pipeline). As you can see above, you can use multiple filters per pipeline and even restore (or undo) the filter at any point.</p>
<p><code>gulp-if</code> is similar but not the same. It accepts a "condition" in the form of a Boolean or a function which returns one (like <code>gulp-filter</code>). The other two parameters are reserved for the postive and (optional) negative outcomes.</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">isLong</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./*'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span>isLong<span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This is particularly handy when paired with runtime flags and the <code>gulp-util</code> module. Using the following example, passing <code>--mode production</code> will result in the images being compressed before being copied to the <code>output</code> directory. This is useful for skipping over time-consuming steps.</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> isProductionMode <span class="token operator">=</span> $<span class="token punctuation">.</span>util<span class="token punctuation">.</span>argvs<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./*.png'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span>isProductionMode<span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./output'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>What if this all goes wrong? Stick in a call to <code>gulp-debug</code> anywhere to see which files are coming down the stream then and there;</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./abc/**/*.png'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'Before filter'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'*@2x.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'After filter'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>gulp-debug</code> will then log varying levels of details about the files to the console depending on the options you pass to it.</p>
<h3><a href="#5-theres-more-to-gulp-than-gulp-plugins" class="post-header-anchor" id="5-theres-more-to-gulp-than-gulp-plugins" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#5: There's more to Gulp than Gulp plugins</h3>
<p>One of the best things about Gulp is that you can use whichever modules you'd like in your tasks. There are a lot of "Gulp friendly" modules out there on <a href="https://www.npmjs.com/" rel="noopener">npm</a> which support streams and Gulp's <code>vinyl</code> files. Even if a module doesn't, you can do whatever you'd like within a task anyway, you just won't be able to easily pipe to/from it in a pipeline. Here are some of our favourite modules which aren't named <code>gulp-*</code>:</p>
<ul>
<li><a href="http://browsersync.io/" rel="noopener"><code>browser-sync</code></a>:
<ul>
<li>Quickly spin up a little local server to serve your files for testing.</li>
<li>Sync clicks, scrolls, and more across browsers.</li>
<li>Watch files and inject changes on the fly.</li>
<li>Essential for testing responsive designs.</li>
</ul>
</li>
<li><a href="https://github.com/addyosmani/critical" rel="noopener"><code>critical</code></a>: Extract & inline critical-path CSS in HTML pages.</li>
<li><a href="https://github.com/nwjs/nw-builder" rel="noopener"><code>nw-builder</code></a>: Generate executables from <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> apps.</li>
<li><a href="https://github.com/SBoudrias/Inquirer.js/" rel="noopener"><code>inquirer</code></a>: <em>The</em> module for prompting the user for input, validating input, etc.</li>
<li><a href="https://github.com/ck86/main-bower-files" rel="noopener"><code>main-bower-files</code></a>: Parses your <code>bower.json</code> and gives you a list of your dependencies <code>main</code> files.</li>
</ul>
<h3><a href="#6-gulpfilecoffee" class="post-header-anchor" id="6-gulpfilecoffee" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#6: <code>gulpfile.coffee</code></h3>
<pre><code class="language-coffeescript">gulp <span class="token operator">=</span> require <span class="token string">'gulp'</span>
$ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
isProductionMode <span class="token operator">=</span> $<span class="token punctuation">.</span>util<span class="token punctuation">.</span>argvs<span class="token punctuation">.</span>mode <span class="token keyword">is</span> <span class="token string">'production'</span>

gulp<span class="token punctuation">.</span>task <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">></span>
  gulp<span class="token punctuation">.</span>src <span class="token string">'./*.png'</span>
    <span class="token punctuation">.</span>pipe $<span class="token punctuation">.</span><span class="token keyword">if</span> isProductionMode<span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>pipe gulp<span class="token punctuation">.</span>dest <span class="token string">'./output'</span>
</code></pre>
<p>Gulp supports CoffeeScript since version 3.7. Once you <code>npm install --save-dev coffee-script</code> in the same directory as your gulpfile, you can have a <code>gulpfile.coffee</code> intead of a <code>gulpfile.js</code> and everything will work as normal.</p>
<h3><a href="#7-more-accurate-timing" class="post-header-anchor" id="7-more-accurate-timing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#7: More accurate timing</h3>
<p>Gulp logs whenever a task starts, when it finishes, and how long it took. Gulp is fast, but it's easy to be fooled into thinking it's faster than it is if you have asynchronous code in a task. Take this gulpfile for example:</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Default is running...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>So our <code>default</code> task does some logging but first has a dependency on an <code>images</code> task does some logging after three seconds. If you were to run <code>gulp</code>, you'd see something like this:</p>
<pre><code>Starting 'images'...
[22:21:07] Finished 'images' after 465 μs
[22:21:07] Starting 'default'...
[22:21:07] Default is running...
[22:21:07] Finished 'default' after 70 ms
[22:21:10] Tada! Images is really done.
</code></pre>
<p>Wait, the <code>default</code> task starts before the <code>images</code> task logs its message? Note we're also being told <code>images</code> only took 465 micro-seconds. There are three ways we can fix this.</p>
<p>One way is to return a reliable stream, but that doesn't apply here so we'll move on. Quick side note: if you are using a gulpfile.coffee like mentioned above, CoffeeScript's implicit return (i.e. the last line of every function becomes a <code>return</code> statement when compiled) which could help tighten us task timings without you realising it.</p>
<p>One way to solve this is to use the task's callback argument like this:</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Default is running...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Note, <code>done</code> can only be called once per task and it can also be called with an <code>Error</code> which will end the task appropriately. The output would now be something like the following:</p>
<pre><code>[22:31:19] Starting 'images'...
[22:31:22] Tada! Images is really done.
[22:31:22] Finished 'images' after 3.07 s
[22:31:22] Starting 'default'...
[22:31:22] Default is running...
[22:31:22] Finished 'default' after 653 μs
</code></pre>
<p>3.07 seconds, that's more like it. Gulp also supports promises in tasks and that's the other way we can solve it;</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-load-plugins'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'es6-promise'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Promise<span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Default is running...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Note: calling <code>reject</code> anywhere in the task with an <code>Error</code> would be just like calling the <code>done</code> callback with one.</p>
<h3><a href="#8-flatten-task-dependencies-for-concurrency" class="post-header-anchor" id="8-flatten-task-dependencies-for-concurrency" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#8: Flatten task dependencies for concurrency</h3>
<p>Don't group task dependencies by purpose, even though that might make most sense initially. Gulp uses Orchestrator underneath, which is described as "a module for sequencing and executing tasks and dependencies in maximum concurrency." Dependencies are ran in parallel, as much as your dependency graph permits. So, what you really should do is try to flatten that graph as much as possible.</p>
<p>If you had these tasks for example:</p>
<pre><code class="language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'frontend'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'frontend'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'styles'</span><span class="token punctuation">,</span> <span class="token string">'scripts'</span><span class="token punctuation">,</span> <span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'styles'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'inline-above-fold-styles'</span><span class="token punctuation">,</span> <span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'inline-above-fold-styles'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'scripts'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bundle-a'</span><span class="token punctuation">,</span> <span class="token string">'bundle-b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'bundle-a'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'bundle-b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'templates'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'styles'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>There are a few problems here, but look at how <code>templates</code> depends on <code>styles</code>. This means that all of <code>styles</code> need to finish before <code>templates</code> can run, even though it might actually only depend on <code>inline-above-fold-styles</code> for example. The first change here that I'd make is to remove the <code>styles</code> task altogether and have <code>templates</code> depend directly on <code>inline-above-fold-styles</code>;</p>
<pre><code class="language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'inline-above-fold-styles'</span><span class="token punctuation">,</span> <span class="token string">'scripts'</span><span class="token punctuation">,</span> <span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token string">'templates'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'inline-above-fold-styles'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'scripts'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bundle-a'</span><span class="token punctuation">,</span> <span class="token string">'bundle-b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'bundle-a'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'bundle-b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'templates'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'inline-above-fold-styles'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>So yeah, remove any tasks there for decoration and flatten the dependency graph as much as possible.</p>
<h3><a href="#9-forget-about-yeoman" class="post-header-anchor" id="9-forget-about-yeoman" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#9: Forget about Yeoman</h3>
<p>Ok, that heading is pure sensationalism. If you don't know <a href="http://yeoman.io/" rel="noopener">Yeoman</a> is, it's a tool for scaffolding or bootstrapping projects. So someone creates a "generator" which when ran might ask you a few questions (like "Would you like to use JavaScript or CoffeeScript?") and then spit out a skeleton project for you. There are thousands of Yeoman generators out there for all sorts of apps, <a href="http://yeoman.io/generators/" rel="noopener">take a look</a>.</p>
<p>Let's say you create a lot of similar projects or even directories within a project and you'd like to have a template for that so you can quickly generate it as you go. Well, you could learn the Yeoman API but everything Yeoman does is already doable with Gulp, so why not just use Gulp plugins? You can easily copy files, prompt the user, and so on. Well that's what <a href="http://slushjs.github.io/" rel="noopener">Slush</a> is; "The streaming scaffolding system. Gulp as a replacement for Yeoman."</p>
<p>It's really easy to create a Slush generator. A Slush generator is just a globally installed module with a <code>slushfile</code> (which is just a gulpfile). Here's a very simple one:</p>
<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>_dirname <span class="token operator">+</span> <span class="token string">'/**/*'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This just copies all files in the generator's directory to the user's current directory. Notice that you need to use <code>__dirname</code> when pointing to files within the generator.</p>
<p>To use this generation is must be named something like <code>slush-something</code> and <code>slush</code> itself must also be installed globally. Then running <code>slush something</code> will run your generator (i.e. call the <code>slush-something</code> generator's slushfile).</p>
<p>There are very few Slush generators in comparison to Yeoman, so if you're looking for a Slush generator, then maybe stick to Yeoman (for now), but if you're writing one, I'd suggest using Slush. Why not kill two birds with the one API?</p>
<h3><a href="#10-gulp-grunt" class="post-header-anchor" id="10-gulp-grunt" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#10: gulp-grunt</h3>
<p>If you're still using Grunt (poor you!) then the <a href="https://github.com/gratimax/gulp-grunt" rel="noopener"><code>gulp-grunt</code></a> gulp plugin can help you transition bit by bit to Gulp. This plugin allows you to run your Grunt tasks from Gulp and even have your Gulp tasks depend on Grunt tasks. If you want to know, <a href="https://github.com/gratimax/gulp-grunt" rel="noopener">gulp-grunt's comprehensive readme</a> has you covered.</p>
</div></article><aside><div class="post-comments"><p>Feedback is more than welcome via <a href="https://twitter.com/lynchy010">@lynchy010</a> or <a href="mailto:contact@adamlynch.com">contact@adamlynch.com</a></div><div class="no-ssr-placeholder"></div></aside></div><footer class="footer"><p class="footer-text"><a href="https://github.com/adam-lynch/adam-lynch.github.io" class="footer-link">This site is open source</a><span class="copyright">© 2019 Adam Lynch</span></footer></main></div></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{article:{id:"10-things-to-know-about-gulp",slug:"10-things-to-know-about-gulp",highlightedLanguages:["javascript","coffeescript",""],source:"---\ndate: 2015-11-24\nsummary: NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.\noriginal:\n  blogLink: https://engineroom.teamwork.com\n  blogName: Teamwork's Engine Room\n  url: https://engineroom.teamwork.com/10-things-to-know-about-gulp-2e99176f9c74\ntags:\n  - gulp\n  - build\n  - build system\n  - javascript\n  - node.js\n  - development\n---\n\n## 10 things to know about Gulp\n\n![](/images/blog-content/10-things-to-know-about-gulp/gulp.png)\n\n:::summary\n\nI love [Gulp](http://gulpjs.com/). It’s great in so many ways and for so many purposes. I’ve been putting off writing a post on it forever. There’s just too much to write about; I could write a book on it. So instead, I’m going to give a quick introduction and share a few tips.\n\n:::\n\nNever heard of Gulp? It’s a build system or task runner like Maven, Ant, Grunt, and so on, except much much better. A few other key points:\n\n- Based on Node.js streams.\n- Aims to avoid writing to disk unnecessarily for performance.\n- The API is really simple. There are four methods.\n- Code is favoured over configuration.\n- It’s really intuitive. You take some files, you do this, that, and that other thing to them, and then store them somewhere.\n- Plugins are really simple and easy to use.\n- Takes advantage of existing modules on npm (which has now reached over 200,000 modules by the way), but more about that later.\n\nI’m unlucky enough to have had experience with a host of build systems. My introduction to Gulp happened not long after I joined Teamwork when it was added to one project to begin with. I’ve latched onto it ever since. Now, Gulp is used in every project here for all sorts. I’ve even written and contributed to a lot of Gulp plugins / Gulp-friendly modules, beginning with [gulp-bless](https://github.com/BlessCSS/gulp-bless). It’s really easy! Most Gulp plugins have one source file, less than a hundred lines long.\n\nIf you’d like to get up to speed with Gulp, make sure to read [Gulp for Beginners](https://css-tricks.com/gulp-for-beginners/) by Zell Liew (and there’s more where that came from; his [Automate Your Workflow](http://automateyourworkflow.com/) book). Now, onto some tips.\n\n### #1: Gulp doesn’t just compile & minify assets\n\nDon’t get me wrong, there are some great plugins for the frontend (shout out to [gulp-autoprefixer](https://github.com/sindresorhus/gulp-autoprefixer)), but that’s not all the Gulp community has to offer. Pretty much anything you can think of; there’s a plugin for that. Some other uses we’ve found for Gulp include:\n\n- Building desktop apps from Web apps, signing executables, etc.\n- Linting, validation and analysis.\n- Deploying over FTP, to AWS S3, GitHub pages, etc.\n- Generating documentation.\n- Static site generation.\n- And a lot lot more.\n\n### #2: `gulp.dest` isn’t the end\n\n```javascript\nvar gulp = require('gulp');\nvar rename = require('gulp-rename');\n\ngulp.task('default', function() {\n  gulp.src('*.md')\n    .pipe(gulp.dest('./output'))\n    .pipe(gulp.dest('./another'))\n    .pipe(rename({\n      extname: '.txt'\n    }))\n    .pipe(gulp.dest('./yet-another'));\n});\n```\n\nThis is a simple but noteworthy one as it's not immediately obvious to everyone. You can save files to disk as many times as you'd like in a pipeline.\n\n\n### #3: Clean up that gulpfile\n\nDespite how very very simple it is, `gulp-load-plugins` has to be my favourite Gulp plugin. Since ~~\"no one plugin should have all that power\"~~ Gulp plugins do one thing and one thing well, it's easy to end up with an uncomfortable amount of `require`s at the top of your gulpfile.\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\ngulp.task('default', function(){\n  gulp.src('./input/*')\n    .pipe($.if(false, $.replace('hello', 'world')))\n    .pipe(gulp.dest('./'))\n    .pipe($.debug());\n});\n```\n\n`gulp-load-plugins` makes all of your plugins (i.e. anything named `gulp-*` in your `package.json`) available to you to as properties of the single object. This has a great side-effect in that for a plugin to be usable at all, for anyone, it must be in your `package.json`. This removes the opportunity for someone to install a plugin (like `npm install gulp-filter`) forgetting the `--save-dev` flag (resulting in it working for them but not the next person on the team to pull their changes and npm install).\n\n\n### #4: Bend the stream to your will\n\nYou'll inevitably need a bit of flexibility in your tasks. For example, you might want to apply some manipulations exclusively to a subset of files within the stream;\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\ngulp.task('default', function(){\n  var pngFilter = $.filter('*.png');\n\n  gulp.src('./images/*')\n    .pipe(gulp.dest('./output/images'))\n    .pipe(pngFilter)\n    // ...\n    .pipe(gulp.dest('./output/raster'))\n    .pipe(pngFilter.restore())\n    .pipe($.filter(function(file){\n      return file.contents.toString('utf8').length > 500;\n    }))\n    // ...\n    .pipe(gulp.dest('./output/other'));\n});\n```\n\n`gulp-filter` accepts a single glob, an array of globs or a function which returns a Boolean (in case your step depends on properties of the files coming down the pipeline). As you can see above, you can use multiple filters per pipeline and even restore (or undo) the filter at any point.\n\n`gulp-if` is similar but not the same. It accepts a \"condition\" in the form of a Boolean or a function which returns one (like `gulp-filter`). The other two parameters are reserved for the postive and (optional) negative outcomes.\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\ngulp.task('default', function() {\n  var isLong = function(file) {\n    return file.contents.toString('utf8').length > 500;\n  };\n\n  gulp.src('./*')\n    .pipe($.if(isLong, gulp.dest('./output'), gulp.dest('./output2'));\n});\n```\n\nThis is particularly handy when paired with runtime flags and the `gulp-util` module. Using the following example, passing `--mode production` will result in the images being compressed before being copied to the `output` directory. This is useful for skipping over time-consuming steps.\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\nvar isProductionMode = $.util.argvs.mode === 'production';\n\ngulp.task('default', function() {\n  gulp.src('./*.png')\n    .pipe($.if(isProductionMode, $.imagemin())\n    .pipe(gulp.dest('./output'));\n});\n```\n\nWhat if this all goes wrong? Stick in a call to `gulp-debug` anywhere to see which files are coming down the stream then and there;\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\ngulp.task('default', function() {\n  gulp.src('./abc/**/*.png')\n    .pipe($.debug({\n      title: 'Before filter'\n    }))\n    .pipe($.filter('*@2x.png'))\n    .pipe($.debug({\n      title: 'After filter'\n    }))\n});\n```\n\n`gulp-debug` will then log varying levels of details about the files to the console depending on the options you pass to it.\n\n### #5: There's more to Gulp than Gulp plugins\n\nOne of the best things about Gulp is that you can use whichever modules you'd like in your tasks. There are a lot of \"Gulp friendly\" modules out there on [npm](https://www.npmjs.com/) which support streams and Gulp's `vinyl` files. Even if a module doesn't, you can do whatever you'd like within a task anyway, you just won't be able to easily pipe to/from it in a pipeline. Here are some of our favourite modules which aren't named `gulp-*`:\n\n- [`browser-sync`](http://browsersync.io/):\n  - Quickly spin up a little local server to serve your files for testing.\n  - Sync clicks, scrolls, and more across browsers.\n  - Watch files and inject changes on the fly.\n  - Essential for testing responsive designs.\n- [`critical`](https://github.com/addyosmani/critical): Extract & inline critical-path CSS in HTML pages.\n- [`nw-builder`](https://github.com/nwjs/nw-builder): Generate executables from [NW.js](https://github.com/nwjs/nw.js) apps.\n- [`inquirer`](https://github.com/SBoudrias/Inquirer.js/): _The_ module for prompting the user for input, validating input, etc.\n- [`main-bower-files`](https://github.com/ck86/main-bower-files): Parses your `bower.json` and gives you a list of your dependencies `main` files.\n\n\n### #6: `gulpfile.coffee`\n\n```coffeescript\ngulp = require 'gulp'\n$ = require('gulp-load-plugins')()\nisProductionMode = $.util.argvs.mode is 'production'\n\ngulp.task 'default', ->\n  gulp.src './*.png'\n    .pipe $.if isProductionMode, $.imagemin()\n    .pipe gulp.dest './output'\n```\n\nGulp supports CoffeeScript since version 3.7\\. Once you `npm install --save-dev coffee-script` in the same directory as your gulpfile, you can have a `gulpfile.coffee` intead of a `gulpfile.js` and everything will work as normal.\n\n### #7: More accurate timing\n\nGulp logs whenever a task starts, when it finishes, and how long it took. Gulp is fast, but it's easy to be fooled into thinking it's faster than it is if you have asynchronous code in a task. Take this gulpfile for example:\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\ngulp.task('images', function() {\n  setTimeout(function() {\n    $.util.log(\"Tada! Images is really done.\");\n  }, 3000);\n});\n\ngulp.task('default', ['images'], function() {\n  $.util.log('Default is running...');\n});\n```\n\nSo our `default` task does some logging but first has a dependency on an `images` task does some logging after three seconds. If you were to run `gulp`, you'd see something like this:\n\n```\nStarting 'images'...\n[22:21:07] Finished 'images' after 465 μs\n[22:21:07] Starting 'default'...\n[22:21:07] Default is running...\n[22:21:07] Finished 'default' after 70 ms\n[22:21:10] Tada! Images is really done.\n```\n\nWait, the `default` task starts before the `images` task logs its message? Note we're also being told `images` only took 465 micro-seconds. There are three ways we can fix this.\n\nOne way is to return a reliable stream, but that doesn't apply here so we'll move on. Quick side note: if you are using a gulpfile.coffee like mentioned above, CoffeeScript's implicit return (i.e. the last line of every function becomes a `return` statement when compiled) which could help tighten us task timings without you realising it.\n\nOne way to solve this is to use the task's callback argument like this:\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\ngulp.task('images', function(done) {\n  setTimeout(function() {\n    $.util.log(\"Tada! Images is really done.\");\n    done();\n  }, 3000);\n});\n\ngulp.task('default', ['images'], function() {\n  $.util.log('Default is running...');\n});\n```\n\nNote, `done` can only be called once per task and it can also be called with an `Error` which will end the task appropriately. The output would now be something like the following:\n\n```\n[22:31:19] Starting 'images'...\n[22:31:22] Tada! Images is really done.\n[22:31:22] Finished 'images' after 3.07 s\n[22:31:22] Starting 'default'...\n[22:31:22] Default is running...\n[22:31:22] Finished 'default' after 653 μs\n```\n\n3.07 seconds, that's more like it. Gulp also supports promises in tasks and that's the other way we can solve it;\n\n```javascript\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\nvar Promise = require('es6-promise').Promise;\n\ngulp.task('images', function() {\n  return new Promise(function(resolve, reject) {\n    setTimeout(function() {\n      $.util.log(\"Tada! Images is really done.\");\n      resolve();\n    }, 3000);\n  });\n});\n\ngulp.task('default', ['images'], function() {\n  $.util.log('Default is running...');\n});\n```\n\nNote: calling `reject` anywhere in the task with an `Error` would be just like calling the `done` callback with one.\n\n### #8: Flatten task dependencies for concurrency\n\nDon't group task dependencies by purpose, even though that might make most sense initially. Gulp uses Orchestrator underneath, which is described as \"a module for sequencing and executing tasks and dependencies in maximum concurrency.\" Dependencies are ran in parallel, as much as your dependency graph permits. So, what you really should do is try to flatten that graph as much as possible.\n\nIf you had these tasks for example:\n\n```javascript\ngulp.task('default', ['frontend']);\n\ngulp.task('frontend', ['styles', 'scripts', 'images', 'templates']);\n\ngulp.task('styles', ['css', 'inline-above-fold-styles', 'images']);\n\ngulp.task('css', function(){ ... });\n\ngulp.task('inline-above-fold-styles', function(){ ... });\n\ngulp.task('scripts', ['bundle-a', 'bundle-b']);\n\ngulp.task('bundle-a', function(){ ... });\n\ngulp.task('bundle-b', function(){ ... });\n\ngulp.task('images', function(){ ... });\n\ngulp.task('templates', ['styles'], function(){ ... });\n```\n\nThere are a few problems here, but look at how `templates` depends on `styles`. This means that all of `styles` need to finish before `templates` can run, even though it might actually only depend on `inline-above-fold-styles` for example. The first change here that I'd make is to remove the `styles` task altogether and have `templates` depend directly on `inline-above-fold-styles`;\n\n```javascript\ngulp.task('default', ['css', 'inline-above-fold-styles', 'scripts', 'images', 'templates']);\n\ngulp.task('css', function(){ ... });\n\ngulp.task('inline-above-fold-styles', function(){ ... });\n\ngulp.task('scripts', ['bundle-a', 'bundle-b']);\n\ngulp.task('bundle-a', function(){ ... });\n\ngulp.task('bundle-b', function(){ ... });\n\ngulp.task('images', function(){ ... });\n\ngulp.task('templates', ['inline-above-fold-styles'], function(){ ... });\n```\n\nSo yeah, remove any tasks there for decoration and flatten the dependency graph as much as possible.\n\n\n### #9: Forget about Yeoman\n\nOk, that heading is pure sensationalism. If you don't know [Yeoman](http://yeoman.io/) is, it's a tool for scaffolding or bootstrapping projects. So someone creates a \"generator\" which when ran might ask you a few questions (like \"Would you like to use JavaScript or CoffeeScript?\") and then spit out a skeleton project for you. There are thousands of Yeoman generators out there for all sorts of apps, [take a look](http://yeoman.io/generators/).\n\nLet's say you create a lot of similar projects or even directories within a project and you'd like to have a template for that so you can quickly generate it as you go. Well, you could learn the Yeoman API but everything Yeoman does is already doable with Gulp, so why not just use Gulp plugins? You can easily copy files, prompt the user, and so on. Well that's what [Slush](http://slushjs.github.io/) is; \"The streaming scaffolding system. Gulp as a replacement for Yeoman.\"\n\nIt's really easy to create a Slush generator. A Slush generator is just a globally installed module with a `slushfile` (which is just a gulpfile). Here's a very simple one:\n\n```javascript\nvar gulp = require('gulp');\n\ngulp.task('default', function() {\n  gulp.src(_dirname + '/**/*')\n    .pipe(gulp.dest('./'));\n});\n```\n\nThis just copies all files in the generator's directory to the user's current directory. Notice that you need to use `__dirname` when pointing to files within the generator.\n\nTo use this generation is must be named something like `slush-something` and `slush` itself must also be installed globally. Then running `slush something` will run your generator (i.e. call the `slush-something` generator's slushfile).\n\nThere are very few Slush generators in comparison to Yeoman, so if you're looking for a Slush generator, then maybe stick to Yeoman (for now), but if you're writing one, I'd suggest using Slush. Why not kill two birds with the one API?\n\n### #10: gulp-grunt\n\nIf you're still using Grunt (poor you!) then the [`gulp-grunt`](https://github.com/gratimax/gulp-grunt) gulp plugin can help you transition bit by bit to Gulp. This plugin allows you to run your Grunt tasks from Gulp and even have your Gulp tasks depend on Grunt tasks. If you want to know, [gulp-grunt's comprehensive readme](https://github.com/gratimax/gulp-grunt) has you covered.\n",unfilteredRenderedBody:'<h2><a id="10-things-to-know-about-gulp" class="post-header-anchor" href="#10-things-to-know-about-gulp" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>10 things to know about Gulp</h2>\n<p><img src="/images/blog-content/10-things-to-know-about-gulp/gulp.png" alt=""></p>\n<article-summary><p>I love <a href="http://gulpjs.com/" rel="noopener">Gulp</a>. It’s great in so many ways and for so many purposes. I’ve been putting off writing a post on it forever. There’s just too much to write about; I could write a book on it. So instead, I’m going to give a quick introduction and share a few tips.</p>\n</article-summary><p>Never heard of Gulp? It’s a build system or task runner like Maven, Ant, Grunt, and so on, except much much better. A few other key points:</p>\n<ul>\n<li>Based on Node.js streams.</li>\n<li>Aims to avoid writing to disk unnecessarily for performance.</li>\n<li>The API is really simple. There are four methods.</li>\n<li>Code is favoured over configuration.</li>\n<li>It’s really intuitive. You take some files, you do this, that, and that other thing to them, and then store them somewhere.</li>\n<li>Plugins are really simple and easy to use.</li>\n<li>Takes advantage of existing modules on npm (which has now reached over 200,000 modules by the way), but more about that later.</li>\n</ul>\n<p>I’m unlucky enough to have had experience with a host of build systems. My introduction to Gulp happened not long after I joined Teamwork when it was added to one project to begin with. I’ve latched onto it ever since. Now, Gulp is used in every project here for all sorts. I’ve even written and contributed to a lot of Gulp plugins / Gulp-friendly modules, beginning with <a href="https://github.com/BlessCSS/gulp-bless" rel="noopener">gulp-bless</a>. It’s really easy! Most Gulp plugins have one source file, less than a hundred lines long.</p>\n<p>If you’d like to get up to speed with Gulp, make sure to read <a href="https://css-tricks.com/gulp-for-beginners/" rel="noopener">Gulp for Beginners</a> by Zell Liew (and there’s more where that came from; his <a href="http://automateyourworkflow.com/" rel="noopener">Automate Your Workflow</a> book). Now, onto some tips.</p>\n<h3><a id="1-gulp-doesnt-just-compile--minify-assets" class="post-header-anchor" href="#1-gulp-doesnt-just-compile--minify-assets" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#1: Gulp doesn’t just compile &amp; minify assets</h3>\n<p>Don’t get me wrong, there are some great plugins for the frontend (shout out to <a href="https://github.com/sindresorhus/gulp-autoprefixer" rel="noopener">gulp-autoprefixer</a>), but that’s not all the Gulp community has to offer. Pretty much anything you can think of; there’s a plugin for that. Some other uses we’ve found for Gulp include:</p>\n<ul>\n<li>Building desktop apps from Web apps, signing executables, etc.</li>\n<li>Linting, validation and analysis.</li>\n<li>Deploying over FTP, to AWS S3, GitHub pages, etc.</li>\n<li>Generating documentation.</li>\n<li>Static site generation.</li>\n<li>And a lot lot more.</li>\n</ul>\n<h3><a id="2-gulpdest-isnt-the-end" class="post-header-anchor" href="#2-gulpdest-isnt-the-end" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#2: <code>gulp.dest</code> isn’t the end</h3>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> rename <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-rename\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'*.md\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./another\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      extname<span class="token punctuation">:</span> <span class="token string">\'.txt\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./yet-another\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is a simple but noteworthy one as it\'s not immediately obvious to everyone. You can save files to disk as many times as you\'d like in a pipeline.</p>\n<h3><a id="3-clean-up-that-gulpfile" class="post-header-anchor" href="#3-clean-up-that-gulpfile" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#3: Clean up that gulpfile</h3>\n<p>Despite how very very simple it is, <code>gulp-load-plugins</code> has to be my favourite Gulp plugin. Since <s>&quot;no one plugin should have all that power&quot;</s> Gulp plugins do one thing and one thing well, it\'s easy to end up with an uncomfortable amount of <code>require</code>s at the top of your gulpfile.</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./input/*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">,</span> <span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>gulp-load-plugins</code> makes all of your plugins (i.e. anything named <code>gulp-*</code> in your <code>package.json</code>) available to you to as properties of the single object. This has a great side-effect in that for a plugin to be usable at all, for anyone, it must be in your <code>package.json</code>. This removes the opportunity for someone to install a plugin (like <code>npm install gulp-filter</code>) forgetting the <code>--save-dev</code> flag (resulting in it working for them but not the next person on the team to pull their changes and npm install).</p>\n<h3><a id="4-bend-the-stream-to-your-will" class="post-header-anchor" href="#4-bend-the-stream-to-your-will" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#4: Bend the stream to your will</h3>\n<p>You\'ll inevitably need a bit of flexibility in your tasks. For example, you might want to apply some manipulations exclusively to a subset of files within the stream;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token keyword">var</span> pngFilter <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">\'*.png\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./images/*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output/images\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>pngFilter<span class="token punctuation">)</span>\n    <span class="token comment">// ...</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output/raster\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>pngFilter<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>\n      <span class="token keyword">return</span> file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">...</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output/other\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>gulp-filter</code> accepts a single glob, an array of globs or a function which returns a Boolean (in case your step depends on properties of the files coming down the pipeline). As you can see above, you can use multiple filters per pipeline and even restore (or undo) the filter at any point.</p>\n<p><code>gulp-if</code> is similar but not the same. It accepts a &quot;condition&quot; in the form of a Boolean or a function which returns one (like <code>gulp-filter</code>). The other two parameters are reserved for the postive and (optional) negative outcomes.</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> <span class="token function-variable function">isLong</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span>isLong<span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output2\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is particularly handy when paired with runtime flags and the <code>gulp-util</code> module. Using the following example, passing <code>--mode production</code> will result in the images being compressed before being copied to the <code>output</code> directory. This is useful for skipping over time-consuming steps.</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> isProductionMode <span class="token operator">=</span> $<span class="token punctuation">.</span>util<span class="token punctuation">.</span>argvs<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./*.png\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span>isProductionMode<span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>What if this all goes wrong? Stick in a call to <code>gulp-debug</code> anywhere to see which files are coming down the stream then and there;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./abc/**/*.png\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'Before filter\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">\'*@2x.png\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'After filter\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>gulp-debug</code> will then log varying levels of details about the files to the console depending on the options you pass to it.</p>\n<h3><a id="5-theres-more-to-gulp-than-gulp-plugins" class="post-header-anchor" href="#5-theres-more-to-gulp-than-gulp-plugins" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#5: There\'s more to Gulp than Gulp plugins</h3>\n<p>One of the best things about Gulp is that you can use whichever modules you\'d like in your tasks. There are a lot of &quot;Gulp friendly&quot; modules out there on <a href="https://www.npmjs.com/" rel="noopener">npm</a> which support streams and Gulp\'s <code>vinyl</code> files. Even if a module doesn\'t, you can do whatever you\'d like within a task anyway, you just won\'t be able to easily pipe to/from it in a pipeline. Here are some of our favourite modules which aren\'t named <code>gulp-*</code>:</p>\n<ul>\n<li><a href="http://browsersync.io/" rel="noopener"><code>browser-sync</code></a>:\n<ul>\n<li>Quickly spin up a little local server to serve your files for testing.</li>\n<li>Sync clicks, scrolls, and more across browsers.</li>\n<li>Watch files and inject changes on the fly.</li>\n<li>Essential for testing responsive designs.</li>\n</ul>\n</li>\n<li><a href="https://github.com/addyosmani/critical" rel="noopener"><code>critical</code></a>: Extract &amp; inline critical-path CSS in HTML pages.</li>\n<li><a href="https://github.com/nwjs/nw-builder" rel="noopener"><code>nw-builder</code></a>: Generate executables from <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> apps.</li>\n<li><a href="https://github.com/SBoudrias/Inquirer.js/" rel="noopener"><code>inquirer</code></a>: <em>The</em> module for prompting the user for input, validating input, etc.</li>\n<li><a href="https://github.com/ck86/main-bower-files" rel="noopener"><code>main-bower-files</code></a>: Parses your <code>bower.json</code> and gives you a list of your dependencies <code>main</code> files.</li>\n</ul>\n<h3><a id="6-gulpfilecoffee" class="post-header-anchor" href="#6-gulpfilecoffee" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#6: <code>gulpfile.coffee</code></h3>\n<pre><code class="language-coffeescript">gulp <span class="token operator">=</span> require <span class="token string">\'gulp\'</span>\n$ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nisProductionMode <span class="token operator">=</span> $<span class="token punctuation">.</span>util<span class="token punctuation">.</span>argvs<span class="token punctuation">.</span>mode <span class="token keyword">is</span> <span class="token string">\'production\'</span>\n\ngulp<span class="token punctuation">.</span>task <span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">></span>\n  gulp<span class="token punctuation">.</span>src <span class="token string">\'./*.png\'</span>\n    <span class="token punctuation">.</span>pipe $<span class="token punctuation">.</span><span class="token keyword">if</span> isProductionMode<span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span>pipe gulp<span class="token punctuation">.</span>dest <span class="token string">\'./output\'</span>\n</code></pre>\n<p>Gulp supports CoffeeScript since version 3.7. Once you <code>npm install --save-dev coffee-script</code> in the same directory as your gulpfile, you can have a <code>gulpfile.coffee</code> intead of a <code>gulpfile.js</code> and everything will work as normal.</p>\n<h3><a id="7-more-accurate-timing" class="post-header-anchor" href="#7-more-accurate-timing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#7: More accurate timing</h3>\n<p>Gulp logs whenever a task starts, when it finishes, and how long it took. Gulp is fast, but it\'s easy to be fooled into thinking it\'s faster than it is if you have asynchronous code in a task. Take this gulpfile for example:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Default is running...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So our <code>default</code> task does some logging but first has a dependency on an <code>images</code> task does some logging after three seconds. If you were to run <code>gulp</code>, you\'d see something like this:</p>\n<pre><code>Starting \'images\'...\n[22:21:07] Finished \'images\' after 465 μs\n[22:21:07] Starting \'default\'...\n[22:21:07] Default is running...\n[22:21:07] Finished \'default\' after 70 ms\n[22:21:10] Tada! Images is really done.\n</code></pre>\n<p>Wait, the <code>default</code> task starts before the <code>images</code> task logs its message? Note we\'re also being told <code>images</code> only took 465 micro-seconds. There are three ways we can fix this.</p>\n<p>One way is to return a reliable stream, but that doesn\'t apply here so we\'ll move on. Quick side note: if you are using a gulpfile.coffee like mentioned above, CoffeeScript\'s implicit return (i.e. the last line of every function becomes a <code>return</code> statement when compiled) which could help tighten us task timings without you realising it.</p>\n<p>One way to solve this is to use the task\'s callback argument like this:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Default is running...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note, <code>done</code> can only be called once per task and it can also be called with an <code>Error</code> which will end the task appropriately. The output would now be something like the following:</p>\n<pre><code>[22:31:19] Starting \'images\'...\n[22:31:22] Tada! Images is really done.\n[22:31:22] Finished \'images\' after 3.07 s\n[22:31:22] Starting \'default\'...\n[22:31:22] Default is running...\n[22:31:22] Finished \'default\' after 653 μs\n</code></pre>\n<p>3.07 seconds, that\'s more like it. Gulp also supports promises in tasks and that\'s the other way we can solve it;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'es6-promise\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Promise<span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Default is running...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note: calling <code>reject</code> anywhere in the task with an <code>Error</code> would be just like calling the <code>done</code> callback with one.</p>\n<h3><a id="8-flatten-task-dependencies-for-concurrency" class="post-header-anchor" href="#8-flatten-task-dependencies-for-concurrency" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#8: Flatten task dependencies for concurrency</h3>\n<p>Don\'t group task dependencies by purpose, even though that might make most sense initially. Gulp uses Orchestrator underneath, which is described as &quot;a module for sequencing and executing tasks and dependencies in maximum concurrency.&quot; Dependencies are ran in parallel, as much as your dependency graph permits. So, what you really should do is try to flatten that graph as much as possible.</p>\n<p>If you had these tasks for example:</p>\n<pre><code class="language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'frontend\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'frontend\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'styles\'</span><span class="token punctuation">,</span> <span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token string">\'templates\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'styles\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token string">\'bundle-b\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-b\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'templates\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'styles\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>There are a few problems here, but look at how <code>templates</code> depends on <code>styles</code>. This means that all of <code>styles</code> need to finish before <code>templates</code> can run, even though it might actually only depend on <code>inline-above-fold-styles</code> for example. The first change here that I\'d make is to remove the <code>styles</code> task altogether and have <code>templates</code> depend directly on <code>inline-above-fold-styles</code>;</p>\n<pre><code class="language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token string">\'templates\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token string">\'bundle-b\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-b\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'templates\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So yeah, remove any tasks there for decoration and flatten the dependency graph as much as possible.</p>\n<h3><a id="9-forget-about-yeoman" class="post-header-anchor" href="#9-forget-about-yeoman" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#9: Forget about Yeoman</h3>\n<p>Ok, that heading is pure sensationalism. If you don\'t know <a href="http://yeoman.io/" rel="noopener">Yeoman</a> is, it\'s a tool for scaffolding or bootstrapping projects. So someone creates a &quot;generator&quot; which when ran might ask you a few questions (like &quot;Would you like to use JavaScript or CoffeeScript?&quot;) and then spit out a skeleton project for you. There are thousands of Yeoman generators out there for all sorts of apps, <a href="http://yeoman.io/generators/" rel="noopener">take a look</a>.</p>\n<p>Let\'s say you create a lot of similar projects or even directories within a project and you\'d like to have a template for that so you can quickly generate it as you go. Well, you could learn the Yeoman API but everything Yeoman does is already doable with Gulp, so why not just use Gulp plugins? You can easily copy files, prompt the user, and so on. Well that\'s what <a href="http://slushjs.github.io/" rel="noopener">Slush</a> is; &quot;The streaming scaffolding system. Gulp as a replacement for Yeoman.&quot;</p>\n<p>It\'s really easy to create a Slush generator. A Slush generator is just a globally installed module with a <code>slushfile</code> (which is just a gulpfile). Here\'s a very simple one:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>_dirname <span class="token operator">+</span> <span class="token string">\'/**/*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This just copies all files in the generator\'s directory to the user\'s current directory. Notice that you need to use <code>__dirname</code> when pointing to files within the generator.</p>\n<p>To use this generation is must be named something like <code>slush-something</code> and <code>slush</code> itself must also be installed globally. Then running <code>slush something</code> will run your generator (i.e. call the <code>slush-something</code> generator\'s slushfile).</p>\n<p>There are very few Slush generators in comparison to Yeoman, so if you\'re looking for a Slush generator, then maybe stick to Yeoman (for now), but if you\'re writing one, I\'d suggest using Slush. Why not kill two birds with the one API?</p>\n<h3><a id="10-gulp-grunt" class="post-header-anchor" href="#10-gulp-grunt" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#10: gulp-grunt</h3>\n<p>If you\'re still using Grunt (poor you!) then the <a href="https://github.com/gratimax/gulp-grunt" rel="noopener"><code>gulp-grunt</code></a> gulp plugin can help you transition bit by bit to Gulp. This plugin allows you to run your Grunt tasks from Gulp and even have your Gulp tasks depend on Grunt tasks. If you want to know, <a href="https://github.com/gratimax/gulp-grunt" rel="noopener">gulp-grunt\'s comprehensive readme</a> has you covered.</p>\n',attributes:{date:"2015-11-24T00:00:00.000Z",summary:"NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/10-things-to-know-about-gulp-2e99176f9c74"},tags:[{id:"gulp",name:"gulp"},{id:"build",name:"build"},{id:"build-system",name:"build system"},{id:"javascript",name:"javascript"},{id:"nodejs",name:"node.js"},{id:"development",name:"development"}],title:"10 things to know about Gulp",updated_at:"2019-05-22T08:25:22.460Z",photo:"/images/blog-content/10-things-to-know-about-gulp/gulp.png"},title:"10 things to know about Gulp",renderedSummary:"<p>NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.</p>\n",rendered:'<h2><a id="10-things-to-know-about-gulp" class="post-header-anchor" href="#10-things-to-know-about-gulp" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>10 things to know about Gulp</h2>\n<p><img src="/images/blog-content/10-things-to-know-about-gulp/gulp.png" alt=""></p>\n<p>I love <a href="http://gulpjs.com/" rel="noopener">Gulp</a>. It’s great in so many ways and for so many purposes. I’ve been putting off writing a post on it forever. There’s just too much to write about; I could write a book on it. So instead, I’m going to give a quick introduction and share a few tips.</p>\n<p>Never heard of Gulp? It’s a build system or task runner like Maven, Ant, Grunt, and so on, except much much better. A few other key points:</p>\n<ul>\n<li>Based on Node.js streams.</li>\n<li>Aims to avoid writing to disk unnecessarily for performance.</li>\n<li>The API is really simple. There are four methods.</li>\n<li>Code is favoured over configuration.</li>\n<li>It’s really intuitive. You take some files, you do this, that, and that other thing to them, and then store them somewhere.</li>\n<li>Plugins are really simple and easy to use.</li>\n<li>Takes advantage of existing modules on npm (which has now reached over 200,000 modules by the way), but more about that later.</li>\n</ul>\n<p>I’m unlucky enough to have had experience with a host of build systems. My introduction to Gulp happened not long after I joined Teamwork when it was added to one project to begin with. I’ve latched onto it ever since. Now, Gulp is used in every project here for all sorts. I’ve even written and contributed to a lot of Gulp plugins / Gulp-friendly modules, beginning with <a href="https://github.com/BlessCSS/gulp-bless" rel="noopener">gulp-bless</a>. It’s really easy! Most Gulp plugins have one source file, less than a hundred lines long.</p>\n<p>If you’d like to get up to speed with Gulp, make sure to read <a href="https://css-tricks.com/gulp-for-beginners/" rel="noopener">Gulp for Beginners</a> by Zell Liew (and there’s more where that came from; his <a href="http://automateyourworkflow.com/" rel="noopener">Automate Your Workflow</a> book). Now, onto some tips.</p>\n<h3><a id="1-gulp-doesnt-just-compile--minify-assets" class="post-header-anchor" href="#1-gulp-doesnt-just-compile--minify-assets" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#1: Gulp doesn’t just compile &amp; minify assets</h3>\n<p>Don’t get me wrong, there are some great plugins for the frontend (shout out to <a href="https://github.com/sindresorhus/gulp-autoprefixer" rel="noopener">gulp-autoprefixer</a>), but that’s not all the Gulp community has to offer. Pretty much anything you can think of; there’s a plugin for that. Some other uses we’ve found for Gulp include:</p>\n<ul>\n<li>Building desktop apps from Web apps, signing executables, etc.</li>\n<li>Linting, validation and analysis.</li>\n<li>Deploying over FTP, to AWS S3, GitHub pages, etc.</li>\n<li>Generating documentation.</li>\n<li>Static site generation.</li>\n<li>And a lot lot more.</li>\n</ul>\n<h3><a id="2-gulpdest-isnt-the-end" class="post-header-anchor" href="#2-gulpdest-isnt-the-end" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#2: <code>gulp.dest</code> isn’t the end</h3>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> rename <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-rename\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'*.md\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./another\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      extname<span class="token punctuation">:</span> <span class="token string">\'.txt\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./yet-another\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is a simple but noteworthy one as it\'s not immediately obvious to everyone. You can save files to disk as many times as you\'d like in a pipeline.</p>\n<h3><a id="3-clean-up-that-gulpfile" class="post-header-anchor" href="#3-clean-up-that-gulpfile" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#3: Clean up that gulpfile</h3>\n<p>Despite how very very simple it is, <code>gulp-load-plugins</code> has to be my favourite Gulp plugin. Since <s>&quot;no one plugin should have all that power&quot;</s> Gulp plugins do one thing and one thing well, it\'s easy to end up with an uncomfortable amount of <code>require</code>s at the top of your gulpfile.</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./input/*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">,</span> <span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>gulp-load-plugins</code> makes all of your plugins (i.e. anything named <code>gulp-*</code> in your <code>package.json</code>) available to you to as properties of the single object. This has a great side-effect in that for a plugin to be usable at all, for anyone, it must be in your <code>package.json</code>. This removes the opportunity for someone to install a plugin (like <code>npm install gulp-filter</code>) forgetting the <code>--save-dev</code> flag (resulting in it working for them but not the next person on the team to pull their changes and npm install).</p>\n<h3><a id="4-bend-the-stream-to-your-will" class="post-header-anchor" href="#4-bend-the-stream-to-your-will" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#4: Bend the stream to your will</h3>\n<p>You\'ll inevitably need a bit of flexibility in your tasks. For example, you might want to apply some manipulations exclusively to a subset of files within the stream;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token keyword">var</span> pngFilter <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">\'*.png\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./images/*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output/images\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>pngFilter<span class="token punctuation">)</span>\n    <span class="token comment">// ...</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output/raster\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>pngFilter<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>\n      <span class="token keyword">return</span> file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">...</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output/other\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>gulp-filter</code> accepts a single glob, an array of globs or a function which returns a Boolean (in case your step depends on properties of the files coming down the pipeline). As you can see above, you can use multiple filters per pipeline and even restore (or undo) the filter at any point.</p>\n<p><code>gulp-if</code> is similar but not the same. It accepts a &quot;condition&quot; in the form of a Boolean or a function which returns one (like <code>gulp-filter</code>). The other two parameters are reserved for the postive and (optional) negative outcomes.</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> <span class="token function-variable function">isLong</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> file<span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span>isLong<span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output2\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This is particularly handy when paired with runtime flags and the <code>gulp-util</code> module. Using the following example, passing <code>--mode production</code> will result in the images being compressed before being copied to the <code>output</code> directory. This is useful for skipping over time-consuming steps.</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> isProductionMode <span class="token operator">=</span> $<span class="token punctuation">.</span>util<span class="token punctuation">.</span>argvs<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./*.png\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token keyword">if</span><span class="token punctuation">(</span>isProductionMode<span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./output\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>What if this all goes wrong? Stick in a call to <code>gulp-debug</code> anywhere to see which files are coming down the stream then and there;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">\'./abc/**/*.png\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'Before filter\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">\'*@2x.png\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'After filter\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>gulp-debug</code> will then log varying levels of details about the files to the console depending on the options you pass to it.</p>\n<h3><a id="5-theres-more-to-gulp-than-gulp-plugins" class="post-header-anchor" href="#5-theres-more-to-gulp-than-gulp-plugins" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#5: There\'s more to Gulp than Gulp plugins</h3>\n<p>One of the best things about Gulp is that you can use whichever modules you\'d like in your tasks. There are a lot of &quot;Gulp friendly&quot; modules out there on <a href="https://www.npmjs.com/" rel="noopener">npm</a> which support streams and Gulp\'s <code>vinyl</code> files. Even if a module doesn\'t, you can do whatever you\'d like within a task anyway, you just won\'t be able to easily pipe to/from it in a pipeline. Here are some of our favourite modules which aren\'t named <code>gulp-*</code>:</p>\n<ul>\n<li><a href="http://browsersync.io/" rel="noopener"><code>browser-sync</code></a>:\n<ul>\n<li>Quickly spin up a little local server to serve your files for testing.</li>\n<li>Sync clicks, scrolls, and more across browsers.</li>\n<li>Watch files and inject changes on the fly.</li>\n<li>Essential for testing responsive designs.</li>\n</ul>\n</li>\n<li><a href="https://github.com/addyosmani/critical" rel="noopener"><code>critical</code></a>: Extract &amp; inline critical-path CSS in HTML pages.</li>\n<li><a href="https://github.com/nwjs/nw-builder" rel="noopener"><code>nw-builder</code></a>: Generate executables from <a href="https://github.com/nwjs/nw.js" rel="noopener">NW.js</a> apps.</li>\n<li><a href="https://github.com/SBoudrias/Inquirer.js/" rel="noopener"><code>inquirer</code></a>: <em>The</em> module for prompting the user for input, validating input, etc.</li>\n<li><a href="https://github.com/ck86/main-bower-files" rel="noopener"><code>main-bower-files</code></a>: Parses your <code>bower.json</code> and gives you a list of your dependencies <code>main</code> files.</li>\n</ul>\n<h3><a id="6-gulpfilecoffee" class="post-header-anchor" href="#6-gulpfilecoffee" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#6: <code>gulpfile.coffee</code></h3>\n<pre><code class="language-coffeescript">gulp <span class="token operator">=</span> require <span class="token string">\'gulp\'</span>\n$ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nisProductionMode <span class="token operator">=</span> $<span class="token punctuation">.</span>util<span class="token punctuation">.</span>argvs<span class="token punctuation">.</span>mode <span class="token keyword">is</span> <span class="token string">\'production\'</span>\n\ngulp<span class="token punctuation">.</span>task <span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">></span>\n  gulp<span class="token punctuation">.</span>src <span class="token string">\'./*.png\'</span>\n    <span class="token punctuation">.</span>pipe $<span class="token punctuation">.</span><span class="token keyword">if</span> isProductionMode<span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span>pipe gulp<span class="token punctuation">.</span>dest <span class="token string">\'./output\'</span>\n</code></pre>\n<p>Gulp supports CoffeeScript since version 3.7. Once you <code>npm install --save-dev coffee-script</code> in the same directory as your gulpfile, you can have a <code>gulpfile.coffee</code> intead of a <code>gulpfile.js</code> and everything will work as normal.</p>\n<h3><a id="7-more-accurate-timing" class="post-header-anchor" href="#7-more-accurate-timing" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#7: More accurate timing</h3>\n<p>Gulp logs whenever a task starts, when it finishes, and how long it took. Gulp is fast, but it\'s easy to be fooled into thinking it\'s faster than it is if you have asynchronous code in a task. Take this gulpfile for example:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Default is running...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So our <code>default</code> task does some logging but first has a dependency on an <code>images</code> task does some logging after three seconds. If you were to run <code>gulp</code>, you\'d see something like this:</p>\n<pre><code>Starting \'images\'...\n[22:21:07] Finished \'images\' after 465 μs\n[22:21:07] Starting \'default\'...\n[22:21:07] Default is running...\n[22:21:07] Finished \'default\' after 70 ms\n[22:21:10] Tada! Images is really done.\n</code></pre>\n<p>Wait, the <code>default</code> task starts before the <code>images</code> task logs its message? Note we\'re also being told <code>images</code> only took 465 micro-seconds. There are three ways we can fix this.</p>\n<p>One way is to return a reliable stream, but that doesn\'t apply here so we\'ll move on. Quick side note: if you are using a gulpfile.coffee like mentioned above, CoffeeScript\'s implicit return (i.e. the last line of every function becomes a <code>return</code> statement when compiled) which could help tighten us task timings without you realising it.</p>\n<p>One way to solve this is to use the task\'s callback argument like this:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Default is running...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note, <code>done</code> can only be called once per task and it can also be called with an <code>Error</code> which will end the task appropriately. The output would now be something like the following:</p>\n<pre><code>[22:31:19] Starting \'images\'...\n[22:31:22] Tada! Images is really done.\n[22:31:22] Finished \'images\' after 3.07 s\n[22:31:22] Starting \'default\'...\n[22:31:22] Default is running...\n[22:31:22] Finished \'default\' after 653 μs\n</code></pre>\n<p>3.07 seconds, that\'s more like it. Gulp also supports promises in tasks and that\'s the other way we can solve it;</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-load-plugins\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'es6-promise\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Promise<span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Tada! Images is really done."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  $<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Default is running...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Note: calling <code>reject</code> anywhere in the task with an <code>Error</code> would be just like calling the <code>done</code> callback with one.</p>\n<h3><a id="8-flatten-task-dependencies-for-concurrency" class="post-header-anchor" href="#8-flatten-task-dependencies-for-concurrency" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#8: Flatten task dependencies for concurrency</h3>\n<p>Don\'t group task dependencies by purpose, even though that might make most sense initially. Gulp uses Orchestrator underneath, which is described as &quot;a module for sequencing and executing tasks and dependencies in maximum concurrency.&quot; Dependencies are ran in parallel, as much as your dependency graph permits. So, what you really should do is try to flatten that graph as much as possible.</p>\n<p>If you had these tasks for example:</p>\n<pre><code class="language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'frontend\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'frontend\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'styles\'</span><span class="token punctuation">,</span> <span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token string">\'templates\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'styles\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token string">\'images\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token string">\'bundle-b\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-b\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'templates\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'styles\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>There are a few problems here, but look at how <code>templates</code> depends on <code>styles</code>. This means that all of <code>styles</code> need to finish before <code>templates</code> can run, even though it might actually only depend on <code>inline-above-fold-styles</code> for example. The first change here that I\'d make is to remove the <code>styles</code> task altogether and have <code>templates</code> depend directly on <code>inline-above-fold-styles</code>;</p>\n<pre><code class="language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token string">\'templates\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'css\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'scripts\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token string">\'bundle-b\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-a\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'bundle-b\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'images\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'templates\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'inline-above-fold-styles\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>So yeah, remove any tasks there for decoration and flatten the dependency graph as much as possible.</p>\n<h3><a id="9-forget-about-yeoman" class="post-header-anchor" href="#9-forget-about-yeoman" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#9: Forget about Yeoman</h3>\n<p>Ok, that heading is pure sensationalism. If you don\'t know <a href="http://yeoman.io/" rel="noopener">Yeoman</a> is, it\'s a tool for scaffolding or bootstrapping projects. So someone creates a &quot;generator&quot; which when ran might ask you a few questions (like &quot;Would you like to use JavaScript or CoffeeScript?&quot;) and then spit out a skeleton project for you. There are thousands of Yeoman generators out there for all sorts of apps, <a href="http://yeoman.io/generators/" rel="noopener">take a look</a>.</p>\n<p>Let\'s say you create a lot of similar projects or even directories within a project and you\'d like to have a template for that so you can quickly generate it as you go. Well, you could learn the Yeoman API but everything Yeoman does is already doable with Gulp, so why not just use Gulp plugins? You can easily copy files, prompt the user, and so on. Well that\'s what <a href="http://slushjs.github.io/" rel="noopener">Slush</a> is; &quot;The streaming scaffolding system. Gulp as a replacement for Yeoman.&quot;</p>\n<p>It\'s really easy to create a Slush generator. A Slush generator is just a globally installed module with a <code>slushfile</code> (which is just a gulpfile). Here\'s a very simple one:</p>\n<pre><code class="language-javascript"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>_dirname <span class="token operator">+</span> <span class="token string">\'/**/*\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">\'./\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>This just copies all files in the generator\'s directory to the user\'s current directory. Notice that you need to use <code>__dirname</code> when pointing to files within the generator.</p>\n<p>To use this generation is must be named something like <code>slush-something</code> and <code>slush</code> itself must also be installed globally. Then running <code>slush something</code> will run your generator (i.e. call the <code>slush-something</code> generator\'s slushfile).</p>\n<p>There are very few Slush generators in comparison to Yeoman, so if you\'re looking for a Slush generator, then maybe stick to Yeoman (for now), but if you\'re writing one, I\'d suggest using Slush. Why not kill two birds with the one API?</p>\n<h3><a id="10-gulp-grunt" class="post-header-anchor" href="#10-gulp-grunt" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>#10: gulp-grunt</h3>\n<p>If you\'re still using Grunt (poor you!) then the <a href="https://github.com/gratimax/gulp-grunt" rel="noopener"><code>gulp-grunt</code></a> gulp plugin can help you transition bit by bit to Gulp. This plugin allows you to run your Grunt tasks from Gulp and even have your Gulp tasks depend on Grunt tasks. If you want to know, <a href="https://github.com/gratimax/gulp-grunt" rel="noopener">gulp-grunt\'s comprehensive readme</a> has you covered.</p>\n',summary:"NW.js is great for creating desktop applications using Web app technologies. If you're not familiar with NW.js, I'd advise you to read an introductory article like Creating Your First Desktop App With HTML, JS and Node-WebKit to get a good base first. This is a slightly more advanced article intended for anyone interested into distributing their NW.js app to Windows users.\n",original:{blogLink:"https://engineroom.teamwork.com",blogName:"Teamwork's Engine Room",url:"https://engineroom.teamwork.com/10-things-to-know-about-gulp-2e99176f9c74"},photo:"/images/blog-content/10-things-to-know-about-gulp/gulp.png",keywords:["gulp","build","build system","javascript","node.js","development"],published_at:"2015-11-24T00:00:00.000Z",updated_at:"2019-05-22T08:25:22.460Z",year:2015,month:11,day:25,relevanceScore:1.25,moreArticles:[{id:"flexible-data-tables-with-css-grid",slug:"flexible-data-tables-with-css-grid",highlightedLanguages:["css"],source:'---\ndate: 2019-05-12\ntags:\n  - css grid\n  - css\n  - javascript\n  - table\n  - data\n  - responsive design\n  - responsive\n  - flexbox\n  - resize column\n  - web app\n  - development\n  - crm\n  - sales\n---\n\n## Flexible data tables with CSS Grid\n\n::: summary\n\nNow that we\'ve launched, I can finally talk about the secret project I\'ve been working on for the last two years. One interesting piece of the [Teamwork CRM](https://www.teamwork.com/crm) puzzle was the "list view". \n\nIt\'s a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won\'t bore you. I\'ll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.\n\n:::\n\n\nFirst, I need to give some more context, starting with the purpose and design goals of these screens. Feel free to [skip to the CSS Grid bit](#just-get-to-css-grid-already).\n\n:::figure flexible-data-tables-with-css-grid/wide3.png The leads list view.\n:::\n\nPrimarily it allows salespeople to scan a list of items like their leads or contacts, and find anything important they need to take action on. It\'s not like an Excel spreadsheet — we can do a better job at laying out the data, which there will be a lot of.\n\nEverything we do is responsively designed. We start with the most narrow / constrained variant first and tweak the layout based on content, design, use cases (we don\'t have device-orientated breakpoints). \n\nAt its most minimal, the columns are stacked vertically within rows, spanning the full width of the screen. \n\n:::figure flexible-data-tables-with-css-grid/narrow.png What a list view looks like on a narrow screen.\n:::\n\nResponsive tables are tricky. There are [several existing patterns](https://bradfrost.github.io/this-is-responsive/patterns.html) you could pick from. Consider what your users are trying to achieve and choose wisely. \n\nOnce we have enough pixels in our canvas to play with, we switch to a more typical table layout such that the columns are... well, columns. There are no major layout changes beyond this point but we still want to display the columns as best as we can for the salesperson viewing it.\n\nAssume there are a lot of columns (we\'ll look at how the user can configure the columns in more detail later). The table should fill the width of the screen (at least). Column widths then should be determined by their content and the type of values they contain; e.g. short / long text, date, number, URL, etc. Date columns should take up less room than long text columns. \n\nColumns must have a minimum width and therefore only so many can fit into the viewport. As a result this table will be vertically and horizontally scrollable for a lot of salespeople.\n\n:::figure flexible-data-tables-with-css-grid/resizing-window.gif How the layout varies per window width. Sorry the GIF is a bit janky, I provide some interactive examples below.\n:::\n\nTo begin with, we lay the table out as best we can using regular old-school table-layout CSS. Next, I\'ll show you how we enhance it with CSS Grid. Following that, how we leverage Grid to allow users to resize columns, which would be a lot more awkward with regular table-layout CSS.\n\n## Just get to CSS Grid already\n\nI\'m no CSS Grid expert but I love it. It\'s extremely powerful and simple, allowing you to implement previously tricky layouts with minute amounts of code. I\'ll skip giving an introduction to Grid in this article. Go read Rachel Andrew\'s [The New CSS Layout](https://abookapart.com/products/the-new-css-layout) or [A Complete Guide to Grid](https://css-tricks.com/snippets/css/complete-guide-grid/) and when you\'re done wondering where Grid was all your life, come back to me.\n\nThe first thing we do is apply `display: grid` to the `<table>` to make it a grid. This won\'t break anything if the browser doesn\'t support it (it will carry on using `display:table`). Its children become grid items; the `<thead>` and `<tbody>`. It\'s not the `<thead>`, `<tbody>`, or even the `<tr>`s we\'re concerned with though. What we want to do is lay out our `<th>`s and `<td>`s on this grid. We could apply `display: grid` to each of these too (i.e. grids within grids), but that\'s not ideal. Each `<tr>` grid would be independent of others and that\'s not good (you\'ll see later that I had the same problem with Flexbox).\n\nA workaround is to use `display: contents` on the `<thead>`, `<tbody>`, and `<tr>`s. This basically removes the them from the Grid layout, bypassing them, and promotes their children (the `<th>`s and `<td>`s) to participate in the the `<table>` grid instead. \n\nThen we use the magic `grid-template-columns` to control the grid items. Yes, one line of CSS. For example, if we had one date column and one URL column, it might be something like:\n\n```css\ngrid-template-columns: minmax(150px, 1.33fr) minmax(150px, 2.33fr);\n```\n\nWe use the same minimum size for all columns but the max (`fr`) value is determined by the column data type. I tried using Grid\'s`auto` and `max-content` too but what we\'ve ended up with seems to produce the best result.\n\nHere is a simplified example:\n\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="XwKWdG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/XwKWdG/" target="_blank">\n  Flexible data table with CSS Grid</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nYou should <a href="https://codepen.io/adam-lynch/debug/XwKWdG" target="_blank">open it in a new tab</a> as it\'s a bit constrained embedded here like this. Then try resizing the window.\n\n## Resizing columns with Grid\n\nOn top of this, we support reordering, resizing, and toggling which columns are shown. The lists of possible columns are long, including properties of the item (e.g. leads) itself, properties of related items (e.g. the company linked to the lead), and custom fields. \n\nFor example, a user could create a (date) custom field for contacts called "Date of birth" so that can be tracked in the system for each contact. \n\nSince a type like "Date" is selected when creating a custom field, our system already handles custom fields. There\'s more to think about when columns are toggled, but first I need to explain how resizing works.\n\n1. The user hovers over a column header, a resize handle is shown on the right hand side. We\'re listening for `mousedown` on the resize handle.\n2. When the user clicks the handle, we bind some more `mousemove` and `mousedown` event listeners (to the `window`). We also add some classes for decoration at this point.\n3. When the user moves their mouse, we calculate the new column width. This takes the cursor position, the table\'s scroll position, and our minimum into account. Then we re-set the `<table>`\'s `grid-template-columns`s rule (via `style` attribute), this time replacing the max (`fr`) value with a pixel value. For example, `grid-template-columns: minmax(150px, 1.33fr) 296px;`. We do this using `requestAnimationFrame` to keep it as smooth as possible.\n4. When `mouseup` is fired, we unbind event listeners and remove classes.\n\nTry this simplified example (or ideally <a href="https://codepen.io/adam-lynch/pen/GaqgXP" target="_blank">open it in a new tab</a>):\n\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="GaqgXP" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with good UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/GaqgXP/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with good UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nWhat\'s great here is that we only need to update one element in the DOM, not each cell.\n\nWe always build with touch users in mind, but it\'s OK not to support this via touch. It\'s a very precise action. Even if I wanted to resize a column using touch, I\'d probably expect a different interaction, like a multi-touch spread gesture.\n\n## Fixed column widths\n\nYou might have noticed I didn\'t tell the whole truth. Not only do we "fix" the width of the column you\'re resizing, we make all column widths fixed. Maybe you didn\'t even notice, because that\'s exactly how it should work.\n\nI originally thought that users would like that when they stretched or squeezed columns, the other ones could adjust too. If the columns filled the screen width nicely and you make one smaller, one (or some) of the others could grow if they had more content to show. Try this example for yourself below (or ideally <a href="https://codepen.io/adam-lynch/pen/wbWvep" target="_blank">open it in a new tab</a>):\n\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="wbWvep" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with bad UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/wbWvep/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with bad UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p> \n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n\nAfter some user testing, it was clear this is unexpected behaviour. As a user, I feel less in control when there are unpredictable side-effects to my actions. \n\nWe shouldn\'t make assumptions based on which column was or wasn\'t interacted with. When resizing one column, a user could have already made an implicit decision that the rest were perfect.\n\nTherefore, if you open the app for the first time, the columns are laid out as best as possible. If you resize your screen, they resize using the same ratios. Once you touch the resize handler of any column, all of the visible columns become fixed width.\n\n:::figure flexible-data-tables-with-css-grid/resizing-columns.gif Before, during, and after resizing a column. Sorry the GIF is a bit janky.\n:::\n\nOnce someone takes the time to tailor the screen to their needs, we take note. Any time a column is resized or made fixed, we create an independent localStorage entry mapping a column identifier to a pixel value.\n\nI can\'t remember exactly why we decided to set the fixed value using pixels, rather than something more fluid. Maybe it was just to keep it simple. Maybe it\'s because we do actually fall back to using a more archaic approach to setting column widths if Grid and `display: contents` aren\'t supported. You don\'t have to do this, it would have been too important to leave out for our users.\n\nUsing something fluid probably wouldn\'t align with the user\'s intentions anyway. We can\'t assume that making all columns smaller in order to keep more of them in the screen is the most important thing. If they had resized a column, it\'s to see a certain amount of content in that column. If we used a fluid unit, and then they made the screen narrower, we\'d be disregarding the choice they made. They\'d have to resize the column again to see the same content. Users are unlikely to be thinking "Hmm, I want this column to take up 20% of the window even if I resize it". Anyway, users rarely resize windows; I\'m going into too much detail on an edge case here.\n\n## Toggling columns\n\n:::figure flexible-data-tables-with-css-grid/manage-columns.png Our modal for customizing which columns are shown.\n:::\n\nImagine a salesperson has changed the column set using the above modal. If none of the chosen columns have been resized previously, they get laid out using the default `grid-template-column` values depending on their data type. For example, `minmax(150px, 3.33fr)`.\n\nIf any of the columns has a fixed width stored in localStorage, we make *all* of the chosen columns fixed width (and store those widths in localStorage too).\n\nOver time, more and more columns will become fixed. The only way for users to get back to fluid columns is if they were to reset the columns.\n\nWe also store an array of column identifiers in localStorage, separate to the column width entries.\n\n## "Why didn\'t you just use {{ libraryName }}?"\n\nI didn\'t want to just offload the problem to a heavy JavaScript library. It would be heavy, janky, wouldn\'t be responsive, and might not even use `<table>` at all. I also didn\'t want to write something like that myself. There must be a better way, I thought.\n\n## "Why didn\'t you just use Flexbox?"\n\nEach row would be evaluated / spaced independently of each other. A column might not be aligned with the column above it because of varying content length.\n\nI could have switched to `<div>`s representing the column containing the vertically stacked cells within. I didn\'t want to have to do this though. I wanted to use a `<table>`. On top of that, I could have easily ran into issues from the reverse angle anyway, like cells not matching in height across columns.\n\n## "Why didn\'t you just use a `<colgroup>`?"\n\nCheck out [`<colgroup>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup), it\'s a handy old element. Once you define your columns using `<col>`s, styles applied to one will effectively be applied to all of the cells in that column. \n\nIn the end though, it was simply too limited for what I needed to do. It didn\'t take long to realise it was a no-go. So much so, that I can\'t remember exactly what the problems were. I\'m pretty sure it was impossible to achieve the level of fluidity I wanted, and it didn\'t work well with Flexbox or Grid.\n\n## "Why didn\'t you just use table-layout: fixed?"\n\nI could have use `table-layout: fixed` on the `<table>` and set the column widths using percentages. However, from looking at examples and playing around, this only seems to work if the table is 100% in width. Also resizing one column causes the other columns to resize to fill the 100% width.\n\n## "But you could still have used a table!"\n\nYes, tables can do a lot of smart things out of the box, but they can\'t efficiently support everything I wanted to do. Still disagree? OK you wizard, teach me.\n\n## Don\'t go overboard with display: contents\n\n`display:contents` allowed us to keep our table markup. Use it only when you really have to though. There is, or at least were, issues in some browsers around accessibility and how screen readers would read the content. \n\nWe discovered a [strange bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1550728) when combining it with native drag & drop in Firefox.\n\nFortunately, subgrid on the way which will properly allow descendants to participate in grids. Our use case is simple in that we want to effectively flatten the markup but subgrid will open the door for wilder multi-dimensional grid orgies. See [Why display: contents is not CSS Grid Layout subgrid](https://rachelandrew.co.uk/archives/2017/07/20/why-display-contents-is-not-css-grid-layout-subgrid/).\n\n## I\'m probably forgetting something\n\nThere\'s a lot more to this screen. I think there was some text-overflow issue when resizing columns but I can\'t remember anymore. \n\nWe use `position: sticky` to keep the table headers in place as you scroll down. It\'s a lovely enhancement and it degrades nicely. However, we do have a JavaScript fallback for IE11 users. I really wouldn\'t recommend doing that. It\'s tricky to achieve with horizontally scrollable tables.\n\nI didn\'t even touch on all of the features of these list views. Users can apply, save, and share custom filters (e.g. show me leads over $500 or where the contact is in Europe). These column filters can be set to remember the column set you had when you created them, because you might always want to see certain columns for a given workflow.\n\nWe\'ll soon support bulk editing via the list view, as well exporting your tailored view to CSV.\n\nAnyway, thanks for reading.\n',unfilteredRenderedBody:'<h2><a id="flexible-data-tables-with-css-grid" class="post-header-anchor" href="#flexible-data-tables-with-css-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Flexible data tables with CSS Grid</h2>\n<article-summary><p>Now that we\'ve launched, I can finally talk about the secret project I\'ve been working on for the last two years. One interesting piece of the <a href="https://www.teamwork.com/crm" rel="noopener">Teamwork CRM</a> puzzle was the &quot;list view&quot;.</p>\n<p>It\'s a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won\'t bore you. I\'ll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.</p>\n</article-summary><p>First, I need to give some more context, starting with the purpose and design goals of these screens. Feel free to <a href="#just-get-to-css-grid-already">skip to the CSS Grid bit</a>.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png" alt=""/></a>\n          <figcaption><p>The leads list view.</p>\n</figcaption>\n        </figure><p>Primarily it allows salespeople to scan a list of items like their leads or contacts, and find anything important they need to take action on. It\'s not like an Excel spreadsheet — we can do a better job at laying out the data, which there will be a lot of.</p>\n<p>Everything we do is responsively designed. We start with the most narrow / constrained variant first and tweak the layout based on content, design, use cases (we don\'t have device-orientated breakpoints).</p>\n<p>At its most minimal, the columns are stacked vertically within rows, spanning the full width of the screen.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png" alt=""/></a>\n          <figcaption><p>What a list view looks like on a narrow screen.</p>\n</figcaption>\n        </figure><p>Responsive tables are tricky. There are <a href="https://bradfrost.github.io/this-is-responsive/patterns.html" rel="noopener">several existing patterns</a> you could pick from. Consider what your users are trying to achieve and choose wisely.</p>\n<p>Once we have enough pixels in our canvas to play with, we switch to a more typical table layout such that the columns are... well, columns. There are no major layout changes beyond this point but we still want to display the columns as best as we can for the salesperson viewing it.</p>\n<p>Assume there are a lot of columns (we\'ll look at how the user can configure the columns in more detail later). The table should fill the width of the screen (at least). Column widths then should be determined by their content and the type of values they contain; e.g. short / long text, date, number, URL, etc. Date columns should take up less room than long text columns.</p>\n<p>Columns must have a minimum width and therefore only so many can fit into the viewport. As a result this table will be vertically and horizontally scrollable for a lot of salespeople.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif" alt=""/></a>\n          <figcaption><p>How the layout varies per window width. Sorry the GIF is a bit janky, I provide some interactive examples below.</p>\n</figcaption>\n        </figure><p>To begin with, we lay the table out as best we can using regular old-school table-layout CSS. Next, I\'ll show you how we enhance it with CSS Grid. Following that, how we leverage Grid to allow users to resize columns, which would be a lot more awkward with regular table-layout CSS.</p>\n<h2><a id="just-get-to-css-grid-already" class="post-header-anchor" href="#just-get-to-css-grid-already" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Just get to CSS Grid already</h2>\n<p>I\'m no CSS Grid expert but I love it. It\'s extremely powerful and simple, allowing you to implement previously tricky layouts with minute amounts of code. I\'ll skip giving an introduction to Grid in this article. Go read Rachel Andrew\'s <a href="https://abookapart.com/products/the-new-css-layout" rel="noopener">The New CSS Layout</a> or <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" rel="noopener">A Complete Guide to Grid</a> and when you\'re done wondering where Grid was all your life, come back to me.</p>\n<p>The first thing we do is apply <code>display: grid</code> to the <code>&lt;table&gt;</code> to make it a grid. This won\'t break anything if the browser doesn\'t support it (it will carry on using <code>display:table</code>). Its children become grid items; the <code>&lt;thead&gt;</code> and <code>&lt;tbody&gt;</code>. It\'s not the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, or even the <code>&lt;tr&gt;</code>s we\'re concerned with though. What we want to do is lay out our <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s on this grid. We could apply <code>display: grid</code> to each of these too (i.e. grids within grids), but that\'s not ideal. Each <code>&lt;tr&gt;</code> grid would be independent of others and that\'s not good (you\'ll see later that I had the same problem with Flexbox).</p>\n<p>A workaround is to use <code>display: contents</code> on the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, and <code>&lt;tr&gt;</code>s. This basically removes the them from the Grid layout, bypassing them, and promotes their children (the <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s) to participate in the the <code>&lt;table&gt;</code> grid instead.</p>\n<p>Then we use the magic <code>grid-template-columns</code> to control the grid items. Yes, one line of CSS. For example, if we had one date column and one URL column, it might be something like:</p>\n<pre><code class="language-css"><span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 1.33fr<span class="token punctuation">)</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 2.33fr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>We use the same minimum size for all columns but the max (<code>fr</code>) value is determined by the column data type. I tried using Grid\'s<code>auto</code> and <code>max-content</code> too but what we\'ve ended up with seems to produce the best result.</p>\n<p>Here is a simplified example:</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="XwKWdG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/XwKWdG/" target="_blank">\n  Flexible data table with CSS Grid</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>You should <a href="https://codepen.io/adam-lynch/debug/XwKWdG" target="_blank">open it in a new tab</a> as it\'s a bit constrained embedded here like this. Then try resizing the window.</p>\n<h2><a id="resizing-columns-with-grid" class="post-header-anchor" href="#resizing-columns-with-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resizing columns with Grid</h2>\n<p>On top of this, we support reordering, resizing, and toggling which columns are shown. The lists of possible columns are long, including properties of the item (e.g. leads) itself, properties of related items (e.g. the company linked to the lead), and custom fields.</p>\n<p>For example, a user could create a (date) custom field for contacts called &quot;Date of birth&quot; so that can be tracked in the system for each contact.</p>\n<p>Since a type like &quot;Date&quot; is selected when creating a custom field, our system already handles custom fields. There\'s more to think about when columns are toggled, but first I need to explain how resizing works.</p>\n<ol>\n<li>The user hovers over a column header, a resize handle is shown on the right hand side. We\'re listening for <code>mousedown</code> on the resize handle.</li>\n<li>When the user clicks the handle, we bind some more <code>mousemove</code> and <code>mousedown</code> event listeners (to the <code>window</code>). We also add some classes for decoration at this point.</li>\n<li>When the user moves their mouse, we calculate the new column width. This takes the cursor position, the table\'s scroll position, and our minimum into account. Then we re-set the <code>&lt;table&gt;</code>\'s <code>grid-template-columns</code>s rule (via <code>style</code> attribute), this time replacing the max (<code>fr</code>) value with a pixel value. For example, <code>grid-template-columns: minmax(150px, 1.33fr) 296px;</code>. We do this using <code>requestAnimationFrame</code> to keep it as smooth as possible.</li>\n<li>When <code>mouseup</code> is fired, we unbind event listeners and remove classes.</li>\n</ol>\n<p>Try this simplified example (or ideally <a href="https://codepen.io/adam-lynch/pen/GaqgXP" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="GaqgXP" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with good UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/GaqgXP/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with good UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>What\'s great here is that we only need to update one element in the DOM, not each cell.</p>\n<p>We always build with touch users in mind, but it\'s OK not to support this via touch. It\'s a very precise action. Even if I wanted to resize a column using touch, I\'d probably expect a different interaction, like a multi-touch spread gesture.</p>\n<h2><a id="fixed-column-widths" class="post-header-anchor" href="#fixed-column-widths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fixed column widths</h2>\n<p>You might have noticed I didn\'t tell the whole truth. Not only do we &quot;fix&quot; the width of the column you\'re resizing, we make all column widths fixed. Maybe you didn\'t even notice, because that\'s exactly how it should work.</p>\n<p>I originally thought that users would like that when they stretched or squeezed columns, the other ones could adjust too. If the columns filled the screen width nicely and you make one smaller, one (or some) of the others could grow if they had more content to show. Try this example for yourself below (or ideally <a href="https://codepen.io/adam-lynch/pen/wbWvep" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="wbWvep" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with bad UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/wbWvep/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with bad UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p> \n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>After some user testing, it was clear this is unexpected behaviour. As a user, I feel less in control when there are unpredictable side-effects to my actions.</p>\n<p>We shouldn\'t make assumptions based on which column was or wasn\'t interacted with. When resizing one column, a user could have already made an implicit decision that the rest were perfect.</p>\n<p>Therefore, if you open the app for the first time, the columns are laid out as best as possible. If you resize your screen, they resize using the same ratios. Once you touch the resize handler of any column, all of the visible columns become fixed width.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif" alt=""/></a>\n          <figcaption><p>Before, during, and after resizing a column. Sorry the GIF is a bit janky.</p>\n</figcaption>\n        </figure><p>Once someone takes the time to tailor the screen to their needs, we take note. Any time a column is resized or made fixed, we create an independent localStorage entry mapping a column identifier to a pixel value.</p>\n<p>I can\'t remember exactly why we decided to set the fixed value using pixels, rather than something more fluid. Maybe it was just to keep it simple. Maybe it\'s because we do actually fall back to using a more archaic approach to setting column widths if Grid and <code>display: contents</code> aren\'t supported. You don\'t have to do this, it would have been too important to leave out for our users.</p>\n<p>Using something fluid probably wouldn\'t align with the user\'s intentions anyway. We can\'t assume that making all columns smaller in order to keep more of them in the screen is the most important thing. If they had resized a column, it\'s to see a certain amount of content in that column. If we used a fluid unit, and then they made the screen narrower, we\'d be disregarding the choice they made. They\'d have to resize the column again to see the same content. Users are unlikely to be thinking &quot;Hmm, I want this column to take up 20% of the window even if I resize it&quot;. Anyway, users rarely resize windows; I\'m going into too much detail on an edge case here.</p>\n<h2><a id="toggling-columns" class="post-header-anchor" href="#toggling-columns" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Toggling columns</h2>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png" alt=""/></a>\n          <figcaption><p>Our modal for customizing which columns are shown.</p>\n</figcaption>\n        </figure><p>Imagine a salesperson has changed the column set using the above modal. If none of the chosen columns have been resized previously, they get laid out using the default <code>grid-template-column</code> values depending on their data type. For example, <code>minmax(150px, 3.33fr)</code>.</p>\n<p>If any of the columns has a fixed width stored in localStorage, we make <em>all</em> of the chosen columns fixed width (and store those widths in localStorage too).</p>\n<p>Over time, more and more columns will become fixed. The only way for users to get back to fluid columns is if they were to reset the columns.</p>\n<p>We also store an array of column identifiers in localStorage, separate to the column width entries.</p>\n<h2><a id="why-didnt-you-just-use--libraryname-" class="post-header-anchor" href="#why-didnt-you-just-use--libraryname-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use {{ libraryName }}?&quot;</h2>\n<p>I didn\'t want to just offload the problem to a heavy JavaScript library. It would be heavy, janky, wouldn\'t be responsive, and might not even use <code>&lt;table&gt;</code> at all. I also didn\'t want to write something like that myself. There must be a better way, I thought.</p>\n<h2><a id="why-didnt-you-just-use-flexbox" class="post-header-anchor" href="#why-didnt-you-just-use-flexbox" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use Flexbox?&quot;</h2>\n<p>Each row would be evaluated / spaced independently of each other. A column might not be aligned with the column above it because of varying content length.</p>\n<p>I could have switched to <code>&lt;div&gt;</code>s representing the column containing the vertically stacked cells within. I didn\'t want to have to do this though. I wanted to use a <code>&lt;table&gt;</code>. On top of that, I could have easily ran into issues from the reverse angle anyway, like cells not matching in height across columns.</p>\n<h2><a id="why-didnt-you-just-use-a-colgroup-" class="post-header-anchor" href="#why-didnt-you-just-use-a-colgroup-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use a <code>&lt;colgroup&gt;</code>?&quot;</h2>\n<p>Check out <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup" rel="noopener"><code>&lt;colgroup&gt;</code></a>, it\'s a handy old element. Once you define your columns using <code>&lt;col&gt;</code>s, styles applied to one will effectively be applied to all of the cells in that column.</p>\n<p>In the end though, it was simply too limited for what I needed to do. It didn\'t take long to realise it was a no-go. So much so, that I can\'t remember exactly what the problems were. I\'m pretty sure it was impossible to achieve the level of fluidity I wanted, and it didn\'t work well with Flexbox or Grid.</p>\n<h2><a id="why-didnt-you-just-use-table-layout-fixed" class="post-header-anchor" href="#why-didnt-you-just-use-table-layout-fixed" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use table-layout: fixed?&quot;</h2>\n<p>I could have use <code>table-layout: fixed</code> on the <code>&lt;table&gt;</code> and set the column widths using percentages. However, from looking at examples and playing around, this only seems to work if the table is 100% in width. Also resizing one column causes the other columns to resize to fill the 100% width.</p>\n<h2><a id="but-you-could-still-have-used-a-table" class="post-header-anchor" href="#but-you-could-still-have-used-a-table" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;But you could still have used a table!&quot;</h2>\n<p>Yes, tables can do a lot of smart things out of the box, but they can\'t efficiently support everything I wanted to do. Still disagree? OK you wizard, teach me.</p>\n<h2><a id="dont-go-overboard-with-display-contents" class="post-header-anchor" href="#dont-go-overboard-with-display-contents" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Don\'t go overboard with display: contents</h2>\n<p><code>display:contents</code> allowed us to keep our table markup. Use it only when you really have to though. There is, or at least were, issues in some browsers around accessibility and how screen readers would read the content.</p>\n<p>We discovered a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1550728" rel="noopener">strange bug</a> when combining it with native drag &amp; drop in Firefox.</p>\n<p>Fortunately, subgrid on the way which will properly allow descendants to participate in grids. Our use case is simple in that we want to effectively flatten the markup but subgrid will open the door for wilder multi-dimensional grid orgies. See <a href="https://rachelandrew.co.uk/archives/2017/07/20/why-display-contents-is-not-css-grid-layout-subgrid/" rel="noopener">Why display: contents is not CSS Grid Layout subgrid</a>.</p>\n<h2><a id="im-probably-forgetting-something" class="post-header-anchor" href="#im-probably-forgetting-something" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I\'m probably forgetting something</h2>\n<p>There\'s a lot more to this screen. I think there was some text-overflow issue when resizing columns but I can\'t remember anymore.</p>\n<p>We use <code>position: sticky</code> to keep the table headers in place as you scroll down. It\'s a lovely enhancement and it degrades nicely. However, we do have a JavaScript fallback for IE11 users. I really wouldn\'t recommend doing that. It\'s tricky to achieve with horizontally scrollable tables.</p>\n<p>I didn\'t even touch on all of the features of these list views. Users can apply, save, and share custom filters (e.g. show me leads over $500 or where the contact is in Europe). These column filters can be set to remember the column set you had when you created them, because you might always want to see certain columns for a given workflow.</p>\n<p>We\'ll soon support bulk editing via the list view, as well exporting your tailored view to CSV.</p>\n<p>Anyway, thanks for reading.</p>\n',attributes:{date:"2019-05-12T00:00:00.000Z",tags:[{id:"css-grid",name:"css grid"},{id:"css",name:"css"},{id:"javascript",name:"javascript"},{id:"table",name:"table"},{id:"data",name:"data"},{id:"responsive-design",name:"responsive design"},{id:"responsive",name:"responsive"},{id:"flexbox",name:"flexbox"},{id:"resize-column",name:"resize column"},{id:"web-app",name:"web app"},{id:"development",name:"development"},{id:"crm",name:"crm"},{id:"sales",name:"sales"}],title:"Flexible data tables with CSS Grid",updated_at:"2019-05-12T15:23:45.287Z",photo:"/images/blog-content/flexible-data-tables-with-css-grid/wide3.png"},title:"Flexible data tables with CSS Grid",renderedSummary:"<p>Now that we've launched, I can finally talk about the secret project I've been working on for the last two years. One interesting piece of the <a href=\"https://www.teamwork.com/crm\" rel=\"noopener\">Teamwork CRM</a> puzzle was the &quot;list view&quot;.</p>\n<p>It's a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won't bore you. I'll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.</p>\n",rendered:'<h2><a id="flexible-data-tables-with-css-grid" class="post-header-anchor" href="#flexible-data-tables-with-css-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Flexible data tables with CSS Grid</h2>\n<p>Now that we\'ve launched, I can finally talk about the secret project I\'ve been working on for the last two years. One interesting piece of the <a href="https://www.teamwork.com/crm" rel="noopener">Teamwork CRM</a> puzzle was the &quot;list view&quot;.</p>\n<p>It\'s a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won\'t bore you. I\'ll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.</p>\n<p>First, I need to give some more context, starting with the purpose and design goals of these screens. Feel free to <a href="#just-get-to-css-grid-already">skip to the CSS Grid bit</a>.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/wide3.png" alt=""/></a>\n          <figcaption><p>The leads list view.</p>\n</figcaption>\n        </figure><p>Primarily it allows salespeople to scan a list of items like their leads or contacts, and find anything important they need to take action on. It\'s not like an Excel spreadsheet — we can do a better job at laying out the data, which there will be a lot of.</p>\n<p>Everything we do is responsively designed. We start with the most narrow / constrained variant first and tweak the layout based on content, design, use cases (we don\'t have device-orientated breakpoints).</p>\n<p>At its most minimal, the columns are stacked vertically within rows, spanning the full width of the screen.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/narrow.png" alt=""/></a>\n          <figcaption><p>What a list view looks like on a narrow screen.</p>\n</figcaption>\n        </figure><p>Responsive tables are tricky. There are <a href="https://bradfrost.github.io/this-is-responsive/patterns.html" rel="noopener">several existing patterns</a> you could pick from. Consider what your users are trying to achieve and choose wisely.</p>\n<p>Once we have enough pixels in our canvas to play with, we switch to a more typical table layout such that the columns are... well, columns. There are no major layout changes beyond this point but we still want to display the columns as best as we can for the salesperson viewing it.</p>\n<p>Assume there are a lot of columns (we\'ll look at how the user can configure the columns in more detail later). The table should fill the width of the screen (at least). Column widths then should be determined by their content and the type of values they contain; e.g. short / long text, date, number, URL, etc. Date columns should take up less room than long text columns.</p>\n<p>Columns must have a minimum width and therefore only so many can fit into the viewport. As a result this table will be vertically and horizontally scrollable for a lot of salespeople.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-window.gif" alt=""/></a>\n          <figcaption><p>How the layout varies per window width. Sorry the GIF is a bit janky, I provide some interactive examples below.</p>\n</figcaption>\n        </figure><p>To begin with, we lay the table out as best we can using regular old-school table-layout CSS. Next, I\'ll show you how we enhance it with CSS Grid. Following that, how we leverage Grid to allow users to resize columns, which would be a lot more awkward with regular table-layout CSS.</p>\n<h2><a id="just-get-to-css-grid-already" class="post-header-anchor" href="#just-get-to-css-grid-already" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Just get to CSS Grid already</h2>\n<p>I\'m no CSS Grid expert but I love it. It\'s extremely powerful and simple, allowing you to implement previously tricky layouts with minute amounts of code. I\'ll skip giving an introduction to Grid in this article. Go read Rachel Andrew\'s <a href="https://abookapart.com/products/the-new-css-layout" rel="noopener">The New CSS Layout</a> or <a href="https://css-tricks.com/snippets/css/complete-guide-grid/" rel="noopener">A Complete Guide to Grid</a> and when you\'re done wondering where Grid was all your life, come back to me.</p>\n<p>The first thing we do is apply <code>display: grid</code> to the <code>&lt;table&gt;</code> to make it a grid. This won\'t break anything if the browser doesn\'t support it (it will carry on using <code>display:table</code>). Its children become grid items; the <code>&lt;thead&gt;</code> and <code>&lt;tbody&gt;</code>. It\'s not the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, or even the <code>&lt;tr&gt;</code>s we\'re concerned with though. What we want to do is lay out our <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s on this grid. We could apply <code>display: grid</code> to each of these too (i.e. grids within grids), but that\'s not ideal. Each <code>&lt;tr&gt;</code> grid would be independent of others and that\'s not good (you\'ll see later that I had the same problem with Flexbox).</p>\n<p>A workaround is to use <code>display: contents</code> on the <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, and <code>&lt;tr&gt;</code>s. This basically removes the them from the Grid layout, bypassing them, and promotes their children (the <code>&lt;th&gt;</code>s and <code>&lt;td&gt;</code>s) to participate in the the <code>&lt;table&gt;</code> grid instead.</p>\n<p>Then we use the magic <code>grid-template-columns</code> to control the grid items. Yes, one line of CSS. For example, if we had one date column and one URL column, it might be something like:</p>\n<pre><code class="language-css"><span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 1.33fr<span class="token punctuation">)</span> <span class="token function">minmax</span><span class="token punctuation">(</span>150px, 2.33fr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>We use the same minimum size for all columns but the max (<code>fr</code>) value is determined by the column data type. I tried using Grid\'s<code>auto</code> and <code>max-content</code> too but what we\'ve ended up with seems to produce the best result.</p>\n<p>Here is a simplified example:</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="XwKWdG" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/XwKWdG/" target="_blank">\n  Flexible data table with CSS Grid</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>You should <a href="https://codepen.io/adam-lynch/debug/XwKWdG" target="_blank">open it in a new tab</a> as it\'s a bit constrained embedded here like this. Then try resizing the window.</p>\n<h2><a id="resizing-columns-with-grid" class="post-header-anchor" href="#resizing-columns-with-grid" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Resizing columns with Grid</h2>\n<p>On top of this, we support reordering, resizing, and toggling which columns are shown. The lists of possible columns are long, including properties of the item (e.g. leads) itself, properties of related items (e.g. the company linked to the lead), and custom fields.</p>\n<p>For example, a user could create a (date) custom field for contacts called &quot;Date of birth&quot; so that can be tracked in the system for each contact.</p>\n<p>Since a type like &quot;Date&quot; is selected when creating a custom field, our system already handles custom fields. There\'s more to think about when columns are toggled, but first I need to explain how resizing works.</p>\n<ol>\n<li>The user hovers over a column header, a resize handle is shown on the right hand side. We\'re listening for <code>mousedown</code> on the resize handle.</li>\n<li>When the user clicks the handle, we bind some more <code>mousemove</code> and <code>mousedown</code> event listeners (to the <code>window</code>). We also add some classes for decoration at this point.</li>\n<li>When the user moves their mouse, we calculate the new column width. This takes the cursor position, the table\'s scroll position, and our minimum into account. Then we re-set the <code>&lt;table&gt;</code>\'s <code>grid-template-columns</code>s rule (via <code>style</code> attribute), this time replacing the max (<code>fr</code>) value with a pixel value. For example, <code>grid-template-columns: minmax(150px, 1.33fr) 296px;</code>. We do this using <code>requestAnimationFrame</code> to keep it as smooth as possible.</li>\n<li>When <code>mouseup</code> is fired, we unbind event listeners and remove classes.</li>\n</ol>\n<p>Try this simplified example (or ideally <a href="https://codepen.io/adam-lynch/pen/GaqgXP" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="GaqgXP" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with good UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/GaqgXP/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with good UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p>\n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>What\'s great here is that we only need to update one element in the DOM, not each cell.</p>\n<p>We always build with touch users in mind, but it\'s OK not to support this via touch. It\'s a very precise action. Even if I wanted to resize a column using touch, I\'d probably expect a different interaction, like a multi-touch spread gesture.</p>\n<h2><a id="fixed-column-widths" class="post-header-anchor" href="#fixed-column-widths" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Fixed column widths</h2>\n<p>You might have noticed I didn\'t tell the whole truth. Not only do we &quot;fix&quot; the width of the column you\'re resizing, we make all column widths fixed. Maybe you didn\'t even notice, because that\'s exactly how it should work.</p>\n<p>I originally thought that users would like that when they stretched or squeezed columns, the other ones could adjust too. If the columns filled the screen width nicely and you make one smaller, one (or some) of the others could grow if they had more content to show. Try this example for yourself below (or ideally <a href="https://codepen.io/adam-lynch/pen/wbWvep" target="_blank">open it in a new tab</a>):</p>\n<p class="codepen" data-height="390" data-theme-id="light" data-default-tab="result" data-user="adam-lynch" data-slug-hash="wbWvep" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Flexible data table with CSS Grid (resizable columns with bad UX)">\n  <span>Something went wrong. View <a href="https://codepen.io/adam-lynch/pen/wbWvep/" target="_blank">\n  Flexible data table with CSS Grid (resizable columns with bad UX)</a> by Adam Lynch (<a href="https://codepen.io/adam-lynch">@adam-lynch</a>)\n  on <a href="https://codepen.io">CodePen</a>.</span>\n</p> \n<script async src="https://static.codepen.io/assets/embed/ei.js"><\/script>\n<p>After some user testing, it was clear this is unexpected behaviour. As a user, I feel less in control when there are unpredictable side-effects to my actions.</p>\n<p>We shouldn\'t make assumptions based on which column was or wasn\'t interacted with. When resizing one column, a user could have already made an implicit decision that the rest were perfect.</p>\n<p>Therefore, if you open the app for the first time, the columns are laid out as best as possible. If you resize your screen, they resize using the same ratios. Once you touch the resize handler of any column, all of the visible columns become fixed width.</p>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif"><img src="/images/blog-content/flexible-data-tables-with-css-grid/resizing-columns.gif" alt=""/></a>\n          <figcaption><p>Before, during, and after resizing a column. Sorry the GIF is a bit janky.</p>\n</figcaption>\n        </figure><p>Once someone takes the time to tailor the screen to their needs, we take note. Any time a column is resized or made fixed, we create an independent localStorage entry mapping a column identifier to a pixel value.</p>\n<p>I can\'t remember exactly why we decided to set the fixed value using pixels, rather than something more fluid. Maybe it was just to keep it simple. Maybe it\'s because we do actually fall back to using a more archaic approach to setting column widths if Grid and <code>display: contents</code> aren\'t supported. You don\'t have to do this, it would have been too important to leave out for our users.</p>\n<p>Using something fluid probably wouldn\'t align with the user\'s intentions anyway. We can\'t assume that making all columns smaller in order to keep more of them in the screen is the most important thing. If they had resized a column, it\'s to see a certain amount of content in that column. If we used a fluid unit, and then they made the screen narrower, we\'d be disregarding the choice they made. They\'d have to resize the column again to see the same content. Users are unlikely to be thinking &quot;Hmm, I want this column to take up 20% of the window even if I resize it&quot;. Anyway, users rarely resize windows; I\'m going into too much detail on an edge case here.</p>\n<h2><a id="toggling-columns" class="post-header-anchor" href="#toggling-columns" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Toggling columns</h2>\n<figure>\n          <a href="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png"><img src="/images/blog-content/flexible-data-tables-with-css-grid/manage-columns.png" alt=""/></a>\n          <figcaption><p>Our modal for customizing which columns are shown.</p>\n</figcaption>\n        </figure><p>Imagine a salesperson has changed the column set using the above modal. If none of the chosen columns have been resized previously, they get laid out using the default <code>grid-template-column</code> values depending on their data type. For example, <code>minmax(150px, 3.33fr)</code>.</p>\n<p>If any of the columns has a fixed width stored in localStorage, we make <em>all</em> of the chosen columns fixed width (and store those widths in localStorage too).</p>\n<p>Over time, more and more columns will become fixed. The only way for users to get back to fluid columns is if they were to reset the columns.</p>\n<p>We also store an array of column identifiers in localStorage, separate to the column width entries.</p>\n<h2><a id="why-didnt-you-just-use--libraryname-" class="post-header-anchor" href="#why-didnt-you-just-use--libraryname-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use {{ libraryName }}?&quot;</h2>\n<p>I didn\'t want to just offload the problem to a heavy JavaScript library. It would be heavy, janky, wouldn\'t be responsive, and might not even use <code>&lt;table&gt;</code> at all. I also didn\'t want to write something like that myself. There must be a better way, I thought.</p>\n<h2><a id="why-didnt-you-just-use-flexbox" class="post-header-anchor" href="#why-didnt-you-just-use-flexbox" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use Flexbox?&quot;</h2>\n<p>Each row would be evaluated / spaced independently of each other. A column might not be aligned with the column above it because of varying content length.</p>\n<p>I could have switched to <code>&lt;div&gt;</code>s representing the column containing the vertically stacked cells within. I didn\'t want to have to do this though. I wanted to use a <code>&lt;table&gt;</code>. On top of that, I could have easily ran into issues from the reverse angle anyway, like cells not matching in height across columns.</p>\n<h2><a id="why-didnt-you-just-use-a-colgroup-" class="post-header-anchor" href="#why-didnt-you-just-use-a-colgroup-" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use a <code>&lt;colgroup&gt;</code>?&quot;</h2>\n<p>Check out <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/colgroup" rel="noopener"><code>&lt;colgroup&gt;</code></a>, it\'s a handy old element. Once you define your columns using <code>&lt;col&gt;</code>s, styles applied to one will effectively be applied to all of the cells in that column.</p>\n<p>In the end though, it was simply too limited for what I needed to do. It didn\'t take long to realise it was a no-go. So much so, that I can\'t remember exactly what the problems were. I\'m pretty sure it was impossible to achieve the level of fluidity I wanted, and it didn\'t work well with Flexbox or Grid.</p>\n<h2><a id="why-didnt-you-just-use-table-layout-fixed" class="post-header-anchor" href="#why-didnt-you-just-use-table-layout-fixed" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;Why didn\'t you just use table-layout: fixed?&quot;</h2>\n<p>I could have use <code>table-layout: fixed</code> on the <code>&lt;table&gt;</code> and set the column widths using percentages. However, from looking at examples and playing around, this only seems to work if the table is 100% in width. Also resizing one column causes the other columns to resize to fill the 100% width.</p>\n<h2><a id="but-you-could-still-have-used-a-table" class="post-header-anchor" href="#but-you-could-still-have-used-a-table" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>&quot;But you could still have used a table!&quot;</h2>\n<p>Yes, tables can do a lot of smart things out of the box, but they can\'t efficiently support everything I wanted to do. Still disagree? OK you wizard, teach me.</p>\n<h2><a id="dont-go-overboard-with-display-contents" class="post-header-anchor" href="#dont-go-overboard-with-display-contents" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Don\'t go overboard with display: contents</h2>\n<p><code>display:contents</code> allowed us to keep our table markup. Use it only when you really have to though. There is, or at least were, issues in some browsers around accessibility and how screen readers would read the content.</p>\n<p>We discovered a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1550728" rel="noopener">strange bug</a> when combining it with native drag &amp; drop in Firefox.</p>\n<p>Fortunately, subgrid on the way which will properly allow descendants to participate in grids. Our use case is simple in that we want to effectively flatten the markup but subgrid will open the door for wilder multi-dimensional grid orgies. See <a href="https://rachelandrew.co.uk/archives/2017/07/20/why-display-contents-is-not-css-grid-layout-subgrid/" rel="noopener">Why display: contents is not CSS Grid Layout subgrid</a>.</p>\n<h2><a id="im-probably-forgetting-something" class="post-header-anchor" href="#im-probably-forgetting-something" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>I\'m probably forgetting something</h2>\n<p>There\'s a lot more to this screen. I think there was some text-overflow issue when resizing columns but I can\'t remember anymore.</p>\n<p>We use <code>position: sticky</code> to keep the table headers in place as you scroll down. It\'s a lovely enhancement and it degrades nicely. However, we do have a JavaScript fallback for IE11 users. I really wouldn\'t recommend doing that. It\'s tricky to achieve with horizontally scrollable tables.</p>\n<p>I didn\'t even touch on all of the features of these list views. Users can apply, save, and share custom filters (e.g. show me leads over $500 or where the contact is in Europe). These column filters can be set to remember the column set you had when you created them, because you might always want to see certain columns for a given workflow.</p>\n<p>We\'ll soon support bulk editing via the list view, as well exporting your tailored view to CSV.</p>\n<p>Anyway, thanks for reading.</p>\n',summary:"Now that we've launched, I can finally talk about the secret project I've been working on for the last two years. One interesting piece of the Teamwork CRM puzzle was the &quot;list view&quot;.\nIt's a powerful page component which exists seven times in the app — a table on steroids essentially. I could talk about it for days but I won't bore you. I'll focus on how we added a lot of flexibility with a few lines of CSS (Grid). Namely, how we lay out data-heavy tables, how we support resizing of columns, and more.\n",photo:"/images/blog-content/flexible-data-tables-with-css-grid/wide3.png",keywords:["css grid","css","javascript","table","data","responsive design","responsive","flexbox","resize column","web app","development","crm","sales"],published_at:"2019-05-12T00:00:00.000Z",updated_at:"2019-05-12T15:23:45.287Z",year:2019,month:5,day:13,relevanceScore:2},{id:"random-open-api",slug:"random-open-api",highlightedLanguages:["javascript","javascripton","shell"],source:"---\ndate: 2019-02-02\ntags:\n  - api\n  - open API\n  - public API\n  - twitter\n  - bot\n  - zeit\n  - now\n  - serverless\n  - faas\n  - node.js\n  - cron\n  - development\n---\n\n## How I made the @randomOpenAPI Twitter bot in 42 minutes-ish\n\nIn my day job, I'm building a product in which nothing is simple. There's a lot of flexibility, customization, and connected dots. Sometimes I daydream about working on an app which has one page, no settings, customization, or integrations, a single fixed viewport size to worry about, and so on. You know, an empty page.\n\nSeriously, I do love the challenge and I know it will make a lot of people happy. However, I do wonder how quickly I could make something simple from scratch. That's what this project is about.\n\n::: summary\n\nI love APIs. Especially open APIs. I wish there were way more of them. There's a lot of data out there we can't get our hands on. Imagine all of the unborn apps, studies, and infographics.\n\nThe natural conclusion was to create a Twitter bot. Have you ever seen Stefan Judis' [@randomMDN](https://twitter.com/randommdn)? It tweets a random article from [MDN](https://developer.mozilla.org/en-US/) multiple times a day. I decided to create one of my own to raise awareness about open APIs. Plus it's an excuse for a small fun project.\n\n:::\n\nI decided to time myself while I was at it. It took 42 minutes but read on, it wasn't all smooth sailing.\n\n#### Hello, world!\n\nI created a new directory with an `index.js` containing `console.log('Hello, world!)` and ran `node index` in the directory.\n\nOK, I managed not to mess that up. Then, I needed data about open APIs. Did you know people make curated lists of these APIs? Did you know there's... of course there's an API to get the list of APIs. Luckily, the [Public API for Public APIs](https://api.publicapis.org/) has a `/random` endpoint. At a glance it had enough information:\n\n- title (string)\n- description (string)\n- category (string)\n- And some other stuff (more about that later).\n\nLooks good. Now, I need to hit the API. I don't necessarily need to use a library but one library is better than two interfaces. I prefer a HTTP client library which supports both client and server-side usage. Axios is my latest library of choice for this. So I ran `npm init --yes && npm install axios` . Then I added the following code to `index.js`:\n\n```javascript\n  const axios = require('axios');\n  \n  axios.get('https://api.publicapis.org/random')\n  .then((response) => {\n    console.log(response.data);\n  })\n```\n\nNotice how little effort I'm putting into error handling. I'm on the clock.\n\nRunning `node index` resulted in:\n\n```javascripton\n{ count: 1,\n  entries:\n    [ { API: 'Livecoin',\n        Description: 'Cryptocurrency Exchange',\n        Auth: '',\n        HTTPS: true,\n        Cors: 'unknown',\n        Link: 'https://www.livecoin.net/api',\n        Category: 'Cryptocurrency' } ] }\n```\n\n### Writing the tweet\n\nNext, I constructed a tweet from the data. Luckily, none of the text is very long and Twitter doubled their tweet character limit to 280. I fiddled around way too long here. This is what I ended up with:\n\n```javascript\nconst axios = require('axios');\nconst camelCase = require('camelcase');\n\nconst formatHashtag = (text) => {\n  return camelCase(text.replace(/[^a-zA-Z0-9]/g, ''));\n};\n\naxios.get('https://api.publicapis.org/random')\n.then((response) => {\n  if(!response.data.entries.length){\n    throw new Error('No APIs found');\n  }\n\n  // Build tweet content\n  const api = response.data.entries[0];\n  const isDescriptionShort = api.Description.split(' ').length <= 2;\n  let tweet = `📡 Random Open API 📡\\n\\n${api.API}`; // .API is the name of the API\n\n  // If the description is too short, it's shown as a hashtag later instead\n  if(!isDescriptionShort){\n    tweet += `: ${api.Description} `;\n  }\n\n  tweet += `${api.Link} `;\n\n  const tags = ['openApi', 'api', formatHashtag(api.Category)];\n  if(isDescriptionShort){\n    tags.push(formatHashtag(api.Description));\n  }\n\n  tweet += tags.map(tag => `#${tag}`).join(' ');\n  console.log(tweet);\n})\n```\n\nI didn't like how it looked when the description was short (e.g. `Discogs: Music`). In this case, I used it as a hashtag instead.\n\n### Tweet, tweet!\n\nNext is actually sending a tweet. I did a quick google and ended up running `npm install twitter-lite` . I chose [twitter-lite](https://www.npmjs.com/package/twitter-lite) because:\n\n1. The documentation showed me what I needed to do at a glance.\n2. It didn't seem too heavy or outdated.\n3. It had `lite` in the name 🤷‍♂️.\n\nI needed the following Twitter credentials to post a tweet: \n\n- Consumer key.\n- Consumer secret.\n- Access token key.\n- Access token secret.\n\nThis is what took the longest in this project. I created the Twitter account, applied for access to [Twitter's APIs](https://developer.twitter.com/), created an app, and got the credentials I needed. I'm not going into too much detail here, it's tedious.\n\nI commented out the Axios call from before and threw in the following:\n\n```javascript\n// ...\nconst Twitter = require('twitter-lite');\n\nconst client = new Twitter({\n  subdomain: \"api\",\n  consumer_key: \"notTheRealValue\", // from Twitter.\n  consumer_secret: \"notTheRealValueEither\", // from Twitter.\n  access_token_key: \"nopeNotReal\", // from your User (oauth_token)\n  access_token_secret: \"hmmNoStillNotReal\" // from your User (oauth_token_secret)\n});\n\n// ....\n\nclient.post(\"statuses/update\", { status: 'Hello, World!' })\n.then(() => console.log('Success!'))\n```\n\nOnce I ran `node index` again, there was a `Hello, World!` tweet in my feed.\n\nNext, I combined the API and Twitter code, then ran it again;\n\n:::figure random-open-api/tweet.png A screenshot of the first Tweet posted (Daum maps).\n:::\n\nIsn't it beautiful?\n\n### Now, where to host this?\n\nI thought serverless would be a good fit for hosting this. I'd heard the praise Zeit's [Now](https://zeit.co/now) had gotten so I thought I'd give it a go. It's a serverless hosting platform which supports static files, JavaScript, PHP, Python, Go, and more. \n\nThey have integrations with GitHub and more but I went with the slightly more manual approach. I ran `npm install -g now && now login` and added a `now.json` file;\n\n```javascripton\n{\n  \"version\": 2,\n  \"builds\": [{ \"src\": \"*.js\", \"use\": \"@now/node\" }]\n}\n```\n\nThis tells Now that any JavaScript files should be built with their Node.js builder. \n\nI had to tweak my `index.js` slightly. First to add their function boilerplate, and secondly to call `res.end` to output something, rather than logging it to the console;\n\n```javascript\n// ...\n\nmodule.exports = (req, res) => { // Zeit boilerplate\n  axios.get('https://api.publicapis.org/random')\n  .then((response) => {\n    // ...\n    \n    // Tweet, tweet!\n    client.post(\"statuses/update\", { status: tweet })\n    .then(() => res.end('Success!'))\n    .catch((err) => {\n      res.end(`Error: ${err.message}\\n\\n${err.stack}`);\n    });\n  })\n  .catch((error) => {\n    res.end(`Error: ${error.message}\\n\\n${error.stack}`);\n  });\n};\n```\n\nI then ran `now` which is their command for deploying your serverless function. This took a bit longer than I expected to be honest, but to be fair there's probably a lot going behind the scenes to achieve what Zeit provides. \n\nThe result:\n\n```shell\n> Deploying ~/Code/random-open-api under notmyreal@email.com\n> Using project random-open-api\n> https://random-open-api-jdhf89whf3489.now.sh [v2] [in clipboard] [3s]\n┌ index.js        Ready               [24s]\n└── λ index.js (39.83KB) [bru1]\n> Success! Deployment ready [28s]\n```\n\nNow gives you a new URL each time you deploy. I went to this URL in my browser and saw \"Success!\". Yes, it sent the tweet! That was easy.\n\n### Getting secretive\n\nI planned to open source the code and I didn't want to commit my Twitter credentials. First, I needed to create a secret for each so I ran the following commands:\n\n```shell\nnow secret add CONSUMER_KEY \"notTheRealValue\"\nnow secret add CONSUMER_SECRET \"notTheRealValueEither\"\nnow secret add ACCESS_TOKEN_KEY \"nopeNotReal\"\nnow secret add ACCESS_TOKEN_SECRET \"hmmNoStillNotReal\"\n```\n\nThen I added the following `env` object to my `now.json` file. \n\n```javascripton\n{\n  \"version\": 2,\n  \"builds\": [{ \"src\": \"*.js\", \"use\": \"@now/node\" }],\n  \"env\": {\n    \"CONSUMER_KEY\": \"@consumer_key\",\n    \"CONSUMER_SECRET\": \"@consumer_secret\",\n    \"ACCESS_TOKEN_KEY\": \"@access_token_key\",\n    \"ACCESS_TOKEN_SECRET\": \"@access_token_secret\"\n  }\n}\n```\n\nThis then allowed me to use `process.env.CONSUMER_KEY` in my function, for example;\n\n```javascript\nconst client = new Twitter({\n  subdomain: \"api\",\n  consumer_key: process.env.CONSUMER_KEY, // from Twitter.\n  consumer_secret: process.env.CONSUMER_SECRET, // from Twitter.\n  access_token_key: process.env.ACCESS_TOKEN_KEY, // from your User (oauth_token)\n  access_token_secret: process.env.ACCESS_TOKEN_SECRET // from your User (oauth_token_secret)\n});\n```\n\nNow would replace those references with the actual values when deploying. Not too complicated right?\n\nI ran `now` again but this time it didn't work. I got a blank response in my browser. Well, what happened was I somehow managed to type `process.key` , not `process.env` . I went down a rabbit hole trying all sorts of other ways of using environment variables, secrets, `now-env` , and more, before realizing my mistake.\n\n### Automation\n\nI was feeling good. All I had to do was configure Now to run the function on a schedule, publish the code, write and publish the blog post. Profit. \n\nWell, Zeit doesn't support running things on a schedule :(\n\nAt least they don't in Now version 2. I remember there was a bit of talk around the fact they released a backwards incompatible v2. It was forward thinking but had fewer features than v1. I think v1 supported what I needed but I didn't want to start a project by going back in time. \n\nThere were workarounds suggested in GitHub issues like having a `setInterval` in your function. Em, no. I swear, every time I play around with serverless, FaaS, or IoT, an obvious use case isn't covered.\n\nSo I gave up on Now. I decided to manually log into Twitter and tweet a few times a day...\n\nI actually settled for a simple but uncomfortable solution. It turns out there's a completely free (and open source) service, [cron-job.org](https://cron-job.org/en/), which will call your URL on a schedule.\n\n:::figure random-open-api/cron.png The job configuration.\n:::\n\nAll I had to do was sign up, create a job with my URL, and schedule it. As you see, I didn't even have to use the horrible [cron format](http://www.nncron.ru/help/EN/working/cron-format.htm). It was painless.\n\n### Deployment aliases\n\nI realized that if I ever deploy an update, I'll have to log into [cron-job.org](http://cron-job.org) and update the URL. Then I discovered Now's aliases. Individual deployments can be assigned deployments;\n\n:::figure random-open-api/alias.png The create alias modal.\n:::\n\nYou can choose a [now.sh](http://now.sh) subdomain or give your own domain.\n\nSo each time I update the code and deploy, I'll re-assign the alias to the new deployment. There's probably a better way around this but I didn't want to spend too long worrying about it. The code won't need to be updated much and if it ever does, I'd assume the Now dashboard is where it's managed.\n\n### The end\n\nSo that's it. It took me 42 minutes in total, including a couple of blunders. Thank you, bye. \n\nGoodbye!\n\nHey, stop, why are you still reading?\n\nUgh, fine...\n\n### Palm, have you met face?\n\nWhile writing this, I noticed that the API returns more than strictly \"open\" APIs. Some are, while others require some kind of signup and authentication. I guess I was trying to move too fast.\n\nLooking through results, even the ones which require authentication are still free and publicly available. It doesn't bother me then if they're not 100% \"open\", the data is still there to use.\n\nOh wait, no... they're not all free either. The [Semantria API](https://semantria.readme.io/docs) is one entry I just found for example; a \"paid Saas text analytics service\".\n\n![\"Just when I thought I was out, they pull me back in!\" from the Godfather](/images/blog-content/random-open-api/godfather.gif)\n\nLooking at the Public API for Public APIs again, they also return an `auth` property for each API. I've seen results with `\"auth\": \"apiKey\"`, `\"auth\": \"OAuth\"`, and `\"auth\": \"\"`. I need to tweet about the last case.\n\nThe `/random` endpoint doesn't support filtering, so I'd have to keep calling it until I get one that's open. Hmm.\n\nThe `/entries` endpoint does support an `auth` filter parameter but it returns an array of APIs. This looks like my best bet. It doesn't support pagination so it must either return all or at least as many as it can. Here's the new API code:\n\n```javascript\naxios.get('https://api.publicapis.org/entries?auth=null')\n.then((response) => {\n  if(!response.data.entries.length){\n    throw new Error('No APIs found');\n  }\n\n  // Build tweet content from random result\n  const api = response.data.entries[Math.floor(Math.random() * response.data.entries.length)];\n```\n\nThere's no reason why `/random` couldn't also accept filter parameters. After I publish this, I'll go make a pull-request.\n\n### Conclusion\n\nIt was a nice break to rush head first into a small project, hacking something together without reading documentation, properly handling errors, etc. but I don't recommend working like this. It was almost a disaster.\n\nFollow [@randomOpenAPI](twitter.com/randomOpenAPI) on Twitter. Check out the source code at [github.com/adam-lynch/random-open-api](github.com/adam-lynch/random-open-api).\n\nWhat could you make? I could imagine someone finding value in an account that tweets about *two* random APIs. The mashups might be handy for coming up with project ideas.\n",unfilteredRenderedBody:'<h2><a id="how-i-made-the-randomopenapi-twitter-bot-in-42-minutes-ish" class="post-header-anchor" href="#how-i-made-the-randomopenapi-twitter-bot-in-42-minutes-ish" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>How I made the @randomOpenAPI Twitter bot in 42 minutes-ish</h2>\n<p>In my day job, I\'m building a product in which nothing is simple. There\'s a lot of flexibility, customization, and connected dots. Sometimes I daydream about working on an app which has one page, no settings, customization, or integrations, a single fixed viewport size to worry about, and so on. You know, an empty page.</p>\n<p>Seriously, I do love the challenge and I know it will make a lot of people happy. However, I do wonder how quickly I could make something simple from scratch. That\'s what this project is about.</p>\n<article-summary><p>I love APIs. Especially open APIs. I wish there were way more of them. There\'s a lot of data out there we can\'t get our hands on. Imagine all of the unborn apps, studies, and infographics.</p>\n<p>The natural conclusion was to create a Twitter bot. Have you ever seen Stefan Judis\' <a href="https://twitter.com/randommdn" rel="noopener">@randomMDN</a>? It tweets a random article from <a href="https://developer.mozilla.org/en-US/" rel="noopener">MDN</a> multiple times a day. I decided to create one of my own to raise awareness about open APIs. Plus it\'s an excuse for a small fun project.</p>\n</article-summary><p>I decided to time myself while I was at it. It took 42 minutes but read on, it wasn\'t all smooth sailing.</p>\n<h4><a id="hello-world" class="post-header-anchor" href="#hello-world" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Hello, world!</h4>\n<p>I created a new directory with an <code>index.js</code> containing <code>console.log(\'Hello, world!)</code> and ran <code>node index</code> in the directory.</p>\n<p>OK, I managed not to mess that up. Then, I needed data about open APIs. Did you know people make curated lists of these APIs? Did you know there\'s... of course there\'s an API to get the list of APIs. Luckily, the <a href="https://api.publicapis.org/" rel="noopener">Public API for Public APIs</a> has a <code>/random</code> endpoint. At a glance it had enough information:</p>\n<ul>\n<li>title (string)</li>\n<li>description (string)</li>\n<li>category (string)</li>\n<li>And some other stuff (more about that later).</li>\n</ul>\n<p>Looks good. Now, I need to hit the API. I don\'t necessarily need to use a library but one library is better than two interfaces. I prefer a HTTP client library which supports both client and server-side usage. Axios is my latest library of choice for this. So I ran <code>npm init --yes &amp;&amp; npm install axios</code> . Then I added the following code to <code>index.js</code>:</p>\n<pre><code class="language-javascript">  <span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'axios\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  \n  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/random\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p>Notice how little effort I\'m putting into error handling. I\'m on the clock.</p>\n<p>Running <code>node index</code> resulted in:</p>\n<pre><code class="language-javascripton">{ count: 1,\n  entries:\n    [ { API: \'Livecoin\',\n        Description: \'Cryptocurrency Exchange\',\n        Auth: \'\',\n        HTTPS: true,\n        Cors: \'unknown\',\n        Link: \'https://www.livecoin.net/api\',\n        Category: \'Cryptocurrency\' } ] }\n</code></pre>\n<h3><a id="writing-the-tweet" class="post-header-anchor" href="#writing-the-tweet" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Writing the tweet</h3>\n<p>Next, I constructed a tweet from the data. Luckily, none of the text is very long and Twitter doubled their tweet character limit to 280. I fiddled around way too long here. This is what I ended up with:</p>\n<pre><code class="language-javascript"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'axios\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> camelCase <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'camelcase\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">formatHashtag</span> <span class="token operator">=</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">camelCase</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[^a-zA-Z0-9]/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\naxios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/random\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'No APIs found\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// Build tweet content</span>\n  <span class="token keyword">const</span> api <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> isDescriptionShort <span class="token operator">=</span> api<span class="token punctuation">.</span>Description<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> tweet <span class="token operator">=</span> <span class="token template-string"><span class="token string">`📡 Random Open API 📡\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api<span class="token punctuation">.</span>API<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// .API is the name of the API</span>\n\n  <span class="token comment">// If the description is too short, it\'s shown as a hashtag later instead</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isDescriptionShort<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    tweet <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api<span class="token punctuation">.</span>Description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> `</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  tweet <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api<span class="token punctuation">.</span>Link<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> `</span></span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'openApi\'</span><span class="token punctuation">,</span> <span class="token string">\'api\'</span><span class="token punctuation">,</span> <span class="token function">formatHashtag</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>Category<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span>isDescriptionShort<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">formatHashtag</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  tweet <span class="token operator">+=</span> tags<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>tag <span class="token operator">=></span> <span class="token template-string"><span class="token string">`#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p>I didn\'t like how it looked when the description was short (e.g. <code>Discogs: Music</code>). In this case, I used it as a hashtag instead.</p>\n<h3><a id="tweet-tweet" class="post-header-anchor" href="#tweet-tweet" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Tweet, tweet!</h3>\n<p>Next is actually sending a tweet. I did a quick google and ended up running <code>npm install twitter-lite</code> . I chose <a href="https://www.npmjs.com/package/twitter-lite" rel="noopener">twitter-lite</a> because:</p>\n<ol>\n<li>The documentation showed me what I needed to do at a glance.</li>\n<li>It didn\'t seem too heavy or outdated.</li>\n<li>It had <code>lite</code> in the name 🤷‍♂️.</li>\n</ol>\n<p>I needed the following Twitter credentials to post a tweet:</p>\n<ul>\n<li>Consumer key.</li>\n<li>Consumer secret.</li>\n<li>Access token key.</li>\n<li>Access token secret.</li>\n</ul>\n<p>This is what took the longest in this project. I created the Twitter account, applied for access to <a href="https://developer.twitter.com/" rel="noopener">Twitter\'s APIs</a>, created an app, and got the credentials I needed. I\'m not going into too much detail here, it\'s tedious.</p>\n<p>I commented out the Axios call from before and threw in the following:</p>\n<pre><code class="language-javascript"><span class="token comment">// ...</span>\n<span class="token keyword">const</span> Twitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'twitter-lite\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  subdomain<span class="token punctuation">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>\n  consumer_key<span class="token punctuation">:</span> <span class="token string">"notTheRealValue"</span><span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  consumer_secret<span class="token punctuation">:</span> <span class="token string">"notTheRealValueEither"</span><span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  access_token_key<span class="token punctuation">:</span> <span class="token string">"nopeNotReal"</span><span class="token punctuation">,</span> <span class="token comment">// from your User (oauth_token)</span>\n  access_token_secret<span class="token punctuation">:</span> <span class="token string">"hmmNoStillNotReal"</span> <span class="token comment">// from your User (oauth_token_secret)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ....</span>\n\nclient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"statuses/update"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> <span class="token string">\'Hello, World!\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Success!\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre>\n<p>Once I ran <code>node index</code> again, there was a <code>Hello, World!</code> tweet in my feed.</p>\n<p>Next, I combined the API and Twitter code, then ran it again;</p>\n<figure>\n          <a href="/images/blog-content/random-open-api/tweet.png"><img src="/images/blog-content/random-open-api/tweet.png" alt=""/></a>\n          <figcaption><p>A screenshot of the first Tweet posted (Daum maps).</p>\n</figcaption>\n        </figure><p>Isn\'t it beautiful?</p>\n<h3><a id="now-where-to-host-this" class="post-header-anchor" href="#now-where-to-host-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Now, where to host this?</h3>\n<p>I thought serverless would be a good fit for hosting this. I\'d heard the praise Zeit\'s <a href="https://zeit.co/now" rel="noopener">Now</a> had gotten so I thought I\'d give it a go. It\'s a serverless hosting platform which supports static files, JavaScript, PHP, Python, Go, and more.</p>\n<p>They have integrations with GitHub and more but I went with the slightly more manual approach. I ran <code>npm install -g now &amp;&amp; now login</code> and added a <code>now.json</code> file;</p>\n<pre><code class="language-javascripton">{\n  "version": 2,\n  "builds": [{ "src": "*.js", "use": "@now/node" }]\n}\n</code></pre>\n<p>This tells Now that any JavaScript files should be built with their Node.js builder.</p>\n<p>I had to tweak my <code>index.js</code> slightly. First to add their function boilerplate, and secondly to call <code>res.end</code> to output something, rather than logging it to the console;</p>\n<pre><code class="language-javascript"><span class="token comment">// ...</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// Zeit boilerplate</span>\n  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/random\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    \n    <span class="token comment">// Tweet, tweet!</span>\n    client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"statuses/update"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> tweet <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">\'Success!\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>stack<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>stack<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>I then ran <code>now</code> which is their command for deploying your serverless function. This took a bit longer than I expected to be honest, but to be fair there\'s probably a lot going behind the scenes to achieve what Zeit provides.</p>\n<p>The result:</p>\n<pre><code class="language-shell">> Deploying ~/Code/random-open-api under notmyreal@email.com\n> Using project random-open-api\n> https://random-open-api-jdhf89whf3489.now.sh [v2] [in clipboard] [3s]\n┌ index.js        Ready               [24s]\n└── λ index.js (39.83KB) [bru1]\n> Success! Deployment ready [28s]\n</code></pre>\n<p>Now gives you a new URL each time you deploy. I went to this URL in my browser and saw &quot;Success!&quot;. Yes, it sent the tweet! That was easy.</p>\n<h3><a id="getting-secretive" class="post-header-anchor" href="#getting-secretive" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Getting secretive</h3>\n<p>I planned to open source the code and I didn\'t want to commit my Twitter credentials. First, I needed to create a secret for each so I ran the following commands:</p>\n<pre><code class="language-shell">now secret add CONSUMER_KEY "notTheRealValue"\nnow secret add CONSUMER_SECRET "notTheRealValueEither"\nnow secret add ACCESS_TOKEN_KEY "nopeNotReal"\nnow secret add ACCESS_TOKEN_SECRET "hmmNoStillNotReal"\n</code></pre>\n<p>Then I added the following <code>env</code> object to my <code>now.json</code> file.</p>\n<pre><code class="language-javascripton">{\n  "version": 2,\n  "builds": [{ "src": "*.js", "use": "@now/node" }],\n  "env": {\n    "CONSUMER_KEY": "@consumer_key",\n    "CONSUMER_SECRET": "@consumer_secret",\n    "ACCESS_TOKEN_KEY": "@access_token_key",\n    "ACCESS_TOKEN_SECRET": "@access_token_secret"\n  }\n}\n</code></pre>\n<p>This then allowed me to use <code>process.env.CONSUMER_KEY</code> in my function, for example;</p>\n<pre><code class="language-javascript"><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  subdomain<span class="token punctuation">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>\n  consumer_key<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>CONSUMER_KEY<span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  consumer_secret<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>CONSUMER_SECRET<span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  access_token_key<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>ACCESS_TOKEN_KEY<span class="token punctuation">,</span> <span class="token comment">// from your User (oauth_token)</span>\n  access_token_secret<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>ACCESS_TOKEN_SECRET <span class="token comment">// from your User (oauth_token_secret)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Now would replace those references with the actual values when deploying. Not too complicated right?</p>\n<p>I ran <code>now</code> again but this time it didn\'t work. I got a blank response in my browser. Well, what happened was I somehow managed to type <code>process.key</code> , not <code>process.env</code> . I went down a rabbit hole trying all sorts of other ways of using environment variables, secrets, <code>now-env</code> , and more, before realizing my mistake.</p>\n<h3><a id="automation" class="post-header-anchor" href="#automation" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Automation</h3>\n<p>I was feeling good. All I had to do was configure Now to run the function on a schedule, publish the code, write and publish the blog post. Profit.</p>\n<p>Well, Zeit doesn\'t support running things on a schedule 😦</p>\n<p>At least they don\'t in Now version 2. I remember there was a bit of talk around the fact they released a backwards incompatible v2. It was forward thinking but had fewer features than v1. I think v1 supported what I needed but I didn\'t want to start a project by going back in time.</p>\n<p>There were workarounds suggested in GitHub issues like having a <code>setInterval</code> in your function. Em, no. I swear, every time I play around with serverless, FaaS, or IoT, an obvious use case isn\'t covered.</p>\n<p>So I gave up on Now. I decided to manually log into Twitter and tweet a few times a day...</p>\n<p>I actually settled for a simple but uncomfortable solution. It turns out there\'s a completely free (and open source) service, <a href="https://cron-job.org/en/" rel="noopener">cron-job.org</a>, which will call your URL on a schedule.</p>\n<figure>\n          <a href="/images/blog-content/random-open-api/cron.png"><img src="/images/blog-content/random-open-api/cron.png" alt=""/></a>\n          <figcaption><p>The job configuration.</p>\n</figcaption>\n        </figure><p>All I had to do was sign up, create a job with my URL, and schedule it. As you see, I didn\'t even have to use the horrible <a href="http://www.nncron.ru/help/EN/working/cron-format.htm" rel="noopener">cron format</a>. It was painless.</p>\n<h3><a id="deployment-aliases" class="post-header-anchor" href="#deployment-aliases" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Deployment aliases</h3>\n<p>I realized that if I ever deploy an update, I\'ll have to log into <a href="http://cron-job.org" rel="noopener">cron-job.org</a> and update the URL. Then I discovered Now\'s aliases. Individual deployments can be assigned deployments;</p>\n<figure>\n          <a href="/images/blog-content/random-open-api/alias.png"><img src="/images/blog-content/random-open-api/alias.png" alt=""/></a>\n          <figcaption><p>The create alias modal.</p>\n</figcaption>\n        </figure><p>You can choose a <a href="http://now.sh" rel="noopener">now.sh</a> subdomain or give your own domain.</p>\n<p>So each time I update the code and deploy, I\'ll re-assign the alias to the new deployment. There\'s probably a better way around this but I didn\'t want to spend too long worrying about it. The code won\'t need to be updated much and if it ever does, I\'d assume the Now dashboard is where it\'s managed.</p>\n<h3><a id="the-end" class="post-header-anchor" href="#the-end" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The end</h3>\n<p>So that\'s it. It took me 42 minutes in total, including a couple of blunders. Thank you, bye.</p>\n<p>Goodbye!</p>\n<p>Hey, stop, why are you still reading?</p>\n<p>Ugh, fine...</p>\n<h3><a id="palm-have-you-met-face" class="post-header-anchor" href="#palm-have-you-met-face" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Palm, have you met face?</h3>\n<p>While writing this, I noticed that the API returns more than strictly &quot;open&quot; APIs. Some are, while others require some kind of signup and authentication. I guess I was trying to move too fast.</p>\n<p>Looking through results, even the ones which require authentication are still free and publicly available. It doesn\'t bother me then if they\'re not 100% &quot;open&quot;, the data is still there to use.</p>\n<p>Oh wait, no... they\'re not all free either. The <a href="https://semantria.readme.io/docs" rel="noopener">Semantria API</a> is one entry I just found for example; a &quot;paid Saas text analytics service&quot;.</p>\n<p><img src="/images/blog-content/random-open-api/godfather.gif" alt="&quot;Just when I thought I was out, they pull me back in!&quot; from the Godfather"></p>\n<p>Looking at the Public API for Public APIs again, they also return an <code>auth</code> property for each API. I\'ve seen results with <code>&quot;auth&quot;: &quot;apiKey&quot;</code>, <code>&quot;auth&quot;: &quot;OAuth&quot;</code>, and <code>&quot;auth&quot;: &quot;&quot;</code>. I need to tweet about the last case.</p>\n<p>The <code>/random</code> endpoint doesn\'t support filtering, so I\'d have to keep calling it until I get one that\'s open. Hmm.</p>\n<p>The <code>/entries</code> endpoint does support an <code>auth</code> filter parameter but it returns an array of APIs. This looks like my best bet. It doesn\'t support pagination so it must either return all or at least as many as it can. Here\'s the new API code:</p>\n<pre><code class="language-javascript">axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/entries?auth=null\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'No APIs found\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// Build tweet content from random result</span>\n  <span class="token keyword">const</span> api <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n</code></pre>\n<p>There\'s no reason why <code>/random</code> couldn\'t also accept filter parameters. After I publish this, I\'ll go make a pull-request.</p>\n<h3><a id="conclusion" class="post-header-anchor" href="#conclusion" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Conclusion</h3>\n<p>It was a nice break to rush head first into a small project, hacking something together without reading documentation, properly handling errors, etc. but I don\'t recommend working like this. It was almost a disaster.</p>\n<p>Follow <a href="twitter.com/randomOpenAPI">@randomOpenAPI</a> on Twitter. Check out the source code at <a href="github.com/adam-lynch/random-open-api">github.com/adam-lynch/random-open-api</a>.</p>\n<p>What could you make? I could imagine someone finding value in an account that tweets about <em>two</em> random APIs. The mashups might be handy for coming up with project ideas.</p>\n',attributes:{date:"2019-02-02T00:00:00.000Z",tags:[{id:"api",name:"api"},{id:"open-api",name:"open API"},{id:"public-api",name:"public API"},{id:"twitter",name:"twitter"},{id:"bot",name:"bot"},{id:"zeit",name:"zeit"},{id:"now",name:"now"},{id:"serverless",name:"serverless"},{id:"faas",name:"faas"},{id:"nodejs",name:"node.js"},{id:"cron",name:"cron"},{id:"development",name:"development"}],title:"How I made the @randomOpenAPI Twitter bot in 42 minutes-ish",updated_at:"2019-05-22T08:26:12.392Z",photo:"/images/blog-content/random-open-api/tweet.png"},title:"How I made the @randomOpenAPI Twitter bot in 42 minutes-ish",renderedSummary:'<p>I love APIs. Especially open APIs. I wish there were way more of them. There\'s a lot of data out there we can\'t get our hands on. Imagine all of the unborn apps, studies, and infographics.</p>\n<p>The natural conclusion was to create a Twitter bot. Have you ever seen Stefan Judis\' <a href="https://twitter.com/randommdn" rel="noopener">@randomMDN</a>? It tweets a random article from <a href="https://developer.mozilla.org/en-US/" rel="noopener">MDN</a> multiple times a day. I decided to create one of my own to raise awareness about open APIs. Plus it\'s an excuse for a small fun project.</p>\n',rendered:'<h2><a id="how-i-made-the-randomopenapi-twitter-bot-in-42-minutes-ish" class="post-header-anchor" href="#how-i-made-the-randomopenapi-twitter-bot-in-42-minutes-ish" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>How I made the @randomOpenAPI Twitter bot in 42 minutes-ish</h2>\n<p>In my day job, I\'m building a product in which nothing is simple. There\'s a lot of flexibility, customization, and connected dots. Sometimes I daydream about working on an app which has one page, no settings, customization, or integrations, a single fixed viewport size to worry about, and so on. You know, an empty page.</p>\n<p>Seriously, I do love the challenge and I know it will make a lot of people happy. However, I do wonder how quickly I could make something simple from scratch. That\'s what this project is about.</p>\n<p>I love APIs. Especially open APIs. I wish there were way more of them. There\'s a lot of data out there we can\'t get our hands on. Imagine all of the unborn apps, studies, and infographics.</p>\n<p>The natural conclusion was to create a Twitter bot. Have you ever seen Stefan Judis\' <a href="https://twitter.com/randommdn" rel="noopener">@randomMDN</a>? It tweets a random article from <a href="https://developer.mozilla.org/en-US/" rel="noopener">MDN</a> multiple times a day. I decided to create one of my own to raise awareness about open APIs. Plus it\'s an excuse for a small fun project.</p>\n<p>I decided to time myself while I was at it. It took 42 minutes but read on, it wasn\'t all smooth sailing.</p>\n<h4><a id="hello-world" class="post-header-anchor" href="#hello-world" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Hello, world!</h4>\n<p>I created a new directory with an <code>index.js</code> containing <code>console.log(\'Hello, world!)</code> and ran <code>node index</code> in the directory.</p>\n<p>OK, I managed not to mess that up. Then, I needed data about open APIs. Did you know people make curated lists of these APIs? Did you know there\'s... of course there\'s an API to get the list of APIs. Luckily, the <a href="https://api.publicapis.org/" rel="noopener">Public API for Public APIs</a> has a <code>/random</code> endpoint. At a glance it had enough information:</p>\n<ul>\n<li>title (string)</li>\n<li>description (string)</li>\n<li>category (string)</li>\n<li>And some other stuff (more about that later).</li>\n</ul>\n<p>Looks good. Now, I need to hit the API. I don\'t necessarily need to use a library but one library is better than two interfaces. I prefer a HTTP client library which supports both client and server-side usage. Axios is my latest library of choice for this. So I ran <code>npm init --yes &amp;&amp; npm install axios</code> . Then I added the following code to <code>index.js</code>:</p>\n<pre><code class="language-javascript">  <span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'axios\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  \n  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/random\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p>Notice how little effort I\'m putting into error handling. I\'m on the clock.</p>\n<p>Running <code>node index</code> resulted in:</p>\n<pre><code class="language-javascripton">{ count: 1,\n  entries:\n    [ { API: \'Livecoin\',\n        Description: \'Cryptocurrency Exchange\',\n        Auth: \'\',\n        HTTPS: true,\n        Cors: \'unknown\',\n        Link: \'https://www.livecoin.net/api\',\n        Category: \'Cryptocurrency\' } ] }\n</code></pre>\n<h3><a id="writing-the-tweet" class="post-header-anchor" href="#writing-the-tweet" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Writing the tweet</h3>\n<p>Next, I constructed a tweet from the data. Luckily, none of the text is very long and Twitter doubled their tweet character limit to 280. I fiddled around way too long here. This is what I ended up with:</p>\n<pre><code class="language-javascript"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'axios\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> camelCase <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'camelcase\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">formatHashtag</span> <span class="token operator">=</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">camelCase</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[^a-zA-Z0-9]/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\naxios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/random\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'No APIs found\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// Build tweet content</span>\n  <span class="token keyword">const</span> api <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> isDescriptionShort <span class="token operator">=</span> api<span class="token punctuation">.</span>Description<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> tweet <span class="token operator">=</span> <span class="token template-string"><span class="token string">`📡 Random Open API 📡\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api<span class="token punctuation">.</span>API<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// .API is the name of the API</span>\n\n  <span class="token comment">// If the description is too short, it\'s shown as a hashtag later instead</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isDescriptionShort<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    tweet <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api<span class="token punctuation">.</span>Description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> `</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  tweet <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>api<span class="token punctuation">.</span>Link<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> `</span></span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'openApi\'</span><span class="token punctuation">,</span> <span class="token string">\'api\'</span><span class="token punctuation">,</span> <span class="token function">formatHashtag</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>Category<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span>isDescriptionShort<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">formatHashtag</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  tweet <span class="token operator">+=</span> tags<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>tag <span class="token operator">=></span> <span class="token template-string"><span class="token string">`#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p>I didn\'t like how it looked when the description was short (e.g. <code>Discogs: Music</code>). In this case, I used it as a hashtag instead.</p>\n<h3><a id="tweet-tweet" class="post-header-anchor" href="#tweet-tweet" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Tweet, tweet!</h3>\n<p>Next is actually sending a tweet. I did a quick google and ended up running <code>npm install twitter-lite</code> . I chose <a href="https://www.npmjs.com/package/twitter-lite" rel="noopener">twitter-lite</a> because:</p>\n<ol>\n<li>The documentation showed me what I needed to do at a glance.</li>\n<li>It didn\'t seem too heavy or outdated.</li>\n<li>It had <code>lite</code> in the name 🤷‍♂️.</li>\n</ol>\n<p>I needed the following Twitter credentials to post a tweet:</p>\n<ul>\n<li>Consumer key.</li>\n<li>Consumer secret.</li>\n<li>Access token key.</li>\n<li>Access token secret.</li>\n</ul>\n<p>This is what took the longest in this project. I created the Twitter account, applied for access to <a href="https://developer.twitter.com/" rel="noopener">Twitter\'s APIs</a>, created an app, and got the credentials I needed. I\'m not going into too much detail here, it\'s tedious.</p>\n<p>I commented out the Axios call from before and threw in the following:</p>\n<pre><code class="language-javascript"><span class="token comment">// ...</span>\n<span class="token keyword">const</span> Twitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'twitter-lite\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  subdomain<span class="token punctuation">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>\n  consumer_key<span class="token punctuation">:</span> <span class="token string">"notTheRealValue"</span><span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  consumer_secret<span class="token punctuation">:</span> <span class="token string">"notTheRealValueEither"</span><span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  access_token_key<span class="token punctuation">:</span> <span class="token string">"nopeNotReal"</span><span class="token punctuation">,</span> <span class="token comment">// from your User (oauth_token)</span>\n  access_token_secret<span class="token punctuation">:</span> <span class="token string">"hmmNoStillNotReal"</span> <span class="token comment">// from your User (oauth_token_secret)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ....</span>\n\nclient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"statuses/update"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> <span class="token string">\'Hello, World!\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Success!\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre>\n<p>Once I ran <code>node index</code> again, there was a <code>Hello, World!</code> tweet in my feed.</p>\n<p>Next, I combined the API and Twitter code, then ran it again;</p>\n<figure>\n          <a href="/images/blog-content/random-open-api/tweet.png"><img src="/images/blog-content/random-open-api/tweet.png" alt=""/></a>\n          <figcaption><p>A screenshot of the first Tweet posted (Daum maps).</p>\n</figcaption>\n        </figure><p>Isn\'t it beautiful?</p>\n<h3><a id="now-where-to-host-this" class="post-header-anchor" href="#now-where-to-host-this" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Now, where to host this?</h3>\n<p>I thought serverless would be a good fit for hosting this. I\'d heard the praise Zeit\'s <a href="https://zeit.co/now" rel="noopener">Now</a> had gotten so I thought I\'d give it a go. It\'s a serverless hosting platform which supports static files, JavaScript, PHP, Python, Go, and more.</p>\n<p>They have integrations with GitHub and more but I went with the slightly more manual approach. I ran <code>npm install -g now &amp;&amp; now login</code> and added a <code>now.json</code> file;</p>\n<pre><code class="language-javascripton">{\n  "version": 2,\n  "builds": [{ "src": "*.js", "use": "@now/node" }]\n}\n</code></pre>\n<p>This tells Now that any JavaScript files should be built with their Node.js builder.</p>\n<p>I had to tweak my <code>index.js</code> slightly. First to add their function boilerplate, and secondly to call <code>res.end</code> to output something, rather than logging it to the console;</p>\n<pre><code class="language-javascript"><span class="token comment">// ...</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// Zeit boilerplate</span>\n  axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/random\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n    \n    <span class="token comment">// Tweet, tweet!</span>\n    client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"statuses/update"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> tweet <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">\'Success!\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span>stack<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\n\\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>stack<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>I then ran <code>now</code> which is their command for deploying your serverless function. This took a bit longer than I expected to be honest, but to be fair there\'s probably a lot going behind the scenes to achieve what Zeit provides.</p>\n<p>The result:</p>\n<pre><code class="language-shell">> Deploying ~/Code/random-open-api under notmyreal@email.com\n> Using project random-open-api\n> https://random-open-api-jdhf89whf3489.now.sh [v2] [in clipboard] [3s]\n┌ index.js        Ready               [24s]\n└── λ index.js (39.83KB) [bru1]\n> Success! Deployment ready [28s]\n</code></pre>\n<p>Now gives you a new URL each time you deploy. I went to this URL in my browser and saw &quot;Success!&quot;. Yes, it sent the tweet! That was easy.</p>\n<h3><a id="getting-secretive" class="post-header-anchor" href="#getting-secretive" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Getting secretive</h3>\n<p>I planned to open source the code and I didn\'t want to commit my Twitter credentials. First, I needed to create a secret for each so I ran the following commands:</p>\n<pre><code class="language-shell">now secret add CONSUMER_KEY "notTheRealValue"\nnow secret add CONSUMER_SECRET "notTheRealValueEither"\nnow secret add ACCESS_TOKEN_KEY "nopeNotReal"\nnow secret add ACCESS_TOKEN_SECRET "hmmNoStillNotReal"\n</code></pre>\n<p>Then I added the following <code>env</code> object to my <code>now.json</code> file.</p>\n<pre><code class="language-javascripton">{\n  "version": 2,\n  "builds": [{ "src": "*.js", "use": "@now/node" }],\n  "env": {\n    "CONSUMER_KEY": "@consumer_key",\n    "CONSUMER_SECRET": "@consumer_secret",\n    "ACCESS_TOKEN_KEY": "@access_token_key",\n    "ACCESS_TOKEN_SECRET": "@access_token_secret"\n  }\n}\n</code></pre>\n<p>This then allowed me to use <code>process.env.CONSUMER_KEY</code> in my function, for example;</p>\n<pre><code class="language-javascript"><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  subdomain<span class="token punctuation">:</span> <span class="token string">"api"</span><span class="token punctuation">,</span>\n  consumer_key<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>CONSUMER_KEY<span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  consumer_secret<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>CONSUMER_SECRET<span class="token punctuation">,</span> <span class="token comment">// from Twitter.</span>\n  access_token_key<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>ACCESS_TOKEN_KEY<span class="token punctuation">,</span> <span class="token comment">// from your User (oauth_token)</span>\n  access_token_secret<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>ACCESS_TOKEN_SECRET <span class="token comment">// from your User (oauth_token_secret)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>Now would replace those references with the actual values when deploying. Not too complicated right?</p>\n<p>I ran <code>now</code> again but this time it didn\'t work. I got a blank response in my browser. Well, what happened was I somehow managed to type <code>process.key</code> , not <code>process.env</code> . I went down a rabbit hole trying all sorts of other ways of using environment variables, secrets, <code>now-env</code> , and more, before realizing my mistake.</p>\n<h3><a id="automation" class="post-header-anchor" href="#automation" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Automation</h3>\n<p>I was feeling good. All I had to do was configure Now to run the function on a schedule, publish the code, write and publish the blog post. Profit.</p>\n<p>Well, Zeit doesn\'t support running things on a schedule 😦</p>\n<p>At least they don\'t in Now version 2. I remember there was a bit of talk around the fact they released a backwards incompatible v2. It was forward thinking but had fewer features than v1. I think v1 supported what I needed but I didn\'t want to start a project by going back in time.</p>\n<p>There were workarounds suggested in GitHub issues like having a <code>setInterval</code> in your function. Em, no. I swear, every time I play around with serverless, FaaS, or IoT, an obvious use case isn\'t covered.</p>\n<p>So I gave up on Now. I decided to manually log into Twitter and tweet a few times a day...</p>\n<p>I actually settled for a simple but uncomfortable solution. It turns out there\'s a completely free (and open source) service, <a href="https://cron-job.org/en/" rel="noopener">cron-job.org</a>, which will call your URL on a schedule.</p>\n<figure>\n          <a href="/images/blog-content/random-open-api/cron.png"><img src="/images/blog-content/random-open-api/cron.png" alt=""/></a>\n          <figcaption><p>The job configuration.</p>\n</figcaption>\n        </figure><p>All I had to do was sign up, create a job with my URL, and schedule it. As you see, I didn\'t even have to use the horrible <a href="http://www.nncron.ru/help/EN/working/cron-format.htm" rel="noopener">cron format</a>. It was painless.</p>\n<h3><a id="deployment-aliases" class="post-header-anchor" href="#deployment-aliases" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Deployment aliases</h3>\n<p>I realized that if I ever deploy an update, I\'ll have to log into <a href="http://cron-job.org" rel="noopener">cron-job.org</a> and update the URL. Then I discovered Now\'s aliases. Individual deployments can be assigned deployments;</p>\n<figure>\n          <a href="/images/blog-content/random-open-api/alias.png"><img src="/images/blog-content/random-open-api/alias.png" alt=""/></a>\n          <figcaption><p>The create alias modal.</p>\n</figcaption>\n        </figure><p>You can choose a <a href="http://now.sh" rel="noopener">now.sh</a> subdomain or give your own domain.</p>\n<p>So each time I update the code and deploy, I\'ll re-assign the alias to the new deployment. There\'s probably a better way around this but I didn\'t want to spend too long worrying about it. The code won\'t need to be updated much and if it ever does, I\'d assume the Now dashboard is where it\'s managed.</p>\n<h3><a id="the-end" class="post-header-anchor" href="#the-end" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The end</h3>\n<p>So that\'s it. It took me 42 minutes in total, including a couple of blunders. Thank you, bye.</p>\n<p>Goodbye!</p>\n<p>Hey, stop, why are you still reading?</p>\n<p>Ugh, fine...</p>\n<h3><a id="palm-have-you-met-face" class="post-header-anchor" href="#palm-have-you-met-face" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Palm, have you met face?</h3>\n<p>While writing this, I noticed that the API returns more than strictly &quot;open&quot; APIs. Some are, while others require some kind of signup and authentication. I guess I was trying to move too fast.</p>\n<p>Looking through results, even the ones which require authentication are still free and publicly available. It doesn\'t bother me then if they\'re not 100% &quot;open&quot;, the data is still there to use.</p>\n<p>Oh wait, no... they\'re not all free either. The <a href="https://semantria.readme.io/docs" rel="noopener">Semantria API</a> is one entry I just found for example; a &quot;paid Saas text analytics service&quot;.</p>\n<p><img src="/images/blog-content/random-open-api/godfather.gif" alt="&quot;Just when I thought I was out, they pull me back in!&quot; from the Godfather"></p>\n<p>Looking at the Public API for Public APIs again, they also return an <code>auth</code> property for each API. I\'ve seen results with <code>&quot;auth&quot;: &quot;apiKey&quot;</code>, <code>&quot;auth&quot;: &quot;OAuth&quot;</code>, and <code>&quot;auth&quot;: &quot;&quot;</code>. I need to tweet about the last case.</p>\n<p>The <code>/random</code> endpoint doesn\'t support filtering, so I\'d have to keep calling it until I get one that\'s open. Hmm.</p>\n<p>The <code>/entries</code> endpoint does support an <code>auth</code> filter parameter but it returns an array of APIs. This looks like my best bet. It doesn\'t support pagination so it must either return all or at least as many as it can. Here\'s the new API code:</p>\n<pre><code class="language-javascript">axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'https://api.publicapis.org/entries?auth=null\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'No APIs found\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// Build tweet content from random result</span>\n  <span class="token keyword">const</span> api <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n</code></pre>\n<p>There\'s no reason why <code>/random</code> couldn\'t also accept filter parameters. After I publish this, I\'ll go make a pull-request.</p>\n<h3><a id="conclusion" class="post-header-anchor" href="#conclusion" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Conclusion</h3>\n<p>It was a nice break to rush head first into a small project, hacking something together without reading documentation, properly handling errors, etc. but I don\'t recommend working like this. It was almost a disaster.</p>\n<p>Follow <a href="twitter.com/randomOpenAPI">@randomOpenAPI</a> on Twitter. Check out the source code at <a href="github.com/adam-lynch/random-open-api">github.com/adam-lynch/random-open-api</a>.</p>\n<p>What could you make? I could imagine someone finding value in an account that tweets about <em>two</em> random APIs. The mashups might be handy for coming up with project ideas.</p>\n',summary:"I love APIs. Especially open APIs. I wish there were way more of them. There's a lot of data out there we can't get our hands on. Imagine all of the unborn apps, studies, and infographics.\nThe natural conclusion was to create a Twitter bot. Have you ever seen Stefan Judis' @randomMDN? It tweets a random article from MDN multiple times a day. I decided to create one of my own to raise awareness about open APIs. Plus it's an excuse for a small fun project.\n",photo:"/images/blog-content/random-open-api/tweet.png",keywords:["api","open API","public API","twitter","bot","zeit","now","serverless","faas","node.js","cron","development"],published_at:"2019-02-02T00:00:00.000Z",updated_at:"2019-05-22T08:26:12.392Z",year:2019,month:2,day:3,relevanceScore:1.875},{id:"improve-permissions-ux",slug:"improve-permissions-ux",highlightedLanguages:["javascript"],source:"---\ndate: 2018-03-03\ntags:\n  - ux\n  - permissions\n  - pwa\n  - web\n  - javascript\n  - notifications\n  - geolocation\n  - extension\n  - browsers\n  - development\n---\n\n## How to improve your permissions UX\n\n:::summary\n\n\"Welcome to Costco, can I have your phone number?\" Most people would refuse, right? Well I suppose *some* might oblige, but that depends on a host of factors. This is what permissions requests are like on the web. Let's take a look at how we can do better, before it's too late. Side note: a phone number is like a SnapChat username to your parents.\n\n:::\n\nWe sure can build amazing experiences these days. We can leverage powerful browser APIs to access  users' location, send them notifications (whether your site is open or not), interact with MIDI devices, and a lot more. We didn't get here on our own though. A lot of these capabilities came to other platforms first. We are in our own league when it comes to UX and engagement however. Most users see permissions requests (and these capabilities) as a nuisance.\n\n:::figure improve-permissions-ux/chris-wilson.png Chris Wilson, [The New Bar for Web Experiences](https://www.youtube.com/watch?v=PsgW-0M67TQ) (Chrome Dev Summit 2017)\n:::\n\nAt the last Chrome Dev Summit, Chris Wilson revealed that over 90% of permissions requests in Chrome for Android were unsuccessful. It's understandable. If there were an annoyance scale, I'd position it somewhere between auto-playing media and when native mobile apps open a page from their own website in a WebView, which has a banner that tells you to install their mobile app.\n\nExamples aren't needed because we've all experienced it. It's not so bad if it's obvious why the permission is needed, but in general, we need to try harder. [Peter-Paul Koch argued](https://www.quirksmode.org/blog/archives/2015/05/web_vs_native_l.html) that the web shouldn't emulate native (apps) because it will lead to bad UX. Was he right? These APIs aren't at fault but our implementations are sloppy. As web developers and designers we should lift our heads up and look around a bit more; we can learn a lot from mobile (and other platforms).\n\n\n### Why should I care?\n\nWell, the user's experience should be of utmost importance in general, but in particular, it's a bad first impression to immediately ask someone for their location. A permissions request is an easy way to disrupt the user and it instantly makes your site less trustworthy. From content credibility to conversions, trust plays a key role on the web. Simplest of all, you aren't achieving what you set out to; users aren't accepting permissions requests. In fact, it could be hurting you more than it helps. For example, you might want to send people notifications to reduce churn and keep them coming back to your content. However, it could be driving people away before they even read a single article.\n\n:::figure improve-permissions-ux/balls.jpg What the permissions prompt looks like in Chrome 63.\n:::\n\nChrome 63 (mobile) [adds fuel to the fire](https://cloudfour.com/thinks/time-to-update-your-permissions-ux/). Requests appear like modals in front of the content and users no longer have the option to dismiss the request without making a decision. This will also reduce the amount of repeat requests as users can no longer dismiss. This will surely spur sites to improve their UX. Users will not put up with sites triggering a modal like that on top of HTML modals, banners and annoying ads covering the page on load.\n\nWhat will browsers do if we don't improve? They might disable access to these APIs by default. Users would then have to grant the permission from their browser settings. If browsers feel like being nice they might show a little icon somewhere (e.g. in the address bar) which would show the prompt on click. Disabling by default would be extreme but Google already [removed the notification centre](https://venturebeat.com/2018/03/01/microsoft-improves-its-ai-face-and-image-recognition-tools/) citing lack of usage and it would certainly make a lot of users happy.\n\n\n### When should I request access to these APIs?\n\nDon't. Just don't. Only ask for access if you really need it. If you're playing around on your personal site or making an API demo, fine, but if you have users, have empathy. You are not your users. If you're asking right away because it's critical to your app, I'd re-think that. Will your site or app really not function without it? I doubt it. Otherwise, you'd have to block people from using your app who respond negatively to the permissions request then? Even https://webcamtests.com/ doesn't immediately ask for access to your webcam.\n\nIf you actually need access, context is key. It starts at the door. Make sure the user understands what your site or app is about. How can they if they're immediately presented with a request to track their location? Provide some value to the user first if you can, build some trust. Only ask *when* you really need to. Wait until they get to your store locator before you even begin to think about asking for their location. Ask the user if they'd like to receive notifications of new articles after they'd read a couple. People often think of progressive enhancement as a stack. Just because the user's browsers supports a feature, doesn't mean you should use it right away. There is something to be said for nailing the core experience and enhancing it over time, you know, progressively.\n\n\n### The double request pattern\n\nIf you are going to interrupt the user (and that's what it is, an interruption), then at least do your best to increase the chances of acceptance. You may only get one attempt. Clicking \"Block\" in Google Chrome is permanent, unless the user goes and manually overrides it for your site in Chrome's settings. Other browsers have a \"Remember this choice\" checkbox which results in the same thing.  \n\n:::figure improve-permissions-ux/google-calendar.png Google Calendar's fake UI prompt for notifications\n:::\n\nThis is where the double request pattern from mobile-land comes in. Show some fake UI first, i.e. HTML. If the user responds positively, then trigger the native permissions request. If it's rejected or ignored, then fine. You're not limited to one attempt and can ask them again whenever you want. Be smart here though, don't bombard the user. Ask again after a few more visits or come up with a clever algorithm.\n\nRequests without context are granted 40% less (another fact Chris Wilson shared in his talk). When showing this fake prompt, explain why the permission is needed, how the user will benefit, what will happen once they accept (the native request prompt will appear), etc. If you want to send notifications, what will the notifications be about? How often will the user receive them? The new Google Calendar's fake notification prompt is a good example.\n\nYou were probably imagining a popup (like Google Calendar's one) so far, but hiding the option away in your app's settings would be even better (although they're not mutually exclusively). Allowing the user to opt-in like that is surely the pattern with the highest success rate.\n\n\n#### The permissions API\n\nOne problem with using fake UI is knowing whether or not the user has already granted the permission. You don't want to show the popup again on every visit and if it's an app setting, it should look enabled. Some of the APIs provide a way to figure this out. Notifications for example; `Notification.permission` will either be `granted`, `denied`, or `prompt`. This varies from API to API and some APIs haven't got an option like that at all. For example, the geolocation API; there is no way to check if the user has previously granted access to their location without requesting it again.\n \nThe [Permissions API](https://w3c.github.io/permissions/) comes in handy here. It allows us to query the status of any permission through a single (asynchronous) interface, even the geolocation API. For example:\n\n```javascript\nnavigator.permissions.query({ name: 'notifications' })\n  .then((result) -> {\n\t  if(result.status === 'granted'){\n\t    // They've granted permission previously\n\t  }\n\t  // Otherwise result.status is 'denied' or 'prompt'\n  })\n  .catch((error) -> {\n    /* \n     * The permission state cannot be checked. \n     * E.g. Firefox didn't support the persistent-storage permission name until Firefox 53\n     */\n  });\n```\n\nFor some APIs, permissions aren't as simple though so you can provide some context when querying;\n\n```javascript\nnavigator.permissions.query({ name: 'midi', sysex: true })\n  // ...\n```\n\nUnfortunately, the Permissions API is currently only supported in Chrome (43+) and Firefox (46+). When a permission is explicitly granted or denied, you can store that information in [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) (or elsewhere) as a fallback. Then you can look up the permission's state there instead of querying it using the Permission API.\n\nThe [Mozilla Developer Network](https://developer.mozilla.org/en-US/docs/Web/API/Permissions) also describes similar methods for requesting and revoking permissions. No browser supports the former and the latter is only supported in Firefox (47+);\n\n```javascript\nnavigator.permissions.revoke({ name: 'microphone' })\n  // ...\n```\n\n\n### Incentivize the user\n\nTo encourage the user to opt-in, you could explain that they will be rewarded in some way. It's to you what that reward could be. Alternatively, you could just use gamification. For example, you could show an on-boarding checklist somewhere in your app, containing \"Enable notifications\" and anything else you'd like. Simply showing the number of completed items or completion percentage to the user will be enough to get some to enable notifications. Don't blackmail users though; don't block them from using certain features until they've granted a permission or signed up for your newsletter or anything like that.\n\n\n### What if the native request is rejected?\n\nIt's unlikely but there is a chance the user could still reject access once the native prompt is shown (or ignore it). If this happens, you should show some feedback and explain how to manually enable the permission via their browser settings (or link to an explanation).\n\n:::figure improve-permissions-ux/whatsapp.png The overlay WhatsApp (web) shows when the native prompt is shown.\n:::\n\nWe can do more than cross our fingers though. When the user interacts with your fake UI and you're about to trigger the native prompt, you could show something to guide them. It could even be an overlay which covers the entire page. By doing this, you can draw more attention to the prompt, prevent it being ignored, and even show some text. I remember when Google Chrome first got popular, some sites would show an arrow pointing at the download bar after you downloaded something. It was crude but it worked. I'd keep this overlay simple though. You shouldn't assume where the native prompt will appear, browser-sniff, or have too much code here in general.\n\n\n### Be reasonable\n\nWhat you do once they enable the permission is another story. First of all, you should ideally give users the option to opt-out. Especially if it's notifications they're granting, [don't go overboard](https://www.youtube.com/watch?v=gkND9G_VqVo). There is no spam filter for notifications. You could provide further settings to tweak how permissions are used. For example, Slack provides granular settings around notifications. My favourite part is that it defaults to sending you a notification for every message but once you've settled into app, it recommends reducing your notification level so you'll only get notified when you're @mentioned.\n\nDon't send the user multiple notifications for the same thing. Even if I've your app is open in 20 tabs, I should only get one notification per event. The Notification API allows you to provide a \"tag\" to achieve this;\n\n```javascript\nnew Notification(\"New email from ...\", { \n  body: \"Hey, how are you? I was wondering...\",\n  tag: \"1\" \n  // ...\n});\n```\n\nIf multiple notifications are created with the same tag (e.g. an email ID), the user will only receive one.\n\n\n### Be pragmatic\n\nYou don't need to do *all* of this. It depends how important the permission in question is to your site. The web would be a better place if everyone applied even a little bit of this.\n\n::: quote Peter Drucker\nIf you can't measure it, you can't improve it.\n:::\n\nFor each permission or feature, track engagement and acceptance, how far users get before rejecting a permission, etc. This is a conversion funnel like any other. You can then tweak it and A/B test.\n\n\n### Dear browsers\n\nHelp us out. Changes could be made to improve the experience for users and prevent abuse. To be fair, browsers block requesting a permission after three dismissals (i.e. when the user ignores it). Google Chrome (at least) allows requests again after a week. This is good but more could be done. \n\nMaybe browsers could allow us to provide some text (a new API option) that will be shown within the native prompt to give more context to the user. This might make a request to access the user's microphone feel a bit less creepy. Alternatively, if we pass a callback, the prompt could have an icon, link, or button to learn why the permission is being requested.\n\nNow let's take a look at some measures that already exist to prevent abuse. As a security feature, the Bluetooth API doesn't allow you to request a device unless it was triggered by a \"user gesture\" such as a touch or click. \n\nChrome (at least) no longer allows notifications from iFrames, from insecure origins ([like other features](https://sites.google.com/a/chromium.org/dev/Home/chromium-security/deprecating-powerful-features-on-insecure-origins)), and even warns you if you request notifications and it wasn't in response to a user gesture. Can't we just enforce this for any permissions request?\n\nChrome's rules around accessing persistent-storage aren't as simple; Chrome will automatically grant the persistence permission if any of the following are true:\n\n- The site is bookmarked (and the user has 5 or less bookmarks)\n- The site has high site engagement\n- The site has been added to home screen\n- The site has push notifications enabled\n\nOtherwise, the permission is automatically denied. \n\nI'm not saying those rules are good or bad but browsers should agree on *some* rules to enforce in respect to all permissions requests. That is my plea. Of course, developers and designers need to do better regardless, but this would really help.\n\nP.S. I noticed there's now a [Dialog API](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog); it would be nice to add some rules here too before it gets too popular and people are using it to display ads the second you hit their page. \n\n\n### Introducing AskBlocker\n\nI've been thinking about writing this for a long time and it was Jason Grigsby's [Time to Update Your Permissions UX](https://cloudfour.com/thinks/time-to-update-your-permissions-ux/) post that inspired me to actually do it. Not only did it turn out to be much longer than I expected, but I brought more work on myself by deciding to create browser extensions as well. \n\n:::figure improve-permissions-ux/askblocker.png AskBlocker for Chrome (screenshot)\n:::\n\n[AskBlocker](https://adamlynch.com/askblocker/) is an extension for Chrome, Firefox, and Brave, which keeps permissions requests in check. Permissions requests are blocked until you've interacted with the page (i.e. click, tap, or key press), with the following exceptions:\n\n- If the permission has been previously requested and granted (or explicitly denied).\n- If the domain is `localhost` or `127.0.0.1`.\n- If you've navigated to the current page from another page on the same domain.\n\nThis will at least block immediate requests to enable notifications the first time you go a site. You can see the requests which were caught and whitelist them (it will ask again and reload, to be safe). It's [open-source](https://github.com/adam-lynch/askblocker).\n\nNote: There aren't any extensions for other browsers (yet) because they don't support the Permissions API. \n\n\n### Conclusion\n\n- We can learn lessons from mobile development and more.\n- Users aren't granting permissions requests.\n- It's no longer possible to dismiss requests in Google Chrome's mobile apps.\n- We looked at how to improve your permissions UX and increase acceptance rate; the keys are discipline, context, timing, measuring, and trust, among others.\n- Browsers, please help.\n- Try out [AskBlocker](https://adamlynch.com/askblocker).\n",unfilteredRenderedBody:'<h2><a id="how-to-improve-your-permissions-ux" class="post-header-anchor" href="#how-to-improve-your-permissions-ux" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>How to improve your permissions UX</h2>\n<article-summary><p>&quot;Welcome to Costco, can I have your phone number?&quot; Most people would refuse, right? Well I suppose <em>some</em> might oblige, but that depends on a host of factors. This is what permissions requests are like on the web. Let\'s take a look at how we can do better, before it\'s too late. Side note: a phone number is like a SnapChat username to your parents.</p>\n</article-summary><p>We sure can build amazing experiences these days. We can leverage powerful browser APIs to access  users\' location, send them notifications (whether your site is open or not), interact with MIDI devices, and a lot more. We didn\'t get here on our own though. A lot of these capabilities came to other platforms first. We are in our own league when it comes to UX and engagement however. Most users see permissions requests (and these capabilities) as a nuisance.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/chris-wilson.png"><img src="/images/blog-content/improve-permissions-ux/chris-wilson.png" alt=""/></a>\n          <figcaption><p>Chris Wilson, <a href="https://www.youtube.com/watch?v=PsgW-0M67TQ" rel="noopener">The New Bar for Web Experiences</a> (Chrome Dev Summit 2017)</p>\n</figcaption>\n        </figure><p>At the last Chrome Dev Summit, Chris Wilson revealed that over 90% of permissions requests in Chrome for Android were unsuccessful. It\'s understandable. If there were an annoyance scale, I\'d position it somewhere between auto-playing media and when native mobile apps open a page from their own website in a WebView, which has a banner that tells you to install their mobile app.</p>\n<p>Examples aren\'t needed because we\'ve all experienced it. It\'s not so bad if it\'s obvious why the permission is needed, but in general, we need to try harder. <a href="https://www.quirksmode.org/blog/archives/2015/05/web_vs_native_l.html" rel="noopener">Peter-Paul Koch argued</a> that the web shouldn\'t emulate native (apps) because it will lead to bad UX. Was he right? These APIs aren\'t at fault but our implementations are sloppy. As web developers and designers we should lift our heads up and look around a bit more; we can learn a lot from mobile (and other platforms).</p>\n<h3><a id="why-should-i-care" class="post-header-anchor" href="#why-should-i-care" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Why should I care?</h3>\n<p>Well, the user\'s experience should be of utmost importance in general, but in particular, it\'s a bad first impression to immediately ask someone for their location. A permissions request is an easy way to disrupt the user and it instantly makes your site less trustworthy. From content credibility to conversions, trust plays a key role on the web. Simplest of all, you aren\'t achieving what you set out to; users aren\'t accepting permissions requests. In fact, it could be hurting you more than it helps. For example, you might want to send people notifications to reduce churn and keep them coming back to your content. However, it could be driving people away before they even read a single article.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/balls.jpg"><img src="/images/blog-content/improve-permissions-ux/balls.jpg" alt=""/></a>\n          <figcaption><p>What the permissions prompt looks like in Chrome 63.</p>\n</figcaption>\n        </figure><p>Chrome 63 (mobile) <a href="https://cloudfour.com/thinks/time-to-update-your-permissions-ux/" rel="noopener">adds fuel to the fire</a>. Requests appear like modals in front of the content and users no longer have the option to dismiss the request without making a decision. This will also reduce the amount of repeat requests as users can no longer dismiss. This will surely spur sites to improve their UX. Users will not put up with sites triggering a modal like that on top of HTML modals, banners and annoying ads covering the page on load.</p>\n<p>What will browsers do if we don\'t improve? They might disable access to these APIs by default. Users would then have to grant the permission from their browser settings. If browsers feel like being nice they might show a little icon somewhere (e.g. in the address bar) which would show the prompt on click. Disabling by default would be extreme but Google already <a href="https://venturebeat.com/2018/03/01/microsoft-improves-its-ai-face-and-image-recognition-tools/" rel="noopener">removed the notification centre</a> citing lack of usage and it would certainly make a lot of users happy.</p>\n<h3><a id="when-should-i-request-access-to-these-apis" class="post-header-anchor" href="#when-should-i-request-access-to-these-apis" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>When should I request access to these APIs?</h3>\n<p>Don\'t. Just don\'t. Only ask for access if you really need it. If you\'re playing around on your personal site or making an API demo, fine, but if you have users, have empathy. You are not your users. If you\'re asking right away because it\'s critical to your app, I\'d re-think that. Will your site or app really not function without it? I doubt it. Otherwise, you\'d have to block people from using your app who respond negatively to the permissions request then? Even <a href="https://webcamtests.com/" rel="noopener">https://webcamtests.com/</a> doesn\'t immediately ask for access to your webcam.</p>\n<p>If you actually need access, context is key. It starts at the door. Make sure the user understands what your site or app is about. How can they if they\'re immediately presented with a request to track their location? Provide some value to the user first if you can, build some trust. Only ask <em>when</em> you really need to. Wait until they get to your store locator before you even begin to think about asking for their location. Ask the user if they\'d like to receive notifications of new articles after they\'d read a couple. People often think of progressive enhancement as a stack. Just because the user\'s browsers supports a feature, doesn\'t mean you should use it right away. There is something to be said for nailing the core experience and enhancing it over time, you know, progressively.</p>\n<h3><a id="the-double-request-pattern" class="post-header-anchor" href="#the-double-request-pattern" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The double request pattern</h3>\n<p>If you are going to interrupt the user (and that\'s what it is, an interruption), then at least do your best to increase the chances of acceptance. You may only get one attempt. Clicking &quot;Block&quot; in Google Chrome is permanent, unless the user goes and manually overrides it for your site in Chrome\'s settings. Other browsers have a &quot;Remember this choice&quot; checkbox which results in the same thing.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/google-calendar.png"><img src="/images/blog-content/improve-permissions-ux/google-calendar.png" alt=""/></a>\n          <figcaption><p>Google Calendar\'s fake UI prompt for notifications</p>\n</figcaption>\n        </figure><p>This is where the double request pattern from mobile-land comes in. Show some fake UI first, i.e. HTML. If the user responds positively, then trigger the native permissions request. If it\'s rejected or ignored, then fine. You\'re not limited to one attempt and can ask them again whenever you want. Be smart here though, don\'t bombard the user. Ask again after a few more visits or come up with a clever algorithm.</p>\n<p>Requests without context are granted 40% less (another fact Chris Wilson shared in his talk). When showing this fake prompt, explain why the permission is needed, how the user will benefit, what will happen once they accept (the native request prompt will appear), etc. If you want to send notifications, what will the notifications be about? How often will the user receive them? The new Google Calendar\'s fake notification prompt is a good example.</p>\n<p>You were probably imagining a popup (like Google Calendar\'s one) so far, but hiding the option away in your app\'s settings would be even better (although they\'re not mutually exclusively). Allowing the user to opt-in like that is surely the pattern with the highest success rate.</p>\n<h4><a id="the-permissions-api" class="post-header-anchor" href="#the-permissions-api" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The permissions API</h4>\n<p>One problem with using fake UI is knowing whether or not the user has already granted the permission. You don\'t want to show the popup again on every visit and if it\'s an app setting, it should look enabled. Some of the APIs provide a way to figure this out. Notifications for example; <code>Notification.permission</code> will either be <code>granted</code>, <code>denied</code>, or <code>prompt</code>. This varies from API to API and some APIs haven\'t got an option like that at all. For example, the geolocation API; there is no way to check if the user has previously granted access to their location without requesting it again.</p>\n<p>The <a href="https://w3c.github.io/permissions/" rel="noopener">Permissions API</a> comes in handy here. It allows us to query the status of any permission through a single (asynchronous) interface, even the geolocation API. For example:</p>\n<pre><code class="language-javascript">navigator<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'notifications\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>\n\t  <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">\'granted\'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n\t    <span class="token comment">// They\'ve granted permission previously</span>\n\t  <span class="token punctuation">}</span>\n\t  <span class="token comment">// Otherwise result.status is \'denied\' or \'prompt\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">/* \n     * The permission state cannot be checked. \n     * E.g. Firefox didn\'t support the persistent-storage permission name until Firefox 53\n     */</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>For some APIs, permissions aren\'t as simple though so you can provide some context when querying;</p>\n<pre><code class="language-javascript">navigator<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'midi\'</span><span class="token punctuation">,</span> sysex<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// ...</span>\n</code></pre>\n<p>Unfortunately, the Permissions API is currently only supported in Chrome (43+) and Firefox (46+). When a permission is explicitly granted or denied, you can store that information in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener">localStorage</a> (or elsewhere) as a fallback. Then you can look up the permission\'s state there instead of querying it using the Permission API.</p>\n<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions" rel="noopener">Mozilla Developer Network</a> also describes similar methods for requesting and revoking permissions. No browser supports the former and the latter is only supported in Firefox (47+);</p>\n<pre><code class="language-javascript">navigator<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'microphone\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// ...</span>\n</code></pre>\n<h3><a id="incentivize-the-user" class="post-header-anchor" href="#incentivize-the-user" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Incentivize the user</h3>\n<p>To encourage the user to opt-in, you could explain that they will be rewarded in some way. It\'s to you what that reward could be. Alternatively, you could just use gamification. For example, you could show an on-boarding checklist somewhere in your app, containing &quot;Enable notifications&quot; and anything else you\'d like. Simply showing the number of completed items or completion percentage to the user will be enough to get some to enable notifications. Don\'t blackmail users though; don\'t block them from using certain features until they\'ve granted a permission or signed up for your newsletter or anything like that.</p>\n<h3><a id="what-if-the-native-request-is-rejected" class="post-header-anchor" href="#what-if-the-native-request-is-rejected" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>What if the native request is rejected?</h3>\n<p>It\'s unlikely but there is a chance the user could still reject access once the native prompt is shown (or ignore it). If this happens, you should show some feedback and explain how to manually enable the permission via their browser settings (or link to an explanation).</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/whatsapp.png"><img src="/images/blog-content/improve-permissions-ux/whatsapp.png" alt=""/></a>\n          <figcaption><p>The overlay WhatsApp (web) shows when the native prompt is shown.</p>\n</figcaption>\n        </figure><p>We can do more than cross our fingers though. When the user interacts with your fake UI and you\'re about to trigger the native prompt, you could show something to guide them. It could even be an overlay which covers the entire page. By doing this, you can draw more attention to the prompt, prevent it being ignored, and even show some text. I remember when Google Chrome first got popular, some sites would show an arrow pointing at the download bar after you downloaded something. It was crude but it worked. I\'d keep this overlay simple though. You shouldn\'t assume where the native prompt will appear, browser-sniff, or have too much code here in general.</p>\n<h3><a id="be-reasonable" class="post-header-anchor" href="#be-reasonable" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Be reasonable</h3>\n<p>What you do once they enable the permission is another story. First of all, you should ideally give users the option to opt-out. Especially if it\'s notifications they\'re granting, <a href="https://www.youtube.com/watch?v=gkND9G_VqVo" rel="noopener">don\'t go overboard</a>. There is no spam filter for notifications. You could provide further settings to tweak how permissions are used. For example, Slack provides granular settings around notifications. My favourite part is that it defaults to sending you a notification for every message but once you\'ve settled into app, it recommends reducing your notification level so you\'ll only get notified when you\'re @mentioned.</p>\n<p>Don\'t send the user multiple notifications for the same thing. Even if I\'ve your app is open in 20 tabs, I should only get one notification per event. The Notification API allows you to provide a &quot;tag&quot; to achieve this;</p>\n<pre><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"New email from ..."</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> \n  body<span class="token punctuation">:</span> <span class="token string">"Hey, how are you? I was wondering..."</span><span class="token punctuation">,</span>\n  tag<span class="token punctuation">:</span> <span class="token string">"1"</span> \n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>If multiple notifications are created with the same tag (e.g. an email ID), the user will only receive one.</p>\n<h3><a id="be-pragmatic" class="post-header-anchor" href="#be-pragmatic" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Be pragmatic</h3>\n<p>You don\'t need to do <em>all</em> of this. It depends how important the permission in question is to your site. The web would be a better place if everyone applied even a little bit of this.</p>\n<blockquote><p>If you can\'t measure it, you can\'t improve it.</p>\n<footer>&mdash;<cite><p>Peter Drucker</p>\n</cite></footer></blockquote><p>For each permission or feature, track engagement and acceptance, how far users get before rejecting a permission, etc. This is a conversion funnel like any other. You can then tweak it and A/B test.</p>\n<h3><a id="dear-browsers" class="post-header-anchor" href="#dear-browsers" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dear browsers</h3>\n<p>Help us out. Changes could be made to improve the experience for users and prevent abuse. To be fair, browsers block requesting a permission after three dismissals (i.e. when the user ignores it). Google Chrome (at least) allows requests again after a week. This is good but more could be done.</p>\n<p>Maybe browsers could allow us to provide some text (a new API option) that will be shown within the native prompt to give more context to the user. This might make a request to access the user\'s microphone feel a bit less creepy. Alternatively, if we pass a callback, the prompt could have an icon, link, or button to learn why the permission is being requested.</p>\n<p>Now let\'s take a look at some measures that already exist to prevent abuse. As a security feature, the Bluetooth API doesn\'t allow you to request a device unless it was triggered by a &quot;user gesture&quot; such as a touch or click.</p>\n<p>Chrome (at least) no longer allows notifications from iFrames, from insecure origins (<a href="https://sites.google.com/a/chromium.org/dev/Home/chromium-security/deprecating-powerful-features-on-insecure-origins" rel="noopener">like other features</a>), and even warns you if you request notifications and it wasn\'t in response to a user gesture. Can\'t we just enforce this for any permissions request?</p>\n<p>Chrome\'s rules around accessing persistent-storage aren\'t as simple; Chrome will automatically grant the persistence permission if any of the following are true:</p>\n<ul>\n<li>The site is bookmarked (and the user has 5 or less bookmarks)</li>\n<li>The site has high site engagement</li>\n<li>The site has been added to home screen</li>\n<li>The site has push notifications enabled</li>\n</ul>\n<p>Otherwise, the permission is automatically denied.</p>\n<p>I\'m not saying those rules are good or bad but browsers should agree on <em>some</em> rules to enforce in respect to all permissions requests. That is my plea. Of course, developers and designers need to do better regardless, but this would really help.</p>\n<p>P.S. I noticed there\'s now a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog" rel="noopener">Dialog API</a>; it would be nice to add some rules here too before it gets too popular and people are using it to display ads the second you hit their page.</p>\n<h3><a id="introducing-askblocker" class="post-header-anchor" href="#introducing-askblocker" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing AskBlocker</h3>\n<p>I\'ve been thinking about writing this for a long time and it was Jason Grigsby\'s <a href="https://cloudfour.com/thinks/time-to-update-your-permissions-ux/" rel="noopener">Time to Update Your Permissions UX</a> post that inspired me to actually do it. Not only did it turn out to be much longer than I expected, but I brought more work on myself by deciding to create browser extensions as well.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/askblocker.png"><img src="/images/blog-content/improve-permissions-ux/askblocker.png" alt=""/></a>\n          <figcaption><p>AskBlocker for Chrome (screenshot)</p>\n</figcaption>\n        </figure><p><a href="https://adamlynch.com/askblocker/" rel="noopener">AskBlocker</a> is an extension for Chrome, Firefox, and Brave, which keeps permissions requests in check. Permissions requests are blocked until you\'ve interacted with the page (i.e. click, tap, or key press), with the following exceptions:</p>\n<ul>\n<li>If the permission has been previously requested and granted (or explicitly denied).</li>\n<li>If the domain is <code>localhost</code> or <code>127.0.0.1</code>.</li>\n<li>If you\'ve navigated to the current page from another page on the same domain.</li>\n</ul>\n<p>This will at least block immediate requests to enable notifications the first time you go a site. You can see the requests which were caught and whitelist them (it will ask again and reload, to be safe). It\'s <a href="https://github.com/adam-lynch/askblocker" rel="noopener">open-source</a>.</p>\n<p>Note: There aren\'t any extensions for other browsers (yet) because they don\'t support the Permissions API.</p>\n<h3><a id="conclusion" class="post-header-anchor" href="#conclusion" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Conclusion</h3>\n<ul>\n<li>We can learn lessons from mobile development and more.</li>\n<li>Users aren\'t granting permissions requests.</li>\n<li>It\'s no longer possible to dismiss requests in Google Chrome\'s mobile apps.</li>\n<li>We looked at how to improve your permissions UX and increase acceptance rate; the keys are discipline, context, timing, measuring, and trust, among others.</li>\n<li>Browsers, please help.</li>\n<li>Try out <a href="https://adamlynch.com/askblocker" rel="noopener">AskBlocker</a>.</li>\n</ul>\n',attributes:{date:"2018-03-03T00:00:00.000Z",tags:[{id:"ux",name:"ux"},{id:"permissions",name:"permissions"},{id:"pwa",name:"pwa"},{id:"web",name:"web"},{id:"javascript",name:"javascript"},{id:"notifications",name:"notifications"},{id:"geolocation",name:"geolocation"},{id:"extension",name:"extension"},{id:"browsers",name:"browsers"},{id:"development",name:"development"}],title:"How to improve your permissions UX",updated_at:"2019-05-22T08:25:53.239Z",photo:"/images/blog-content/improve-permissions-ux/chris-wilson.png"},title:"How to improve your permissions UX",renderedSummary:"<p>&quot;Welcome to Costco, can I have your phone number?&quot; Most people would refuse, right? Well I suppose <em>some</em> might oblige, but that depends on a host of factors. This is what permissions requests are like on the web. Let's take a look at how we can do better, before it's too late. Side note: a phone number is like a SnapChat username to your parents.</p>\n",rendered:'<h2><a id="how-to-improve-your-permissions-ux" class="post-header-anchor" href="#how-to-improve-your-permissions-ux" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>How to improve your permissions UX</h2>\n<p>&quot;Welcome to Costco, can I have your phone number?&quot; Most people would refuse, right? Well I suppose <em>some</em> might oblige, but that depends on a host of factors. This is what permissions requests are like on the web. Let\'s take a look at how we can do better, before it\'s too late. Side note: a phone number is like a SnapChat username to your parents.</p>\n<p>We sure can build amazing experiences these days. We can leverage powerful browser APIs to access  users\' location, send them notifications (whether your site is open or not), interact with MIDI devices, and a lot more. We didn\'t get here on our own though. A lot of these capabilities came to other platforms first. We are in our own league when it comes to UX and engagement however. Most users see permissions requests (and these capabilities) as a nuisance.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/chris-wilson.png"><img src="/images/blog-content/improve-permissions-ux/chris-wilson.png" alt=""/></a>\n          <figcaption><p>Chris Wilson, <a href="https://www.youtube.com/watch?v=PsgW-0M67TQ" rel="noopener">The New Bar for Web Experiences</a> (Chrome Dev Summit 2017)</p>\n</figcaption>\n        </figure><p>At the last Chrome Dev Summit, Chris Wilson revealed that over 90% of permissions requests in Chrome for Android were unsuccessful. It\'s understandable. If there were an annoyance scale, I\'d position it somewhere between auto-playing media and when native mobile apps open a page from their own website in a WebView, which has a banner that tells you to install their mobile app.</p>\n<p>Examples aren\'t needed because we\'ve all experienced it. It\'s not so bad if it\'s obvious why the permission is needed, but in general, we need to try harder. <a href="https://www.quirksmode.org/blog/archives/2015/05/web_vs_native_l.html" rel="noopener">Peter-Paul Koch argued</a> that the web shouldn\'t emulate native (apps) because it will lead to bad UX. Was he right? These APIs aren\'t at fault but our implementations are sloppy. As web developers and designers we should lift our heads up and look around a bit more; we can learn a lot from mobile (and other platforms).</p>\n<h3><a id="why-should-i-care" class="post-header-anchor" href="#why-should-i-care" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Why should I care?</h3>\n<p>Well, the user\'s experience should be of utmost importance in general, but in particular, it\'s a bad first impression to immediately ask someone for their location. A permissions request is an easy way to disrupt the user and it instantly makes your site less trustworthy. From content credibility to conversions, trust plays a key role on the web. Simplest of all, you aren\'t achieving what you set out to; users aren\'t accepting permissions requests. In fact, it could be hurting you more than it helps. For example, you might want to send people notifications to reduce churn and keep them coming back to your content. However, it could be driving people away before they even read a single article.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/balls.jpg"><img src="/images/blog-content/improve-permissions-ux/balls.jpg" alt=""/></a>\n          <figcaption><p>What the permissions prompt looks like in Chrome 63.</p>\n</figcaption>\n        </figure><p>Chrome 63 (mobile) <a href="https://cloudfour.com/thinks/time-to-update-your-permissions-ux/" rel="noopener">adds fuel to the fire</a>. Requests appear like modals in front of the content and users no longer have the option to dismiss the request without making a decision. This will also reduce the amount of repeat requests as users can no longer dismiss. This will surely spur sites to improve their UX. Users will not put up with sites triggering a modal like that on top of HTML modals, banners and annoying ads covering the page on load.</p>\n<p>What will browsers do if we don\'t improve? They might disable access to these APIs by default. Users would then have to grant the permission from their browser settings. If browsers feel like being nice they might show a little icon somewhere (e.g. in the address bar) which would show the prompt on click. Disabling by default would be extreme but Google already <a href="https://venturebeat.com/2018/03/01/microsoft-improves-its-ai-face-and-image-recognition-tools/" rel="noopener">removed the notification centre</a> citing lack of usage and it would certainly make a lot of users happy.</p>\n<h3><a id="when-should-i-request-access-to-these-apis" class="post-header-anchor" href="#when-should-i-request-access-to-these-apis" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>When should I request access to these APIs?</h3>\n<p>Don\'t. Just don\'t. Only ask for access if you really need it. If you\'re playing around on your personal site or making an API demo, fine, but if you have users, have empathy. You are not your users. If you\'re asking right away because it\'s critical to your app, I\'d re-think that. Will your site or app really not function without it? I doubt it. Otherwise, you\'d have to block people from using your app who respond negatively to the permissions request then? Even <a href="https://webcamtests.com/" rel="noopener">https://webcamtests.com/</a> doesn\'t immediately ask for access to your webcam.</p>\n<p>If you actually need access, context is key. It starts at the door. Make sure the user understands what your site or app is about. How can they if they\'re immediately presented with a request to track their location? Provide some value to the user first if you can, build some trust. Only ask <em>when</em> you really need to. Wait until they get to your store locator before you even begin to think about asking for their location. Ask the user if they\'d like to receive notifications of new articles after they\'d read a couple. People often think of progressive enhancement as a stack. Just because the user\'s browsers supports a feature, doesn\'t mean you should use it right away. There is something to be said for nailing the core experience and enhancing it over time, you know, progressively.</p>\n<h3><a id="the-double-request-pattern" class="post-header-anchor" href="#the-double-request-pattern" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The double request pattern</h3>\n<p>If you are going to interrupt the user (and that\'s what it is, an interruption), then at least do your best to increase the chances of acceptance. You may only get one attempt. Clicking &quot;Block&quot; in Google Chrome is permanent, unless the user goes and manually overrides it for your site in Chrome\'s settings. Other browsers have a &quot;Remember this choice&quot; checkbox which results in the same thing.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/google-calendar.png"><img src="/images/blog-content/improve-permissions-ux/google-calendar.png" alt=""/></a>\n          <figcaption><p>Google Calendar\'s fake UI prompt for notifications</p>\n</figcaption>\n        </figure><p>This is where the double request pattern from mobile-land comes in. Show some fake UI first, i.e. HTML. If the user responds positively, then trigger the native permissions request. If it\'s rejected or ignored, then fine. You\'re not limited to one attempt and can ask them again whenever you want. Be smart here though, don\'t bombard the user. Ask again after a few more visits or come up with a clever algorithm.</p>\n<p>Requests without context are granted 40% less (another fact Chris Wilson shared in his talk). When showing this fake prompt, explain why the permission is needed, how the user will benefit, what will happen once they accept (the native request prompt will appear), etc. If you want to send notifications, what will the notifications be about? How often will the user receive them? The new Google Calendar\'s fake notification prompt is a good example.</p>\n<p>You were probably imagining a popup (like Google Calendar\'s one) so far, but hiding the option away in your app\'s settings would be even better (although they\'re not mutually exclusively). Allowing the user to opt-in like that is surely the pattern with the highest success rate.</p>\n<h4><a id="the-permissions-api" class="post-header-anchor" href="#the-permissions-api" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>The permissions API</h4>\n<p>One problem with using fake UI is knowing whether or not the user has already granted the permission. You don\'t want to show the popup again on every visit and if it\'s an app setting, it should look enabled. Some of the APIs provide a way to figure this out. Notifications for example; <code>Notification.permission</code> will either be <code>granted</code>, <code>denied</code>, or <code>prompt</code>. This varies from API to API and some APIs haven\'t got an option like that at all. For example, the geolocation API; there is no way to check if the user has previously granted access to their location without requesting it again.</p>\n<p>The <a href="https://w3c.github.io/permissions/" rel="noopener">Permissions API</a> comes in handy here. It allows us to query the status of any permission through a single (asynchronous) interface, even the geolocation API. For example:</p>\n<pre><code class="language-javascript">navigator<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'notifications\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>\n\t  <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">\'granted\'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n\t    <span class="token comment">// They\'ve granted permission previously</span>\n\t  <span class="token punctuation">}</span>\n\t  <span class="token comment">// Otherwise result.status is \'denied\' or \'prompt\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">/* \n     * The permission state cannot be checked. \n     * E.g. Firefox didn\'t support the persistent-storage permission name until Firefox 53\n     */</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>For some APIs, permissions aren\'t as simple though so you can provide some context when querying;</p>\n<pre><code class="language-javascript">navigator<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'midi\'</span><span class="token punctuation">,</span> sysex<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// ...</span>\n</code></pre>\n<p>Unfortunately, the Permissions API is currently only supported in Chrome (43+) and Firefox (46+). When a permission is explicitly granted or denied, you can store that information in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener">localStorage</a> (or elsewhere) as a fallback. Then you can look up the permission\'s state there instead of querying it using the Permission API.</p>\n<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions" rel="noopener">Mozilla Developer Network</a> also describes similar methods for requesting and revoking permissions. No browser supports the former and the latter is only supported in Firefox (47+);</p>\n<pre><code class="language-javascript">navigator<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'microphone\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// ...</span>\n</code></pre>\n<h3><a id="incentivize-the-user" class="post-header-anchor" href="#incentivize-the-user" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Incentivize the user</h3>\n<p>To encourage the user to opt-in, you could explain that they will be rewarded in some way. It\'s to you what that reward could be. Alternatively, you could just use gamification. For example, you could show an on-boarding checklist somewhere in your app, containing &quot;Enable notifications&quot; and anything else you\'d like. Simply showing the number of completed items or completion percentage to the user will be enough to get some to enable notifications. Don\'t blackmail users though; don\'t block them from using certain features until they\'ve granted a permission or signed up for your newsletter or anything like that.</p>\n<h3><a id="what-if-the-native-request-is-rejected" class="post-header-anchor" href="#what-if-the-native-request-is-rejected" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>What if the native request is rejected?</h3>\n<p>It\'s unlikely but there is a chance the user could still reject access once the native prompt is shown (or ignore it). If this happens, you should show some feedback and explain how to manually enable the permission via their browser settings (or link to an explanation).</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/whatsapp.png"><img src="/images/blog-content/improve-permissions-ux/whatsapp.png" alt=""/></a>\n          <figcaption><p>The overlay WhatsApp (web) shows when the native prompt is shown.</p>\n</figcaption>\n        </figure><p>We can do more than cross our fingers though. When the user interacts with your fake UI and you\'re about to trigger the native prompt, you could show something to guide them. It could even be an overlay which covers the entire page. By doing this, you can draw more attention to the prompt, prevent it being ignored, and even show some text. I remember when Google Chrome first got popular, some sites would show an arrow pointing at the download bar after you downloaded something. It was crude but it worked. I\'d keep this overlay simple though. You shouldn\'t assume where the native prompt will appear, browser-sniff, or have too much code here in general.</p>\n<h3><a id="be-reasonable" class="post-header-anchor" href="#be-reasonable" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Be reasonable</h3>\n<p>What you do once they enable the permission is another story. First of all, you should ideally give users the option to opt-out. Especially if it\'s notifications they\'re granting, <a href="https://www.youtube.com/watch?v=gkND9G_VqVo" rel="noopener">don\'t go overboard</a>. There is no spam filter for notifications. You could provide further settings to tweak how permissions are used. For example, Slack provides granular settings around notifications. My favourite part is that it defaults to sending you a notification for every message but once you\'ve settled into app, it recommends reducing your notification level so you\'ll only get notified when you\'re @mentioned.</p>\n<p>Don\'t send the user multiple notifications for the same thing. Even if I\'ve your app is open in 20 tabs, I should only get one notification per event. The Notification API allows you to provide a &quot;tag&quot; to achieve this;</p>\n<pre><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">"New email from ..."</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> \n  body<span class="token punctuation">:</span> <span class="token string">"Hey, how are you? I was wondering..."</span><span class="token punctuation">,</span>\n  tag<span class="token punctuation">:</span> <span class="token string">"1"</span> \n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>If multiple notifications are created with the same tag (e.g. an email ID), the user will only receive one.</p>\n<h3><a id="be-pragmatic" class="post-header-anchor" href="#be-pragmatic" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Be pragmatic</h3>\n<p>You don\'t need to do <em>all</em> of this. It depends how important the permission in question is to your site. The web would be a better place if everyone applied even a little bit of this.</p>\n<blockquote><p>If you can\'t measure it, you can\'t improve it.</p>\n<footer>&mdash;<cite><p>Peter Drucker</p>\n</cite></footer></blockquote><p>For each permission or feature, track engagement and acceptance, how far users get before rejecting a permission, etc. This is a conversion funnel like any other. You can then tweak it and A/B test.</p>\n<h3><a id="dear-browsers" class="post-header-anchor" href="#dear-browsers" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Dear browsers</h3>\n<p>Help us out. Changes could be made to improve the experience for users and prevent abuse. To be fair, browsers block requesting a permission after three dismissals (i.e. when the user ignores it). Google Chrome (at least) allows requests again after a week. This is good but more could be done.</p>\n<p>Maybe browsers could allow us to provide some text (a new API option) that will be shown within the native prompt to give more context to the user. This might make a request to access the user\'s microphone feel a bit less creepy. Alternatively, if we pass a callback, the prompt could have an icon, link, or button to learn why the permission is being requested.</p>\n<p>Now let\'s take a look at some measures that already exist to prevent abuse. As a security feature, the Bluetooth API doesn\'t allow you to request a device unless it was triggered by a &quot;user gesture&quot; such as a touch or click.</p>\n<p>Chrome (at least) no longer allows notifications from iFrames, from insecure origins (<a href="https://sites.google.com/a/chromium.org/dev/Home/chromium-security/deprecating-powerful-features-on-insecure-origins" rel="noopener">like other features</a>), and even warns you if you request notifications and it wasn\'t in response to a user gesture. Can\'t we just enforce this for any permissions request?</p>\n<p>Chrome\'s rules around accessing persistent-storage aren\'t as simple; Chrome will automatically grant the persistence permission if any of the following are true:</p>\n<ul>\n<li>The site is bookmarked (and the user has 5 or less bookmarks)</li>\n<li>The site has high site engagement</li>\n<li>The site has been added to home screen</li>\n<li>The site has push notifications enabled</li>\n</ul>\n<p>Otherwise, the permission is automatically denied.</p>\n<p>I\'m not saying those rules are good or bad but browsers should agree on <em>some</em> rules to enforce in respect to all permissions requests. That is my plea. Of course, developers and designers need to do better regardless, but this would really help.</p>\n<p>P.S. I noticed there\'s now a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog" rel="noopener">Dialog API</a>; it would be nice to add some rules here too before it gets too popular and people are using it to display ads the second you hit their page.</p>\n<h3><a id="introducing-askblocker" class="post-header-anchor" href="#introducing-askblocker" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Introducing AskBlocker</h3>\n<p>I\'ve been thinking about writing this for a long time and it was Jason Grigsby\'s <a href="https://cloudfour.com/thinks/time-to-update-your-permissions-ux/" rel="noopener">Time to Update Your Permissions UX</a> post that inspired me to actually do it. Not only did it turn out to be much longer than I expected, but I brought more work on myself by deciding to create browser extensions as well.</p>\n<figure>\n          <a href="/images/blog-content/improve-permissions-ux/askblocker.png"><img src="/images/blog-content/improve-permissions-ux/askblocker.png" alt=""/></a>\n          <figcaption><p>AskBlocker for Chrome (screenshot)</p>\n</figcaption>\n        </figure><p><a href="https://adamlynch.com/askblocker/" rel="noopener">AskBlocker</a> is an extension for Chrome, Firefox, and Brave, which keeps permissions requests in check. Permissions requests are blocked until you\'ve interacted with the page (i.e. click, tap, or key press), with the following exceptions:</p>\n<ul>\n<li>If the permission has been previously requested and granted (or explicitly denied).</li>\n<li>If the domain is <code>localhost</code> or <code>127.0.0.1</code>.</li>\n<li>If you\'ve navigated to the current page from another page on the same domain.</li>\n</ul>\n<p>This will at least block immediate requests to enable notifications the first time you go a site. You can see the requests which were caught and whitelist them (it will ask again and reload, to be safe). It\'s <a href="https://github.com/adam-lynch/askblocker" rel="noopener">open-source</a>.</p>\n<p>Note: There aren\'t any extensions for other browsers (yet) because they don\'t support the Permissions API.</p>\n<h3><a id="conclusion" class="post-header-anchor" href="#conclusion" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>Conclusion</h3>\n<ul>\n<li>We can learn lessons from mobile development and more.</li>\n<li>Users aren\'t granting permissions requests.</li>\n<li>It\'s no longer possible to dismiss requests in Google Chrome\'s mobile apps.</li>\n<li>We looked at how to improve your permissions UX and increase acceptance rate; the keys are discipline, context, timing, measuring, and trust, among others.</li>\n<li>Browsers, please help.</li>\n<li>Try out <a href="https://adamlynch.com/askblocker" rel="noopener">AskBlocker</a>.</li>\n</ul>\n',summary:"&quot;Welcome to Costco, can I have your phone number?&quot; Most people would refuse, right? Well I suppose some might oblige, but that depends on a host of factors. This is what permissions requests are like on the web. Let's take a look at how we can do better, before it's too late. Side note: a phone number is like a SnapChat username to your parents.\n",photo:"/images/blog-content/improve-permissions-ux/chris-wilson.png",keywords:["ux","permissions","pwa","web","javascript","notifications","geolocation","extension","browsers","development"],published_at:"2018-03-03T00:00:00.000Z",updated_at:"2019-05-22T08:25:53.239Z",year:2018,month:3,day:4,relevanceScore:1.4166666666666665}]}}],error:null,state:{nameToShow:"Adam Lynch",githubAccountUrl:"https://github.com/adam-lynch",siteUrl:"https://adamlynch.com",siteTitle:"Adam Lynch",repositoryUrl:"https://github.com/adam-lynch/adam-lynch.github.io"},serverRendered:!0}</script><script src="/_nuxt/manifest.25595636d53df74f38ab.js" defer></script><script src="/_nuxt/layouts/default.8ce3dde6452dcf1cfcac.js" defer></script><script src="/_nuxt/1.03bda2e583db241630d8.js" defer></script><script src="/_nuxt/vendor.ce05078a33ab89125ee8.js" defer></script><script src="/_nuxt/app.7fd5760da80466c89126.js" defer></script>

    <script src="https://use.typekit.net/tci5xbk.js"></script>
    <script>try{Typekit.load({async:!0})}catch(a){}</script>
    <script>!function(e,a,t,n,c,g,s){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,g=a.createElement("script"),s=a.getElementsByTagName("script")[0],g.async=1,g.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(g,s)}(window,document),ga("create","UA-31546953-1","auto"),ga("send","pageview")</script>
  

